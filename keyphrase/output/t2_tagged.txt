however/RB/however /,/, the/DT/the cost/NN/cost of/IN/of this/DT/this compaction/NN/compaction is/VBZ/is time/NN/time and/CC/and it/PRP/it can/MD/can be/VB/be particularly/RB/particularly severe/JJ/severe for/IN/for large/JJ/large hard/JJ/hard disks/NNS/disks that/WDT/that use/NN/use contiguous/VBZ/contiguous allocation/NN/allocation /,/, where/WRB/where compacting/VBG/compacting all/DT/all the/DT/the space/NN/space 11.4/CD/11.4 473/CD/473 may/MD/may take/VB/take hours/NNS/hours and/CC/and may/MD/may be/VB/be necessary/JJ/necessary on/IN/on a/DT/a weekly/JJ/weekly basis/NNP/basis. some/DT/some systems/NNS/systems require/VBP/require that/IN/that this/DT/this function/NN/function be/VB/be done/VBN/done with/IN/with the/DT/the file/NN/file system/NN/system unmounted/NNP/unmounted. during/IN/during this/DT/this normal/JJ/normal system/NN/system operation/NN/operation generally/RB/generally can/MD/can not/RB/not be/VB/be permitted/VBN/permitted /,/, so/RB/so such/JJ/such compaction/NN/compaction is/VBZ/is avoided/VBN/avoided at/IN/at all/DT/all costs/NNS/costs on/IN/on production/NN/production machines/NNP/machines. most/JJS/most modern/JJ/modern systems/NNS/systems that/WDT/that need/VBP/need defragmentation/NN/defragmentation can/MD/can perform/VB/perform it/PRP/it during/IN/during normal/JJ/normal system/NN/system operations/NNS/operations /,/, but/CC/but the/DT/the performance/NN/performance penalty/NN/penalty can/MD/can be/VB/be substantial/JJ/substantial /./. another/DT/another problem/NN/problem with/IN/with contiguous/JJ/contiguous allocation/NN/allocation is/VBZ/is determining/VBG/determining how/WRB/how much/JJ/much space/NN/space is/VBZ/is needed/VBN/needed for/IN/for a/DT/a file/NNP/file. when/WRB/when the/DT/the file/NN/file is/VBZ/is created/VBN/created /,/, the/DT/the total/JJ/total amount/NN/amount of/IN/of space/NN/space it/PRP/it will/MD/will need/VB/need must/MD/must be/VB/be found/VBN/found and/CC/and allocated/NNP/allocated. how/WRB/how does/VBZ/does the/DT/the creator/NN/creator /:/( program/NN/program or/CC/or person/NN/person /:/) know/NN/know the/DT/the size/NN/size of/IN/of the/DT/the file/NN/file to/TO/to be/VB/be created/VBN/created in/IN/in some/DT/some cases/NNS/cases /,/, this/DT/this detennination/NN/detennination may/MD/may be/VB/be fairly/RB/fairly simple/JJ/simple /NN/( copying/VBG/copying an/DT/an existing/VBG/existing file/NN/file /,/, for/IN/for example/NN/example /:/) ;/:/; in/IN/in general/JJ/general /,/, however/RB/however /,/, the/DT/the size/NN/size of/IN/of an/DT/an output/NN/output file/NN/file may/MD/may be/VB/be difficult/JJ/difficult to/TO/to estimate/VB/estimate /./. if/IN/if we/PRP/we allocate/VBP/allocate too/RB/too little/RB/little space/NN/space to/TO/to a/DT/a file/NN/file /,/, we/PRP/we may/MD/may find/VB/find that/IN/that the/DT/the file/NN/file can/MD/can not/RB/not be/VB/be extended/NNP/extended. especially/RB/especially with/IN/with a/DT/a best-fit/JJ/best-fit allocation/NN/allocation strategy/NN/strategy /,/, the/DT/the space/NN/space on/IN/on both/DT/both sides/NNS/sides of/IN/of the/DT/the file/NN/file may/MD/may be/VB/be in/IN/in use/NNP/use. hence/NN/hence /,/, we/PRP/we can/MD/can not/RB/not make/VB/make the/DT/the file/NN/file larger/NN/larger in/IN/in place/NN/place /./. two/CD/two possibilities/NNS/possibilities then/RB/then exist/NNP/exist. first/RB/first /,/, the/DT/the user/NN/user program/NN/program can/MD/can be/VB/be terminated/VBN/terminated /,/, with/IN/with an/DT/an appropriate/JJ/appropriate error/NN/error message/NNP/message. the/DT/the user/NN/user must/MD/must then/RB/then allocate/VB/allocate more/JJR/more space/NN/space and/CC/and run/VBP/run the/DT/the program/NN/program again/NNP/again. these/DT/these repeated/JJ/repeated runs/NNS/runs may/MD/may be/VB/be costly/NNP/costly. to/TO/to prevent/VB/prevent them/PRP/them /,/, the/DT/the user/NN/user will/MD/will normally/RB/normally overestimate/VB/overestimate the/DT/the amount/NN/amount of/IN/of space/NN/space needed/VBN/needed /,/, resulting/VBG/resulting in/IN/in considerable/JJ/considerable wasted/VBN/wasted space/NNP/space. the/DT/the other/JJ/other possibility/NN/possibility is/VBZ/is to/TO/to find/VB/find a/DT/a larger/JJR/larger hole/NN/hole /,/, copy/NN/copy the/DT/the contents/NNS/contents of/IN/of the/DT/the file/NN/file to/TO/to the/DT/the new/JJ/new space/NN/space /,/, and/CC/and release/VB/release the/DT/the previous/JJ/previous space/NNP/space. this/DT/this series/NN/series of/IN/of actions/NNS/actions can/MD/can be/VB/be repeated/VBN/repeated as/IN/as long/RB/long as/IN/as space/NN/space exists/NNS/exists /,/, although/IN/although it/PRP/it can/MD/can be/VB/be time/NN/time consuming/NNP/consuming. however/RB/however /,/, the/DT/the user/NN/user need/VBP/need never/RB/never be/VB/be informed/VBN/informed explicitly/RB/explicitly about/IN/about what/WP/what is/VBZ/is happening/VBG/happening ;/:/; the/DT/the system/NN/system continues/VBZ/continues despite/IN/despite the/DT/the problem/NN/problem /,/, although/IN/although more/JJR/more and/CC/and more/JJR/more slowly/RB/slowly /./. even/RB/even if/IN/if the/DT/the total/JJ/total amount/NN/amount of/IN/of space/NN/space needed/VBN/needed for/IN/for a/DT/a file/NN/file is/VBZ/is known/VBN/known in/IN/in advance/NN/advance /,/, preallocation/NN/preallocation may/MD/may be/VB/be inefficient/NNP/inefficient. a/DT/a file/NN/file that/WDT/that will/MD/will grow/VB/grow slowly/RB/slowly over/IN/over a/DT/a long/JJ/long period/NN/period /:/( months/NNS/months or/CC/or years/NNS/years /:/) must/MD/must be/VB/be allocated/VBN/allocated enough/JJ/enough space/NN/space for/IN/for its/PRP$/its final/JJ/final size/NN/size /,/, even/RB/even though/IN/though much/RB/much of/IN/of that/DT/that space/NN/space will/MD/will be/VB/be unused/VBN/unused for/IN/for a/DT/a long/JJ/long time/NNP/time. the/DT/the file/NN/file therefore/NN/therefore has/VBZ/has a/DT/a large/JJ/large amount/NN/amount of/IN/of internal/JJ/internal fragmentation/NN/fragmentation /./. to/TO/to minimize/VB/minimize these/DT/these drawbacks/NNS/drawbacks /,/, some/DT/some operating/NN/operating systems/NNS/systems use/VBP/use a/DT/a modified/VBN/modified contiguous-allocation/NN/contiguous-allocation scheme/NNP/scheme. here/RB/here /,/, a/DT/a contiguous/JJ/contiguous chunk/NN/chunk of/IN/of space/NN/space is/VBZ/is allocated/VBN/allocated initially/RB/initially ;/:/; then/RB/then /,/, if/IN/if that/DT/that amount/NN/amount proves/VBZ/proves not/RB/not to/TO/to be/VB/be large/JJ/large enough/RB/enough /,/, another/DT/another chunk/NN/chunk of/IN/of contiguous/JJ/contiguous space/NN/space /,/, known/VBN/known as/IN/as an/DT/an is/VBZ/is added/NNP/added. the/DT/the location/NN/location of/IN/of a/DT/a file/NN/file 's/POS/'s blocks/NNS/blocks is/VBZ/is then/RB/then recorded/VBN/recorded as/IN/as a/DT/a location/NN/location and/CC/and a/DT/a block/NN/block count/NN/count /,/, plus/CC/plus a/DT/a link/NN/link to/TO/to the/DT/the first/JJ/first block/NN/block of/IN/of the/DT/the next/JJ/next extent/NNP/extent. on/IN/on some/DT/some systems/NNS/systems /,/, the/DT/the owner/NN/owner of/IN/of the/DT/the file/NN/file can/MD/can set/VB/set the/DT/the extent/NN/extent size/NN/size /,/, but/CC/but this/DT/this setting/NN/setting results/NNS/results in/IN/in inefficiencies/NNS/inefficiencies if/IN/if the/DT/the owner/NN/owner is/VBZ/is incorrect/NNP/incorrect. internal/JJ/internal fragm.entation/NN/fragm.entation can/MD/can still/RB/still be/VB/be a/DT/a problem/NN/problem if/IN/if the/DT/the extents/NNS/extents are/VBP/are too/RB/too large/JJ/large /,/, and/CC/and external/JJ/external fragmentation/NN/fragmentation can/MD/can become/VB/become a/DT/a problem/NN/problem as/IN/as extents/NNS/extents of/IN/of varying/VBG/varying sizes/NNS/sizes are/VBP/are allocated/VBN/allocated and/CC/and deallocated/NNP/deallocated. the/DT/the commercial/JJ/commercial veritas/NNS/veritas file/IN/file system/NN/system uses/NNS/uses extents/NNS/extents to/TO/to optimize/VB/optimize performance/NNP/performance. it/PRP/it is/VBZ/is a/DT/a high-performance/NN/high-performance replacement/NN/replacement for/IN/for the/DT/the standard/JJ/standard unix/NN/unix ufs/NNS/ufs /./. 11.4.2/CD/11.4.2 linked/VBD/linked allocation/NN/allocation solves/NNS/solves all/DT/all problems/NNS/problems of/IN/of contiguous/JJ/contiguous allocation/NNP/allocation. with/IN/with linked/JJ/linked allocation/NN/allocation /,/, each/DT/each file/NN/file is/VBZ/is a/DT/a linked/VBN/linked list/NN/list of/IN/of disk/NN/disk blocks/NNS/blocks ;/:/; the/DT/the disk/NN/disk blocks/NNS/blocks may/MD/may be/VB/be scattered/VBN/scattered anywhere/RB/anywhere on/IN/on the/DT/the disk/NNP/disk. the/DT/the directory/NN/directory contains/VBZ/contains a/DT/a pointer/NN/pointer to/TO/to the/DT/the first/JJ/first and/CC/and last/JJ/last blocks/NNS/blocks of/IN/of the/DT/the file/NNP/file. for/IN/for example/NN/example /,/, a/DT/a file/NN/file of/IN/of five/CD/five blocks/NNS/blocks might/MD/might start/VB/start at/IN/at block/NN/block 9/CD/9 and/CC/and continue/VB/continue at/IN/at block/NN/block 16/CD/16 /,/, then/RB/then block/VB/block 1/CD/1 /,/, then/RB/then block/VB/block 10/CD/10 /,/, and/CC/and finally/RB/finally block/VB/block 25/CD/25 /CD/( figure/NN/figure 11.6/CD/11.6 /CD/) /./. each/DT/each block/NN/block contains/VBZ/contains a/DT/a pointer/NN/pointer to/TO/to the/DT/the next/JJ/next block/NNP/block. these/DT/these pointers/NNS/pointers 474/CD/474 chapter/NN/chapter 11/CD/11 directory/NN/directory 12/CD/12 16/CD/16 170180190/CD/170180190 20021/CD/20021 ~/CD/~ _20_/NNP/_20_. ~/NNP/~ 23_0-4/CD/23_0-4------------ ~/CD/~ 2402sc.51/CD/2402sc.51 /:/: 260270/CD/260270 280290300310/CD/280290300310 figure/NN/figure i/PRP/i 1.6/CD/1.6 linked/VBD/linked allocation/NN/allocation of/IN/of disk/NN/disk space/NN/space /./. are/VBP/are not/RB/not made/VBN/made available/JJ/available to/TO/to the/DT/the user/NNP/user. thus/RB/thus /,/, if/IN/if each/DT/each block/NN/block is/VBZ/is 512/CD/512 bytes/NNS/bytes in/IN/in size/NN/size /,/, and/CC/and a/DT/a disk/NN/disk address/NN/address /:/( the/DT/the poileter/NN/poileter /:/) requires/NNS/requires 4/CD/4 bytes/NNS/bytes /,/, then/RB/then the/DT/the user/NN/user sees/VBZ/sees blocks/NNS/blocks of/IN/of 508/CD/508 bytes/NNS/bytes /./. to/TO/to create/VB/create a/DT/a new/JJ/new file/NN/file /,/, we/PRP/we simply/RB/simply create/VBP/create a/DT/a new/JJ/new entry/NN/entry ile/NN/ile the/DT/the directory/NNP/directory. with/IN/with linked/JJ/linked allocation/NN/allocation /,/, each/DT/each directory/NN/directory entry/NN/entry has/VBZ/has a/DT/a pointer/NN/pointer to/TO/to the/DT/the first/JJ/first disk/NN/disk block/NN/block of/IN/of the/DT/the file/NNP/file. this/DT/this pointer/NN/pointer is/VBZ/is initialized/VBN/initialized to/TO/to nil/VB/nil /:/( the/DT/the end-of-list/JJ/end-of-list pointer/NN/pointer value/NN/value /:/) to/TO/to signify/VB/signify an/DT/an empty/NN/empty file/NNP/file. the/DT/the size/NN/size field/NN/field is/VBZ/is also/RB/also set/VBN/set to/TO/to 0/CD/0. a/DT/a write/JJ/write to/TO/to the/DT/the file/NN/file causes/NNS/causes the/DT/the free-space/NN/free-space management/NN/management system/NN/system to/TO/to filed/VBN/filed a/DT/a free/JJ/free block/NN/block /,/, and/CC/and this/DT/this new/JJ/new block/NN/block is/VBZ/is written/VBN/written to/TO/to and/CC/and is/VBZ/is linked/VBN/linked to/TO/to the/DT/the end/NN/end of/IN/of the/DT/the file/NNP/file. to/TO/to read/VB/read a/DT/a file/NN/file /,/, we/PRP/we simply/RB/simply read/VB/read blocks/NNS/blocks by/IN/by following/VBG/following the/DT/the pointers/NNS/pointers from/IN/from block/NN/block to/TO/to block/NNP/block. there/RB/there is/VBZ/is no/DT/no external/JJ/external fragmentation/NN/fragmentation with/IN/with linked/JJ/linked allocation/NN/allocation /,/, and/CC/and any/DT/any free/JJ/free block/NN/block on/IN/on the/DT/the free-space/NN/free-space list/NN/list can/MD/can be/VB/be used/VBN/used to/TO/to satisfy/VB/satisfy a/DT/a request/NNP/request. the/DT/the size/NN/size of/IN/of a/DT/a file/NN/file need/NN/need not/RB/not be/VB/be declared/VBN/declared when/WRB/when that/IN/that file/JJ/file is/VBZ/is created/VBN/created /./. a/DT/a file/NN/file can/MD/can continue/VB/continue to/TO/to grow/VB/grow as/IN/as long/RB/long as/IN/as free/JJ/free blocks/NNS/blocks are/VBP/are available/NNP/available. consequently/RB/consequently /,/, it/PRP/it is/VBZ/is never/RB/never necessary/JJ/necessary to/TO/to compact/VB/compact disk/NN/disk space/NN/space /./. linked/VBN/linked allocation/NN/allocation does/VBZ/does have/VB/have disadvantages/NNS/disadvantages /,/, however/NNP/however. the/DT/the major/JJ/major problem/NN/problem is/VBZ/is that/IN/that it/PRP/it can/MD/can be/VB/be used/VBN/used effectively/RB/effectively only/RB/only for/IN/for sequential-access/JJ/sequential-access files/NNP/files. to/TO/to filed/VBD/filed the/DT/the ith/NN/ith block/NN/block of/IN/of a/DT/a file/NN/file /,/, we/PRP/we must/MD/must start/VB/start at/IN/at the/DT/the begirueing/NN/begirueing of/IN/of that/DT/that file/NN/file and/CC/and follow/NN/follow the/DT/the pointers/NNS/pointers rnetil/IN/rnetil we/PRP/we get/VBP/get to/TO/to the/DT/the ith/NN/ith block/NNP/block. each/DT/each access/NN/access to/TO/to a/DT/a pointer/NN/pointer requires/VBZ/requires a/DT/a disk/NN/disk read/NN/read /,/, and/CC/and some/DT/some require/NN/require a/DT/a disk/NN/disk seek/NNP/seek. consequently/RB/consequently /,/, it/PRP/it is/VBZ/is inefficient/JJ/inefficient to/TO/to support/VB/support a/DT/a direct-access/JJ/direct-access capability/NN/capability for/IN/for linked-allocation/NN/linked-allocation files/NNS/files /./. another/DT/another disadvantage/NN/disadvantage is/VBZ/is the/DT/the space/NN/space required/VBN/required for/IN/for the/DT/the pointers/NNP/pointers. if/IN/if a/DT/a pointer/NN/pointer requires/VBZ/requires 4/CD/4 bytes/NNS/bytes out/IN/out of/IN/of a/DT/a 512-byte/JJ/512-byte block/NN/block /,/, then/RB/then 0.78/CD/0.78 percent/NN/percent of/IN/of the/DT/the disk/NN/disk is/VBZ/is being/VBG/being used/VBN/used for/IN/for pointers/NNS/pointers /,/, rather/RB/rather than/IN/than for/IN/for information/NNP/information. each/DT/each file/NN/file requires/VBZ/requires slightly/RB/slightly more/JJR/more space/NN/space than/IN/than it/PRP/it would/MD/would otherwise/VB/otherwise /./. the/DT/the usual/JJ/usual solution/NN/solution to/TO/to this/DT/this problem/NN/problem is/VBZ/is to/TO/to collect/VB/collect blocks/NNS/blocks into/IN/into multiples/NNS/multiples /,/, called/VBN/called and/CC/and to/TO/to allocate/VB/allocate clusters/NNS/clusters rather/RB/rather than/IN/than blocks/NNP/blocks. for/IN/for instance/NN/instance /,/, the/DT/the file/NN/file system/NN/system may/MD/may define/VB/define a/DT/a cluster/NN/cluster as/IN/as four/CD/four blocks/NNS/blocks and/CC/and operate/VB/operate on/IN/on the/DT/the disk/NN/disk only/RB/only in/IN/in cluster/NN/cluster units/NNP/units. pointers/NNS/pointers then/RB/then use/VB/use a/DT/a much/RB/much smaller/JJR/smaller percentage/NN/percentage of/IN/of the/DT/the file/NN/file 's/POS/'s disk/NN/disk space/NN/space /./. this/DT/this method/NN/method allows/VBZ/allows the/DT/the logical-to-physical/JJ/logical-to-physical block/NN/block mapping/VBG/mapping to/TO/to remain/VB/remain simple/JJ/simple 11.4/CD/11.4 475/CD/475 but/CC/but improves/VBZ/improves disk/NN/disk throughput/NN/throughput /:/( because/IN/because fewer/JJR/fewer disk-head/JJ/disk-head seeks/NNS/seeks are/VBP/are required/VBN/required /-NONE-/) and/CC/and decreases/NNS/decreases the/DT/the space/NN/space needed/VBD/needed for/IN/for block/NN/block allocation/NN/allocation and/CC/and free-list/JJ/free-list management/NN/management /./. the/DT/the cost/NN/cost of/IN/of this/DT/this approach/NN/approach is/VBZ/is an/DT/an increase/NN/increase in/IN/in internal/JJ/internal fragmentation/NN/fragmentation /,/, because/IN/because more/JJR/more space/NN/space is/VBZ/is wasted/VBN/wasted when/WRB/when a/DT/a cluster/NN/cluster is/VBZ/is partially/RB/partially full/JJ/full than/IN/than when/WRB/when a/DT/a block/NN/block is/VBZ/is partially/RB/partially full/NNP/full. clusters/NNS/clusters can/MD/can be/VB/be used/VBN/used to/TO/to improve/VB/improve the/DT/the disk-access/JJ/disk-access time/NN/time for/IN/for many/JJ/many other/JJ/other algorithms/NNS/algorithms as/IN/as welt/NN/welt so/IN/so they/PRP/they are/VBP/are used/VBN/used in/IN/in most/JJS/most file/JJ/file systems/NNS/systems /./. yet/RB/yet another/DT/another problem/NN/problem of/IN/of linked/VBN/linked allocation/NN/allocation is/VBZ/is reliability/NNP/reliability. recall/NN/recall that/WDT/that the/DT/the files/NNS/files are/VBP/are linked/VBN/linked together/RB/together by/IN/by pointers/NNS/pointers scattered/VBN/scattered all/DT/all over/IN/over the/DT/the disk/NN/disk /,/, and/CC/and consider/NN/consider what/WP/what would/MD/would happen/VB/happen if/IN/if a/DT/a pointer/NN/pointer were/VBD/were lost/VBN/lost or/CC/or damaged/NNP/damaged. a/DT/a bug/NN/bug in/IN/in the/DT/the operating-system/JJ/operating-system software/NN/software or/CC/or a/DT/a disk/NN/disk hardware/NN/hardware failure/NN/failure might/MD/might result/VB/result in/IN/in picking/NN/picking up/IN/up the/DT/the wrong/JJ/wrong pointer/NNP/pointer. this/DT/this error/NN/error could/MD/could in/IN/in turn/NN/turn result/NN/result in/IN/in linking/NN/linking into/IN/into the/DT/the free-space/JJ/free-space list/NN/list or/CC/or into/IN/into another/DT/another file/NNP/file. one/CD/one partial/JJ/partial solution/NN/solution is/VBZ/is to/TO/to use/VB/use doubly/RB/doubly linked/VBN/linked lists/NNS/lists /,/, and/CC/and another/DT/another is/VBZ/is to/TO/to store/VB/store the/DT/the file/NN/file name/NN/name and/CC/and relative/JJ/relative block/NN/block number/NN/number in/IN/in each/DT/each block/NN/block ;/:/; however/RB/however /,/, these/DT/these schemes/NNS/schemes require/VBP/require even/RB/even more/RBR/more overhead/JJ/overhead for/IN/for each/DT/each file/NN/file /./. an/DT/an important/JJ/important variation/NN/variation on/IN/on linked/VBN/linked allocation/NN/allocation is/VBZ/is the/DT/the use/NN/use of/IN/of a/DT/a /NN/( fat/NN/fat !/./! /./. this/DT/this simple/NN/simple but/CC/but efficient/NN/efficient method/NN/method of/IN/of disk-space/NN/disk-space allocation/NN/allocation is/VBZ/is used/VBN/used by/IN/by the/DT/the ms-dos/NNP/ms-dos and/CC/and os/2/-NONE-/os/2 operating/VBG/operating systems/NNP/systems. a/DT/a section/NN/section of/IN/of disk/NN/disk at/IN/at the/DT/the beginning/NN/beginning of/IN/of each/DT/each volume/NN/volume is/VBZ/is set/VBN/set aside/NN/aside to/TO/to contain/VB/contain the/DT/the table/NNP/table. the/DT/the table/NN/table has/VBZ/has one/CD/one entry/NN/entry for/IN/for each/DT/each disk/NN/disk block/NN/block and/CC/and is/VBZ/is indexed/VBN/indexed by/IN/by block/NN/block number/NNP/number. the/DT/the fat/JJ/fat is/VBZ/is used/VBN/used in/IN/in much/JJ/much the/DT/the same/JJ/same way/NN/way as/IN/as a/DT/a linked/VBN/linked list/NNP/list. the/DT/the directory/NN/directory entry/NN/entry contains/VBZ/contains the/DT/the block/NN/block number/NN/number of/IN/of the/DT/the first/JJ/first block/NN/block of/IN/of the/DT/the file/NNP/file. the/DT/the table/NN/table entry/NN/entry indexed/VBD/indexed by/IN/by that/DT/that block/NN/block number/NN/number contains/VBZ/contains the/DT/the block/NN/block number/NN/number of/IN/of the/DT/the next/JJ/next block/NN/block in/IN/in the/DT/the file/NNP/file. this/DT/this chain/NN/chain continues/VBZ/continues until/IN/until it/PRP/it reaches/VBZ/reaches the/DT/the last/JJ/last block/NN/block /,/, which/WDT/which has/VBZ/has a/DT/a special/JJ/special end-of-file/JJ/end-of-file value/NN/value as/IN/as the/DT/the table/NN/table entry/NN/entry /./. an/DT/an unused/VBN/unused block/NN/block is/VBZ/is indicated/VBN/indicated by/IN/by a/DT/a table/JJ/table value/NN/value of/IN/of 0/CD/0. allocating/VBG/allocating a/DT/a new/JJ/new block/NN/block to/TO/to a/DT/a file/NN/file is/VBZ/is a/DT/a simple/JJ/simple matter/NN/matter of/IN/of finding/NN/finding the/DT/the first/JJ/first 0-valued/CD/0-valued table/NN/table entry/NN/entry and/CC/and replacing/VBG/replacing the/DT/the previous/JJ/previous end-of-file/JJ/end-of-file value/NN/value with/IN/with the/DT/the address/NN/address of/IN/of the/DT/the new/JJ/new block/NNP/block. the/DT/the 0/-NONE-/0 is/VBZ/is then/RB/then replaced/VBN/replaced with/IN/with the/DT/the end-of-file/JJ/end-of-file value/NNP/value. an/DT/an illustrative/JJ/illustrative example/NN/example is/VBZ/is the/DT/the fat/JJ/fat structure/NN/structure shown/NN/shown in/IN/in figure/NN/figure 11.7/CD/11.7 for/IN/for a/DT/a file/NN/file consisting/VBG/consisting of/IN/of disk/NN/disk blocks/NNS/blocks 217/CD/217 /,/, 618/CD/618 /,/, and/CC/and 339/CD/339 /./. directory/NN/directory entry/NN/entry name/NN/name start/NN/start block/NN/block 0/-NONE-/0 217/CD/217 618/CD/618 339/CD/339 /:/- 618/CD/618 339/CD/339 number/NN/number of/IN/of disk/NN/disk blocks/NNS/blocks -1/-NONE-/-1 fat/JJ/fat figure/NN/figure 11.7/CD/11.7 file-allocation/NN/file-allocation table/JJ/table /./. 476/CD/476 chapter/NN/chapter 11/CD/11 the/DT/the fat/JJ/fat allocation/NN/allocation scheme/NN/scheme can/MD/can result/VB/result in/IN/in a/DT/a significant/JJ/significant number/NN/number of/IN/of disk/NN/disk head/NN/head seeks/VBZ/seeks /,/, unless/IN/unless the/DT/the fat/JJ/fat is/VBZ/is cached/NNP/cached. the/DT/the disk/NN/disk head/NN/head must/MD/must move/VB/move to/TO/to the/DT/the start/NN/start of/IN/of the/DT/the volume/NN/volume to/TO/to read/VB/read the/DT/the fat/JJ/fat and/CC/and find/NN/find the/DT/the location/NN/location of/IN/of the/DT/the block/NN/block in/IN/in question/NN/question /,/, then/RB/then move/VB/move to/TO/to the/DT/the location/NN/location of/IN/of the/DT/the block/NN/block itself/NNP/itself. in/IN/in the/DT/the worst/JJS/worst case/NN/case /,/, both/DT/both moves/NNS/moves occur/VBP/occur for/IN/for each/DT/each of/IN/of the/DT/the blocks/NNP/blocks. a/DT/a benefit/NN/benefit is/VBZ/is that/IN/that random-access/JJ/random-access time/NN/time is/VBZ/is improved/VBN/improved /,/, because/IN/because the/DT/the disk/NN/disk head/NN/head can/MD/can find/VB/find the/DT/the location/NN/location of/IN/of any/DT/any block/NN/block by/IN/by reading/NN/reading the/DT/the information/NN/information in/IN/in the/DT/the fat/JJ/fat /./. 11.4.3/CD/11.4.3 indexed/VBD/indexed allocation/NN/allocation linked/VBN/linked allocation/NN/allocation solves/NNS/solves the/DT/the external-fragmentation/NN/external-fragmentation and/CC/and size-declaration/NN/size-declaration problems/NNS/problems of/IN/of contiguous/JJ/contiguous allocation/NNP/allocation. however/RB/however /,/, in/IN/in the/DT/the absence/NN/absence of/IN/of a/DT/a fat/JJ/fat /,/, linked/VBN/linked allocation/NN/allocation can/MD/can not/RB/not support/VB/support efficient/JJ/efficient direct/JJ/direct access/NN/access /,/, since/IN/since the/DT/the pointers/NNS/pointers to/TO/to the/DT/the blocks/NNS/blocks are/VBP/are scattered/VBN/scattered with/IN/with the/DT/the blocks/NNS/blocks themselves/PRP/themselves all/DT/all over/IN/over the/DT/the disk/NN/disk and/CC/and must/MD/must be/VB/be retrieved/VBN/retrieved in/IN/in order/NNP/order. solves/NNS/solves this/DT/this problem/NN/problem by/IN/by bringil1.g/JJ/bringil1.g all/DT/all the/DT/the pointers/NNS/pointers together/RB/together into/IN/into one/CD/one location/NN/location /:/: the/DT/the blo/NN/blo ;/:/; ct/NN/ct /:/: /./. each/DT/each file/NN/file has/VBZ/has its/PRP$/its own/JJ/own index/NN/index block/NN/block /,/, which/WDT/which is/VBZ/is an/DT/an array/NN/array of/IN/of disk-block/JJ/disk-block addresses/NNS/addresses /./. the/DT/the i/PRP/i th/VBP/th entry/NN/entry in/IN/in the/DT/the index/NN/index block/NN/block points/NNS/points to/TO/to the/DT/the i/PRP/i 111/CD/111 block/NN/block of/IN/of the/DT/the file/NNP/file. the/DT/the directory/NN/directory contains/VBZ/contains the/DT/the address/NN/address of/IN/of the/DT/the index/NN/index block/NN/block /:/( figure/NN/figure 11.8/CD/11.8 /CD/) /./. to/TO/to find/VB/find and/CC/and read/VB/read the/DT/the i/PRP/i 1jz/CD/1jz block/NN/block /,/, we/PRP/we use/VBP/use the/DT/the pointer/NN/pointer in/IN/in the/DT/the i/NN/i 1lz/CD/1lz index-block/JJ/index-block entry/NNP/entry. this/DT/this scheme/NN/scheme is/VBZ/is similar/JJ/similar to/TO/to the/DT/the paging/NN/paging scheme/NN/scheme described/VBD/described il1/NNP/il1. section/NN/section 8.4/CD/8.4 /./. when/WRB/when the/DT/the file/NN/file is/VBZ/is created/VBN/created /,/, all/DT/all pointers/NNS/pointers in/IN/in the/DT/the index/NN/index block/NN/block are/VBP/are set/VBN/set to/TO/to nil/NNP/nil. when/WRB/when the/DT/the ith/NN/ith block/NN/block is/VBZ/is first/JJ/first written/VBN/written /,/, a/DT/a block/NN/block is/VBZ/is obtained/VBN/obtained from/IN/from the/DT/the free-space/NN/free-space manage1/NNP/manage1 ~/NNP/~ and/CC/and its/PRP$/its address/NN/address is/VBZ/is put/VBN/put in/RP/in the/DT/the ith/NN/ith index-block/NN/index-block entry/NN/entry /./. indexed/VBN/indexed allocation/NN/allocation supports/NNS/supports direct/JJ/direct access/NN/access /,/, without/IN/without suffering/NN/suffering from/IN/from external/JJ/external fragmentation/NN/fragmentation /,/, because/IN/because any/DT/any free/JJ/free block/NN/block on/IN/on the/DT/the disk/NN/disk can/MD/can satisfy/VB/satisfy a/DT/a request/NN/request for/IN/for more/JJR/more space/NNP/space. indexed/VBD/indexed allocation/NN/allocation does/VBZ/does suffer/NN/suffer from/IN/from wasted/VBN/wasted space/NN/space /,/, however/NNP/however. the/DT/the pointer/NN/pointer overhead/NN/overhead of/IN/of the/DT/the index/NN/index block/NN/block is/VBZ/is generally/RB/generally greater/JJR/greater than/IN/than the/DT/the pointer/NN/pointer overhead/NN/overhead of/IN/of linked/VBN/linked allocation/NNP/allocation. consider/NN/consider a/DT/a common/JJ/common case/NN/case in/IN/in which/WDT/which we/PRP/we have/VBP/have a/DT/a file/NN/file of/IN/of only/RB/only one/CD/one or/CC/or two/CD/two blocks/NNP/blocks. with/IN/with linked/JJ/linked allocation/NN/allocation /,/, we/PRP/we lose/VBP/lose the/DT/the space/NN/space of/IN/of only/RB/only one/CD/one pointer/NN/pointer per/IN/per directory/NN/directory file/NN/file jeep/NN/jeep 16/CD/16 figure/NN/figure 11.8/CD/11.8 indexed/VBN/indexed allocation/NN/allocation of/IN/of disk/NN/disk space/NN/space /./. 11.4/CD/11.4 allocation/NN/allocation methods/NNS/methods 477/CD/477 block/NNP/block. with/IN/with indexed/VBN/indexed allocation/NN/allocation /,/, an/DT/an entire/JJ/entire index/NN/index block/NN/block must/MD/must be/VB/be allocated/VBN/allocated /,/, even/RB/even if/IN/if only/RB/only one/CD/one or/CC/or two/CD/two pointers/NNS/pointers will/MD/will be/VB/be non-nil/JJ/non-nil /./. this/DT/this point/NN/point raises/VBZ/raises the/DT/the question/NN/question of/IN/of how/WRB/how large/JJ/large the/DT/the index/NN/index block/NN/block should/MD/should be/NNP/be. every/DT/every file/NN/file must/MD/must have/VB/have an/DT/an index/NN/index block/NN/block /,/, so/RB/so we/PRP/we want/VBP/want the/DT/the index/NN/index block/NN/block to/TO/to be/VB/be as/RB/as small/JJ/small as/IN/as possible/NNP/possible. if/IN/if the/DT/the index/NN/index block/NN/block is/VBZ/is too/RB/too small/JJ/small /,/, however/RB/however /,/, it/PRP/it will/MD/will not/RB/not be/VB/be able/JJ/able to/TO/to hold/VB/hold enough/JJ/enough pointers/NNS/pointers for/IN/for a/DT/a large/JJ/large file/NN/file /,/, and/CC/and a/DT/a mechanism/NN/mechanism will/MD/will have/VB/have to/TO/to be/VB/be available/JJ/available to/TO/to deal/NN/deal with/IN/with this/DT/this issue/NNP/issue. mechanisms/VBZ/mechanisms for/IN/for this/DT/this purpose/NN/purpose include/VBP/include the/DT/the following/VBG/following /:/: c/NN/c linked/VBD/linked scheme/NNP/scheme. an/DT/an index/NN/index block/NN/block is/VBZ/is normally/RB/normally one/CD/one disk/NN/disk block/NNP/block. thus/RB/thus /,/, it/PRP/it can/MD/can be/VB/be read/VBN/read and/CC/and written/VBN/written directly/RB/directly by/IN/by itself/NNP/itself. to/TO/to allow/VB/allow for/IN/for large/JJ/large files/NNS/files /,/, we/PRP/we can/MD/can link/VB/link together/RP/together several/JJ/several index/NN/index blocks/NNP/blocks. for/IN/for example/NN/example /,/, an/DT/an index/NN/index block/NN/block might/MD/might contain/VB/contain a/DT/a small/JJ/small header/NN/header giving/VBG/giving the/DT/the name/NN/name of/IN/of the/DT/the file/NN/file and/CC/and a/DT/a set/NN/set of/IN/of the/DT/the first/JJ/first 100/CD/100 disk-block/NN/disk-block addresses/NNP/addresses. the/DT/the next/JJ/next address/NN/address /:/( the/DT/the last/JJ/last word/NN/word in/IN/in the/DT/the index/NN/index block/NN/block /:/) is/VBZ/is nil/NN/nil /:/( for/IN/for a/DT/a small/JJ/small file/NN/file /:/) or/CC/or is/VBZ/is a/DT/a pointer/NN/pointer to/TO/to another/DT/another index/NN/index block/NN/block /:/( for/IN/for a/DT/a large/JJ/large file/NN/file /:/) /./. multilevel/NN/multilevel index/NNP/index. a/DT/a variant/NN/variant of/IN/of linked/VBN/linked representation/NN/representation uses/NNS/uses a/DT/a first-level/JJ/first-level index/NN/index block/NN/block to/TO/to point/NN/point to/TO/to a/DT/a set/NN/set of/IN/of second-level/JJ/second-level index/NN/index blocks/NNS/blocks /,/, which/WDT/which in/IN/in tum/NN/tum point/NN/point to/TO/to the/DT/the file/NN/file blocks/NNP/blocks. to/TO/to access/NN/access a/DT/a block/NN/block /,/, the/DT/the operating/NN/operating system/NN/system uses/NNS/uses the/DT/the first-level/JJ/first-level index/NN/index to/TO/to find/VB/find a/DT/a second-level/JJ/second-level index/NN/index block/NN/block and/CC/and then/RB/then uses/VBZ/uses that/IN/that block/NN/block to/TO/to find/VB/find the/DT/the desired/VBN/desired data/NNS/data block/NNP/block. this/DT/this approach/NN/approach could/MD/could be/VB/be continued/VBN/continued to/TO/to a/DT/a third/JJ/third or/CC/or fourth/JJ/fourth level/NN/level /,/, depending/VBG/depending on/IN/on the/DT/the desired/VBN/desired maximum/NN/maximum file/NN/file size/NNP/size. with/IN/with 4,096-byte/JJ/4,096-byte blocks/NNS/blocks /,/, we/PRP/we could/MD/could store/VB/store 1,024/CD/1,024 four-byte/JJ/four-byte pointers/NNS/pointers in/IN/in an/DT/an index/NN/index block/NNP/block. two/CD/two levels/NNS/levels of/IN/of indexes/NNS/indexes allow/VBP/allow 1,048,576/CD/1,048,576 data/NNS/data blocks/NNS/blocks and/CC/and a/DT/a file/NN/file size/NN/size of/IN/of up/IN/up to/TO/to 4gb/CD/4gb /./. combined/VBN/combined scheme/NNP/scheme. another/DT/another alternative/NN/alternative /,/, used/VBN/used in/IN/in the/DT/the ufs/NNS/ufs /,/, is/VBZ/is to/TO/to keep/VB/keep the/DT/the first/JJ/first /,/, say/VBP/say /,/, 15/CD/15 pointers/NNS/pointers of/IN/of the/DT/the index/NN/index block/NN/block in/IN/in the/DT/the file/NN/file 's/POS/'s inode/NNP/inode. the/DT/the first/JJ/first 12/CD/12 of/IN/of these/DT/these pointers/NNS/pointers point/VBP/point to/TO/to direct/VB/direct blocks/NNS/blocks ;/:/; that/DT/that is/VBZ/is /,/, they/PRP/they contain/VBP/contain addresses/NNS/addresses of/IN/of blocks/NNS/blocks that/WDT/that contain/NN/contain data/NNS/data of/IN/of the/DT/the file/NNP/file. thus/RB/thus /,/, the/DT/the data/NNS/data for/IN/for small/JJ/small files/NNS/files /:/( of/IN/of no/DT/no more/RBR/more than/IN/than 12/CD/12 blocks/NNS/blocks /:/) do/VBP/do not/RB/not need/VB/need a/DT/a separate/JJ/separate index/NN/index block/NNP/block. if/IN/if the/DT/the block/NN/block size/NN/size is/VBZ/is 4/CD/4 kb/NN/kb /,/, then/RB/then up/RB/up to/TO/to 48/CD/48 kb/NN/kb of/IN/of data/NNS/data can/MD/can be/VB/be accessed/VBN/accessed directly/-NONE-/directly. the/DT/the next/JJ/next three/CD/three pointers/NNS/pointers point/NN/point to/TO/to indirect/VB/indirect blocks/NNP/blocks. the/DT/the first/JJ/first points/NNS/points to/TO/to a/DT/a single/JJ/single indirect/NN/indirect block/NN/block /,/, which/WDT/which is/VBZ/is an/DT/an index/NN/index block/NN/block containing/VBG/containing not/RB/not data/NNS/data but/CC/but the/DT/the addresses/NNS/addresses of/IN/of blocks/NNS/blocks that/WDT/that do/VBP/do contain/VBP/contain data/NNP/data. the/DT/the second/JJ/second points/NNS/points to/TO/to a/DT/a double/JJ/double indirect/NN/indirect block/NN/block /,/, which/WDT/which contains/VBZ/contains the/DT/the address/NN/address of/IN/of a/DT/a block/NN/block that/WDT/that contains/VBZ/contains the/DT/the addresses/NNS/addresses of/IN/of blocks/NNS/blocks that/WDT/that contain/NN/contain pointers/NNS/pointers to/TO/to the/DT/the actual/JJ/actual data/NNS/data blocks/NNP/blocks. the/DT/the last/JJ/last pointer/NN/pointer contains/VBZ/contains the/DT/the address/NN/address of/IN/of a/DT/a triple/NN/triple indirect/NN/indirect block/NNP/block. under/IN/under this/DT/this method/NN/method /,/, the/DT/the number/NN/number of/IN/of blocks/NNS/blocks that/WDT/that can/MD/can be/VB/be allocated/VBN/allocated to/TO/to a/DT/a file/NN/file exceeds/VBZ/exceeds the/DT/the amount/NN/amount of/IN/of space/NN/space addressable/JJ/addressable by/IN/by the/DT/the four-byte/JJ/four-byte file/NN/file pointers/NNS/pointers used/VBN/used by/IN/by many/JJ/many operating/VBG/operating systems/NNP/systems. a/DT/a 32-bit/JJ/32-bit file/NN/file pointer/NN/pointer reaches/NNS/reaches only/RB/only 232/CD/232 bytes/NNS/bytes /,/, or/CC/or 4gb/CD/4gb. many/JJ/many unix/CD/unix implementations/NNS/implementations /,/, including/VBG/including solaris/NNS/solaris and/CC/and ibm/NN/ibm 's/POS/'s aix/NN/aix /,/, now/RB/now support/NN/support up/RP/up to/TO/to 64-bit/CD/64-bit file/NN/file pointers/NNP/pointers. pointers/NNS/pointers of/IN/of this/DT/this size/NN/size allow/VBP/allow files/NNS/files and/CC/and file/JJ/file systems/NNS/systems to/TO/to be/VB/be terabytes/NNS/terabytes in/IN/in size/NNP/size. a/DT/a unix/NN/unix inode/NN/inode is/VBZ/is shown/VBN/shown in/IN/in figure/NN/figure 11.9/CD/11.9 /./. indexed-allocation/NN/indexed-allocation schemes/NNS/schemes suffer/VBP/suffer from/IN/from some/DT/some of/IN/of the/DT/the same/JJ/same performance/NN/performance problems/NNS/problems as/IN/as does/VBZ/does linked/VBN/linked allocation/NNP/allocation. specifically/RB/specifically /,/, the/DT/the index/NN/index blocks/NNS/blocks can/MD/can be/VB/be cached/VBN/cached in/IN/in memory/NN/memory /,/, but/CC/but the/DT/the data/NNS/data blocks/VBZ/blocks may/MD/may be/VB/be spread/VBN/spread all/DT/all over/IN/over a/DT/a volume/NN/volume /./. 11.4.4/CD/11.4.4 performance/NN/performance the/DT/the allocation/NN/allocation methods/NNS/methods that/WDT/that we/PRP/we have/VBP/have discussed/VBN/discussed vary/JJ/vary in/IN/in their/PRP$/their storage/NN/storage efficiency/NN/efficiency and/CC/and data-block/JJ/data-block access/NN/access times/NNP/times. both/DT/both are/VBP/are important/JJ/important criteria/NNS/criteria in/IN/in selecting/VBG/selecting the/DT/the proper/NN/proper method/NN/method or/CC/or methods/NNS/methods for/IN/for an/DT/an operating/NN/operating system/NN/system to/TO/to implement/VB/implement /./. 478/CD/478 chapter/NN/chapter 11/CD/11 implementing/VBG/implementing file/JJ/file systems/NNS/systems figure/NN/figure 11.9/CD/11.9 the/DT/the unix/NN/unix inode/NN/inode /./. before/IN/before selecting/VBG/selecting an/DT/an allocation/NN/allocation method/NN/method /,/, we/PRP/we need/VBP/need to/TO/to determine/VB/determine how/WRB/how the/DT/the systems/NNS/systems will/MD/will be/VB/be used/NNP/used. a/DT/a system/NN/system with/IN/with mostly/RB/mostly sequential/JJ/sequential access/NN/access should/MD/should not/RB/not use/VB/use the/DT/the same/JJ/same method/NN/method as/IN/as a/DT/a system/NN/system with/IN/with mostly/RB/mostly random/IN/random access/NN/access /./. for/IN/for any/DT/any type/NN/type of/IN/of access/NN/access /,/, contiguous/JJ/contiguous allocation/NN/allocation requires/VBZ/requires only/RB/only one/CD/one access/NN/access to/TO/to get/VB/get a/DT/a disk/NN/disk block/NNP/block. since/IN/since we/PRP/we can/MD/can easily/RB/easily keep/VB/keep the/DT/the initial/JJ/initial address/NN/address of/IN/of the/DT/the file/NN/file in/IN/in memory/NN/memory /,/, we/PRP/we can/MD/can calculate/VB/calculate immediately/RB/immediately the/DT/the disk/NN/disk address/NN/address of/IN/of the/DT/the ith/NN/ith block/NN/block /:/( or/CC/or the/DT/the next/JJ/next block/NN/block /:/) and/CC/and read/VB/read it/PRP/it directly/RB/directly /./. for/IN/for linked/VBN/linked allocation/NN/allocation /,/, we/PRP/we can/MD/can also/RB/also keep/VB/keep the/DT/the address/NN/address of/IN/of the/DT/the next/JJ/next block/NN/block in/IN/in memory/NN/memory and/CC/and read/VB/read it/PRP/it directly/NNP/directly. this/DT/this method/NN/method is/VBZ/is fine/NN/fine for/IN/for sequential/JJ/sequential access/NN/access ;/:/; for/IN/for direct/JJ/direct access/NN/access /,/, however/RB/however /,/, an/DT/an access/NN/access to/TO/to the/DT/the ith/NN/ith block/NN/block might/MD/might require/VB/require i/PRP/i disk/VB/disk reads/NNP/reads. this/DT/this problem/NN/problem indicates/VBZ/indicates why/WRB/why linked/VBN/linked allocation/NN/allocation should/MD/should not/RB/not be/VB/be used/VBN/used for/IN/for an/DT/an application/NN/application requiring/VBG/requiring direct/JJ/direct access/NN/access /./. as/IN/as a/DT/a result/NN/result /,/, some/DT/some systems/NNS/systems support/NN/support direct-access/NN/direct-access files/NNS/files by/IN/by using/VBG/using contiguous/JJ/contiguous allocation/NN/allocation and/CC/and sequential-access/JJ/sequential-access files/NNS/files by/IN/by using/VBG/using linked/VBN/linked allocation/NNP/allocation. for/IN/for these/DT/these systems/NNS/systems /,/, the/DT/the type/NN/type of/IN/of access/NN/access to/TO/to be/VB/be made/VBN/made must/MD/must be/VB/be declared/VBN/declared when/WRB/when the/DT/the file/NN/file is/VBZ/is created/NNP/created. a/DT/a file/NN/file created/VBN/created for/IN/for sequential/JJ/sequential access/NN/access will/MD/will be/VB/be linked/VBN/linked and/CC/and can/MD/can not/RB/not be/VB/be used/VBN/used for/IN/for direct/JJ/direct access/NNP/access. a/DT/a file/NN/file created/VBN/created for/IN/for direct/JJ/direct access/NN/access will/MD/will be/VB/be contiguous/JJ/contiguous and/CC/and can/MD/can support/VB/support both/DT/both direct/JJ/direct access/NN/access and/CC/and sequential/JJ/sequential access/NN/access /,/, but/CC/but its/PRP$/its maximum/NN/maximum length/NN/length must/MD/must be/VB/be declared/VBN/declared when/WRB/when it/PRP/it is/VBZ/is created/NNP/created. in/IN/in this/DT/this case/NN/case /,/, the/DT/the operating/NN/operating system/NN/system must/MD/must have/VB/have appropriate/JJ/appropriate data/NNS/data structures/NNS/structures and/CC/and algorithms/NNS/algorithms to/TO/to support/VB/support both/DT/both allocation/NN/allocation methods/NNS/methods /./. files/NNS/files can/MD/can be/VB/be converted/VBN/converted from/IN/from one/CD/one type/NN/type to/TO/to another/DT/another by/IN/by the/DT/the creation/NN/creation of/IN/of a/DT/a new/JJ/new file/NN/file of/IN/of the/DT/the desired/VBN/desired type/NN/type /,/, into/IN/into which/WDT/which the/DT/the contents/NNS/contents of/IN/of the/DT/the old/JJ/old file/NN/file are/VBP/are copied/NNP/copied. the/DT/the old/JJ/old file/NN/file may/MD/may then/RB/then be/VB/be deleted/VBN/deleted and/CC/and the/DT/the new/JJ/new file/NN/file renamed/VBN/renamed /./. indexed/VBN/indexed allocation/NN/allocation is/VBZ/is more/RBR/more complex/NNP/complex. if/IN/if the/DT/the index/NN/index block/NN/block is/VBZ/is already/RB/already in/IN/in memory/NN/memory /,/, then/RB/then the/DT/the access/NN/access can/MD/can be/VB/be made/VBN/made directly/-NONE-/directly. however/RB/however /,/, keeping/VBG/keeping the/DT/the index/NN/index block/NN/block in/IN/in memory/NN/memory requires/VBZ/requires considerable/JJ/considerable space/NNP/space. if/IN/if this/DT/this memory/NN/memory space/NN/space is/VBZ/is not/RB/not available/JJ/available /,/, then/RB/then we/PRP/we may/MD/may have/VB/have to/TO/to read/VB/read first/RB/first the/DT/the index/NN/index block/NN/block and/CC/and then/RB/then the/DT/the desired/VBN/desired data/NNS/data block/NNP/block. for/IN/for a/DT/a two-level/JJ/two-level index/NN/index /,/, two/CD/two index-block/JJ/index-block reads/NNS/reads might/MD/might be/VB/be necessary/NNP/necessary. for/IN/for an/DT/an 11.5/CD/11.5 11.5/CD/11.5 479/CD/479 extremely/RB/extremely large/JJ/large file/NN/file /,/, accessing/VBG/accessing a/DT/a block/NN/block near/IN/near the/DT/the end/NN/end of/IN/of the/DT/the file/NN/file would/MD/would require/VB/require reading/NN/reading in/IN/in all/DT/all the/DT/the index/NN/index blocks/NNS/blocks before/IN/before the/DT/the needed/VBN/needed data/NNS/data block/VBP/block finally/RB/finally could/MD/could be/VB/be read/NNP/read. thus/RB/thus /,/, the/DT/the performance/NN/performance of/IN/of indexed/VBN/indexed allocation/NN/allocation depends/NNS/depends on/IN/on the/DT/the index/NN/index structure/NN/structure /,/, on/IN/on the/DT/the size/NN/size of/IN/of the/DT/the file/NN/file /,/, and/CC/and on/IN/on the/DT/the position/NN/position of/IN/of the/DT/the block/NN/block desired/VBD/desired /./. some/DT/some systems/NNS/systems combine/VBP/combine contiguous/JJ/contiguous allocation/NN/allocation with/IN/with indexed/VBN/indexed allocation/NN/allocation by/IN/by using/VBG/using contiguous/JJ/contiguous allocation/NN/allocation for/IN/for small/JJ/small files/NNS/files /:/( up/IN/up to/TO/to three/CD/three or/CC/or four/CD/four blocks/NNS/blocks /:/) and/CC/and automatically/RB/automatically switching/VBG/switching to/TO/to an/DT/an indexed/VBN/indexed allocation/NN/allocation if/IN/if the/DT/the file/NN/file grows/VBZ/grows large/NNP/large. since/IN/since most/JJS/most files/NNS/files are/VBP/are small/JJ/small /,/, and/CC/and contiguous/JJ/contiguous allocation/NN/allocation is/VBZ/is efficient/JJ/efficient for/IN/for small/JJ/small files/NNS/files /,/, average/JJ/average performance/NN/performance can/MD/can be/VB/be quite/RB/quite good/JJ/good /./. for/IN/for instance/NN/instance /,/, the/DT/the version/NN/version of/IN/of the/DT/the unix/NN/unix operating/NN/operating system/NN/system from/IN/from sun/NN/sun microsystems/NNS/microsystems was/VBD/was changed/VBN/changed in/IN/in 1991/CD/1991 to/TO/to improve/VB/improve performance/NN/performance in/IN/in the/DT/the file-system/JJ/file-system allocation/NN/allocation algorithm/NNP/algorithm. the/DT/the performance/NN/performance measurements/NNS/measurements indicated/VBD/indicated that/IN/that the/DT/the maximum/NN/maximum disk/NN/disk throughput/NN/throughput on/IN/on a/DT/a typical/JJ/typical workstation/NN/workstation /:/( a/DT/a 12-mips/CD/12-mips sparcstation1/NNP/sparcstation1 /NNP/) took/VBD/took 50/CD/50 percent/NN/percent of/IN/of the/DT/the cpu/NN/cpu and/CC/and produced/VBN/produced a/DT/a disk/NN/disk bandwidth/NN/bandwidth of/IN/of only/RB/only 1.5/CD/1.5 me/PRP/me per/IN/per second/NNP/second. to/TO/to improve/VB/improve performance/NN/performance /,/, sun/NN/sun made/VBD/made changes/NNS/changes to/TO/to allocate/VB/allocate space/NN/space in/IN/in clusters/NNS/clusters of/IN/of 56/CD/56 kb/NN/kb whenever/NN/whenever possible/JJ/possible /NN/( 56/CD/56 kb/NN/kb was/VBD/was the/DT/the maximum/NN/maximum size/NN/size of/IN/of a/DT/a dma/NN/dma transfer/NN/transfer on/IN/on sun/NN/sun systems/NNS/systems at/IN/at that/DT/that time/NN/time /:/) /./. this/DT/this allocation/NN/allocation reduced/VBD/reduced external/JJ/external fragmentation/NN/fragmentation /,/, and/CC/and thus/RB/thus seek/VB/seek and/CC/and latency/NN/latency times/NNP/times. in/IN/in addition/NN/addition /,/, the/DT/the disk-reading/JJ/disk-reading routines/NNS/routines were/VBD/were optimized/VBN/optimized to/TO/to read/VB/read in/IN/in these/DT/these large/JJ/large clusters/NNP/clusters. the/DT/the inode/NN/inode structure/NN/structure was/VBD/was left/VBN/left unchanged/NNP/unchanged. as/IN/as a/DT/a result/NN/result of/IN/of these/DT/these changes/NNS/changes /,/, plus/CC/plus the/DT/the use/NN/use of/IN/of read-ahead/JJ/read-ahead and/CC/and free-behind/JJ/free-behind /NN/( discussed/VBD/discussed in/IN/in section/NN/section 11.6.2/CD/11.6.2 /CD/) /,/, 25/CD/25 percent/NN/percent less/RBR/less cpu/NN/cpu was/VBD/was used/VBN/used /,/, and/CC/and throughput/VBD/throughput substantially/RB/substantially improved/VBN/improved /./. many/JJ/many other/JJ/other optimizations/NNS/optimizations are/VBP/are in/IN/in use/NNP/use. given/VBN/given the/DT/the disparity/NN/disparity between/IN/between cpu/NN/cpu speed/NN/speed and/CC/and disk/NN/disk speed/NN/speed /,/, it/PRP/it is/VBZ/is not/RB/not unreasonable/JJ/unreasonable to/TO/to add/VB/add thousands/NNS/thousands of/IN/of extra/JJ/extra instructions/NNS/instructions to/TO/to the/DT/the operating/NN/operating system/NN/system to/TO/to save/VB/save just/RB/just a/DT/a few/JJ/few disk-head/JJ/disk-head movements/NNS/movements /./. furthermore/NN/furthermore /,/, this/DT/this disparity/NN/disparity is/VBZ/is increasing/VBG/increasing over/IN/over time/NN/time /,/, to/TO/to the/DT/the point/NN/point where/WRB/where hundreds/NNS/hundreds of/IN/of thousands/NNS/thousands of/IN/of instructions/NNS/instructions reasonably/RB/reasonably could/MD/could be/VB/be used/VBN/used to/TO/to optimize/VB/optimize head/NN/head movements/NNS/movements /./. since/IN/since disk/NN/disk space/NN/space is/VBZ/is limited/VBN/limited /,/, we/PRP/we need/VBP/need to/TO/to reuse/VB/reuse the/DT/the space/NN/space from/IN/from deleted/VBN/deleted files/NNS/files for/IN/for new/JJ/new files/NNS/files /,/, if/IN/if possible/NNP/possible. /NNP/( write-once/NNP/write-once optical/JJ/optical disks/NNS/disks only/RB/only allow/VBP/allow one/CD/one write/JJ/write to/TO/to any/DT/any given/VBN/given sector/NN/sector /,/, and/CC/and thus/RB/thus such/JJ/such reuse/NN/reuse is/VBZ/is not/RB/not physically/RB/physically possible/NNP/possible. /:/) to/TO/to keep/VB/keep track/NN/track of/IN/of free/JJ/free disk/NN/disk space/NN/space /,/, the/DT/the system/NN/system maintains/VBZ/maintains a/DT/a the/DT/the free-space/NN/free-space list/NN/list records/NNS/records all/DT/all free/JJ/free disk/NN/disk blocks-those/JJ/blocks-those not/RB/not allocated/VBN/allocated to/TO/to some/DT/some file/NN/file or/CC/or directory/NNP/directory. to/TO/to create/VB/create a/DT/a file/NN/file /,/, we/PRP/we search/VBP/search the/DT/the free-space/NN/free-space list/NN/list for/IN/for the/DT/the required/VBN/required amount/NN/amount of/IN/of space/NN/space and/CC/and allocate/VB/allocate that/IN/that space/NN/space to/TO/to the/DT/the new/JJ/new file/NNP/file. this/DT/this space/NN/space is/VBZ/is then/RB/then removed/VBN/removed from/IN/from the/DT/the free-space/NN/free-space list/NNP/list. when/WRB/when a/DT/a file/NN/file is/VBZ/is deleted/VBN/deleted /,/, its/PRP$/its disk/NN/disk space/NN/space is/VBZ/is added/VBN/added to/TO/to the/DT/the free-space/NN/free-space list/NNP/list. the/DT/the free-space/NN/free-space list/NN/list /,/, despite/IN/despite its/PRP$/its name/NN/name /,/, might/MD/might not/RB/not be/VB/be implemented/VBN/implemented as/IN/as a/DT/a list/NN/list /,/, as/IN/as we/PRP/we discuss/VBP/discuss next/JJ/next /./. 11.5.1/CD/11.5.1 bit/NN/bit vector/NN/vector frequently/RB/frequently /,/, the/DT/the free-space/NN/free-space list/NN/list is/VBZ/is implemented/VBN/implemented as/RB/as a/DT/a or/CC/or each/DT/each block/NN/block is/VBZ/is represented/VBN/represented by/IN/by 1/CD/1 bit/NNP/bit. if/IN/if the/DT/the block/NN/block is/VBZ/is free/JJ/free /,/, the/DT/the bit/NN/bit is/VBZ/is 1/CD/1 ;/:/; if/IN/if the/DT/the block/NN/block is/VBZ/is allocated/VBN/allocated /,/, the/DT/the bit/NN/bit is/VBZ/is 0/-NONE-/0 /./. for/IN/for example/NN/example /,/, consider/NN/consider a/DT/a disk/NN/disk where/WRB/where blocks/NNS/blocks 2/CD/2 /,/, 3/CD/3 /,/, 4/CD/4 /,/, 5/CD/5 /,/, 8/CD/8 /,/, 9/CD/9 /,/, 10/CD/10 /,/, 11/CD/11 /,/, 12/CD/12 /,/, 13/CD/13 /,/, 17/CD/17 /,/, 18/CD/18 /,/, 25/CD/25 /,/, 26/CD/26 /,/, and/CC/and 27/CD/27 are/VBP/are free/JJ/free and/CC/and the/DT/the rest/NN/rest of/IN/of the/DT/the blocks/NNS/blocks are/VBP/are allocated/NNP/allocated. the/DT/the free-space/NN/free-space bit/NN/bit map/NN/map would/MD/would be/VB/be 480/CD/480 chapter/NN/chapter 11/CD/11 001111001111110001100000011100000/CD/001111001111110001100000011100000 /:/.. /./. the/DT/the main/JJ/main advantage/NN/advantage of/IN/of this/DT/this approach/NN/approach is/VBZ/is its/PRP$/its relative/JJ/relative simplicity/NN/simplicity and/CC/and its/PRP$/its efficiency/NN/efficiency in/IN/in finding/NN/finding the/DT/the first/JJ/first free/JJ/free block/NN/block or/CC/or n/NN/n consecutive/JJ/consecutive free/JJ/free blocks/NNS/blocks on/IN/on the/DT/the disk/NNP/disk. indeed/RB/indeed /,/, many/JJ/many computers/NNS/computers supply/RB/supply bit-manipulation/JJ/bit-manipulation instructions/NNS/instructions that/WDT/that can/MD/can be/VB/be used/VBN/used effectively/RB/effectively for/IN/for that/DT/that purpose/NNP/purpose. for/IN/for example/NN/example /,/, the/DT/the intel/NN/intel family/NN/family starting/VBG/starting with/IN/with the/DT/the 80386/CD/80386 and/CC/and the/DT/the motorola/NN/motorola family/NN/family starting/VBG/starting with/IN/with the/DT/the 68020/CD/68020 have/VBP/have instructions/NNS/instructions that/IN/that return/NN/return the/DT/the offset/NN/offset in/IN/in a/DT/a word/NN/word of/IN/of the/DT/the first/JJ/first bit/NN/bit with/IN/with the/DT/the value/NN/value 1/CD/1 /CD/( these/DT/these processors/NNS/processors have/VBP/have powered/VBN/powered pcs/NNS/pcs and/CC/and macintosh/JJ/macintosh systems/NNS/systems /,/, respectively/RB/respectively /:/) /./. one/CD/one technique/NN/technique for/IN/for finding/NN/finding the/DT/the first/JJ/first free/JJ/free block/NN/block on/IN/on a/DT/a system/NN/system that/WDT/that uses/VBZ/uses a/DT/a bit-vector/NN/bit-vector to/TO/to allocate/VB/allocate disk/NN/disk space/NN/space is/VBZ/is to/TO/to sequentially/RB/sequentially check/VB/check each/DT/each word/NN/word in/IN/in the/DT/the bit/NN/bit map/NN/map to/TO/to see/VB/see whether/IN/whether that/DT/that value/NN/value is/VBZ/is not/RB/not 0/-NONE-/0 /,/, since/IN/since a/DT/a 0-valued/JJ/0-valued word/NN/word contains/VBZ/contains only/RB/only 0/-NONE-/0 bits/NNS/bits and/CC/and represents/NNS/represents a/DT/a set/NN/set of/IN/of allocated/VBN/allocated blocks/NNP/blocks. the/DT/the first/JJ/first non-0/-NONE-/non-0 word/NN/word is/VBZ/is scanned/VBN/scanned for/IN/for the/DT/the first/JJ/first 1/CD/1 bit/NN/bit /,/, which/WDT/which is/VBZ/is the/DT/the location/NN/location of/IN/of the/DT/the first/JJ/first free/JJ/free block/NNP/block. the/DT/the calculation/NN/calculation of/IN/of the/DT/the block/NN/block number/NN/number is/VBZ/is /NNP/( number/NN/number of/IN/of bits/NNS/bits per/IN/per word/NN/word /:/) x/NN/x /:/( number/NN/number of/IN/of 0-value/JJ/0-value words/NNS/words /:/) +/:/+ offset/NN/offset of/IN/of first/JJ/first 1/CD/1 bit/NN/bit /./. again/RB/again /,/, we/PRP/we see/VBP/see hardware/NN/hardware features/NNS/features driving/VBG/driving software/NN/software functionality/NNP/functionality. unfortunately/RB/unfortunately /,/, bit/NN/bit vectors/NNS/vectors are/VBP/are inefficient/JJ/inefficient unless/IN/unless the/DT/the entire/JJ/entire vector/NN/vector is/VBZ/is kept/VBN/kept in/IN/in main/JJ/main memory/NN/memory /:/( and/CC/and is/VBZ/is written/VBN/written to/TO/to disk/VB/disk occasionally/RB/occasionally for/IN/for recovery/NN/recovery needs/VBZ/needs /:/) /./. keeping/VBG/keeping it/PRP/it in/IN/in main/JJ/main memory/NN/memory is/VBZ/is possible/JJ/possible for/IN/for smaller/JJR/smaller disks/NNS/disks but/CC/but not/RB/not necessarily/RB/necessarily for/IN/for larger/JJR/larger ones/NNS/ones /./. a/DT/a 1.3-gb/CD/1.3-gb disk/NN/disk with/IN/with 512-byte/JJ/512-byte blocks/NNS/blocks would/MD/would need/VB/need a/DT/a bit/NN/bit map/NN/map of/IN/of over/IN/over 332/CD/332 kb/NN/kb to/TO/to track/VB/track its/PRP$/its free/JJ/free blocks/NNS/blocks /,/, although/IN/although clustering/NN/clustering the/DT/the blocks/NNS/blocks in/IN/in groups/NNS/groups of/IN/of four/CD/four reduces/NNS/reduces this/DT/this number/NN/number to/TO/to around/IN/around 83/CD/83 kb/NN/kb per/IN/per disk/NNP/disk. a/DT/a 1-tb/CD/1-tb disk/NN/disk with/IN/with 4-kb/CD/4-kb blocks/NNS/blocks requires/VBZ/requires 32/CD/32 mb/NN/mb to/TO/to store/VB/store its/PRP$/its bit/NN/bit map/NNP/map. given/NN/given that/WDT/that disk/NN/disk size/VBP/size constantly/RB/constantly increases/NNS/increases /,/, the/DT/the problem/NN/problem with/IN/with bit/NN/bit vectors/NNS/vectors will/MD/will continue/VB/continue to/TO/to escalate/NNP/escalate. a/DT/a 1-pb/CD/1-pb file/NN/file system/NN/system would/MD/would take/VB/take a/DT/a 32-gb/CD/32-gb bitmap/NN/bitmap just/RB/just to/TO/to manage/VB/manage its/PRP$/its free/JJ/free space/NN/space /./. 11.5.2/CD/11.5.2 linked/VBD/linked list/NN/list another/DT/another approach/NN/approach to/TO/to free-space/NN/free-space management/NN/management is/VBZ/is to/TO/to link/VB/link together/RP/together all/DT/all the/DT/the free/JJ/free disk/NN/disk blocks/NNS/blocks /,/, keeping/VBG/keeping a/DT/a pointer/NN/pointer to/TO/to the/DT/the first/JJ/first free/JJ/free block/NN/block in/IN/in a/DT/a special/JJ/special location/NN/location on/IN/on the/DT/the disk/NN/disk and/CC/and caching/VBG/caching it/PRP/it in/IN/in memory/NNP/memory. this/DT/this first/JJ/first block/NN/block contains/NNS/contains a/DT/a pointer/NN/pointer to/TO/to the/DT/the next/JJ/next free/JJ/free disk/NN/disk block/NN/block /,/, and/CC/and so/RB/so on/NNP/on. recall/NN/recall our/PRP$/our earlier/JJR/earlier example/NN/example /:/( section/NN/section 11.5.1/CD/11.5.1 /CD/) /,/, in/IN/in which/WDT/which blocks/NNS/blocks 2/CD/2 /,/, 3/CD/3 /,/, 4/CD/4 /,/, 5/CD/5 /,/, 8/CD/8 /,/, 9/CD/9 /,/, 10/CD/10 /,/, 11/CD/11 /,/, 12/CD/12 /,/, 13/CD/13 /,/, 17/CD/17 /,/, 18/CD/18 /,/, 25/CD/25 /,/, 26/CD/26 /,/, and/CC/and 27/CD/27 were/VBD/were free/JJ/free and/CC/and the/DT/the rest/NN/rest of/IN/of the/DT/the blocks/NNS/blocks were/VBD/were allocated/NNP/allocated. in/IN/in this/DT/this situation/NN/situation /,/, we/PRP/we would/MD/would keep/VB/keep a/DT/a pointer/NN/pointer to/TO/to block/VB/block 2/CD/2 as/IN/as the/DT/the first/JJ/first free/JJ/free block/NNP/block. block/NN/block 2/CD/2 would/MD/would contain/VB/contain a/DT/a pointer/NN/pointer to/TO/to block/VB/block 3/CD/3 /,/, which/WDT/which would/MD/would point/VB/point to/TO/to block/VB/block 4/CD/4 /,/, which/WDT/which would/MD/would point/VB/point to/TO/to block/VB/block 5/CD/5 /,/, which/WDT/which would/MD/would point/VB/point to/TO/to block/VB/block 8/CD/8 /,/, and/CC/and so/RB/so on/IN/on /NNP/( figure/NN/figure 11.10/CD/11.10 /CD/) /./. this/DT/this scheme/NN/scheme is/VBZ/is not/RB/not efficient/JJ/efficient ;/:/; to/TO/to traverse/VB/traverse the/DT/the list/NN/list /,/, we/PRP/we must/MD/must read/VB/read each/DT/each block/NN/block /,/, which/WDT/which requires/VBZ/requires substantial/JJ/substantial i/0/-NONE-/i/0 time/NNP/time. fortunately/RB/fortunately /,/, however/RB/however /,/, traversing/VBG/traversing the/DT/the free/JJ/free list/NN/list is/VBZ/is not/RB/not a/DT/a frequent/NN/frequent action/NNP/action. usually/RB/usually /,/, the/DT/the operating/NN/operating system/NN/system simply/RB/simply needs/VBZ/needs a/DT/a free/JJ/free block/NN/block so/IN/so that/IN/that it/PRP/it can/MD/can allocate/VB/allocate that/IN/that block/NN/block to/TO/to a/DT/a file/NN/file /,/, so/RB/so the/DT/the first/JJ/first block/NN/block in/IN/in the/DT/the free/JJ/free list/NN/list is/VBZ/is used/NNP/used. the/DT/the fat/JJ/fat method/NN/method incorporates/NNS/incorporates free-block/JJ/free-block accounting/NN/accounting into/IN/into the/DT/the allocation/NN/allocation data/NNS/data structure/NNP/structure. no/DT/no separate/JJ/separate method/NN/method is/VBZ/is needed/VBN/needed /./. 11.5.3/CD/11.5.3 grouping/VBG/grouping a/DT/a modification/NN/modification of/IN/of the/DT/the free-list/JJ/free-list approach/NN/approach stores/NNS/stores the/DT/the addresses/NNS/addresses of/IN/of n/NN/n free/JJ/free blocks/NNS/blocks in/IN/in the/DT/the first/JJ/first free/JJ/free block/NNP/block. the/DT/the first/JJ/first n-1/-NONE-/n-1 of/IN/of these/DT/these blocks/NNS/blocks are/VBP/are actually/RB/actually free/NNP/free. the/DT/the last/JJ/last block/NN/block contains/VBZ/contains the/DT/the addresses/NNS/addresses of/IN/of another/DT/another n/NN/n free/JJ/free blocks/NNS/blocks /,/, and/CC/and so/RB/so on/NNP/on. the/DT/the addresses/NNS/addresses 11.5/CD/11.5 481/CD/481 figure/NN/figure 11.10/CD/11.10 linked/VBN/linked free-space/NN/free-space list/NN/list on/IN/on disk/NN/disk /./. of/IN/of a/DT/a large/JJ/large number/NN/number of/IN/of free/JJ/free blocks/NNS/blocks can/MD/can now/RB/now be/VB/be found/VBN/found quickly/RB/quickly /,/, unlike/IN/unlike the/DT/the situation/NN/situation when/WRB/when the/DT/the standard/JJ/standard linked-list/JJ/linked-list approach/NN/approach is/VBZ/is used/VBN/used /./. 11.5.4/CD/11.5.4 counting/VBG/counting another/DT/another approach/NN/approach takes/VBZ/takes advantage/NN/advantage of/IN/of the/DT/the fact/NN/fact that/IN/that /,/, generally/RB/generally /,/, several/JJ/several contiguous/JJ/contiguous blocks/NNS/blocks may/MD/may be/VB/be allocated/VBN/allocated or/CC/or freed/VBN/freed simultaneously/RB/simultaneously /,/, particularly/RB/particularly when/WRB/when space/NN/space is/VBZ/is allocated/VBN/allocated with/IN/with the/DT/the contiguous-allocation/NN/contiguous-allocation algorithm/NN/algorithm or/CC/or through/IN/through clustering/NNP/clustering. thus/RB/thus /,/, rather/RB/rather than/IN/than keeping/VBG/keeping a/DT/a list/NN/list of/IN/of n/NN/n free/JJ/free disk/NN/disk addresses/NNS/addresses /,/, we/PRP/we can/MD/can keep/VB/keep the/DT/the address/NN/address of/IN/of the/DT/the first/JJ/first free/JJ/free block/NN/block and/CC/and the/DT/the number/NN/number /:/( n/NN/n /:/) of/IN/of free/JJ/free contiguous/JJ/contiguous blocks/NNS/blocks that/WDT/that follow/VBP/follow the/DT/the first/JJ/first block/NNP/block. each/DT/each entry/NN/entry in/IN/in the/DT/the free-space/NN/free-space list/NN/list then/RB/then consists/VBZ/consists of/IN/of a/DT/a disk/NN/disk address/NN/address and/CC/and a/DT/a count/NNP/count. although/IN/although each/DT/each entry/NN/entry requires/VBZ/requires more/JJR/more space/NN/space than/IN/than would/MD/would a/DT/a simple/JJ/simple disk/NN/disk address/NN/address /,/, the/DT/the overall/JJ/overall list/NN/list is/VBZ/is shorter/NN/shorter /,/, as/IN/as long/RB/long as/IN/as the/DT/the count/NN/count is/VBZ/is generally/RB/generally greater/JJR/greater than/IN/than 1/CD/1. note/NN/note that/IN/that this/DT/this method/NN/method of/IN/of tracking/VBG/tracking free/JJ/free space/NN/space is/VBZ/is similar/JJ/similar to/TO/to the/DT/the extent/NN/extent method/NN/method of/IN/of allocating/VBG/allocating blocks/NNP/blocks. these/DT/these entries/NNS/entries can/MD/can be/VB/be stored/VBN/stored in/IN/in a/DT/a b-tree/JJ/b-tree /,/, rather/RB/rather than/IN/than a/DT/a linked/VBN/linked list/NN/list for/IN/for efficient/NN/efficient lookup/NN/lookup /,/, insertion/NN/insertion /,/, and/CC/and deletion/NN/deletion /./. 11.5.5/CD/11.5.5 space/NN/space maps/NNS/maps sun/VBP/sun 's/POS/'s zfs/NNS/zfs file/IN/file system/NN/system was/VBD/was designed/VBN/designed to/TO/to encompass/NN/encompass huge/JJ/huge numbers/NNS/numbers of/IN/of files/NNS/files /,/, directories/NNS/directories /,/, and/CC/and even/RB/even file/JJ/file systems/NNS/systems /:/( in/IN/in zfs/NNS/zfs /,/, we/PRP/we can/MD/can create/VB/create file-system/JJ/file-system hierarchies/NNS/hierarchies /:/) /./. the/DT/the resulting/VBG/resulting data/NNS/data structures/NNS/structures could/MD/could have/VB/have been/VBN/been large/JJ/large and/CC/and inefficient/NN/inefficient if/IN/if they/PRP/they had/VBD/had not/RB/not been/VBN/been designed/VBN/designed and/CC/and implemented/VBN/implemented properly/NNP/properly. on/IN/on these/DT/these scales/NNS/scales /,/, metadata/NNS/metadata i/0/-NONE-/i/0 can/MD/can have/VB/have a/DT/a large/JJ/large performance/NN/performance impact/NNP/impact. conside1/NNP/conside1 ~/NNP/~ for/IN/for example/NN/example /,/, that/IN/that if/IN/if the/DT/the freespace/NN/freespace list/NN/list is/VBZ/is implemented/VBN/implemented as/RB/as a/DT/a bit/NN/bit map/NN/map /,/, bit/NN/bit maps/NNS/maps must/MD/must be/VB/be modified/VBN/modified both/DT/both when/WRB/when blocks/NNS/blocks are/VBP/are allocated/VBN/allocated and/CC/and when/WRB/when they/PRP/they are/VBP/are freed/NNP/freed. freeing/VBG/freeing 1gb/CD/1gb of/IN/of data/NNS/data on/IN/on a/DT/a 1-tb/CD/1-tb disk/NN/disk could/MD/could cause/VB/cause thousands/NNS/thousands of/IN/of blocks/NNS/blocks of/IN/of bit/NN/bit maps/NNS/maps to/TO/to be/VB/be updated/VBN/updated /,/, because/IN/because those/DT/those data/NNS/data blocks/NNS/blocks could/MD/could be/VB/be scattered/VBN/scattered over/RP/over the/DT/the entire/JJ/entire disk/NN/disk /./. 482/CD/482 chapter/NN/chapter 11/CD/11 11.6/CD/11.6 zfs/NNS/zfs uses/NNS/uses a/DT/a combination/NN/combination of/IN/of techniques/NNS/techniques in/IN/in its/PRP$/its free-space/NN/free-space managem.ent/JJ/managem.ent algorithm/NN/algorithm to/TO/to control/NN/control the/DT/the size/NN/size of/IN/of data/NNS/data structures/NNS/structures and/CC/and minimize/VB/minimize the/DT/the i/0/-NONE-/i/0 needed/VBN/needed to/TO/to manage/NN/manage those/DT/those structures/NNP/structures. first/RB/first /,/, zfs/NNS/zfs creates/VBZ/creates to/TO/to divide/VB/divide the/DT/the space/NN/space on/IN/on the/DT/the device/NN/device into/IN/into chucks/NNS/chucks of/IN/of manageable/JJ/manageable size/NNP/size. a/DT/a given/VBN/given volume/NN/volume may/MD/may contain/VB/contain hundreds/NNS/hundreds of/IN/of metaslabs/NNP/metaslabs. each/DT/each metaslab/NN/metaslab has/VBZ/has an/DT/an associated/VBN/associated space/NN/space map/NNP/map. zfs/VBZ/zfs uses/NNS/uses the/DT/the counting/VBG/counting algorithm/NN/algorithm to/TO/to store/VB/store information/NN/information about/IN/about free/JJ/free blocks/NNP/blocks. rather/RB/rather than/IN/than write/JJ/write count/NN/count structures/NNS/structures to/TO/to disk/VB/disk /,/, it/PRP/it uses/VBZ/uses log-structured/JJ/log-structured file/NN/file- system/NN/system techniques/NNS/techniques to/TO/to record/VB/record them/NNP/them. the/DT/the space/NN/space map/NN/map is/VBZ/is a/DT/a log/NN/log of/IN/of all/DT/all block/NN/block activity/NN/activity /:/( allocatil/NN/allocatil g/NN/g and/CC/and freemg/NN/freemg /:/) /,/, in/IN/in time/NN/time order/NN/order /,/, in/IN/in countil/NN/countil g/NN/g format/NNP/format. when/WRB/when zfs/NNS/zfs decides/VBZ/decides to/TO/to allocate/VB/allocate or/CC/or free/JJ/free space/NN/space from/IN/from a/DT/a metaslab/NN/metaslab /,/, it/PRP/it loads/VBZ/loads the/DT/the associated/VBN/associated space/NN/space map/NN/map into/IN/into memory/NN/memory in/IN/in a/DT/a balanced-tree/JJ/balanced-tree structure/NN/structure /:/( for/IN/for very/RB/very efficient/JJ/efficient operation/NN/operation /:/) /,/, indexed/VBD/indexed by/IN/by offset/VBN/offset /,/, and/CC/and replays/NNS/replays the/DT/the log/NN/log into/IN/into that/DT/that structure/NNP/structure. the/DT/the in-memory/JJ/in-memory space/NN/space map/NN/map is/VBZ/is then/RB/then an/DT/an accurate/JJ/accurate representation/NN/representation of/IN/of the/DT/the allocated/VBN/allocated and/CC/and free/JJ/free space/NN/space in/IN/in the/DT/the metaslab/NNP/metaslab. zfs/VBZ/zfs also/RB/also condenses/VBZ/condenses the/DT/the map/NN/map as/IN/as much/JJ/much as/IN/as possible/JJ/possible by/IN/by combining/NN/combining contiguous/JJ/contiguous free/JJ/free blocks/NNS/blocks into/IN/into a/DT/a sil/NN/sil gle/NN/gle entry/NNP/entry. finally/RB/finally /,/, the/DT/the free-space/NN/free-space list/NN/list is/VBZ/is updated/VBN/updated on/IN/on disk/NN/disk as/IN/as part/NN/part of/IN/of the/DT/the transaction-oriented/JJ/transaction-oriented operations/NNS/operations of/IN/of zfs/NNP/zfs. during/IN/during the/DT/the collection/NN/collection and/CC/and sortmg/NN/sortmg phase/NN/phase /,/, block/NN/block requests/NNS/requests can/MD/can still/RB/still occur/VB/occur /,/, and/CC/and zfs/NNS/zfs satisfies/NNS/satisfies these/DT/these requests/NNS/requests from/IN/from the/DT/the log/NNP/log. in/IN/in essence/NN/essence /,/, the/DT/the log/NN/log plus/VBZ/plus the/DT/the balanced/VBN/balanced tree/NN/tree is/VBZ/is the/DT/the free/JJ/free list/NN/list /./. now/RB/now that/IN/that we/PRP/we have/VBP/have discussed/VBN/discussed various/JJ/various block-allocation/NN/block-allocation and/CC/and directorymanagement/NN/directorymanagement options/NNS/options /,/, we/PRP/we can/MD/can further/RB/further consider/VB/consider their/PRP$/their effect/NN/effect on/IN/on performance/NN/performance and/CC/and efficient/NN/efficient disk/NN/disk use/NNP/use. disks/VBZ/disks tend/NN/tend to/TO/to represent/VB/represent a/DT/a major/JJ/major bottleneck/NN/bottleneck in/IN/in system/NN/system performance/NN/performance /,/, since/IN/since they/PRP/they are/VBP/are the/DT/the slowest/JJS/slowest main/JJ/main computer/NN/computer component/NNP/component. in/IN/in this/DT/this section/NN/section /,/, we/PRP/we discuss/VBP/discuss a/DT/a variety/NN/variety of/IN/of techniques/NNS/techniques used/VBN/used to/TO/to improve/VB/improve the/DT/the efficiency/NN/efficiency and/CC/and performance/NN/performance of/IN/of secondary/JJ/secondary storage/NN/storage /./. 11.6.1/CD/11.6.1 efficiency/NN/efficiency the/DT/the efficient/NN/efficient use/NN/use of/IN/of disk/NN/disk space/NN/space depends/NNS/depends heavily/RB/heavily on/IN/on the/DT/the disk/NN/disk allocation/NN/allocation and/CC/and directory/NN/directory algorithms/NNS/algorithms in/IN/in use/NNP/use. for/IN/for instance/NN/instance /,/, unix/NN/unix inodes/VBZ/inodes are/VBP/are preallocated/VBN/preallocated on/IN/on a/DT/a volume/NNP/volume. even/RB/even an/DT/an empty/NN/empty disk/NN/disk has/VBZ/has a/DT/a percentage/NN/percentage of/IN/of its/PRP$/its space/NN/space lost/VBD/lost to/TO/to inodes/NNS/inodes /./. however/RB/however /,/, by/IN/by preallocating/NN/preallocating the/DT/the inodes/NNS/inodes and/CC/and spreading/VBG/spreading them/PRP/them across/IN/across the/DT/the volume/NN/volume /,/, we/PRP/we improve/VBP/improve the/DT/the file/NN/file system/NN/system 's/POS/'s performance/NNP/performance. this/DT/this improved/VBN/improved performance/NN/performance results/NNS/results from/IN/from the/DT/the unix/NN/unix allocation/NN/allocation and/CC/and free-space/NN/free-space algorithms/NNS/algorithms /,/, which/WDT/which try/NN/try to/TO/to keep/VB/keep a/DT/a file/NN/file 's/POS/'s data/NNS/data blocks/NNS/blocks near/IN/near that/DT/that file/NN/file 's/POS/'s inode/NN/inode block/NN/block to/TO/to reduce/VB/reduce seek/NN/seek time/NN/time /./. as/IN/as another/DT/another example/NN/example /,/, let/VB/let 's/POS/'s reconsider/NN/reconsider the/DT/the clustermg/NN/clustermg scheme/NN/scheme discussed/VBD/discussed in/IN/in section/NN/section 11.4/CD/11.4 /,/, which/WDT/which aids/NNS/aids in/IN/in file-seek/JJ/file-seek and/CC/and file-transfer/JJ/file-transfer performance/NN/performance at/IN/at the/DT/the cost/NN/cost of/IN/of internal/JJ/internal fragmentation/NNP/fragmentation. to/TO/to reduce/VB/reduce this/DT/this fragmentation/NN/fragmentation /,/, bsd/VBD/bsd unix/NN/unix varies/NNS/varies the/DT/the cluster/NN/cluster size/NN/size as/IN/as a/DT/a file/NN/file grows/NNP/grows. large/JJ/large clusters/NNS/clusters are/VBP/are used/VBN/used where/WRB/where they/PRP/they can/MD/can be/VB/be filled/VBN/filled /,/, and/CC/and small/JJ/small clusters/NNS/clusters are/VBP/are used/VBN/used for/IN/for small/JJ/small files/NNS/files and/CC/and the/DT/the last/JJ/last cluster/NN/cluster of/IN/of a/DT/a file/NNP/file. this/DT/this system/NN/system is/VBZ/is described/VBN/described in/IN/in appendix/NN/appendix a/DT/a /./. the/DT/the types/NNS/types of/IN/of data/NNS/data normally/RB/normally kept/VBD/kept in/IN/in a/DT/a file/NN/file 's/POS/'s directory/NN/directory /:/( or/CC/or inode/VB/inode /CD/) entry/NN/entry also/RB/also require/VB/require consideration/NNP/consideration. commonly/RB/commonly /,/, a/DT/a last/JJ/last write/NN/write date/NN/date is/VBZ/is recorded/VBN/recorded to/TO/to supply/RB/supply information/NN/information to/TO/to the/DT/the user/NN/user and/CC/and to/TO/to determine/VB/determine whether/IN/whether the/DT/the file/NN/file needs/VBZ/needs to/TO/to be/VB/be backed/VBN/backed up/NNP/up. some/DT/some systems/NNS/systems also/RB/also keep/VB/keep a/DT/a last/JJ/last access/NN/access date/NN/date /,/, so/RB/so that/IN/that a/DT/a user/NN/user can/MD/can determine/VB/determine when/WRB/when the/DT/the file/NN/file was/VBD/was last/JJ/last read/NNP/read. the/DT/the result/NN/result of/IN/of keeping/NN/keeping this/DT/this information/NN/information is/VBZ/is that/IN/that /,/, whenever/RB/whenever the/DT/the file/NN/file is/VBZ/is read/VBN/read /,/, a/DT/a field/NN/field in/IN/in the/DT/the directory/NN/directory structure/NN/structure must/MD/must be/VB/be written/VBN/written 11.6/CD/11.6 483/CD/483 to/NNP/to. that/IN/that means/VBZ/means the/DT/the block/NN/block must/MD/must be/VB/be read/VBN/read into/IN/into memory/NN/memory /,/, a/DT/a section/NN/section changed/VBN/changed /,/, and/CC/and the/DT/the block/NN/block written/VBN/written back/RB/back out/IN/out to/TO/to disk/VB/disk /,/, because/IN/because operations/NNS/operations on/IN/on disks/NNS/disks occur/VBP/occur only/RB/only in/IN/in block/NN/block /:/( or/CC/or cluster/JJR/cluster /:/) chunks/NNP/chunks. so/RB/so any/DT/any time/NN/time a/DT/a file/NN/file is/VBZ/is opened/VBN/opened for/IN/for reading/NN/reading /,/, its/PRP$/its directory/NN/directory entry/NN/entry must/MD/must be/VB/be read/VBN/read and/CC/and written/VBN/written as/IN/as well/NNP/well. this/DT/this requirement/NN/requirement can/MD/can be/VB/be inefficient/VBN/inefficient for/IN/for frequently/RB/frequently accessed/VBN/accessed files/NNS/files /,/, so/RB/so we/PRP/we must/MD/must weigh/VB/weigh its/PRP$/its benefit/NN/benefit against/IN/against its/PRP$/its performance/NN/performance cost/NN/cost when/WRB/when designing/VBG/designing a/DT/a file/NN/file system/NNP/system. generally/RB/generally /,/, every/DT/every data/NN/data item/NN/item associated/VBN/associated with/IN/with a/DT/a file/JJ/file needs/NNS/needs to/TO/to be/VB/be considered/VBN/considered for/IN/for its/PRP$/its effect/NN/effect on/IN/on efficiency/NN/efficiency and/CC/and performance/NN/performance /./. as/IN/as an/DT/an example/NN/example /,/, consider/NN/consider how/WRB/how efficiency/NN/efficiency is/VBZ/is affected/VBN/affected by/IN/by the/DT/the size/NN/size of/IN/of the/DT/the pointers/NNS/pointers used/VBN/used to/TO/to access/NN/access data/NNP/data. most/JJS/most systems/NNS/systems use/VBP/use either/DT/either 16/CD/16- or/CC/or 32-bit/CD/32-bit pointers/NNS/pointers throughout/IN/throughout the/DT/the operating/NN/operating system/NNP/system. these/DT/these pointer/NN/pointer sizes/VBZ/sizes limit/NN/limit the/DT/the length/NN/length of/IN/of a/DT/a file/NN/file to/TO/to either/DT/either 216/CD/216 /CD/( 64/CD/64 kb/NN/kb /:/) or/CC/or 232/CD/232 bytes/NNS/bytes /:/( 4/CD/4 gb/NN/gb /:/) /./. some/DT/some systems/NNS/systems implement/VBP/implement 64-bit/JJ/64-bit pointers/NNS/pointers to/TO/to increase/VB/increase this/DT/this limit/NN/limit to/TO/to 264/CD/264 bytes/NNS/bytes /,/, which/WDT/which is/VBZ/is a/DT/a very/RB/very large/JJ/large number/NN/number indeed/NNP/indeed. however/RB/however /,/, 64-bit/JJ/64-bit pointers/NNS/pointers take/VBP/take more/JJR/more space/NN/space to/TO/to store/VB/store and/CC/and in/IN/in turn/NN/turn make/NN/make the/DT/the allocation/NN/allocation and/CC/and free-space-management/JJ/free-space-management methods/NNS/methods /:/( linked/VBN/linked lists/NNS/lists /,/, indexes/NNS/indexes /,/, and/CC/and so/RB/so on/IN/on /NNP/) use/NN/use more/JJR/more disk/NN/disk space/NN/space /./. one/CD/one of/IN/of the/DT/the difficulties/NNS/difficulties in/IN/in choosing/NN/choosing a/DT/a pointer/NN/pointer size/NN/size /,/, or/CC/or indeed/RB/indeed any/DT/any fixed/VBN/fixed allocation/NN/allocation size/NN/size within/IN/within an/DT/an operating/NN/operating system/NN/system /,/, is/VBZ/is planning/VBG/planning for/IN/for the/DT/the effects/NNS/effects of/IN/of changing/VBG/changing technology/NNP/technology. consider/NN/consider that/WDT/that the/DT/the ibm/NN/ibm pc/NN/pc xt/NN/xt had/VBD/had a/DT/a 10-mb/CD/10-mb hard/JJ/hard drive/JJ/drive and/CC/and an/DT/an ms-dos/JJ/ms-dos file/NN/file system/NN/system that/WDT/that could/MD/could support/VB/support only/RB/only 32/CD/32 mb/NNP/mb. /NNP/( each/DT/each fat/JJ/fat entry/NN/entry was/VBD/was 12/CD/12 bits/NNS/bits /,/, pointing/VBG/pointing to/TO/to an/DT/an 8-kb/CD/8-kb cluster/NNP/cluster. /NNP/) as/IN/as disk/NN/disk capacities/NNS/capacities increased/VBD/increased /,/, larger/JJR/larger disks/NNS/disks had/VBD/had to/TO/to be/VB/be split/VBN/split into/IN/into 32-mb/CD/32-mb partitions/NNS/partitions /,/, because/IN/because the/DT/the file/NN/file system/NN/system could/MD/could not/RB/not track/VB/track blocks/NNS/blocks beyond/IN/beyond 32mb/CD/32mb. as/IN/as hard/JJ/hard disks/NNS/disks with/IN/with capacities/NNS/capacities of/IN/of over/IN/over 100mb/CD/100mb became/VBD/became common/JJ/common /,/, the/DT/the disk/NN/disk data/NNS/data structures/NNS/structures and/CC/and algorithms/NNS/algorithms in/IN/in ms-dos/NNP/ms-dos had/VBD/had to/TO/to be/VB/be modified/VBN/modified to/TO/to allow/VB/allow larger/JJR/larger file/NN/file systems/NNP/systems. /NNP/( each/DT/each fat/JJ/fat entry/NN/entry was/VBD/was expanded/VBN/expanded to/TO/to 16/CD/16 bits/NNS/bits and/CC/and later/JJ/later to/TO/to 32/CD/32 bits/NNP/bits. /NNP/) the/DT/the initial/JJ/initial file-system/NN/file-system decisions/NNS/decisions were/VBD/were made/VBN/made for/IN/for efficiency/NN/efficiency reasons/NNS/reasons ;/:/; however/RB/however /,/, with/IN/with the/DT/the advent/NN/advent of/IN/of ms-dos/NNS/ms-dos version/NN/version 4/CD/4 /,/, millions/NNS/millions of/IN/of computer/NN/computer users/NNS/users were/VBD/were inconvenienced/VBN/inconvenienced when/WRB/when they/PRP/they had/VBD/had to/TO/to switch/VB/switch to/TO/to the/DT/the new/JJ/new /,/, larger/JJR/larger file/NN/file system/NNP/system. sun/NN/sun 's/POS/'s zfs/NNS/zfs file/IN/file system/NN/system uses/NNS/uses 128-bit/CD/128-bit pointers/NNS/pointers /,/, which/WDT/which theoretically/RB/theoretically should/MD/should never/RB/never need/VB/need to/TO/to be/VB/be extended/NNP/extended. /NNP/( the/DT/the minimum/JJ/minimum mass/NN/mass of/IN/of a/DT/a device/NN/device capable/JJ/capable of/IN/of storing/NN/storing 2128/CD/2128 bytes/NNS/bytes using/VBG/using atomic-level/JJ/atomic-level storage/NN/storage would/MD/would be/VB/be about/RB/about 272/CD/272 trillion/NN/trillion kilograms/NNP/kilograms. /NNP/) as/IN/as another/DT/another example/NN/example /,/, consider/NN/consider the/DT/the evolution/NN/evolution of/IN/of sun/NN/sun 's/POS/'s solaris/NNS/solaris operating/VBG/operating system/NNP/system. originally/RB/originally /,/, many/JJ/many data/NNS/data structures/NNS/structures were/VBD/were of/IN/of fixed/VBN/fixed length/NN/length /,/, allocated/VBD/allocated at/IN/at system/NN/system startup/NNP/startup. these/DT/these structures/NNS/structures included/VBD/included the/DT/the process/NN/process table/NN/table and/CC/and the/DT/the open-file/JJ/open-file table/NNP/table. when/WRB/when the/DT/the process/NN/process table/NN/table became/VBD/became full/JJ/full /,/, no/DT/no more/RBR/more processes/NNS/processes could/MD/could be/VB/be created/VBN/created /./. when/WRB/when the/DT/the file/NN/file table/NN/table became/VBD/became full/JJ/full /,/, no/DT/no more/RBR/more files/NNS/files could/MD/could be/VB/be opened/NNP/opened. the/DT/the system/NN/system would/MD/would fail/VB/fail to/TO/to provide/VB/provide services/NNS/services to/TO/to users/NNP/users. table/JJ/table sizes/NNS/sizes could/MD/could be/VB/be increased/VBN/increased only/RB/only by/IN/by recompiling/NN/recompiling the/DT/the kernel/NN/kernel and/CC/and rebooting/VBG/rebooting the/DT/the system/NNP/system. since/IN/since the/DT/the release/NN/release of/IN/of solaris/NNS/solaris 2/CD/2 /,/, almost/RB/almost all/DT/all kernel/NN/kernel structures/NNS/structures have/VBP/have been/VBN/been allocated/VBN/allocated dynamically/RB/dynamically /,/, eliminating/VBG/eliminating these/DT/these artificial/JJ/artificial limits/NNS/limits on/IN/on system/NN/system performance/NNP/performance. of/IN/of course/NN/course /,/, the/DT/the algorithms/NNS/algorithms that/WDT/that manipulate/NN/manipulate these/DT/these tables/NNS/tables are/VBP/are more/RBR/more complicated/JJ/complicated /,/, and/CC/and the/DT/the operating/NN/operating system/NN/system is/VBZ/is a/DT/a little/RB/little slower/JJR/slower because/IN/because it/PRP/it must/MD/must dynamically/RB/dynamically allocate/VB/allocate and/CC/and deallocate/VB/deallocate table/JJ/table entries/NNS/entries ;/:/; but/CC/but that/IN/that price/NN/price is/VBZ/is the/DT/the usual/JJ/usual one/CD/one for/IN/for more/JJR/more general/JJ/general functionality/NN/functionality /./. 11.6.2/CD/11.6.2 performance/NN/performance even/RB/even after/IN/after the/DT/the basic/JJ/basic file-system/NN/file-system algorithms/NNS/algorithms have/VBP/have been/VBN/been selected/VBN/selected /,/, we/PRP/we can/MD/can still/RB/still improve/VB/improve performance/NN/performance in/IN/in several/JJ/several ways/NNP/ways. as/IN/as will/MD/will be/VB/be discussed/VBN/discussed in/IN/in chapter/NN/chapter 13/CD/13 /,/, most/RBS/most disk/JJ/disk controllers/NNS/controllers include/VBP/include local/JJ/local memory/NN/memory to/TO/to form/NN/form an/DT/an on-board/JJ/on-board cache/NN/cache that/WDT/that is/VBZ/is large/JJ/large enough/RB/enough to/TO/to store/VB/store entire/JJ/entire tracks/NNS/tracks at/IN/at a/DT/a time/NNP/time. once/RB/once a/DT/a seek/NN/seek is/VBZ/is performed/VBN/performed /,/, the/DT/the track/NN/track is/VBZ/is read/VBN/read into/IN/into the/DT/the disk/NN/disk cache/NN/cache starting/VBG/starting at/IN/at the/DT/the sector/NN/sector under/IN/under the/DT/the disk/NN/disk head/NN/head 484/CD/484 chapter/NN/chapter 11/CD/11 1/0/CD/1/0 using/VBG/using read/NN/read /:/( /:/) and/CC/and write/JJ/write /NN/( /:/) tile/NN/tile system/NN/system figure/NN/figure 11.11/CD/11.11 1/0/CD/1/0 without/IN/without a/DT/a unified/JJ/unified buffer/NN/buffer cache/NN/cache /./. /NN/( reducing/VBG/reducing latency/NN/latency time/NN/time /:/) /./. the/DT/the disk/NN/disk controller/NN/controller then/RB/then transfers/VBZ/transfers any/DT/any sector/NN/sector requests/NNS/requests to/TO/to the/DT/the operating/NN/operating system/NNP/system. once/RB/once blocks/VBZ/blocks make/VB/make it/PRP/it from/IN/from the/DT/the disk/NN/disk controller/NN/controller into/IN/into main/JJ/main memory/NN/memory /,/, the/DT/the operating/NN/operating system/NN/system may/MD/may cache/VB/cache the/DT/the blocks/NNS/blocks there/RB/there /./. some/DT/some systems/NNS/systems maintain/VBP/maintain a/DT/a separate/JJ/separate section/NN/section of/IN/of main/JJ/main memory/NN/memory for/IN/for a/DT/a where/WRB/where blocks/NNS/blocks are/VBP/are kept/VBN/kept under/IN/under the/DT/the assumption/NN/assumption that/IN/that will/MD/will be/VB/be used/VBN/used again/RB/again shortly/NNP/shortly. other/JJ/other systems/NNS/systems cache/PRP/cache file/VBP/file data/NNS/data using/VBG/using a/DT/a the/DT/the page/NN/page cache/NN/cache uses/NNS/uses virtual/JJ/virtual memory/NN/memory techniques/NNS/techniques to/TO/to cache/VB/cache file/JJ/file data/NNS/data as/IN/as pages/NNS/pages rather/RB/rather than/IN/than as/IN/as file-system-oriented/JJ/file-system-oriented blocks/NNP/blocks. cachii/NN/cachii lg/NN/lg file/NN/file data/NNS/data using/VBG/using virtual/JJ/virtual addresses/NNS/addresses is/VBZ/is far/RB/far more/RBR/more efficient/JJ/efficient than/IN/than caching/NN/caching through/IN/through physical/JJ/physical disk/NN/disk blocks/NNS/blocks /,/, as/IN/as accesses/NNS/accesses interface/NN/interface with/IN/with virtual/JJ/virtual memory/NN/memory rather/RB/rather than/IN/than the/DT/the file/NN/file system/NNP/system. several/JJ/several systems-including/JJ/systems-including solaris/NNS/solaris /,/, linux/NN/linux /,/, and/CC/and windows/VBZ/windows nt/NN/nt /,/, 2000/CD/2000 /,/, and/CC/and xp-use/JJ/xp-use caching/NN/caching to/TO/to cache/VB/cache both/DT/both process/NN/process pages/NNS/pages and/CC/and file/JJ/file data/NNP/data. this/DT/this is/VBZ/is known/VBN/known as/IN/as some/DT/some versions/NNS/versions of/IN/of unix/NN/unix and/CC/and linux/NN/linux provide/VB/provide a/DT/a to/TO/to illustrate/VB/illustrate the/DT/the benefits/NNS/benefits of/IN/of the/DT/the unified/JJ/unified buffer/NN/buffer cache/NN/cache /,/, consider/NN/consider the/DT/the two/CD/two alternatives/NNS/alternatives for/IN/for opening/VBG/opening and/CC/and accessing/VBG/accessing a/DT/a file/NNP/file. one/CD/one approach/NN/approach is/VBZ/is to/TO/to use/VB/use memory/NN/memory mapping/VBG/mapping /NN/( section/NN/section 9.7/CD/9.7 /CD/) ;/:/; the/DT/the second/JJ/second is/VBZ/is to/TO/to use/VB/use the/DT/the standard/JJ/standard system/NN/system calls/VBZ/calls read/NN/read /:/( /:/) and/CC/and write/JJ/write /NN/( /:/) /./. without/IN/without a/DT/a unified/JJ/unified buffer/NN/buffer cache/NN/cache /,/, we/PRP/we have/VBP/have a/DT/a situation/NN/situation similar/JJ/similar to/TO/to figure/VB/figure 11.11/CD/11.11. here/RB/here /,/, the/DT/the read/NN/read /:/( /:/) and/CC/and write/JJ/write /NN/( /:/) system/NN/system calls/VBZ/calls go/NN/go through/IN/through the/DT/the buffer/NN/buffer cache/NN/cache /./. the/DT/the memory-mapping/JJ/memory-mapping call/NN/call /,/, however/RB/however /,/, requires/VBZ/requires using/VBG/using two/CD/two caches-the/JJ/caches-the page/NN/page cache/NN/cache and/CC/and the/DT/the buffer/NN/buffer cache/NNP/cache. a/DT/a memory/NN/memory mapping/VBG/mapping proceeds/NNS/proceeds by/IN/by reading/NN/reading in/IN/in disk/NN/disk blocks/NNS/blocks from/IN/from the/DT/the file/NN/file system/NN/system and/CC/and storing/VBG/storing them/PRP/them in/IN/in the/DT/the buffer/NN/buffer cache/NNP/cache. because/IN/because the/DT/the virtual/JJ/virtual memory/NN/memory system/NN/system does/VBZ/does not/RB/not interface/VB/interface with/IN/with the/DT/the buffer/NN/buffer cache/NN/cache /,/, the/DT/the contents/NNS/contents of/IN/of the/DT/the file/NN/file in/IN/in the/DT/the buffer/NN/buffer cache/NN/cache must/MD/must be/VB/be copied/VBN/copied into/IN/into the/DT/the page/NN/page cache/NNP/cache. this/DT/this situation/NN/situation is/VBZ/is known/VBN/known as/IN/as and/CC/and requires/NNS/requires caching/VBG/caching file-system/JJ/file-system data/NNS/data twice/NNP/twice. not/RB/not only/RB/only does/VBZ/does it/PRP/it waste/VB/waste memory/NN/memory but/CC/but it/PRP/it also/RB/also wastes/VBZ/wastes significant/JJ/significant cpu/NN/cpu and/CC/and i/o/NNP/i/o cycles/NNS/cycles due/JJ/due to/TO/to the/DT/the extra/JJ/extra data/NNS/data movement/NN/movement within/IN/within system/NN/system memory/NNP/memory. in/IN/in addition/NN/addition /,/, inconsistencies/NNS/inconsistencies between/IN/between the/DT/the two/CD/two caches/NNS/caches can/MD/can result/VB/result in/IN/in corrupt/JJ/corrupt files/NNP/files. in/IN/in contrast/NN/contrast /,/, when/WRB/when a/DT/a unified/JJ/unified buffer/NN/buffer cache/NN/cache is/VBZ/is provided/VBN/provided /,/, both/DT/both memory/NN/memory mapping/VBG/mapping and/CC/and the/DT/the read/NN/read /:/( /:/) and/CC/and write/JJ/write /NN/( /:/) system/NN/system calls/VBZ/calls use/NN/use the/DT/the same/JJ/same page/NN/page cache/NNP/cache. this/DT/this has/VBZ/has the/DT/the benefit/NN/benefit of/IN/of a/DT/a voiding/NN/voiding double/JJ/double 11.6/CD/11.6 485/CD/485 memory-mapped/JJ/memory-mapped 1/0/CD/1/0 buffer/NN/buffer cache/NN/cache file/NN/file system/NN/system figure/NN/figure 11.12/CD/11.12 1/0/CD/1/0 using/VBG/using a/DT/a unified/JJ/unified buffer/NN/buffer cache/NN/cache /./. caching/VBG/caching /,/, and/CC/and it/PRP/it allows/VBZ/allows the/DT/the virtual/JJ/virtual memory/NN/memory system/NN/system to/TO/to manage/NN/manage file-system/NN/file-system data/NNS/data /./. the/DT/the unified/JJ/unified buffer/NN/buffer cache/NN/cache is/VBZ/is shown/VBN/shown in/IN/in figure/NN/figure 11.12/CD/11.12 /./. regardless/NN/regardless of/IN/of whether/IN/whether we/PRP/we are/VBP/are caching/VBG/caching disk/NN/disk blocks/NNS/blocks or/CC/or pages/NNS/pages /:/( or/CC/or both/DT/both /NN/) /,/, lru/NN/lru /:/( section/NN/section 9.4.4/CD/9.4.4 /CD/) seems/NNS/seems a/DT/a reasonable/JJ/reasonable general-purpose/JJ/general-purpose algorithm/NN/algorithm for/IN/for block/NN/block or/CC/or page/NN/page replacement/NNP/replacement. however/RB/however /,/, the/DT/the evolution/NN/evolution of/IN/of the/DT/the solaris/NNS/solaris page-caching/JJ/page-caching algorithms/NNS/algorithms reveals/NNS/reveals the/DT/the difficulty/NN/difficulty in/IN/in choosil1.g/JJ/choosil1.g an/DT/an algorithm/NNP/algorithm. solaris/VBZ/solaris allows/VBZ/allows processes/NNS/processes and/CC/and the/DT/the page/NN/page cache/NN/cache to/TO/to share/VB/share unused/VBN/unused memory/NNP/memory. versions/NNS/versions earlier/JJR/earlier than/IN/than solaris/NNS/solaris 2.5.1/CD/2.5.1 made/VBN/made no/DT/no distmction/NN/distmction between/IN/between allocatmg/NN/allocatmg pages/NNS/pages to/TO/to a/DT/a process/NN/process and/CC/and allocating/VBG/allocating them/PRP/them to/TO/to the/DT/the page/NN/page cache/NNP/cache. as/IN/as a/DT/a result/NN/result /,/, a/DT/a system/NN/system performing/VBG/performing many/JJ/many i/0/-NONE-/i/0 operations/NNS/operations used/VBN/used most/JJS/most of/IN/of the/DT/the available/JJ/available memory/NN/memory for/IN/for caching/NN/caching pages/NNP/pages. because/IN/because of/IN/of the/DT/the high/JJ/high rates/NNS/rates of/IN/of i/0/-NONE-/i/0 /,/, the/DT/the page/NN/page scanner/NN/scanner /:/( section/NN/section 9.10.2/CD/9.10.2 /CD/) reclaimed/VBN/reclaimed pages/NNS/pages from/IN/from processesrather/DT/processesrather than/IN/than from/IN/from the/DT/the page/NN/page cache-when/-NONE-/cache-when free/JJ/free memory/NN/memory ran/VBD/ran low/NNP/low. solaris/NN/solaris 2.6/CD/2.6 and/CC/and solaris/NNS/solaris 7/CD/7 optionally/RB/optionally implemented/VBN/implemented priority/NN/priority paging/NN/paging /,/, in/IN/in which/WDT/which the/DT/the page/NN/page scanner/NN/scanner gives/VBZ/gives priority/NN/priority to/TO/to process/NN/process pages/NNS/pages over/IN/over the/DT/the page/NN/page cache/NNP/cache. solaris/VBZ/solaris 8/CD/8 applied/VBN/applied a/DT/a fixed/VBN/fixed limit/NN/limit to/TO/to process/NN/process pages/NNS/pages and/CC/and the/DT/the file-system/JJ/file-system page/NN/page cache/NN/cache /,/, preventing/VBG/preventing either/DT/either from/IN/from forcing/JJ/forcing the/DT/the other/JJ/other out/IN/out of/IN/of memory/NNP/memory. solaris/VBZ/solaris 9/CD/9 and/CC/and 10/CD/10 again/RB/again changed/VBN/changed the/DT/the algorithms/NNS/algorithms to/TO/to maximize/VB/maximize memory/NN/memory use/NN/use and/CC/and mmimize/NN/mmimize thrashing/VBG/thrashing /./. another/DT/another issue/NN/issue that/IN/that can/MD/can affect/VB/affect the/DT/the performance/NN/performance of/IN/of i/0/-NONE-/i/0 is/VBZ/is whether/IN/whether writes/NNS/writes to/TO/to the/DT/the file/NN/file system/NN/system occur/NN/occur synchronously/RB/synchronously or/CC/or asynchronously/RB/asynchronously /./. occur/NN/occur in/IN/in the/DT/the order/NN/order in/IN/in which/WDT/which the/DT/the disk/NN/disk subsystem/NN/subsystem receives/NNS/receives and/CC/and the/DT/the writes/NNS/writes are/VBP/are not/RB/not buffered/NNP/buffered. thus/RB/thus /,/, the/DT/the calling/NN/calling routine/NN/routine must/MD/must wait/VB/wait for/IN/for the/DT/the data/NNS/data to/TO/to reach/VB/reach the/DT/the disk/NN/disk drive/VBP/drive before/IN/before it/PRP/it can/MD/can proceed/NNP/proceed. in/IN/in an/DT/an the/DT/the data/NN/data are/VBP/are stored/VBN/stored in/IN/in the/DT/the cache/NN/cache /,/, and/CC/and control/NN/control returns/NNS/returns to/TO/to the/DT/the caller/NNP/caller. asynchronous/JJ/asynchronous writes/NNS/writes are/VBP/are done/VBN/done the/DT/the majority/NN/majority of/IN/of the/DT/the time/NNP/time. however/RB/however /,/, metadata/NN/metadata writes/NNS/writes /,/, among/IN/among others/NNS/others /,/, can/MD/can be/VB/be synchronous/NNP/synchronous. operating/NN/operating systems/NNS/systems frequently/RB/frequently include/VBP/include a/DT/a flag/NN/flag in/IN/in the/DT/the open/JJ/open system/NN/system call/NN/call to/TO/to allow/VB/allow a/DT/a process/NN/process to/TO/to request/NN/request that/IN/that writes/NNS/writes be/VB/be performed/VBN/performed synchxonously/-NONE-/synchxonously. for/IN/for example/NN/example /,/, databases/NNS/databases use/VBP/use this/DT/this feature/NN/feature for/IN/for atomic/JJ/atomic transactions/NNS/transactions /,/, to/TO/to assure/VB/assure that/IN/that data/NNS/data reach/VBP/reach stable/JJ/stable storage/NN/storage in/IN/in the/DT/the required/VBN/required order/NN/order /./. some/DT/some systems/NNS/systems optimize/VBP/optimize their/PRP$/their page/NN/page cache/NN/cache by/IN/by using/VBG/using different/JJ/different replacement/NN/replacement algorithms/NNS/algorithms /,/, depending/VBG/depending on/IN/on the/DT/the access/NN/access type/NN/type of/IN/of the/DT/the file/NNP/file. a/DT/a file/NN/file being/VBG/being read/NN/read or/CC/or written/VBN/written sequentially/RB/sequentially should/MD/should not/RB/not have/VB/have its/PRP$/its pages/NNS/pages replaced/VBD/replaced in/IN/in lru/NN/lru order/NN/order /,/, because/IN/because the/DT/the most/RBS/most recently/RB/recently used/VBN/used page/NN/page will/MD/will be/VB/be used/VBN/used last/JJ/last /,/, or/CC/or perhaps/RB/perhaps never/RB/never again/NNP/again. instead/RB/instead /,/, sequential/JJ/sequential access/NN/access can/MD/can be/VB/be optimized/VBN/optimized by/IN/by techniques/NNS/techniques known/VBN/known as/IN/as free-behind/JJ/free-behind and/CC/and read-ahead/NNP/read-ahead. removes/NNS/removes a/DT/a page/NN/page from/IN/from the/DT/the buffer/NN/buffer as/IN/as soon/RB/soon as/IN/as the/DT/the next/JJ/next 486/CD/486 chapter/NN/chapter 11/CD/11 11.7/CD/11.7 page/NN/page is/VBZ/is requested/NNP/requested. the/DT/the previous/JJ/previous are/VBP/are not/RB/not likely/JJ/likely to/TO/to be/VB/be used/VBN/used again/RB/again and/CC/and waste/NN/waste buffer/NN/buffer space/NNP/space. with/IN/with a/DT/a requested/VBN/requested page/NN/page and/CC/and several/JJ/several subsequent/NN/subsequent pages/NNS/pages are/VBP/are read/VBN/read and/CC/and cached/NNP/cached. these/DT/these pages/NNS/pages are/VBP/are likely/JJ/likely to/TO/to be/VB/be requested/VBN/requested after/IN/after the/DT/the current/JJ/current page/NN/page is/VBZ/is processed/NNP/processed. retrieving/NN/retrieving these/DT/these data/NNS/data from/IN/from the/DT/the disk/NN/disk in/IN/in one/CD/one transfer/NN/transfer and/CC/and caching/VBG/caching them/PRP/them saves/VBZ/saves a/DT/a considerable/JJ/considerable ancount/NN/ancount of/IN/of time/NNP/time. one/CD/one might/MD/might think/VB/think that/IN/that a/DT/a track/NN/track cache/NN/cache on/IN/on the/DT/the controller/NN/controller would/MD/would elincinate/VB/elincinate the/DT/the need/NN/need for/IN/for read-ahead/JJ/read-ahead on/IN/on a/DT/a multiprogrammed/VBN/multiprogrammed system/NNP/system. however/RB/however /,/, because/IN/because of/IN/of the/DT/the high/JJ/high latency/NN/latency and/CC/and overhead/JJ/overhead involved/VBN/involved in/IN/in making/NN/making many/JJ/many small/JJ/small transfers/NNS/transfers from/IN/from the/DT/the track/NN/track cache/NN/cache to/TO/to main/VB/main memory/NN/memory /,/, performing/VBG/performing a/DT/a read-ahead/JJ/read-ahead remains/NNS/remains beneficial/JJ/beneficial /./. the/DT/the page/NN/page cache/NN/cache /,/, the/DT/the file/NN/file system/NN/system /,/, and/CC/and the/DT/the disk/NN/disk drivers/NNS/drivers have/VBP/have some/DT/some interesting/JJ/interesting interactions/NNP/interactions. when/WRB/when data/NNS/data are/VBP/are written/VBN/written to/TO/to a/DT/a disk/NN/disk file/NN/file /,/, the/DT/the pages/NNS/pages are/VBP/are buffered/VBN/buffered in/IN/in the/DT/the cache/NN/cache /,/, and/CC/and the/DT/the disk/NN/disk driver/NN/driver sorts/NNS/sorts its/PRP$/its output/NN/output queue/NN/queue according/VBG/according to/TO/to disk/VB/disk address/NN/address /./. these/DT/these two/CD/two actions/NNS/actions allow/VBP/allow the/DT/the disk/NN/disk driver/NN/driver to/TO/to minimize/VB/minimize disk-head/JJ/disk-head seeks/NNS/seeks and/CC/and to/TO/to write/VB/write data/NNS/data at/IN/at times/NNS/times optimized/VBN/optimized for/IN/for disk/NN/disk rotation/NNP/rotation. unless/IN/unless synchronous/JJ/synchronous writes/NNS/writes are/VBP/are required/VBN/required /,/, a/DT/a process/NN/process writing/VBG/writing to/TO/to disk/VB/disk simply/RB/simply writes/VBZ/writes into/IN/into the/DT/the cache/NN/cache /,/, and/CC/and the/DT/the system/NN/system asynchronously/RB/asynchronously writes/VBZ/writes the/DT/the data/NNS/data to/TO/to disk/VB/disk when/WRB/when convenient/NNP/convenient. the/DT/the user/NN/user process/NN/process sees/NNS/sees very/RB/very fast/RB/fast writes/NNP/writes. when/WRB/when data/NNS/data are/VBP/are read/VBN/read from/IN/from a/DT/a disk/NN/disk file/NN/file /,/, the/DT/the block/NN/block i/0/-NONE-/i/0 system/NN/system does/VBZ/does some/DT/some read-ahead/JJ/read-ahead ;/:/; however/RB/however /,/, writes/VBZ/writes are/VBP/are much/RB/much more/RBR/more nearly/RB/nearly asynchronous/JJ/asynchronous than/IN/than are/VBP/are reads/NNP/reads. thus/RB/thus /,/, output/NN/output to/TO/to the/DT/the disk/NN/disk through/IN/through the/DT/the file/NN/file system/NN/system is/VBZ/is often/RB/often faster/JJR/faster than/IN/than is/VBZ/is input/VBN/input for/IN/for large/JJ/large transfers/NNS/transfers /,/, counter/NN/counter to/TO/to intuition/NN/intuition /./. files/NNS/files and/CC/and directories/NNS/directories are/VBP/are kept/VBN/kept both/DT/both in/IN/in main/JJ/main memory/NN/memory and/CC/and on/IN/on disk/NN/disk /,/, and/CC/and care/NN/care must/MD/must be/VB/be taken/VBN/taken to/TO/to ensure/VB/ensure that/IN/that a/DT/a system/NN/system failure/NN/failure does/VBZ/does not/RB/not result/VB/result in/IN/in loss/NN/loss of/IN/of data/NNS/data or/CC/or in/IN/in data/NNS/data inconsistency/NNP/inconsistency. we/PRP/we deal/VBP/deal with/IN/with these/DT/these issues/NNS/issues in/IN/in this/DT/this section/NN/section as/IN/as well/RB/well as/IN/as how/WRB/how a/DT/a system/NN/system can/MD/can recover/VB/recover from/IN/from such/JJ/such a/DT/a failure/NN/failure /./. a/DT/a system/NN/system crash/NN/crash can/MD/can cause/VB/cause inconsistencies/NNS/inconsistencies among/IN/among on-disk/JJ/on-disk file-system/JJ/file-system data/NNS/data structures/NNS/structures /,/, such/JJ/such as/IN/as directory/NN/directory structures/NNS/structures /,/, free-block/JJ/free-block pointers/NNS/pointers /,/, and/CC/and free/JJ/free fcb/NN/fcb pointers/NNP/pointers. many/JJ/many file/NN/file systems/NNS/systems apply/RB/apply changes/NNS/changes to/TO/to these/DT/these structures/NNS/structures in/IN/in place/NNP/place. a/DT/a typical/JJ/typical operation/NN/operation /,/, such/JJ/such as/IN/as creating/NN/creating a/DT/a file/NN/file /,/, can/MD/can involve/VB/involve many/JJ/many structural/JJ/structural changes/NNS/changes within/IN/within the/DT/the file/NN/file system/NN/system on/IN/on the/DT/the disk/NN/disk directory/NN/directory structures/NNS/structures are/VBP/are modified/VBN/modified /,/, fcbs/NNS/fcbs are/VBP/are allocated/VBN/allocated /,/, data/NNS/data blocks/NNS/blocks are/VBP/are allocated/VBN/allocated /,/, and/CC/and the/DT/the free/JJ/free counts/NNS/counts for/IN/for all/DT/all of/IN/of these/DT/these blocks/NNS/blocks are/VBP/are decreased/NNP/decreased. these/DT/these changes/NNS/changes can/MD/can be/VB/be interrupted/VBN/interrupted by/IN/by a/DT/a crash/JJ/crash /,/, and/CC/and inconsistencies/NNS/inconsistencies among/IN/among the/DT/the structures/NNS/structures can/MD/can result/NNP/result. for/IN/for example/NN/example /,/, the/DT/the free/JJ/free fcb/NN/fcb count/NN/count might/MD/might indicate/VB/indicate that/IN/that an/DT/an fcb/NN/fcb had/VBD/had been/VBN/been allocated/VBN/allocated /,/, but/CC/but the/DT/the directory/NN/directory structure/NN/structure might/MD/might not/RB/not point/VB/point to/TO/to the/DT/the fcb/NNP/fcb. compounding/NN/compounding this/DT/this problem/NN/problem is/VBZ/is the/DT/the caching/NN/caching that/IN/that operating/NN/operating systems/NNS/systems do/VBP/do to/TO/to optimize/VB/optimize i/0/-NONE-/i/0 performance/NNP/performance. some/DT/some changes/NNS/changes may/MD/may go/VB/go directly/RB/directly to/TO/to disk/VB/disk /,/, while/IN/while others/NNS/others may/MD/may be/VB/be cached/NNP/cached. if/IN/if the/DT/the cached/VBN/cached changes/NNS/changes do/VBP/do not/RB/not reach/VB/reach disk/NN/disk before/IN/before a/DT/a crash/JJ/crash occurs/NNS/occurs /,/, more/RBR/more corruption/NN/corruption is/VBZ/is possible/JJ/possible /./. in/IN/in addition/NN/addition to/TO/to crashes/NNS/crashes /,/, bugs/NNS/bugs in/IN/in file-system/JJ/file-system implementation/NN/implementation /,/, disk/NN/disk controllers/NNS/controllers /,/, and/CC/and even/RB/even user/JJR/user applications/NNS/applications can/MD/can corrupt/VB/corrupt a/DT/a file/NN/file system/NNP/system. file/NN/file systems/NNS/systems have/VBP/have varying/VBG/varying methods/NNS/methods to/TO/to deal/VB/deal with/IN/with corruption/NN/corruption /,/, depending/VBG/depending on/IN/on the/DT/the file-system/JJ/file-system data/NNS/data structures/NNS/structures and/CC/and algorithms/NNP/algorithms. we/PRP/we deal/VBP/deal with/IN/with these/DT/these issues/NNS/issues next/IN/next /./. 11.7.1/CD/11.7.1 consistency/NN/consistency checking/NN/checking whatever/NN/whatever the/DT/the cause/NN/cause of/IN/of corruption/NN/corruption /,/, a/DT/a file/NN/file system/NN/system must/MD/must first/RB/first detect/VB/detect the/DT/the problems/NNS/problems and/CC/and then/RB/then correct/VB/correct them/NNP/them. for/IN/for detection/NN/detection /,/, a/DT/a scan/NN/scan of/IN/of all/DT/all the/DT/the metadata/NN/metadata on/IN/on each/DT/each file/NN/file 11.7/CD/11.7 487/CD/487 system/NN/system can/MD/can confirm/VB/confirm or/CC/or deny/VB/deny the/DT/the consistency/NN/consistency of/IN/of the/DT/the systenl/NN/systenl unfortunately/RB/unfortunately /,/, this/DT/this scan/NN/scan can/MD/can take/VB/take minutes/NNS/minutes or/CC/or hours/NNS/hours and/CC/and should/MD/should occur/VB/occur every/DT/every time/NN/time the/DT/the system/NN/system boots/NNS/boots /./. alternatively/RB/alternatively /,/, a/DT/a file/NN/file system/NN/system can/MD/can record/VB/record its/PRP$/its state/NN/state within/IN/within the/DT/the file-system/JJ/file-system metadata/NN/metadata /./. at/IN/at the/DT/the start/NN/start of/IN/of any/DT/any metadata/NN/metadata change/NN/change /,/, a/DT/a status/NN/status bit/NN/bit is/VBZ/is set/VBN/set to/TO/to indicate/VB/indicate that/IN/that the/DT/the metadata/NNS/metadata is/VBZ/is in/IN/in flux/NNP/flux. if/IN/if all/DT/all updates/NNS/updates to/TO/to the/DT/the metadata/NN/metadata complete/NN/complete successfully/RB/successfully /,/, the/DT/the file/NN/file system/NN/system can/MD/can clear/VB/clear that/IN/that bit/NNP/bit. it/PRP/it however/RB/however /,/, the/DT/the status/NN/status bit/NN/bit remains/VBZ/remains set/VBN/set /,/, a/DT/a consistency/NN/consistency checker/NN/checker is/VBZ/is run/VBN/run /./. the/DT/the systems/NNS/systems program/NN/program such/JJ/such as/IN/as f/NN/f s/NNS/s ck/VBP/ck in/IN/in unix/NN/unix or/CC/or chkdsk/VB/chkdsk in/IN/in windows-compares/NNS/windows-compares the/DT/the data/NNS/data in/IN/in the/DT/the directory/NN/directory structure/NN/structure with/IN/with the/DT/the data/NNS/data blocks/VBZ/blocks on/IN/on disk/NN/disk and/CC/and tries/NNS/tries to/TO/to fix/VB/fix any/DT/any inconsistencies/NNS/inconsistencies it/PRP/it finds/NNP/finds. the/DT/the allocation/NN/allocation and/CC/and free-space-management/JJ/free-space-management algorithms/NNS/algorithms dictate/VBP/dictate what/WP/what types/NNS/types of/IN/of problems/NNS/problems the/DT/the checker/NN/checker can/MD/can find/VB/find and/CC/and how/WRB/how successful/JJ/successful it/PRP/it will/MD/will be/VB/be in/IN/in fixing/NN/fixing them/NNP/them. for/IN/for instance/NN/instance /,/, if/IN/if linked/VBN/linked allocation/NN/allocation is/VBZ/is used/VBN/used and/CC/and there/EX/there is/VBZ/is a/DT/a link/NN/link from/IN/from any/DT/any block/NN/block to/TO/to its/PRP$/its next/JJ/next block/NN/block /,/, then/RB/then the/DT/the entire/JJ/entire file/NN/file can/MD/can be/VB/be reconstructed/VBN/reconstructed from/IN/from the/DT/the data/NNS/data blocks/VBZ/blocks /,/, and/CC/and the/DT/the directory/NN/directory structure/NN/structure can/MD/can be/VB/be recreated/NNP/recreated. in/IN/in contrast/NN/contrast the/DT/the loss/NN/loss of/IN/of a/DT/a directory/NN/directory entry/NN/entry on/IN/on an/DT/an indexed/VBN/indexed allocation/NN/allocation system/NN/system can/MD/can be/VB/be disastrous/JJ/disastrous /,/, because/IN/because the/DT/the data/NNS/data blocks/VBZ/blocks have/VBP/have no/DT/no knowledge/NN/knowledge of/IN/of one/CD/one another/NNP/another. for/IN/for this/DT/this reason/NN/reason /,/, unix/NN/unix caches/NNS/caches directory/NN/directory entries/NNS/entries for/IN/for reads/NNS/reads ;/:/; but/CC/but any/DT/any write/JJ/write that/IN/that results/NNS/results in/IN/in space/NN/space allocation/NN/allocation /,/, or/CC/or other/JJ/other metadata/NN/metadata changes/NNS/changes /,/, is/VBZ/is done/VBN/done synchronously/RB/synchronously /,/, before/IN/before the/DT/the corresponding/NN/corresponding data/NNS/data blocks/NNS/blocks are/VBP/are written/NNP/written. of/IN/of course/NN/course /,/, problems/NNS/problems can/MD/can still/RB/still occur/VB/occur if/IN/if a/DT/a synchronous/JJ/synchronous write/NN/write is/VBZ/is interrupted/VBN/interrupted by/IN/by a/DT/a crash/JJ/crash /./. 11.7.2/CD/11.7.2 log-structured/JJ/log-structured file/NN/file systems/NNS/systems computer/NN/computer scientists/NNS/scientists often/RB/often fin.d/JJ/fin.d that/IN/that algorithms/NNS/algorithms and/CC/and technologies/NNS/technologies origil1.ally/RB/origil1.ally used/VBN/used in/IN/in one/CD/one area/NN/area are/VBP/are equally/RB/equally useful/JJ/useful in/IN/in other/JJ/other areas/NNP/areas. such/JJ/such is/VBZ/is the/DT/the case/NN/case with/IN/with the/DT/the database/NN/database log-based/JJ/log-based recovery/NN/recovery algorithms/NNS/algorithms described/VBD/described in/IN/in section/NN/section 6.9.2/CD/6.9.2. these/DT/these logging/NN/logging algorithms/NNS/algorithms have/VBP/have been/VBN/been applied/VBN/applied successfully/RB/successfully to/TO/to the/DT/the of/IN/of consistency/NN/consistency '-.il'c'/NN/'-.il'c'-- .ll/NN/.ll the/DT/the resulting/VBG/resulting implementations/NNS/implementations are/VBP/are known/VBN/known as/IN/as /NNP/( or/CC/or file/VB/file systems/NNS/systems /./. note/NN/note that/IN/that with/IN/with the/DT/the consistency-checking/JJ/consistency-checking approach/NN/approach discussed/VBD/discussed in/IN/in the/DT/the preceding/NN/preceding section/NN/section /,/, we/PRP/we essentially/RB/essentially allow/VBP/allow structures/NNS/structures to/TO/to break/VB/break and/CC/and repair/NN/repair them/PRP/them on/IN/on recovery/NNP/recovery. however/RB/however /,/, there/EX/there are/VBP/are several/JJ/several problems/NNS/problems with/IN/with this/DT/this approach/NNP/approach. one/CD/one is/VBZ/is that/IN/that the/DT/the inconsistency/NN/inconsistency may/MD/may be/VB/be irreparable/NNP/irreparable. the/DT/the consistency/NN/consistency check/NN/check may/MD/may not/RB/not be/VB/be able/JJ/able to/TO/to recover/VB/recover the/DT/the structures/NNS/structures /,/, resulting/VBG/resulting in/IN/in loss/NN/loss of/IN/of files/NNS/files and/CC/and even/RB/even entire/JJ/entire directories/NNS/directories /./. consistency/NN/consistency checking/VBG/checking can/MD/can require/VB/require human/JJ/human intervention/NN/intervention to/TO/to resolve/VB/resolve conflicts/NNS/conflicts /,/, and/CC/and that/IN/that is/VBZ/is inconvenient/JJ/inconvenient if/IN/if no/DT/no human/NN/human is/VBZ/is available/NNP/available. the/DT/the system/NN/system can/MD/can remain/VB/remain unavailable/JJ/unavailable until/IN/until the/DT/the human/JJ/human tells/NNS/tells it/PRP/it how/WRB/how to/TO/to proceed/NNP/proceed. consistency/NN/consistency checking/VBG/checking also/RB/also takes/VBZ/takes system/NN/system and/CC/and clock/NN/clock time/NNP/time. to/TO/to check/VB/check terabytes/NNS/terabytes of/IN/of data/NNS/data /,/, hours/NNS/hours of/IN/of clock/NN/clock time/NN/time may/MD/may be/VB/be required/VBN/required /./. the/DT/the solution/NN/solution to/TO/to this/DT/this problem/NN/problem is/VBZ/is to/TO/to apply/RB/apply log-based/JJ/log-based recovery/NN/recovery techniques/NNS/techniques to/TO/to file-system/JJ/file-system metadata/NN/metadata updates/NNP/updates. both/DT/both ntfs/NNS/ntfs and/CC/and the/DT/the veritas/NNS/veritas file/VBP/file system/NN/system use/NN/use this/DT/this method/NN/method /,/, and/CC/and it/PRP/it is/VBZ/is included/VBN/included in/IN/in recent/JJ/recent versions/NNS/versions of/IN/of ufs/NNS/ufs on/IN/on solaris/NNP/solaris. in/IN/in fact/NN/fact it/PRP/it is/VBZ/is becoming/VBG/becoming common/JJ/common on/IN/on many/JJ/many operating/NN/operating systems/NNS/systems /./. fundamentally/RB/fundamentally /,/, all/DT/all metadata/NN/metadata changes/NNS/changes are/VBP/are written/VBN/written each/DT/each set/NN/set of/IN/of operations/NNS/operations for/IN/for performing/VBG/performing a/DT/a specific/JJ/specific task/NN/task is/VBZ/is a/DT/a the/DT/the changes/NNS/changes are/VBP/are written/VBN/written to/TO/to this/DT/this log/NN/log /,/, they/PRP/they are/VBP/are considered/VBN/considered to/TO/to be/VB/be committed/VBN/committed /,/, and/CC/and the/DT/the system/NN/system call/NN/call can/MD/can return/VB/return to/TO/to the/DT/the user/NN/user process/NN/process /,/, allowing/VBG/allowing it/PRP/it to/TO/to continue/VB/continue execution/NNP/execution. meanwhile/RB/meanwhile /,/, these/DT/these log/NN/log entries/NNS/entries are/VBP/are replayed/VBN/replayed across/IN/across the/DT/the actual/JJ/actual filesystem/NN/filesystem structures/NNP/structures. as/IN/as the/DT/the changes/NNS/changes are/VBP/are made/VBN/made /,/, a/DT/a pointer/NN/pointer is/VBZ/is updated/VBN/updated to/TO/to indicate/VB/indicate 488/CD/488 chapter/NN/chapter 11/CD/11 which/WDT/which actions/NNS/actions have/VBP/have completed/VBN/completed and/CC/and which/WDT/which are/VBP/are still/RB/still incomplete/NNP/incomplete. when/WRB/when an/DT/an entire/JJ/entire committed/VBN/committed transaction/NN/transaction is/VBZ/is completed/VBN/completed /,/, it/PRP/it is/VBZ/is removed/VBN/removed from/IN/from the/DT/the log/NN/log file/NN/file /,/, which/WDT/which is/VBZ/is actually/RB/actually a/DT/a circular/JJ/circular buffer/NNP/buffer. a/DT/a cb/NN/cb /:/: ul/JJ/ul ;/:/; n/NN/n writes/VBZ/writes to/TO/to the/DT/the end/NN/end of/IN/of its/PRP$/its space/NN/space and/CC/and then/RB/then continues/VBZ/continues at/IN/at the/DT/the beginning/NN/beginning /,/, overwriting/VBG/overwriting older/JJR/older values/NNS/values as/IN/as it/PRP/it goes/NNP/goes. we/PRP/we would/MD/would not/RB/not want/VB/want the/DT/the buffer/NN/buffer to/TO/to write/VB/write over/IN/over data/NNS/data that/WDT/that had/VBD/had not/RB/not yet/RB/yet been/VBN/been saved/VBN/saved /,/, so/RB/so that/IN/that scenario/NN/scenario is/VBZ/is avoided/NNP/avoided. the/DT/the log/NN/log may/MD/may be/VB/be in/IN/in a/DT/a separate/JJ/separate section/NN/section of/IN/of the/DT/the file/NN/file system/NN/system or/CC/or even/RB/even on/IN/on a/DT/a separate/JJ/separate disk/NN/disk spindle/NNP/spindle. it/PRP/it is/VBZ/is more/RBR/more efficient/JJ/efficient /,/, but/CC/but more/RBR/more complex/JJ/complex /,/, to/TO/to have/VB/have it/PRP/it under/IN/under separate/JJ/separate read/NN/read and/CC/and write/VB/write heads/NNS/heads /,/, thereby/RB/thereby decreasing/VBG/decreasing head/NN/head contention/NN/contention and/CC/and seek/NN/seek times/NNS/times /./. if/IN/if the/DT/the system/NN/system crashes/VBZ/crashes /,/, the/DT/the log/NN/log file/NN/file will/MD/will contain/VB/contain zero/NN/zero or/CC/or more/JJR/more transactions/NNS/transactions /./. any/DT/any transactions/NNS/transactions it/PRP/it contains/VBZ/contains were/VBD/were not/RB/not completed/VBN/completed to/TO/to the/DT/the file/NN/file system/NN/system /,/, even/RB/even though/IN/though they/PRP/they were/VBD/were committed/VBN/committed by/IN/by the/DT/the operating/NN/operating system/NN/system /,/, so/RB/so they/PRP/they must/MD/must now/RB/now be/VB/be completed/VBN/completed /./. the/DT/the transactions/NNS/transactions can/MD/can be/VB/be executed/VBN/executed from/IN/from the/DT/the pointer/NN/pointer until/IN/until the/DT/the work/NN/work is/VBZ/is complete/JJ/complete so/RB/so that/IN/that the/DT/the file-system/JJ/file-system structures/NNS/structures remain/VBP/remain consistent/JJ/consistent the/DT/the only/JJ/only problem/NN/problem occurs/NNS/occurs when/WRB/when a/DT/a transaction/NN/transaction was/VBD/was aborted/VBN/aborted -that/-NONE-/-that is/VBZ/is /,/, was/VBD/was not/RB/not committed/VBN/committed before/IN/before the/DT/the system/NN/system crashed/NNP/crashed. any/DT/any changes/NNS/changes from/IN/from such/JJ/such a/DT/a transaction/NN/transaction that/WDT/that were/VBD/were applied/VBN/applied to/TO/to the/DT/the file/NN/file system/NN/system must/MD/must be/VB/be undone/VBN/undone /,/, again/RB/again preserving/VBG/preserving the/DT/the consistency/NN/consistency of/IN/of the/DT/the file/NN/file system/NN/system /./. this/DT/this recovery/NN/recovery is/VBZ/is all/DT/all that/DT/that is/VBZ/is needed/VBN/needed after/IN/after a/DT/a crash/NN/crash /,/, elimil/NN/elimil ating/VBG/ating any/DT/any problems/NNS/problems with/IN/with consistency/NN/consistency checking/VBG/checking /./. a/DT/a side/NN/side benefit/NN/benefit of/IN/of using/VBG/using logging/NN/logging on/IN/on disk/NN/disk metadata/NN/metadata updates/VBZ/updates is/VBZ/is that/IN/that those/DT/those updates/NNS/updates proceed/VBP/proceed much/RB/much faster/JJR/faster than/IN/than when/WRB/when they/PRP/they are/VBP/are applied/VBN/applied directly/RB/directly to/TO/to the/DT/the on-disk/JJ/on-disk data/NNS/data structures/NNP/structures. the/DT/the reason/NN/reason for/IN/for this/DT/this improvement/NN/improvement is/VBZ/is found/VBN/found in/IN/in the/DT/the performance/NN/performance advantage/NN/advantage of/IN/of sequential/JJ/sequential i/0/-NONE-/i/0 over/IN/over random/NN/random i/0/NNP/i/0. the/DT/the costly/JJ/costly synchronous/JJ/synchronous random/NN/random meta/NN/meta data/NNS/data writes/VBZ/writes are/VBP/are turned/VBN/turned into/IN/into much/RB/much less/JJR/less costly/RB/costly synchronous/JJ/synchronous sequential/JJ/sequential writes/NNS/writes to/TO/to the/DT/the log-structured/JJ/log-structured file/NN/file system/NN/system 's/POS/'s loggil/NN/loggil g/NN/g area/NNP/area. those/DT/those changes/NNS/changes in/IN/in turn/NN/turn are/VBP/are replayed/VBN/replayed asynchronously/RB/asynchronously via/IN/via random/NN/random writes/NNS/writes to/TO/to the/DT/the appropriate/NN/appropriate structures/NNS/structures /./. the/DT/the overall/JJ/overall result/NN/result is/VBZ/is a/DT/a significant/JJ/significant gain/NN/gain in/IN/in performance/NN/performance of/IN/of metadata-oriented/JJ/metadata-oriented operations/NNS/operations /,/, such/JJ/such as/IN/as file/JJ/file creation/NN/creation and/CC/and deletion/NN/deletion /./. 11.7.3/CD/11.7.3 other/JJ/other solutions/NNS/solutions another/DT/another alternative/NN/alternative to/TO/to consistency/NN/consistency checking/NN/checking is/VBZ/is employed/VBN/employed by/IN/by network/NN/network appliance/NN/appliance 's/POS/'s wafl/NN/wafl file/NN/file system/NN/system and/CC/and sun/NN/sun 's/POS/'s zfs/NNS/zfs file/IN/file system/NNP/system. these/DT/these systems/NNS/systems never/RB/never overwrite/JJ/overwrite blocks/NNS/blocks with/IN/with new/JJ/new data/NNP/data. rather/RB/rather /,/, a/DT/a transaction/NN/transaction writes/VBZ/writes all/DT/all data/NNS/data and/CC/and metadata/NNS/metadata changes/NNS/changes to/TO/to new/JJ/new blocks/NNP/blocks. when/WRB/when the/DT/the transaction/NN/transaction is/VBZ/is complete/JJ/complete /,/, the/DT/the metadata/NN/metadata structures/NNS/structures that/WDT/that pointed/VBD/pointed to/TO/to the/DT/the old/JJ/old versions/NNS/versions of/IN/of these/DT/these blocks/NNS/blocks are/VBP/are updated/VBN/updated to/TO/to point/NN/point to/TO/to the/DT/the new/JJ/new blocks/NNP/blocks. the/DT/the file/NN/file system/NN/system can/MD/can then/RB/then remove/VB/remove the/DT/the old/JJ/old pointers/NNS/pointers and/CC/and the/DT/the old/JJ/old blocks/NNS/blocks and/CC/and make/VB/make them/PRP/them available/JJ/available for/IN/for reuse/NNP/reuse. if/IN/if the/DT/the old/JJ/old pointers/NNS/pointers and/CC/and blocks/NNS/blocks are/VBP/are kept/VBN/kept /,/, a/DT/a is/VBZ/is created/VBN/created ;/:/; the/DT/the snapshot/NN/snapshot is/VBZ/is a/DT/a view/NN/view of/IN/of the/DT/the file/NN/file system/NN/system before/IN/before the/DT/the last/JJ/last update/NN/update took/VBD/took place/NNP/place. this/DT/this solution/NN/solution should/MD/should require/VB/require no/DT/no consistency/NN/consistency checking/VBG/checking if/IN/if the/DT/the pointer/NN/pointer update/NN/update is/VBZ/is done/VBN/done atomically/-NONE-/atomically. wafl/NN/wafl does/VBZ/does have/VB/have a/DT/a consistency/NN/consistency checke1/NNP/checke1 ~/NNP/~ however/RB/however /,/, so/RB/so some/DT/some failure/NN/failure scenarios/NNS/scenarios can/MD/can still/RB/still cause/VB/cause metadata/NNS/metadata corruption/NNP/corruption. /NNP/( see/VB/see 11.9/CD/11.9 for/IN/for details/NNS/details of/IN/of the/DT/the wafl/NN/wafl file/NN/file system/NNP/system. /NNP/) sun/NN/sun 's/POS/'s zfs/NNS/zfs takes/VBZ/takes an/DT/an even/RB/even more/RBR/more im/JJ/im ovative/JJ/ovative approach/NN/approach to/TO/to disk/VB/disk consistency/NN/consistency /./. it/PRP/it never/RB/never overwrites/VBZ/overwrites blocks/NNS/blocks /,/, just/RB/just as/IN/as is/VBZ/is the/DT/the case/NN/case with/IN/with wafl/NNP/wafl. however/RB/however /,/, zfs/VBZ/zfs goes/VBZ/goes further/RB/further and/CC/and provides/VBZ/provides check-summing/JJ/check-summing of/IN/of all/DT/all metadata/NN/metadata and/CC/and data/NNS/data blocks/NNP/blocks. this/DT/this solution/NN/solution /:/( when/WRB/when combined/VBN/combined with/IN/with raid/JJ/raid /NN/) assures/NNS/assures that/WDT/that data/NNS/data are/VBP/are always/RB/always correct/NNP/correct. zfs/NNS/zfs therefore/VBP/therefore has/VBZ/has no/DT/no consistency/NN/consistency checker/NNP/checker. /NNP/( more/JJR/more details/NNS/details on/IN/on zfs/NNS/zfs are/VBP/are found/VBN/found in/IN/in section/NN/section 12.7.6/CD/12.7.6. /CD/) 11.7/CD/11.7 489/CD/489 11.7.4/CD/11.7.4 backup/NN/backup and/CC/and restore/VB/restore magnetic/JJ/magnetic disks/NNS/disks sometimes/RB/sometimes fail/VBP/fail /,/, and/CC/and care/NN/care must/MD/must be/VB/be taken/VBN/taken to/TO/to ensure/VB/ensure that/IN/that the/DT/the data/NNS/data lost/VBD/lost in/IN/in such/JJ/such a/DT/a failure/NN/failure are/VBP/are not/RB/not lost/VBN/lost forever/NNP/forever. to/TO/to this/DT/this end/NN/end /,/, system/NN/system programs/NNS/programs can/MD/can be/VB/be used/VBN/used to/TO/to data/NNS/data from/IN/from disk/NN/disk to/TO/to another/DT/another storage/NN/storage device/NN/device /,/, such/JJ/such as/IN/as a/DT/a floppy/NN/floppy disk/NN/disk /,/, magnetic/JJ/magnetic tape/NN/tape /,/, optical/JJ/optical disk/NN/disk /,/, or/CC/or other/JJ/other hard/JJ/hard disk/NNP/disk. recovery/NN/recovery from/IN/from the/DT/the loss/NN/loss of/IN/of an/DT/an individual/NN/individual file/NN/file /,/, or/CC/or of/IN/of an/DT/an entire/JJ/entire disk/NN/disk /,/, may/MD/may then/RB/then be/VB/be a/DT/a matter/NN/matter of/IN/of the/DT/the data/NNS/data from/IN/from backup/NN/backup /./. to/TO/to minimize/VB/minimize the/DT/the copying/NN/copying needed/VBD/needed /,/, we/PRP/we can/MD/can use/VB/use information/NN/information from/IN/from each/DT/each file/NN/file 's/POS/'s directory/NN/directory entry/NNP/entry. for/IN/for instance/NN/instance /,/, if/IN/if the/DT/the backup/NN/backup program/NN/program knows/VBZ/knows when/WRB/when the/DT/the last/JJ/last backup/NN/backup of/IN/of a/DT/a file/NN/file was/VBD/was done/VBN/done /,/, and/CC/and the/DT/the file/NN/file 's/POS/'s last/JJ/last write/NN/write date/NN/date in/IN/in the/DT/the directory/NN/directory indicates/VBZ/indicates that/IN/that the/DT/the file/NN/file has/VBZ/has not/RB/not changed/VBN/changed since/IN/since that/DT/that date/NN/date /,/, then/RB/then the/DT/the file/NN/file does/VBZ/does not/RB/not need/VBP/need to/TO/to be/VB/be copied/VBN/copied again/-NONE-/again. a/DT/a typical/JJ/typical backup/NN/backup schedule/NN/schedule may/MD/may then/RB/then be/VB/be as/RB/as follows/VBZ/follows /:/: 1/CD/1. copy/NN/copy to/TO/to a/DT/a backup/NN/backup medium/NN/medium all/DT/all files/NNS/files from/IN/from the/DT/the disk/NNP/disk. this/DT/this is/VBZ/is called/VBN/called a/DT/a to/TO/to another/DT/another medium/NN/medium all/DT/all files/NNS/files changed/VBD/changed since/IN/since day/NN/day 1/CD/1. this/DT/this is/VBZ/is an/DT/an day/NN/day 3/CD/3. copy/NN/copy to/TO/to another/DT/another medium/NN/medium all/DT/all files/NNS/files changed/VBD/changed since/IN/since day/NN/day 2/CD/2 /./. day/NN/day n/NNP/n. copy/NN/copy to/TO/to another/DT/another medium/NN/medium all/DT/all files/NNS/files changed/VBD/changed since/IN/since day/NN/day n-1/NNP/n-1. then/RB/then go/VB/go back/RB/back to/TO/to day/NN/day 1/CD/1 /./. the/DT/the new/JJ/new cycle/NN/cycle can/MD/can have/VB/have its/PRP$/its backup/NN/backup written/VBN/written over/IN/over the/DT/the previous/JJ/previous set/NN/set or/CC/or onto/IN/onto a/DT/a new/JJ/new set/NN/set of/IN/of backup/NN/backup media/NNP/media. in/IN/in this/DT/this manner/NN/manner /,/, we/PRP/we can/MD/can restore/VB/restore an/DT/an entire/JJ/entire disk/NN/disk by/IN/by starting/NN/starting restores/NNS/restores with/IN/with the/DT/the full/JJ/full backup/NN/backup and/CC/and continuing/VBG/continuing through/IN/through each/DT/each of/IN/of the/DT/the incremental/JJ/incremental backups/NNP/backups. of/IN/of course/NN/course /,/, the/DT/the larger/JJR/larger the/DT/the value/NN/value of/IN/of n/NN/n /,/, the/DT/the greater/JJR/greater the/DT/the number/NN/number of/IN/of media/NNS/media that/WDT/that must/MD/must be/VB/be read/VBN/read for/IN/for a/DT/a complete/JJ/complete restore/NNP/restore. an/DT/an added/VBD/added advantage/NN/advantage of/IN/of this/DT/this backup/NN/backup cycle/NN/cycle is/VBZ/is that/IN/that we/PRP/we can/MD/can restore/VB/restore any/DT/any file/NN/file accidentally/RB/accidentally deleted/VBN/deleted during/IN/during the/DT/the cycle/NN/cycle by/IN/by retrieving/NN/retrieving the/DT/the deleted/VBN/deleted file/NN/file from/IN/from the/DT/the backup/NN/backup of/IN/of the/DT/the previous/JJ/previous day/NNP/day. the/DT/the length/NN/length of/IN/of the/DT/the cycle/NN/cycle is/VBZ/is a/DT/a compromise/NN/compromise between/IN/between the/DT/the amount/NN/amount of/IN/of backup/NN/backup medium/NN/medium needed/VBN/needed and/CC/and the/DT/the number/NN/number of/IN/of days/NNS/days back/VBP/back from/IN/from which/WDT/which a/DT/a restore/NN/restore can/MD/can be/VB/be done/NNP/done. to/TO/to decrease/VB/decrease the/DT/the number/NN/number of/IN/of tapes/NNS/tapes that/WDT/that must/MD/must be/VB/be read/VBN/read to/TO/to do/VB/do a/DT/a restore/VB/restore /,/, an/DT/an option/NN/option is/VBZ/is to/TO/to perform/NN/perform a/DT/a full/JJ/full backup/NN/backup and/CC/and then/RB/then each/DT/each day/NN/day back/RB/back up/IN/up all/DT/all files/NNS/files that/WDT/that have/VBP/have changed/VBN/changed since/IN/since the/DT/the full/JJ/full backup/NNP/backup. in/IN/in this/DT/this way/NN/way /,/, a/DT/a restore/NN/restore can/MD/can be/VB/be done/VBN/done via/IN/via the/DT/the most/RBS/most recent/JJ/recent incremental/NN/incremental backup/NN/backup and/CC/and the/DT/the full/JJ/full backup/NN/backup /,/, with/IN/with no/DT/no other/JJ/other incremental/JJ/incremental backups/NNS/backups needed/NNP/needed. the/DT/the trade-off/JJ/trade-off is/VBZ/is that/IN/that more/JJR/more files/NNS/files will/MD/will be/VB/be modified/VBN/modified each/DT/each day/NN/day /,/, so/RB/so each/DT/each successive/JJ/successive incremental/JJ/incremental backup/NN/backup involves/VBZ/involves more/JJR/more files/NNS/files and/CC/and more/JJR/more backup/NN/backup media/NNS/media /./. a/DT/a user/NN/user ncay/NN/ncay notice/NN/notice that/WDT/that a/DT/a particular/JJ/particular file/NN/file is/VBZ/is missing/VBG/missing or/CC/or corrupted/VBN/corrupted long/JJ/long after/IN/after the/DT/the damage/NN/damage was/VBD/was done/NNP/done. for/IN/for this/DT/this reason/NN/reason /,/, we/PRP/we usually/RB/usually plan/VBP/plan to/TO/to take/VB/take a/DT/a full/JJ/full backup/NN/backup from/IN/from time/NN/time to/TO/to time/VB/time that/IN/that will/MD/will be/VB/be saved/VBN/saved forever/NNP/forever. it/PRP/it is/VBZ/is a/DT/a good/JJ/good idea/NN/idea to/TO/to store/VB/store these/DT/these permanent/JJ/permanent backups/NNS/backups far/RB/far away/RB/away from/IN/from the/DT/the regular/JJ/regular backups/NNS/backups to/TO/to protect/VB/protect against/IN/against hazard/NN/hazard /,/, such/JJ/such as/IN/as a/DT/a fire/NN/fire that/WDT/that destroys/VBZ/destroys the/DT/the computer/NN/computer and/CC/and all/DT/all the/DT/the backups/NNS/backups too/RB/too /./. and/CC/and if/IN/if the/DT/the backup/NN/backup cycle/NN/cycle reuses/NNS/reuses media/NNS/media /,/, we/PRP/we must/MD/must take/VB/take care/NN/care not/RB/not to/TO/to reuse/VB/reuse the/DT/the 490/CD/490 chapter/NN/chapter 11/CD/11 11.8/CD/11.8 media/NNS/media too/RB/too many/JJ/many times-if/JJ/times-if the/DT/the media/NNS/media wear/VBP/wear out/RP/out /,/, it/PRP/it might/MD/might not/RB/not be/VB/be possible/JJ/possible to/TO/to restore/VB/restore any/DT/any data/NNS/data from/IN/from the/DT/the backups/NNS/backups /./. network/NN/network file/NN/file systems/NNS/systems are/VBP/are commonplace/NNP/commonplace. they/PRP/they are/VBP/are typically/RB/typically integrated/VBN/integrated with/IN/with the/DT/the overall/JJ/overall directory/NN/directory structure/NN/structure and/CC/and interface/NN/interface of/IN/of the/DT/the client/NN/client system/NNP/system. nfs/VBZ/nfs is/VBZ/is a/DT/a good/JJ/good example/NN/example of/IN/of a/DT/a widely/RB/widely used/JJ/used /,/, well-implemented/JJ/well-implemented client-server/NN/client-server network/NN/network file/NN/file system/NNP/system. here/RB/here /,/, we/PRP/we use/VBP/use it/PRP/it as/IN/as an/DT/an example/NN/example to/TO/to explore/VB/explore the/DT/the implementation/NN/implementation details/NNS/details of/IN/of network/NN/network file/NN/file systems/NNS/systems /./. nfs/NNS/nfs is/VBZ/is both/DT/both an/DT/an implementation/NN/implementation and/CC/and a/DT/a specification/NN/specification of/IN/of a/DT/a software/NN/software system/NN/system for/IN/for accessing/NN/accessing remote/NN/remote files/NNS/files across/IN/across lans/NNS/lans /:/( or/CC/or even/RB/even wans/VBZ/wans /:/) /./. nfs/NNS/nfs is/VBZ/is part/NN/part of/IN/of onc/NN/onc +/:/+ /,/, which/WDT/which most/RBS/most unix/CD/unix vendors/NNS/vendors and/CC/and some/DT/some pc/NN/pc operating/NN/operating systems/NNS/systems support/NNP/support. the/DT/the implementation/NN/implementation described/VBD/described here/RB/here is/VBZ/is part/NN/part of/IN/of the/DT/the solaris/NNS/solaris operating/VBG/operating system/NN/system /,/, which/WDT/which is/VBZ/is a/DT/a modified/VBN/modified version/NN/version of/IN/of unix/NN/unix svr4/NNP/svr4 running/NN/running on/IN/on sun/NN/sun workstations/NNS/workstations and/CC/and other/JJ/other hardware/NNP/hardware. it/PRP/it uses/VBZ/uses either/DT/either the/DT/the tcp/NN/tcp or/CC/or udp/VB/udp /ip/JJ//ip protocol/NN/protocol /:/( depending/VBG/depending on/IN/on the/DT/the interconnecting/NN/interconnecting network/NN/network /:/) /./. the/DT/the specification/NN/specification and/CC/and the/DT/the implementation/NN/implementation are/VBP/are intertwined/VBN/intertwined in/IN/in our/PRP$/our description/NN/description of/IN/of nfs/NNP/nfs. whenever/NN/whenever detail/NN/detail is/VBZ/is needed/VBN/needed /,/, we/PRP/we refer/VBP/refer to/TO/to the/DT/the sun/NN/sun implementation/NN/implementation ;/:/; whenever/NN/whenever the/DT/the description/NN/description is/VBZ/is general/JJ/general /,/, it/PRP/it applies/VBZ/applies to/TO/to the/DT/the specification/NN/specification also/RB/also /./. there/EX/there are/VBP/are multiple/JJ/multiple versions/NNS/versions of/IN/of nfs/NNS/nfs /,/, with/IN/with the/DT/the latest/JJS/latest being/VBG/being version/NN/version 4/CD/4. here/RB/here /,/, we/PRP/we describe/VBP/describe version/NN/version 3/CD/3 /,/, as/IN/as that/DT/that is/VBZ/is the/DT/the one/CD/one most/JJS/most commonly/RB/commonly deployed/VBN/deployed /./. 11.8.1/CD/11.8.1 overview/NN/overview nfs/NNS/nfs views/NNS/views a/DT/a set/NN/set of/IN/of interconnected/VBN/interconnected workstations/NNS/workstations as/IN/as a/DT/a set/NN/set of/IN/of independent/JJ/independent machines/NNS/machines with/IN/with independent/JJ/independent file/NN/file systems/NNP/systems. the/DT/the goal/NN/goal is/VBZ/is to/TO/to allow/VB/allow some/DT/some degree/NN/degree of/IN/of sharing/VBG/sharing among/IN/among these/DT/these file/JJ/file systems/NNS/systems /:/( on/IN/on explicit/NN/explicit request/NN/request /:/) in/IN/in a/DT/a transparent/NN/transparent manner/NNP/manner. sharing/NN/sharing is/VBZ/is based/VBN/based on/IN/on a/DT/a client-server/JJ/client-server relationship/NNP/relationship. a/DT/a machine/NN/machine may/MD/may be/VB/be /,/, and/CC/and often/RB/often is/VBZ/is /,/, both/DT/both a/DT/a client/NN/client and/CC/and a/DT/a server/NNP/server. sharing/NN/sharing is/VBZ/is allowed/VBN/allowed between/IN/between any/DT/any pair/NN/pair of/IN/of machines/NNP/machines. to/TO/to ensure/VB/ensure machine/NN/machine independence/NN/independence /,/, sharing/VBG/sharing of/IN/of a/DT/a remote/NN/remote file/NN/file system/NN/system affects/NNS/affects only/RB/only the/DT/the client/NN/client machine/NN/machine and/CC/and no/DT/no other/JJ/other machine/NN/machine /./. so/RB/so that/IN/that a/DT/a remote/NN/remote directory/NN/directory will/MD/will be/VB/be accessible/JJ/accessible in/IN/in a/DT/a transparent/NN/transparent manner/NN/manner from/IN/from a/DT/a particular/JJ/particular machine-say/NN/machine-say /,/, from/IN/from ml-a/NNP/ml-a client/NN/client of/IN/of that/DT/that machine/NN/machine must/MD/must first/RB/first carry/VB/carry out/RP/out a/DT/a mount/NN/mount operation/NNP/operation. the/DT/the semantics/NNS/semantics of/IN/of the/DT/the operation/NN/operation involve/NN/involve mounting/VBG/mounting a/DT/a remote/NN/remote directory/NN/directory over/IN/over a/DT/a directory/NN/directory of/IN/of a/DT/a local/JJ/local file/NN/file system/NNP/system. once/RB/once the/DT/the mount/NN/mount operation/NN/operation is/VBZ/is completed/VBN/completed /,/, the/DT/the mounted/VBN/mounted directory/NN/directory looks/NNS/looks like/IN/like an/DT/an integral/JJ/integral subtree/NN/subtree of/IN/of the/DT/the local/JJ/local file/NN/file system/NN/system /,/, replacing/VBG/replacing the/DT/the subtree/NN/subtree descending/VBG/descending from/IN/from the/DT/the local/JJ/local directory/NNP/directory. the/DT/the local/JJ/local directory/NN/directory becomes/VBZ/becomes the/DT/the name/NN/name of/IN/of the/DT/the root/NN/root of/IN/of the/DT/the newly/RB/newly mounted/VBN/mounted directory/NNP/directory. specification/NN/specification of/IN/of the/DT/the remote/NN/remote directory/NN/directory as/IN/as an/DT/an argument/NN/argument for/IN/for the/DT/the mount/NN/mount operation/NN/operation is/VBZ/is not/RB/not done/VBN/done transparently/RB/transparently ;/:/; the/DT/the location/NN/location /:/( or/CC/or host/NN/host name/NN/name /:/) of/IN/of the/DT/the remote/NN/remote directory/NN/directory has/VBZ/has to/TO/to be/VB/be provided/NNP/provided. however/RB/however /,/, fron/NN/fron l/NN/l then/RB/then on/IN/on /,/, users/NNS/users on/IN/on machine/NN/machine ml/NN/ml can/MD/can access/NN/access files/NNS/files in/IN/in the/DT/the remote/NN/remote directory/NN/directory in/IN/in a/DT/a totally/RB/totally transparent/JJ/transparent manner/NN/manner /./. to/TO/to illustrate/VB/illustrate file/JJ/file mounting/NN/mounting /,/, consider/NN/consider the/DT/the file/NN/file system/NN/system depicted/VBD/depicted in/IN/in figure/NN/figure 11.13/CD/11.13 /,/, where/WRB/where the/DT/the triangles/NNS/triangles represent/VBP/represent subtrees/NNS/subtrees of/IN/of directories/NNS/directories that/WDT/that are/VBP/are of/IN/of interest/NNP/interest. the/DT/the figure/NN/figure shows/VBZ/shows three/CD/three independent/JJ/independent file/NN/file systems/NNS/systems of/IN/of machines/NNS/machines named/VBN/named u/NN/u /,/, 51/CD/51 /,/, and/CC/and 52/CD/52. at/IN/at this/DT/this point/NN/point /,/, on/IN/on each/DT/each machine/NN/machine /,/, only/RB/only the/DT/the local/JJ/local files/NNS/files can/MD/can be/VB/be accessed/NNP/accessed. figure/NN/figure 11.14/CD/11.14 /CD/( a/DT/a /NN/) shows/VBZ/shows the/DT/the effects/NNS/effects of/IN/of mounting/VBG/mounting 81/CD/81 /:/: /usr/shared/JJ//usr/shared over/IN/over u/NN/u /:/: /usr/local/JJ//usr/local /./. this/DT/this figure/NN/figure depicts/VBZ/depicts the/DT/the view/NN/view users/NNS/users on/IN/on u/NN/u have/VBP/have of/IN/of their/PRP$/their file/NN/file system/NNP/system. notice/NN/notice that/WDT/that after/IN/after the/DT/the mount/NN/mount is/VBZ/is complete/JJ/complete /,/, they/PRP/they can/MD/can access/VB/access any/DT/any file/NN/file within/IN/within the/DT/the dirl/NN/dirl directory/NN/directory 11.8/CD/11.8 491/CD/491 u/NN/u /:/: s1/NNP/s1 /:/: s2/NNP/s2 /:/: usr/NN/usr usr/NN/usr usr/NN/usr figure/NN/figure 11.13/CD/11.13 three/CD/three independent/JJ/independent file/NN/file systems/NNS/systems /./. using/VBG/using the/DT/the prefix/NN/prefix /usr/NN//usr /local//NN//local/ dir1/NNP/dir1. the/DT/the original/JJ/original directory/NN/directory /usr/NN//usr /local/JJ//local on/IN/on that/DT/that machine/NN/machine is/VBZ/is no/DT/no longer/NN/longer visible/JJ/visible /./. subject/JJ/subject to/TO/to access-rights/NNS/access-rights accreditation/NN/accreditation /,/, any/DT/any file/NN/file system/NN/system /,/, or/CC/or any/DT/any directory/NN/directory within/IN/within a/DT/a file/NN/file system/NN/system /,/, can/MD/can be/VB/be mounted/VBN/mounted remotely/RB/remotely on/IN/on top/JJ/top of/IN/of any/DT/any local/JJ/local directory/NN/directory /./. diskless/NN/diskless workstations/NNS/workstations can/MD/can even/RB/even mount/VB/mount their/PRP$/their own/JJ/own roots/NNS/roots from/IN/from servers/NNP/servers. cascading/NN/cascading mounts/NNS/mounts are/VBP/are also/RB/also permitted/VBN/permitted in/IN/in some/DT/some nfs/NNS/nfs implementations/NNP/implementations. that/IN/that is/VBZ/is /,/, a/DT/a file/NN/file system/NN/system can/MD/can be/VB/be mounted/VBN/mounted over/RP/over another/DT/another file/NN/file system/NN/system that/WDT/that is/VBZ/is remotely/RB/remotely mounted/VBN/mounted /,/, not/RB/not local/NNP/local. a/DT/a machine/NN/machine is/VBZ/is affected/VBN/affected by/IN/by only/RB/only those/DT/those mounts/NNS/mounts that/IN/that it/PRP/it has/VBZ/has itself/PRP/itself invoked/NNP/invoked. mounting/VBG/mounting a/DT/a remote/NN/remote file/NN/file system/NN/system does/VBZ/does not/RB/not give/VB/give the/DT/the client/NN/client access/NN/access to/TO/to other/JJ/other file/NN/file systems/NNS/systems that/WDT/that were/VBD/were /,/, by/IN/by chance/NN/chance /,/, mounted/VBN/mounted over/IN/over the/DT/the former/JJ/former file/NN/file system/NNP/system. thus/RB/thus /,/, the/DT/the mount/NN/mount mechanism/NN/mechanism does/VBZ/does not/RB/not exhibit/VB/exhibit a/DT/a transitivity/NN/transitivity property/NN/property /./. in/IN/in figure/NN/figure 11.14/CD/11.14 /CD/( b/NN/b /:/) /,/, we/PRP/we illustrate/VBP/illustrate cascading/VBG/cascading mounts/NNP/mounts. the/DT/the figure/NN/figure shows/VBZ/shows the/DT/the result/NN/result of/IN/of mounting/NN/mounting s2/NNP/s2 /:/: /usr/JJ//usr /dir2/-NONE-//dir2 over/IN/over u/NN/u /:/: /usr/local/dir1/-NONE-//usr/local/dir1 /,/, which/WDT/which is/VBZ/is already/RB/already remotely/RB/remotely mounted/VBN/mounted from/IN/from 51/CD/51. users/NNS/users can/MD/can access/NN/access files/NNS/files within/IN/within dir2/NNP/dir2 on/IN/on u/NN/u using/VBG/using the/DT/the u/NN/u /:/: u/NN/u /:/: /:/( a/DT/a /NN/) /:/( b/NN/b /:/) figure/NN/figure 11.14/CD/11.14 mounting/VBG/mounting in/IN/in nfs/NNP/nfs. /NNP/( a/DT/a /NN/) mounts/NNP/mounts. /NNP/( b/NN/b /:/) cascading/VBG/cascading mounts/NNS/mounts /./. 492/CD/492 chapter/NN/chapter 11/CD/11 prefix/CD/prefix /usr/local/dir1/NNP//usr/local/dir1. if/IN/if a/DT/a shared/VBN/shared file/NN/file system/NN/system is/VBZ/is mounted/VBN/mounted over/IN/over a/DT/a user/NN/user 's/POS/'s home/NN/home directories/NNS/directories on/IN/on all/DT/all machines/NNS/machines in/IN/in a/DT/a network/NN/network /,/, the/DT/the user/NN/user can/MD/can log/VB/log into/IN/into any/DT/any workstation/NN/workstation and/CC/and get/VB/get his/PRP$/his honce/NN/honce environment/NNP/environment. this/DT/this property/NN/property permits/VBZ/permits one/CD/one of/IN/of the/DT/the design/NN/design goals/NNS/goals of/IN/of nfs/NNS/nfs was/VBD/was to/TO/to operate/VB/operate in/IN/in a/DT/a heterogeneous/JJ/heterogeneous environment/NN/environment of/IN/of different/JJ/different machines/NNS/machines /,/, operating/VBG/operating systems/NNS/systems /,/, and/CC/and network/NN/network architectures/NNS/architectures /./. the/DT/the nfs/NNS/nfs specification/NN/specification is/VBZ/is independent/JJ/independent of/IN/of these/DT/these media/NNS/media and/CC/and thus/RB/thus encourages/VBZ/encourages other/JJ/other implementations/NNP/implementations. this/DT/this independence/NN/independence is/VBZ/is achieved/VBN/achieved through/IN/through the/DT/the use/NN/use of/IN/of rpc/NN/rpc primitives/NNS/primitives built/VBN/built on/IN/on top/JJ/top of/IN/of an/DT/an external/JJ/external data/NNS/data representation/NN/representation /:/( xdr/NN/xdr /:/) protocol/NN/protocol used/VBD/used between/IN/between two/CD/two implementation-independent/JJ/implementation-independent interfaces/NNP/interfaces. hence/NN/hence /,/, if/IN/if the/DT/the system/NN/system consists/VBZ/consists of/IN/of heterogeneous/JJ/heterogeneous machines/NNS/machines and/CC/and file/JJ/file systems/NNS/systems that/WDT/that are/VBP/are properly/RB/properly interfaced/VBN/interfaced to/TO/to nfs/NNS/nfs /,/, file/JJ/file systems/NNS/systems of/IN/of different/JJ/different types/NNS/types can/MD/can be/VB/be mounted/VBN/mounted both/DT/both locally/RB/locally and/CC/and remotely/RB/remotely /./. the/DT/the nfs/NNS/nfs specification/NN/specification distinguishes/NNS/distinguishes between/IN/between the/DT/the services/NNS/services provided/VBN/provided by/IN/by a/DT/a mount/NN/mount mechanism/NN/mechanism and/CC/and the/DT/the actual/JJ/actual remote-file-access/NN/remote-file-access services/NNP/services. accordingly/RB/accordingly /,/, two/CD/two separate/JJ/separate protocols/NNS/protocols are/VBP/are specified/VBN/specified for/IN/for these/DT/these services/NNS/services /:/: a/DT/a mount/NN/mount protocol/NN/protocol and/CC/and a/DT/a protocol/NN/protocol for/IN/for remote/NN/remote file/NN/file accesses/NNS/accesses /,/, the/DT/the the/DT/the protocols/NNS/protocols are/VBP/are specified/VBN/specified as/IN/as sets/NNS/sets of/IN/of rpcs/NNP/rpcs. these/DT/these rpcs/NNS/rpcs are/VBP/are the/DT/the building/VBG/building blocks/NNS/blocks used/VBN/used to/TO/to implement/VB/implement transparent/NN/transparent remote/VB/remote file/JJ/file access/NN/access /./. 11.8.2/CD/11.8.2 the/DT/the mount/NN/mount protocol/NN/protocol the/DT/the establishes/NNS/establishes the/DT/the initial/JJ/initial logical/JJ/logical connection/NN/connection between/IN/between a/DT/a server/NN/server and/CC/and a/DT/a client/NNP/client. in/IN/in sun/NN/sun 's/POS/'s implementation/NN/implementation /,/, each/DT/each machine/NN/machine has/VBZ/has a/DT/a server/NN/server process/NN/process /,/, outside/IN/outside the/DT/the kernel/NN/kernel /,/, performing/VBG/performing the/DT/the protocol/NN/protocol functions/NNS/functions /./. a/DT/a mount/NN/mount operation/NN/operation includes/VBZ/includes the/DT/the name/NN/name of/IN/of the/DT/the remote/NN/remote directory/NN/directory to/TO/to be/VB/be mounted/VBN/mounted and/CC/and the/DT/the name/NN/name of/IN/of the/DT/the server/NN/server machine/NN/machine storing/VBG/storing it/NNP/it. the/DT/the mount/NN/mount request/NN/request is/VBZ/is mapped/VBN/mapped to/TO/to the/DT/the corresponding/NN/corresponding rpc/NN/rpc and/CC/and is/VBZ/is forwarded/VBN/forwarded to/TO/to the/DT/the mount/NN/mount server/NN/server running/VBG/running on/IN/on the/DT/the specific/JJ/specific server/NN/server machine/NNP/machine. the/DT/the server/NN/server maintains/VBZ/maintains an/DT/an that/IN/that specifies/NNS/specifies local/JJ/local file/NN/file systems/NNS/systems that/WDT/that it/PRP/it exports/VBZ/exports for/IN/for mounting/VBG/mounting /,/, along/IN/along with/IN/with names/NNS/names of/IN/of machines/NNS/machines that/WDT/that are/VBP/are permitted/VBN/permitted to/TO/to mount/VB/mount them/NNP/them. /NNP/( in/IN/in solaris/NN/solaris /,/, this/DT/this list/NN/list is/VBZ/is the/DT/the i/NN/i etc/dfs/dfstab/NN/etc/dfs/dfstab /,/, which/WDT/which can/MD/can be/VB/be edited/VBN/edited only/RB/only by/IN/by a/DT/a superuser/NNP/superuser. /NNP/) the/DT/the specification/NN/specification can/MD/can also/RB/also include/VB/include access/NN/access rights/NNS/rights /,/, such/JJ/such as/IN/as read/JJ/read only/NNP/only. to/TO/to simplify/VB/simplify the/DT/the maintenance/NN/maintenance of/IN/of export/NN/export lists/NNS/lists and/CC/and mount/NN/mount tables/NNS/tables /,/, a/DT/a distributed/VBN/distributed naming/VBG/naming scheme/NN/scheme can/MD/can be/VB/be used/VBN/used to/TO/to hold/VB/hold this/DT/this information/NN/information and/CC/and make/VB/make it/PRP/it available/JJ/available to/TO/to appropriate/VB/appropriate clients/NNS/clients /./. recall/NN/recall that/IN/that any/DT/any directory/NN/directory within/IN/within an/DT/an exported/JJ/exported file/NN/file system/NN/system can/MD/can be/VB/be mounted/VBN/mounted remotely/RB/remotely by/IN/by an/DT/an accredited/JJ/accredited machine/NNP/machine. a/DT/a component/NN/component unit/NN/unit is/VBZ/is such/JJ/such a/DT/a directory/NNP/directory. when/WRB/when the/DT/the server/NN/server receives/VBZ/receives a/DT/a mount/NN/mount request/NN/request that/WDT/that conforms/VBZ/conforms to/TO/to its/PRP$/its export/NN/export list/NN/list /,/, it/PRP/it returns/VBZ/returns to/TO/to the/DT/the client/NN/client a/DT/a file/NN/file handle/NN/handle that/WDT/that serves/VBZ/serves as/RB/as the/DT/the key/JJ/key for/IN/for further/JJ/further accesses/NNS/accesses to/TO/to files/NNS/files within/IN/within the/DT/the mounted/VBN/mounted file/NN/file system/NNP/system. the/DT/the file/NN/file handle/NN/handle contains/VBZ/contains all/DT/all the/DT/the information/NN/information that/IN/that the/DT/the server/NN/server needs/VBZ/needs to/TO/to distinguish/VB/distinguish an/DT/an individual/NN/individual file/NN/file it/PRP/it stores/NNP/stores. in/IN/in unix/NN/unix terms/NNS/terms /,/, the/DT/the file/NN/file handle/NN/handle consists/NNS/consists of/IN/of a/DT/a file-system/JJ/file-system identifier/NN/identifier and/CC/and an/DT/an inode/NN/inode number/NN/number to/TO/to identify/VB/identify the/DT/the exact/JJ/exact mounted/VBN/mounted directory/NN/directory within/IN/within the/DT/the exported/VBN/exported file/NN/file system/NN/system /./. the/DT/the server/NN/server also/RB/also maintains/VBZ/maintains a/DT/a list/NN/list of/IN/of the/DT/the client/NN/client machines/NNS/machines and/CC/and the/DT/the corresponding/NN/corresponding currently/RB/currently mounted/VBN/mounted directories/NNP/directories. this/DT/this list/NN/list is/VBZ/is used/VBN/used mainly/RB/mainly for/IN/for administrative/JJ/administrative purposes-for/NN/purposes-for instance/NN/instance /,/, for/IN/for notifying/NN/notifying all/DT/all clients/NNS/clients that/WDT/that the/DT/the server/NN/server is/VBZ/is going/VBG/going down/RB/down /./. only/RB/only through/IN/through addition/NN/addition and/CC/and deletion/NN/deletion of/IN/of entries/NNS/entries in/IN/in this/DT/this list/NN/list can/MD/can the/DT/the server/NN/server state/NN/state be/VB/be affected/VBN/affected by/IN/by the/DT/the mount/NN/mount protocol/NN/protocol /./. usually/RB/usually /,/, a/DT/a system/NN/system has/VBZ/has a/DT/a static/JJ/static mounting/NN/mounting preconfiguration/NN/preconfiguration that/WDT/that is/VBZ/is established/VBN/established at/IN/at boot/NN/boot time/NN/time /:/( i/PRP/i etc/vfstab/VBP/etc/vfstab in/IN/in solaris/NNS/solaris /:/) ;/:/; however/RB/however /,/, this/DT/this layout/NN/layout can/MD/can be/VB/be modified/NNP/modified. in/IN/in 11.8/CD/11.8 493/CD/493 addition/NN/addition to/TO/to the/DT/the actual/JJ/actual mount/NN/mount procedure/NN/procedure /,/, the/DT/the mount/NN/mount protocol/NN/protocol includes/VBZ/includes several/JJ/several other/JJ/other procedures/NNS/procedures /,/, such/JJ/such as/IN/as unmount/NN/unmount and/CC/and return/NN/return export/NN/export list/NN/list /./. 11.8.3/CD/11.8.3 the/DT/the nfs/NNS/nfs protocol/NN/protocol the/DT/the nfs/NNS/nfs protocol/NN/protocol provides/VBZ/provides a/DT/a set/NN/set of/IN/of rpcs/NNS/rpcs for/IN/for remote/NN/remote file/NN/file operations/NNP/operations. the/DT/the procedures/NNS/procedures support/NN/support the/DT/the following/VBG/following operations/NNS/operations /:/: searching/VBG/searching for/IN/for a/DT/a file/NN/file within/IN/within a/DT/a directory/NN/directory reading/NN/reading a/DT/a set/NN/set of/IN/of directory/NN/directory entries/NNS/entries manipulating/VBG/manipulating links/NNS/links and/CC/and directories/NNS/directories accessing/VBG/accessing file/NN/file attributes/NNS/attributes reading/VBG/reading and/CC/and writing/VBG/writing files/NNS/files these/DT/these procedures/NNS/procedures can/MD/can be/VB/be invoked/VBN/invoked only/RB/only after/IN/after a/DT/a file/NN/file handle/NN/handle for/IN/for the/DT/the remotely/RB/remotely mounted/VBN/mounted directory/NN/directory has/VBZ/has been/VBN/been established/VBN/established /./. the/DT/the omission/NN/omission of/IN/of open/JJ/open /NN/( /:/) and/CC/and close/JJ/close /NN/( /:/) operations/NNS/operations is/VBZ/is intentional/NNP/intentional. a/DT/a prominent/NN/prominent feature/NN/feature of/IN/of nfs/NNS/nfs servers/NNS/servers is/VBZ/is that/IN/that they/PRP/they are/VBP/are stateless/NNP/stateless. servers/NNS/servers do/VBP/do not/RB/not maintain/VB/maintain information/NN/information about/IN/about their/PRP$/their clients/NNS/clients from/IN/from one/CD/one access/NN/access to/TO/to another/NNP/another. no/DT/no parallels/NNS/parallels to/TO/to unix/VB/unix 's/POS/'s open-files/NNS/open-files table/JJ/table or/CC/or file/JJ/file structures/NNS/structures exist/VBP/exist on/IN/on the/DT/the server/NN/server side/NNP/side. consequently/RB/consequently /,/, each/DT/each request/NN/request has/VBZ/has to/TO/to provide/VB/provide a/DT/a full/JJ/full set/NN/set of/IN/of arguments/NNS/arguments /,/, including/VBG/including a/DT/a unique/JJ/unique file/NN/file identifier/NN/identifier and/CC/and an/DT/an absolute/JJ/absolute offset/NN/offset inside/NN/inside the/DT/the file/NN/file for/IN/for the/DT/the appropriate/NN/appropriate operations/NNS/operations /./. the/DT/the resulting/VBG/resulting design/NN/design is/VBZ/is robust/VBN/robust ;/:/; no/DT/no special/JJ/special measures/NNS/measures need/VBP/need be/VB/be taken/VBN/taken to/TO/to recover/VB/recover a/DT/a server/NN/server after/IN/after a/DT/a crash/NNP/crash. file/NN/file operations/NNS/operations must/MD/must be/VB/be idempotent/VBN/idempotent for/IN/for this/DT/this purpose/NN/purpose /./. every/DT/every nfs/NNS/nfs request/VBP/request has/VBZ/has a/DT/a sequence/NN/sequence number/NN/number /,/, allowing/VBG/allowing the/DT/the server/NN/server to/TO/to determine/VB/determine if/IN/if a/DT/a request/NN/request is/VBZ/is duplicated/VBN/duplicated or/CC/or if/IN/if any/DT/any are/VBP/are missing/VBG/missing /./. maintaining/VBG/maintaining the/DT/the list/NN/list of/IN/of clients/NNS/clients that/WDT/that we/PRP/we mentioned/VBD/mentioned seems/NNS/seems to/TO/to violate/VB/violate the/DT/the statelessness/NN/statelessness of/IN/of the/DT/the server/NNP/server. howeve1/NNP/howeve1 ~/NNP/~ this/DT/this list/NN/list is/VBZ/is not/RB/not essential/JJ/essential for/IN/for the/DT/the correct/NN/correct operation/NN/operation of/IN/of the/DT/the client/NN/client or/CC/or the/DT/the server/NN/server /,/, and/CC/and hence/NN/hence it/PRP/it does/VBZ/does not/RB/not need/VBP/need to/TO/to be/VB/be restored/VBN/restored after/IN/after a/DT/a server/NN/server crash/NNP/crash. consequently/RB/consequently /,/, it/PRP/it might/MD/might include/VB/include inconsistent/NN/inconsistent data/NNS/data and/CC/and is/VBZ/is treated/VBN/treated as/RB/as only/RB/only a/DT/a hint/NN/hint /./. a/DT/a further/JJ/further implication/NN/implication of/IN/of the/DT/the stateless-server/JJ/stateless-server philosophy/NN/philosophy and/CC/and a/DT/a result/NN/result of/IN/of the/DT/the synchrony/NN/synchrony of/IN/of an/DT/an rpc/NN/rpc is/VBZ/is that/IN/that modified/VBN/modified data/NNS/data /:/( including/VBG/including indirection/NN/indirection and/CC/and status/NN/status blocks/NNS/blocks /:/) must/MD/must be/VB/be committed/VBN/committed to/TO/to the/DT/the server/NN/server 's/POS/'s disk/NN/disk before/IN/before results/NNS/results are/VBP/are returned/VBN/returned to/TO/to the/DT/the client/NNP/client. that/IN/that is/VBZ/is /,/, a/DT/a client/NN/client can/MD/can cache/VB/cache write/JJ/write blocks/NNS/blocks /,/, but/CC/but when/WRB/when it/PRP/it flushes/VBZ/flushes them/PRP/them to/TO/to the/DT/the server/NN/server /,/, it/PRP/it assumes/VBZ/assumes that/IN/that they/PRP/they have/VBP/have reached/VBN/reached the/DT/the server/NN/server 's/POS/'s disks/NNP/disks. the/DT/the server/NN/server must/MD/must write/VB/write all/DT/all nfs/NNS/nfs data/NNS/data synchronously/NNP/synchronously. thus/RB/thus /,/, a/DT/a server/NN/server crash/NN/crash and/CC/and recovery/NN/recovery will/MD/will be/VB/be invisible/JJ/invisible to/TO/to a/DT/a client/NN/client ;/:/; all/DT/all blocks/NNS/blocks that/WDT/that the/DT/the server/NN/server is/VBZ/is managing/VBG/managing for/IN/for the/DT/the client/NN/client will/MD/will be/VB/be intact/NNP/intact. the/DT/the consequent/NN/consequent performance/NN/performance penalty/NN/penalty can/MD/can be/VB/be large/JJ/large /,/, because/IN/because the/DT/the advantages/NNS/advantages of/IN/of caching/VBG/caching are/VBP/are lost/NNP/lost. performance/NN/performance can/MD/can be/VB/be increased/VBN/increased using/VBG/using storage/NN/storage with/IN/with its/PRP$/its own/JJ/own nonvolatile/NN/nonvolatile cache/NN/cache /:/( usually/RB/usually battery-backed-up/JJ/battery-backed-up memory/NN/memory /:/) /./. the/DT/the disk/NN/disk controller/NN/controller ackiwwledges/NNS/ackiwwledges the/DT/the disk/NN/disk write/NN/write when/WRB/when the/DT/the write/JJ/write is/VBZ/is stored/VBN/stored in/IN/in the/DT/the nonvolatile/NN/nonvolatile cache/NNP/cache. in/IN/in essence/NN/essence /,/, the/DT/the host/NN/host sees/VBZ/sees a/DT/a very/RB/very fast/JJ/fast synchronous/JJ/synchronous write/NN/write /./. these/DT/these blocks/NNS/blocks remain/VBP/remain intact/NN/intact even/RB/even after/IN/after system/NN/system crash/NN/crash and/CC/and are/VBP/are written/VBN/written from/IN/from this/DT/this stable/NN/stable storage/NN/storage to/TO/to disk/VB/disk periodically/RB/periodically /./. a/DT/a single/JJ/single nfs/NNS/nfs write/VBP/write procedure/NN/procedure call/NN/call is/VBZ/is guaranteed/VBN/guaranteed to/TO/to be/VB/be atomic/JJ/atomic and/CC/and is/VBZ/is not/RB/not intermixed/VBN/intermixed with/IN/with other/JJ/other write/JJ/write calls/NNS/calls to/TO/to the/DT/the same/JJ/same file/NNP/file. the/DT/the nfs/NNS/nfs protocol/NN/protocol /,/, however/RB/however /,/, does/VBZ/does not/RB/not provide/VB/provide concurrency-control/JJ/concurrency-control mechanisms/NNP/mechanisms. a/DT/a write/JJ/write /NN/( /:/) system/NN/system call/NN/call may/MD/may 494/CD/494 chapter/NN/chapter 11/CD/11 client/NN/client server/NN/server figure/NN/figure 11.15/CD/11.15 schematic/JJ/schematic view/NN/view of/IN/of the/DT/the nfs/NNS/nfs architecture/VBP/architecture /./. be/VB/be broken/VBN/broken down/RP/down into/IN/into several/JJ/several rpc/NN/rpc writes/NNS/writes /,/, because/IN/because each/DT/each nfs/NNS/nfs write/VBP/write or/CC/or read/VB/read call/JJ/call can/NN/can contain/NN/contain up/IN/up to/TO/to 8/CD/8 kb/NN/kb of/IN/of data/NNS/data and/CC/and udp/VB/udp packets/NNS/packets are/VBP/are limited/VBN/limited to/TO/to 1,500/CD/1,500 bytes/NNP/bytes. as/IN/as a/DT/a result/NN/result /,/, two/CD/two users/NNS/users writing/VBG/writing to/TO/to the/DT/the same/JJ/same remote/NN/remote file/NN/file may/MD/may get/VB/get their/PRP$/their data/NNS/data intermixed/VBN/intermixed /./. the/DT/the claim/NN/claim is/VBZ/is that/IN/that /,/, because/IN/because lock/NN/lock management/NN/management is/VBZ/is inherently/RB/inherently stateful/JJ/stateful /,/, a/DT/a service/NN/service outside/IN/outside the/DT/the nfs/NNS/nfs should/MD/should provide/VB/provide locking/VBG/locking /NN/( and/CC/and solaris/VBZ/solaris does/VBZ/does /:/) /./. users/NNS/users are/VBP/are advised/VBN/advised to/TO/to coordinate/VB/coordinate access/NN/access to/TO/to shared/VBN/shared files/NNS/files using/VBG/using mechanisms/NNS/mechanisms outside/IN/outside the/DT/the scope/NN/scope of/IN/of nfs/NNS/nfs /./. nfs/NNS/nfs is/VBZ/is integrated/VBN/integrated into/IN/into the/DT/the operating/NN/operating system/NN/system via/IN/via a/DT/a vfs/NNP/vfs. as/IN/as an/DT/an illustration/NN/illustration of/IN/of the/DT/the architecture/NN/architecture /,/, let/VB/let 's/POS/'s trace/NN/trace how/WRB/how an/DT/an operation/NN/operation on/IN/on an/DT/an already/RB/already open/JJ/open remote/NN/remote file/NN/file is/VBZ/is handled/VBN/handled /-NONE-/( follow/RB/follow the/DT/the example/NN/example in/IN/in figure/NN/figure 11.15/CD/11.15 /CD/) /./. the/DT/the client/NN/client initiates/VBZ/initiates the/DT/the operation/NN/operation with/IN/with a/DT/a regular/JJ/regular system/NN/system call/NNP/call. the/DT/the operating-system/JJ/operating-system layer/NN/layer maps/NNS/maps this/DT/this call/NN/call to/TO/to a/DT/a vfs/NN/vfs operation/NN/operation on/IN/on the/DT/the appropriate/NN/appropriate vnode/NNP/vnode. the/DT/the vfs/NNS/vfs layer/NN/layer identifies/NNS/identifies the/DT/the file/NN/file as/IN/as a/DT/a remote/NN/remote one/CD/one and/CC/and invokes/VBZ/invokes the/DT/the appropriate/NN/appropriate nfs/VBZ/nfs procedure/NNP/procedure. an/DT/an rpc/NN/rpc call/NN/call is/VBZ/is made/VBN/made to/TO/to the/DT/the nfs/NNS/nfs service/NN/service layer/NN/layer at/IN/at the/DT/the remote/NN/remote server/NNP/server. this/DT/this call/NN/call is/VBZ/is reinjected/VBN/reinjected to/TO/to the/DT/the vfs/NNS/vfs layer/NN/layer on/IN/on the/DT/the remote/NN/remote system/NN/system /,/, which/WDT/which finds/NNS/finds that/WDT/that it/PRP/it is/VBZ/is local/JJ/local and/CC/and invokes/VBZ/invokes the/DT/the appropriate/NN/appropriate file-system/NN/file-system operation/NNP/operation. this/DT/this path/NN/path is/VBZ/is retraced/VBN/retraced to/TO/to return/VB/return the/DT/the result/NN/result /./. an/DT/an advantage/NN/advantage of/IN/of this/DT/this architecture/NN/architecture is/VBZ/is that/IN/that the/DT/the client/NN/client and/CC/and the/DT/the server/NN/server are/VBP/are identical/JJ/identical ;/:/; thus/RB/thus /,/, a/DT/a machine/NN/machine may/MD/may be/VB/be a/DT/a client/NN/client /,/, or/CC/or a/DT/a server/NN/server /,/, or/CC/or both/NNP/both. the/DT/the actual/JJ/actual service/NN/service on/IN/on each/DT/each server/NN/server is/VBZ/is performed/VBN/performed by/IN/by kernel/NN/kernel threads/NNS/threads /./. 11.8.4/CD/11.8.4 path-name/JJ/path-name translation/NN/translation in/IN/in nfs/NNS/nfs involves/NNS/involves the/DT/the parsing/VBG/parsing of/IN/of a/DT/a path/NN/path name/NN/name such/JJ/such as/IN/as /usr/local/dir1/file/NNP//usr/local/dir1/file. txt/NN/txt into/IN/into separate/JJ/separate directory/NN/directory entries/NNS/entries /,/, or/CC/or components/NNS/components /:/: /:/( 1/CD/1 /CD/) usr/NN/usr /,/, /:/( 2/CD/2 /CD/) local/JJ/local /,/, and/CC/and /:/( 3/CD/3 /CD/) dir1/NNP/dir1. path-name/NNP/path-name translation/NN/translation is/VBZ/is done/VBN/done by/IN/by breaking/NN/breaking the/DT/the path/NN/path into/IN/into component/NN/component names/NNS/names and/CC/and perform.ing/JJ/perform.ing a/DT/a separate/JJ/separate nfs/NN/nfs lookup/NN/lookup call/NN/call for/IN/for every/DT/every pair/NN/pair of/IN/of component/NN/component name/NN/name and/CC/and directory/NN/directory vnode/NNP/vnode. once/RB/once a/DT/a n10unt/NNP/n10unt point/NN/point is/VBZ/is crossed/VBN/crossed /,/, every/DT/every component/NN/component lookup/NN/lookup causes/NNS/causes a/DT/a separate/JJ/separate rpc/NN/rpc to/TO/to the/DT/the server/NNP/server. this/DT/this 11.8/CD/11.8 495/CD/495 expensive/JJ/expensive path-name-traversal/JJ/path-name-traversal scheme/NN/scheme is/VBZ/is needed/VBN/needed /,/, since/IN/since the/DT/the layout/NN/layout of/IN/of each/DT/each client/NN/client 's/POS/'s logical/JJ/logical name/NN/name space/NN/space is/VBZ/is unique/JJ/unique /,/, dictated/VBN/dictated by/IN/by the/DT/the mounts/NNS/mounts the/DT/the client/NN/client has/VBZ/has performed/NNP/performed. it/PRP/it would/MD/would be/VB/be itluch/JJ/itluch more/JJR/more efficient/JJ/efficient to/TO/to hand/VB/hand a/DT/a server/NN/server a/DT/a path/NN/path name/NN/name and/CC/and receive/JJ/receive a/DT/a target/NN/target vnode/NN/vnode once/RB/once a/DT/a mount/NN/mount point/NN/point is/VBZ/is encountered/NNP/encountered. at/IN/at any/DT/any point/NN/point /,/, however/RB/however /,/, there/EX/there might/MD/might be/VB/be another/DT/another mount/NN/mount point/NN/point for/IN/for the/DT/the particular/JJ/particular client/NN/client of/IN/of whicb/NN/whicb the/DT/the stateless/NN/stateless server/NN/server is/VBZ/is unaware/JJ/unaware /./. so/RB/so that/IN/that lookup/NN/lookup is/VBZ/is fast/VBN/fast /,/, a/DT/a directory-name-lookup/JJ/directory-name-lookup cache/NN/cache on/IN/on the/DT/the client/NN/client side/NN/side holds/NNS/holds the/DT/the vnodes/NNS/vnodes for/IN/for remote/NN/remote directory/NN/directory names/NNP/names. this/DT/this cache/NN/cache speeds/VBZ/speeds up/RP/up references/NNS/references to/TO/to files/NNS/files with/IN/with the/DT/the same/JJ/same initial/JJ/initial path/NN/path name/NNP/name. the/DT/the directory/NN/directory cache/NN/cache is/VBZ/is discarded/VBN/discarded when/WRB/when attributes/NNS/attributes returned/VBN/returned from/IN/from the/DT/the server/NN/server do/VBP/do not/RB/not match/VB/match the/DT/the attributes/NNS/attributes of/IN/of the/DT/the cached/JJ/cached vnode/NN/vnode /./. recall/NN/recall that/IN/that mounting/VBG/mounting a/DT/a remote/NN/remote file/NN/file system/NN/system on/IN/on top/JJ/top of/IN/of another/DT/another already/RB/already mounted/VBN/mounted remote/NN/remote file/NN/file system/NN/system /:/( a/DT/a cascading/NN/cascading mount/NN/mount /:/) is/VBZ/is allowed/VBN/allowed in/IN/in some/DT/some implementations/NNS/implementations of/IN/of nfs/NNP/nfs. however/RB/however /,/, a/DT/a server/NN/server can/MD/can not/RB/not act/VB/act as/IN/as an/DT/an intermediary/JJ/intermediary between/IN/between a/DT/a client/NN/client and/CC/and another/DT/another server/NNP/server. instead/RB/instead /,/, a/DT/a client/NN/client must/MD/must establish/VB/establish a/DT/a direct/JJ/direct client-server/NN/client-server com1ection/NN/com1ection with/IN/with the/DT/the second/JJ/second server/NN/server by/IN/by directly/RB/directly mounting/VBG/mounting the/DT/the desired/JJ/desired directory/NN/directory /./. when/WRB/when a/DT/a client/NN/client has/VBZ/has a/DT/a cascading/NN/cascading mount/NN/mount /,/, more/RBR/more than/IN/than one/CD/one server/NN/server can/MD/can be/VB/be involved/VBN/involved in/IN/in a/DT/a path-name/JJ/path-name traversal/NN/traversal however/RB/however /,/, each/DT/each component/NN/component lookup/NN/lookup is/VBZ/is performed/VBN/performed between/IN/between the/DT/the original/JJ/original client/NN/client and/CC/and some/DT/some server/NNP/server. therefore/NN/therefore /,/, when/WRB/when a/DT/a client/NN/client does/VBZ/does a/DT/a lookup/NN/lookup on/IN/on a/DT/a directory/NN/directory on/IN/on which/WDT/which the/DT/the server/NN/server has/VBZ/has mounted/VBN/mounted a/DT/a file/NN/file system/NN/system /,/, the/DT/the client/NN/client sees/VBZ/sees the/DT/the underlying/VBG/underlying directory/NN/directory instead/RB/instead of/IN/of the/DT/the mounted/VBN/mounted directory/NN/directory /./. 11.8.5/CD/11.8.5 remote/NN/remote operations/NNS/operations with/IN/with the/DT/the exception/NN/exception of/IN/of opening/VBG/opening and/CC/and closing/JJ/closing files/NNS/files /,/, there/EX/there is/VBZ/is almost/RB/almost a/DT/a one-to-one/NN/one-to-one correspondence/NN/correspondence between/IN/between the/DT/the regular/JJ/regular unix/NN/unix system/NN/system calls/VBZ/calls for/IN/for file/NN/file operations/NNS/operations and/CC/and the/DT/the nfs/NNS/nfs protocol/NN/protocol rpcs/NNP/rpcs. thus/RB/thus /,/, a/DT/a remote/NN/remote file/NN/file operation/NN/operation can/MD/can be/VB/be translated/VBN/translated directly/RB/directly to/TO/to the/DT/the corresponding/NN/corresponding rpc/NNP/rpc. conceptually/RB/conceptually /,/, nfs/NNS/nfs adheres/NNS/adheres to/TO/to the/DT/the remote-service/NN/remote-service paradigm/NN/paradigm ;/:/; but/CC/but in/IN/in practice/NN/practice /,/, buffering/VBG/buffering and/CC/and caching/VBG/caching techniques/NNS/techniques are/VBP/are employed/VBN/employed for/IN/for the/DT/the sake/NN/sake of/IN/of performance/NNP/performance. no/DT/no direct/JJ/direct correspondence/NN/correspondence exists/NNS/exists between/IN/between a/DT/a remote/NN/remote operation/NN/operation and/CC/and an/DT/an rpc/NNP/rpc. instead/RB/instead /,/, file/IN/file blocks/NNS/blocks and/CC/and file/JJ/file attributes/NNS/attributes are/VBP/are fetched/VBN/fetched by/IN/by the/DT/the rpcs/NNS/rpcs and/CC/and are/VBP/are cached/VBN/cached locally/NNP/locally. future/JJ/future remote/NN/remote operations/NNS/operations use/VBP/use the/DT/the cached/VBN/cached data/NNS/data /,/, subject/JJ/subject to/TO/to consistency/NN/consistency constraints/NNS/constraints /./. there/RB/there are/VBP/are two/CD/two caches/NNS/caches /:/: the/DT/the file-attribute/JJ/file-attribute /NN/( inode-infonnation/NN/inode-infonnation /:/) cache/NN/cache and/CC/and the/DT/the file-blocks/NNS/file-blocks cache/NNP/cache. when/WRB/when a/DT/a file/NN/file is/VBZ/is opened/VBN/opened /,/, the/DT/the kernel/NN/kernel checks/NNS/checks with/IN/with the/DT/the remote/NN/remote server/NN/server to/TO/to determine/VB/determine whether/IN/whether to/TO/to fetch/VB/fetch or/CC/or revalidate/VB/revalidate the/DT/the cached/JJ/cached attributes/NNP/attributes. the/DT/the cached/JJ/cached file/NN/file blocks/NNS/blocks are/VBP/are used/VBN/used only/RB/only if/IN/if the/DT/the corresponding/NN/corresponding cached/VBD/cached attributes/NNS/attributes are/VBP/are up/RP/up to/TO/to date/NNP/date. the/DT/the attribute/NN/attribute cache/NN/cache is/VBZ/is updated/VBN/updated whenever/RB/whenever new/JJ/new attributes/NNS/attributes arrive/VBP/arrive from/IN/from the/DT/the server/NNP/server. cached/VBD/cached attributes/NNS/attributes are/VBP/are /,/, by/IN/by default/NN/default /,/, discarded/VBD/discarded after/IN/after 60/CD/60 seconds/NNP/seconds. both/DT/both read-ahead/JJ/read-ahead and/CC/and delayed-write/JJ/delayed-write techniques/NNS/techniques are/VBP/are used/VBN/used between/IN/between the/DT/the server/NN/server and/CC/and the/DT/the client/NNP/client. clients/NNS/clients do/VBP/do not/RB/not free/JJ/free delayed-write/JJ/delayed-write blocks/NNS/blocks until/IN/until the/DT/the server/NN/server confirms/VBZ/confirms that/IN/that the/DT/the data/NNS/data have/VBP/have been/VBN/been written/VBN/written to/TO/to disk/VB/disk delayed-write/JJ/delayed-write is/VBZ/is retained/VBN/retained even/RB/even when/WRB/when a/DT/a file/NN/file is/VBZ/is opened/VBN/opened concurrently/RB/concurrently /,/, in/IN/in conflicting/NN/conflicting modes/NNP/modes. hence/NN/hence /,/, unix/NN/unix semantics/NNS/semantics /:/( section/NN/section 10.5.3.1/CD/10.5.3.1 /CD/) are/VBP/are not/RB/not preserved/VBN/preserved /./. tuning/NN/tuning the/DT/the system/NN/system for/IN/for performance/NN/performance makes/VBZ/makes it/PRP/it difficult/VBD/difficult to/TO/to characterize/VB/characterize the/DT/the consistency/NN/consistency semantics/NNS/semantics of/IN/of nfs/NNP/nfs. new/JJ/new files/NNS/files created/VBN/created on/IN/on a/DT/a machine/NN/machine may/MD/may not/RB/not be/VB/be visible/JJ/visible elsewhere/RB/elsewhere for/IN/for 30/CD/30 seconds/NNP/seconds. furthermore/NN/furthermore /,/, writes/VBZ/writes to/TO/to a/DT/a file/NN/file at/IN/at one/CD/one site/JJ/site may/MD/may or/CC/or may/MD/may not/RB/not be/VB/be visible/JJ/visible at/IN/at other/JJ/other sites/NNS/sites that/IN/that have/VBP/have this/DT/this file/NN/file open/NN/open for/IN/for reading/NNP/reading. new/JJ/new opens/NNS/opens of/IN/of a/DT/a file/NN/file observe/NN/observe only/RB/only the/DT/the changes/NNS/changes that/WDT/that have/VBP/have already/RB/already been/VBN/been flushed/VBN/flushed to/TO/to the/DT/the server/NNP/server. thus/RB/thus /,/, nfs/NNS/nfs provides/VBZ/provides neither/DT/neither strict/NN/strict emulation/NN/emulation of/IN/of unix/NN/unix semantics/NNS/semantics nor/CC/nor the/DT/the 496/CD/496 chapter/NN/chapter 11/CD/11 11.9/CD/11.9 session/NN/session sen/NN/sen antics/NNS/antics of/IN/of andrew/JJ/andrew /NN/( section/NN/section 10.5.3.2/CD/10.5.3.2 /CD/) .ln/JJ/.ln spite/NN/spite of/IN/of these/DT/these drawbacks/NNS/drawbacks /,/, the/DT/the utility/NN/utility and/CC/and good/JJ/good performance/NN/performance of/IN/of the/DT/the mechanism/NN/mechanism make/VBP/make it/PRP/it the/DT/the most/RBS/most widely/RB/widely used/JJ/used multi-vendor-distributed/JJ/multi-vendor-distributed system/NN/system in/IN/in operation/NN/operation /./. disk/NN/disk i/o/-NONE-/i/o has/VBZ/has a/DT/a huge/JJ/huge impact/NN/impact on/IN/on system/NN/system performance/NNP/performance. as/IN/as a/DT/a result/NN/result /,/, file-system/JJ/file-system design/NN/design and/CC/and implementation/NN/implementation command/NN/command quite/RB/quite a/DT/a lot/NN/lot of/IN/of attention/NN/attention from/IN/from system/NN/system designers/NNP/designers. some/DT/some file/NN/file systems/NNS/systems are/VBP/are general/JJ/general purpose/NN/purpose /,/, in/IN/in that/DT/that they/PRP/they can/MD/can provide/VB/provide reasonable/JJ/reasonable performance/NN/performance and/CC/and functionality/NN/functionality for/IN/for a/DT/a wide/JJ/wide variety/NN/variety of/IN/of file/NN/file sizes/NNS/sizes /,/, file/JJ/file types/NNS/types /,/, and/CC/and i/0/-NONE-/i/0 loads/NNP/loads. others/NNS/others are/VBP/are optimized/VBN/optimized for/IN/for specific/JJ/specific tasks/NNS/tasks in/IN/in an/DT/an attempt/NN/attempt to/TO/to provide/VB/provide better/JJR/better performance/NN/performance in/IN/in those/DT/those areas/NNS/areas than/IN/than general-purpose/JJ/general-purpose file/NN/file systems/NNS/systems /./. the/DT/the wafl/NN/wafl file/NN/file system/NN/system from/IN/from network/NN/network appliance/NN/appliance is/VBZ/is an/DT/an example/NN/example of/IN/of this/DT/this sort/NN/sort of/IN/of optimization/NNP/optimization. wafl/NN/wafl /,/, the/DT/the write-anywhere/JJ/write-anywhere file/NN/file layout/IN/layout /,/, is/VBZ/is a/DT/a powerful/JJ/powerful /,/, elegant/JJ/elegant file/NN/file system/NN/system optimized/VBD/optimized for/IN/for random/NN/random writes/NNS/writes /./. wafl/NN/wafl is/VBZ/is used/VBN/used exclusively/RB/exclusively on/IN/on network/NN/network file/NN/file servers/NNS/servers produced/VBN/produced by/IN/by network/NN/network appliance/NN/appliance and/CC/and so/RB/so is/VBZ/is meant/VBN/meant for/IN/for use/NN/use as/IN/as a/DT/a distributed/VBN/distributed file/NN/file system/NNP/system. it/PRP/it can/MD/can provide/VB/provide files/NNS/files to/TO/to clients/NNS/clients via/IN/via the/DT/the nfs/NNS/nfs /,/, cifs/NNS/cifs /,/, ftp/NN/ftp /,/, and/CC/and http/VB/http protocols/NNS/protocols /,/, although/IN/although it/PRP/it was/VBD/was designed/VBN/designed just/RB/just for/IN/for nfs/NNS/nfs and/CC/and cifs/NNP/cifs. when/WRB/when many/JJ/many clients/NNS/clients use/VBP/use these/DT/these protocols/NNS/protocols to/TO/to talk/VB/talk to/TO/to a/DT/a file/NN/file server/NN/server /,/, the/DT/the server/NN/server may/MD/may see/VB/see a/DT/a very/RB/very large/JJ/large demand/NN/demand for/IN/for random/NN/random reads/NNS/reads and/CC/and an/DT/an even/RB/even larger/JJR/larger demand/NN/demand for/IN/for random/NN/random writes/NNP/writes. the/DT/the nfs/NNS/nfs and/CC/and cifs/NNS/cifs protocols/NNS/protocols cache/VBP/cache data/NNS/data from/IN/from read/JJ/read operations/NNS/operations /,/, so/RB/so writes/VBZ/writes are/VBP/are of/IN/of the/DT/the greatest/JJS/greatest concern/NN/concern to/TO/to file-server/JJ/file-server creators/NNS/creators /./. wafl/NN/wafl is/VBZ/is used/VBN/used on/IN/on file/JJ/file servers/NNS/servers that/WDT/that include/VBP/include an/DT/an nvram/NN/nvram cache/NN/cache for/IN/for writes/NNS/writes /./. the/DT/the wafl/NN/wafl designers/NNS/designers took/VBD/took advantage/NN/advantage of/IN/of running/VBG/running on/IN/on a/DT/a specific/JJ/specific architecture/NN/architecture to/TO/to optimize/VB/optimize the/DT/the file/NN/file system/NN/system for/IN/for random/NN/random i/0/-NONE-/i/0 /,/, with/IN/with a/DT/a stable-storage/JJ/stable-storage cache/NN/cache in/IN/in front/NN/front /./. ease/NN/ease of/IN/of use/NN/use is/VBZ/is one/CD/one of/IN/of the/DT/the guiding/NN/guiding principles/NNS/principles of/IN/of wafl/NN/wafl /,/, because/IN/because it/PRP/it is/VBZ/is designed/VBN/designed to/TO/to be/VB/be used/VBN/used in/IN/in an/DT/an appliance/NNP/appliance. its/PRP$/its creators/NNS/creators also/RB/also designed/VBN/designed it/PRP/it to/TO/to include/VB/include a/DT/a new/JJ/new snapshot/NN/snapshot functionality/NN/functionality that/WDT/that creates/VBZ/creates multiple/VBP/multiple read-only/RB/read-only copies/NNS/copies of/IN/of the/DT/the file/NN/file system/NN/system at/IN/at different/JJ/different points/NNS/points in/IN/in time/NN/time /,/, as/IN/as we/PRP/we shall/MD/shall see/VB/see /./. the/DT/the file/NN/file system/NN/system is/VBZ/is similar/JJ/similar to/TO/to the/DT/the berkeley/NN/berkeley fast/NN/fast file/NN/file system/NN/system /,/, with/IN/with many/JJ/many modifications/NNP/modifications. it/PRP/it is/VBZ/is block-based/JJ/block-based and/CC/and uses/NNS/uses inodes/NNS/inodes to/TO/to describe/VB/describe files/NNP/files. each/DT/each inode/NN/inode contains/VBZ/contains 16/CD/16 pointers/NNS/pointers to/TO/to blocks/NNS/blocks /:/( or/CC/or indirect/VB/indirect blocks/NNS/blocks /:/) belonging/VBG/belonging to/TO/to the/DT/the file/NN/file described/VBD/described by/IN/by the/DT/the inode/NNP/inode. each/DT/each file/NN/file system/NN/system has/VBZ/has a/DT/a root/NN/root inode/NNP/inode. all/DT/all of/IN/of the/DT/the metadata/NN/metadata lives/VBZ/lives in/IN/in files/NNS/files /:/: all/DT/all inodes/NNS/inodes are/VBP/are in/IN/in one/CD/one file/NN/file /,/, the/DT/the free-block/NN/free-block map/NN/map in/IN/in another/DT/another /,/, and/CC/and the/DT/the free-inode/JJ/free-inode root/NN/root inode/NN/inode 1/CD/1 free/JJ/free blotk/NN/blotk map/NN/map i/PRP/i figure/VBP/figure 11.16/CD/11.16 the/DT/the wafl/NN/wafl file/NN/file layout/IN/layout 11.9/CD/11.9 497/CD/497 map/NN/map in/IN/in a/DT/a third/JJ/third /,/, as/IN/as shown/NN/shown in/IN/in figure/NN/figure 11.16/CD/11.16. because/IN/because these/DT/these are/VBP/are standard/JJ/standard files/NNS/files /,/, the/DT/the data/NNS/data blocks/VBZ/blocks are/VBP/are not/RB/not limited/VBN/limited in/IN/in location/NN/location and/CC/and can/MD/can be/VB/be placed/VBN/placed anywhere/-NONE-/anywhere. if/IN/if a/DT/a file/NN/file system/NN/system is/VBZ/is expanded/VBN/expanded by/IN/by addition/NN/addition of/IN/of disks/NNS/disks /,/, the/DT/the lengths/NNS/lengths of/IN/of the/DT/the metadata/NN/metadata files/NNS/files are/VBP/are automatically/RB/automatically expanded/VBN/expanded by/IN/by the/DT/the file/NN/file systen/NN/systen /./. thus/RB/thus /,/, a/DT/a wafl/NN/wafl file/NN/file system/NN/system is/VBZ/is a/DT/a tree/NN/tree of/IN/of blocks/NNS/blocks with/IN/with the/DT/the root/NN/root inode/NN/inode as/IN/as its/PRP$/its base/NNP/base. to/TO/to take/VB/take a/DT/a snapshot/NN/snapshot /,/, wafl/NN/wafl creates/VBZ/creates a/DT/a copy/NN/copy of/IN/of the/DT/the root/NN/root inode/NNP/inode. any/DT/any file/NN/file or/CC/or metadata/NNS/metadata updates/NNS/updates after/IN/after that/DT/that go/NN/go to/TO/to new/JJ/new blocks/NNS/blocks rather/RB/rather than/IN/than overwriting/VBG/overwriting their/PRP$/their existing/VBG/existing blocks/NNP/blocks. the/DT/the new/JJ/new root/NN/root inode/NN/inode points/NNS/points to/TO/to metadata/VB/metadata and/CC/and data/NNS/data changed/VBD/changed as/IN/as a/DT/a result/NN/result of/IN/of these/DT/these writes/NNP/writes. meanwhile/RB/meanwhile /,/, the/DT/the snapshot/NN/snapshot /:/( the/DT/the old/JJ/old root/NN/root inode/NN/inode /:/) still/RB/still points/VBZ/points to/TO/to the/DT/the old/JJ/old blocks/NNS/blocks /,/, which/WDT/which have/VBP/have not/RB/not been/VBN/been updated/NNP/updated. it/PRP/it therefore/RB/therefore provides/VBZ/provides access/NN/access to/TO/to the/DT/the file/NN/file system/NN/system just/RB/just as/IN/as it/PRP/it was/VBD/was at/IN/at the/DT/the instant/JJ/instant the/DT/the snapshot/NN/snapshot was/VBD/was made-and/JJ/made-and takes/NNS/takes very/RB/very little/JJ/little disk/NN/disk space/NN/space to/TO/to do/VB/do so/RB/so !/./! in/IN/in essence/NN/essence /,/, the/DT/the extra/JJ/extra disk/NN/disk space/NN/space occupied/VBD/occupied by/IN/by a/DT/a snapshot/NN/snapshot consists/VBZ/consists of/IN/of just/RB/just the/DT/the blocks/NNS/blocks that/WDT/that have/VBP/have been/VBN/been modified/VBN/modified since/IN/since the/DT/the snapshot/NN/snapshot was/VBD/was taken/VBN/taken /./. an/DT/an important/JJ/important change/NN/change from/IN/from more/RBR/more standard/JJ/standard file/NN/file systems/NNS/systems is/VBZ/is that/IN/that the/DT/the free-block/JJ/free-block map/NN/map has/VBZ/has more/JJR/more than/IN/than one/CD/one bit/NN/bit per/IN/per block/NNP/block. it/PRP/it is/VBZ/is a/DT/a bitmap/NN/bitmap with/IN/with a/DT/a bit/NN/bit set/NN/set for/IN/for each/DT/each snapshot/NN/snapshot that/IN/that is/VBZ/is using/VBG/using the/DT/the block/NNP/block. when/WRB/when all/DT/all snapshots/NNS/snapshots that/WDT/that have/VBP/have been/VBN/been using/VBG/using the/DT/the block/NN/block are/VBP/are deleted/VBN/deleted /,/, the/DT/the bit/NN/bit map/NN/map for/IN/for that/DT/that block/NN/block is/VBZ/is all/DT/all zeros/NNS/zeros /,/, and/CC/and the/DT/the block/NN/block is/VBZ/is free/JJ/free to/TO/to be/VB/be reused/NNP/reused. used/VBN/used blocks/NNS/blocks are/VBP/are never/RB/never overwritten/VBN/overwritten /,/, so/RB/so writes/VBZ/writes are/VBP/are very/RB/very fast/JJ/fast /,/, because/IN/because a/DT/a write/JJ/write can/NN/can occur/NN/occur at/IN/at the/DT/the free/JJ/free block/NN/block nearest/NN/nearest the/DT/the current/JJ/current head/NN/head location/NNP/location. there/EX/there are/VBP/are many/JJ/many other/JJ/other performance/NN/performance optimizations/NNS/optimizations in/IN/in wafl/NN/wafl as/IN/as well/RB/well /./. many/JJ/many snapshots/NNS/snapshots can/MD/can exist/VB/exist simultaneously/RB/simultaneously /,/, so/RB/so one/CD/one can/MD/can be/VB/be taken/VBN/taken each/DT/each hour/NN/hour of/IN/of the/DT/the day/NN/day and/CC/and each/DT/each day/NN/day of/IN/of the/DT/the month/NNP/month. a/DT/a user/NN/user with/IN/with access/NN/access to/TO/to these/DT/these snapshots/NNS/snapshots can/MD/can access/NN/access files/NNS/files as/IN/as they/PRP/they were/VBD/were at/IN/at any/DT/any of/IN/of the/DT/the times/NNS/times the/DT/the snapshots/NNS/snapshots were/VBD/were taken/VBN/taken /./. the/DT/the snapshot/NN/snapshot facility/NN/facility is/VBZ/is also/RB/also useful/JJ/useful for/IN/for backups/NNS/backups /,/, testing/NN/testing /,/, versioning/VBG/versioning /,/, and/CC/and so/RB/so on/IN/on /./. wafl/NN/wafl 's/POS/'s snapshot/NN/snapshot facility/NN/facility is/VBZ/is very/RB/very efficient/JJ/efficient in/IN/in that/DT/that it/PRP/it does/VBZ/does not/RB/not even/RB/even require/VB/require that/IN/that copy-on-write/JJ/copy-on-write copies/NNS/copies of/IN/of each/DT/each data/NN/data block/NN/block be/VB/be taken/VBN/taken before/IN/before the/DT/the block/NN/block is/VBZ/is modified/VBN/modified /./. other/JJ/other file/NN/file systems/NNS/systems provide/VB/provide snapshots/NNS/snapshots /,/, but/CC/but frequently/RB/frequently with/IN/with less/JJR/less efficiency/NNP/efficiency. wafl/NN/wafl snapshots/NNS/snapshots are/VBP/are depicted/VBN/depicted in/IN/in figure/NN/figure 11.17/CD/11.17 /./. newer/JJR/newer versions/NNS/versions of/IN/of wafl/NN/wafl actually/RB/actually allow/VBP/allow read-write/JJ/read-write snapshots/NNS/snapshots /,/, known/VBN/known as/IN/as ,.hj/NNP/,.hj '/POS/' '/:/'- '/POS/' clones/NNS/clones are/VBP/are also/RB/also efficient/JJ/efficient /,/, using/VBG/using the/DT/the same/JJ/same techniques/NNS/techniques as/IN/as shapshots/NNP/shapshots. in/IN/in this/DT/this case/NN/case /,/, a/DT/a read-only/JJ/read-only snapshot/NN/snapshot captures/NNS/captures the/DT/the state/NN/state of/IN/of the/DT/the file/NN/file system/NN/system /,/, and/CC/and a/DT/a clone/NN/clone refers/NNS/refers back/RB/back to/TO/to that/DT/that read-only/JJ/read-only snapshot/NNP/snapshot. any/DT/any writes/NNS/writes to/TO/to the/DT/the clone/NN/clone are/VBP/are stored/VBN/stored in/IN/in new/JJ/new blocks/NNS/blocks /,/, and/CC/and the/DT/the clone/NN/clone 's/POS/'s pointers/NNS/pointers are/VBP/are updated/VBN/updated to/TO/to refer/VB/refer to/TO/to the/DT/the new/JJ/new blocks/NNS/blocks /./. the/DT/the original/JJ/original snapshot/NN/snapshot is/VBZ/is unmodified/VBN/unmodified /,/, still/RB/still giving/VBG/giving a/DT/a view/NN/view into/IN/into the/DT/the file/JJ/file system/NN/system as/IN/as it/PRP/it was/VBD/was before/IN/before the/DT/the clone/NN/clone was/VBD/was updated/NNP/updated. clones/NNS/clones can/MD/can also/RB/also be/VB/be promoted/VBN/promoted to/TO/to replace/VB/replace the/DT/the original/JJ/original file/NN/file system/NN/system ;/:/; this/DT/this involves/VBZ/involves throwing/VBG/throwing out/RP/out all/DT/all of/IN/of the/DT/the old/JJ/old pointers/NNS/pointers and/CC/and any/DT/any associated/VBN/associated old/JJ/old blocks/NNP/blocks. clones/NNS/clones are/VBP/are useful/JJ/useful for/IN/for testing/NN/testing and/CC/and upgrades/VBZ/upgrades /,/, as/IN/as the/DT/the original/JJ/original version/NN/version is/VBZ/is left/VBN/left untouched/VBN/untouched and/CC/and the/DT/the clone/NN/clone deleted/VBD/deleted when/WRB/when the/DT/the test/NN/test is/VBZ/is done/VBN/done or/CC/or if/IN/if the/DT/the upgrade/NN/upgrade fails/VBZ/fails /./. another/DT/another feature/NN/feature that/IN/that naturally/RB/naturally falls/VBZ/falls from/IN/from the/DT/the wafl/NN/wafl file/NN/file system/NN/system implementation/NN/implementation is/VBZ/is the/DT/the duplication/NN/duplication and/CC/and synchronization/NN/synchronization of/IN/of a/DT/a set/NN/set of/IN/of data/NNS/data over/IN/over a/DT/a network/NN/network to/TO/to another/DT/another system/NNP/system. first/RB/first /,/, a/DT/a snapshot/NN/snapshot of/IN/of a/DT/a wafl/NN/wafl file/NN/file system/NN/system is/VBZ/is duplicated/VBN/duplicated to/TO/to another/DT/another system/NNP/system. when/WRB/when another/DT/another snapshot/NN/snapshot is/VBZ/is taken/VBN/taken on/IN/on the/DT/the source/NN/source system/NN/system /,/, it/PRP/it is/VBZ/is relatively/RB/relatively easy/JJ/easy to/TO/to update/VB/update the/DT/the remote/NN/remote system/NN/system just/RB/just by/IN/by sending/NN/sending over/IN/over all/DT/all blocks/NNS/blocks contained/VBD/contained in/IN/in the/DT/the new/JJ/new snapshot/NNP/snapshot. these/DT/these blocks/NNS/blocks are/VBP/are the/DT/the ones/NNS/ones that/WDT/that have/VBP/have changed/VBN/changed between/IN/between the/DT/the times/NNS/times the/DT/the two/CD/two snapshots/NNS/snapshots were/VBD/were taken/NNP/taken. the/DT/the remote/NN/remote system/NN/system adds/VBZ/adds these/DT/these blocks/NNS/blocks to/TO/to the/DT/the file/NN/file system/NN/system and/CC/and updates/VBZ/updates its/PRP$/its pointers/NNS/pointers /,/, and/CC/and the/DT/the new/JJ/new system/NN/system then/RB/then is/VBZ/is a/DT/a duplicate/NN/duplicate of/IN/of the/DT/the source/NN/source system/NN/system as/IN/as of/IN/of the/DT/the time/NN/time of/IN/of the/DT/the second/JJ/second snapshot/NNP/snapshot. repeating/NN/repeating this/DT/this process/NN/process maintains/VBZ/maintains the/DT/the remote/NN/remote system/NN/system as/IN/as a/DT/a nearly/RB/nearly up-to-date/JJ/up-to-date copy/NN/copy of/IN/of the/DT/the first/JJ/first 498/CD/498 chapter/NN/chapter 11/CD/11 11.10/CD/11.10 /CD/( a/DT/a /NN/) before/IN/before a/DT/a snapshot/NN/snapshot /./. /NN/( b/NN/b /:/) after/IN/after a/DT/a snapshot/NN/snapshot /,/, before/IN/before any/DT/any blocks/NNS/blocks change/VBP/change /./. /:/( c/NN/c /:/) after/IN/after block/NN/block d/NN/d has/VBZ/has changed/VBN/changed to/TO/to o/VB/o /./. figure/NN/figure 11.17/CD/11.17 snapshots/NNS/snapshots in/IN/in wafl/NN/wafl /./. system/NNP/system. such/JJ/such replication/NN/replication is/VBZ/is used/VBN/used for/IN/for disaster/NN/disaster recovery/NNP/recovery. should/MD/should the/DT/the first/JJ/first system/NN/system be/VB/be destroyed/VBN/destroyed /,/, most/RBS/most of/IN/of its/PRP$/its data/NNS/data are/VBP/are available/JJ/available for/IN/for use/NN/use on/IN/on the/DT/the remote/NN/remote system/NN/system /./. finally/RB/finally /,/, we/PRP/we should/MD/should note/VB/note that/IN/that sun/NN/sun 's/POS/'s zfs/NNS/zfs file/IN/file system/NN/system supports/NNS/supports similarly/RB/similarly efficient/JJ/efficient snapshots/NNS/snapshots /,/, clones/NNS/clones /,/, and/CC/and replication/NN/replication /./. the/DT/the file/NN/file system/NN/system resides/VBZ/resides permanently/RB/permanently on/IN/on secondary/JJ/secondary storage/NN/storage /,/, which/WDT/which is/VBZ/is designed/VBN/designed to/TO/to hold/VB/hold a/DT/a large/JJ/large amount/NN/amount of/IN/of data/NNS/data permanently/NNP/permanently. the/DT/the most/RBS/most common/JJ/common secondary-storage/NN/secondary-storage medium/NN/medium is/VBZ/is the/DT/the disk/NN/disk /./. physical/JJ/physical disks/NNS/disks may/MD/may be/VB/be segmented/VBN/segmented into/IN/into partitions/NNS/partitions to/TO/to control/NN/control media/NNS/media use/VBP/use and/CC/and to/TO/to allow/VB/allow multiple/JJ/multiple /,/, possibly/RB/possibly varying/VBG/varying /,/, file/JJ/file systems/NNS/systems on/IN/on a/DT/a single/JJ/single spindle/NN/spindle /./. these/DT/these file/NN/file systems/NNS/systems are/VBP/are mounted/VBN/mounted onto/IN/onto a/DT/a logical/JJ/logical file/NN/file system/NN/system architecture/NN/architecture to/TO/to make/VB/make then/RB/then available/JJ/available for/IN/for use/NNP/use. file/NN/file systems/NNS/systems are/VBP/are often/RB/often implemented/VBN/implemented in/IN/in a/DT/a layered/VBN/layered or/CC/or modular/JJ/modular structure/NNP/structure. the/DT/the lower/JJR/lower levels/NNS/levels deal/VBP/deal with/IN/with the/DT/the physical/JJ/physical properties/NNS/properties of/IN/of storage/NN/storage devices/NNP/devices. upper/NN/upper levels/NNS/levels deal/VBP/deal with/IN/with symbolic/JJ/symbolic file/NN/file names/NNS/names and/CC/and logical/JJ/logical properties/NNS/properties of/IN/of files/NNP/files. intermediate/JJ/intermediate levels/NNS/levels map/VBP/map the/DT/the logical/JJ/logical file/NN/file concepts/NNS/concepts into/IN/into physical/JJ/physical device/NN/device properties/NNS/properties /./. any/DT/any file-system/JJ/file-system type/NN/type can/MD/can have/VB/have different/JJ/different structures/NNS/structures and/CC/and algorithms/NNP/algorithms. a/DT/a vfs/NN/vfs layer/NN/layer allows/VBZ/allows the/DT/the upper/JJ/upper layers/NNS/layers to/TO/to deal/VB/deal with/IN/with each/DT/each file-system/JJ/file-system type/NN/type uniformly/NNP/uniformly. even/RB/even 499/CD/499 remote/NN/remote file/NN/file systems/NNS/systems can/MD/can be/VB/be integrated/VBN/integrated into/IN/into the/DT/the system/NN/system 's/POS/'s directory/NN/directory structure/NN/structure and/CC/and acted/VBD/acted on/IN/on by/IN/by standard/JJ/standard system/NN/system calls/VBZ/calls via/IN/via the/DT/the vfs/NNS/vfs interface/NN/interface /./. the/DT/the various/JJ/various files/NNS/files can/MD/can be/VB/be allocated/VBN/allocated space/NN/space on/IN/on the/DT/the disk/NN/disk in/IN/in three/CD/three ways/NNS/ways /:/: through/IN/through contiguous/JJ/contiguous /,/, linked/VBN/linked /,/, or/CC/or indexed/VBN/indexed allocation/NNP/allocation. contiguous/JJ/contiguous allocation/NN/allocation can/MD/can suffer/VB/suffer from/IN/from external/JJ/external fragmentation/NNP/fragmentation. direct/JJ/direct access/NN/access is/VBZ/is very/RB/very inefficient/JJ/inefficient with/IN/with linked/JJ/linked allocation/NNP/allocation. indexed/VBD/indexed allocation/NN/allocation may/MD/may require/VB/require substantial/JJ/substantial overhead/NN/overhead for/IN/for its/PRP$/its index/NN/index block/NNP/block. these/DT/these algorithms/NNS/algorithms can/MD/can be/VB/be optimized/VBN/optimized in/IN/in many/JJ/many ways/NNP/ways. contiguous/JJ/contiguous space/NN/space can/MD/can be/VB/be enlarged/VBN/enlarged through/IN/through extents/NNS/extents to/TO/to increase/VB/increase flexibility/NN/flexibility and/CC/and to/TO/to decrease/VB/decrease external/JJ/external fragmentation/NNP/fragmentation. indexed/VBD/indexed allocation/NN/allocation can/MD/can be/VB/be done/VBN/done in/IN/in clusters/NNS/clusters of/IN/of multiple/NN/multiple blocks/NNS/blocks to/TO/to increase/VB/increase throughput/NN/throughput and/CC/and to/TO/to reduce/VB/reduce the/DT/the number/NN/number of/IN/of index/NN/index entries/NNS/entries needed/NNP/needed. indexing/NN/indexing in/IN/in large/JJ/large clusters/NNS/clusters is/VBZ/is similar/JJ/similar to/TO/to contiguous/JJ/contiguous allocation/NN/allocation with/IN/with extents/NNS/extents /./. free-space/NN/free-space allocation/NN/allocation methods/NNS/methods also/RB/also influence/NN/influence the/DT/the efficiency/NN/efficiency of/IN/of disk-space/NN/disk-space use/NN/use /,/, the/DT/the performance/NN/performance of/IN/of the/DT/the file/NN/file system/NN/system /,/, and/CC/and the/DT/the reliability/NN/reliability of/IN/of secondary/JJ/secondary storage/NN/storage /./. the/DT/the methods/NNS/methods used/VBN/used include/NN/include bit/NN/bit vectors/NNS/vectors and/CC/and linked/VBD/linked lists/NNP/lists. optimizations/NNS/optimizations include/VBP/include grouping/VBG/grouping /,/, countilcg/NN/countilcg /,/, and/CC/and the/DT/the fat/JJ/fat /,/, which/WDT/which places/NNS/places the/DT/the linked/VBN/linked list/NN/list in/IN/in one/CD/one contiguous/JJ/contiguous area/NN/area /./. directory-management/JJ/directory-management routines/NNS/routines must/MD/must consider/VB/consider efficiency/NN/efficiency /,/, performance/NN/performance /,/, and/CC/and reliability/NNP/reliability. a/DT/a hash/NN/hash table/NN/table is/VBZ/is a/DT/a commonly/RB/commonly used/VBN/used method/NN/method /,/, as/IN/as it/PRP/it is/VBZ/is fast/RB/fast and/CC/and efficient/NNP/efficient. unfortunately/RB/unfortunately /,/, damage/NN/damage to/TO/to the/DT/the table/NN/table or/CC/or a/DT/a system/NN/system crash/NN/crash can/MD/can result/VB/result in/IN/in inconsistency/NN/inconsistency between/IN/between the/DT/the directory/NN/directory information/NN/information and/CC/and the/DT/the disk/NN/disk 's/POS/'s contents/NNS/contents /./. a/DT/a consistency/NN/consistency checker/NN/checker can/MD/can be/VB/be used/VBN/used to/TO/to repair/VB/repair the/DT/the damage/NNP/damage. operating-system/NNP/operating-system backup/NN/backup tools/NNS/tools allow/VBP/allow disk/NN/disk data/NNS/data to/TO/to be/VB/be copied/VBN/copied to/TO/to tape/NN/tape /,/, enabling/VBG/enabling the/DT/the user/NN/user to/TO/to recover/VB/recover from/IN/from data/NNS/data or/CC/or even/RB/even disk/VB/disk loss/NN/loss due/JJ/due to/TO/to hardware/VB/hardware failure/NN/failure /,/, operating/NN/operating system/NN/system bug/NN/bug /,/, or/CC/or user/NN/user error/NN/error /./. network/NN/network file/NN/file systems/NNS/systems /,/, such/JJ/such as/IN/as nfs/NNS/nfs /,/, use/VBP/use client-server/JJ/client-server methodology/NN/methodology to/TO/to allow/VB/allow users/NNS/users to/TO/to access/NN/access files/NNS/files and/CC/and directories/NNS/directories from/IN/from remote/NN/remote machines/NNS/machines as/IN/as if/IN/if they/PRP/they were/VBD/were on/IN/on local/JJ/local file/NN/file systems/NNP/systems. system/NN/system calls/VBZ/calls on/IN/on the/DT/the client/NN/client are/VBP/are translated/VBN/translated into/IN/into network/NN/network protocols/NNS/protocols and/CC/and retranslated/VBD/retranslated into/IN/into file-system/JJ/file-system operations/NNS/operations on/IN/on the/DT/the server/NN/server /./. networking/NN/networking and/CC/and multiple-client/JJ/multiple-client access/NN/access create/NN/create challenges/NNS/challenges in/IN/in the/DT/the areas/NNS/areas of/IN/of data/NNS/data consistency/NN/consistency and/CC/and performance/NN/performance /./. due/JJ/due to/TO/to the/DT/the fundamental/JJ/fundamental role/NN/role that/WDT/that file/NN/file systems/NNS/systems play/VBP/play in/IN/in system/NN/system operation/NN/operation /,/, their/PRP$/their performance/NN/performance and/CC/and reliability/NN/reliability are/VBP/are crucial/NNP/crucial. techniques/NNS/techniques such/JJ/such as/IN/as log/NN/log structures/NNS/structures and/CC/and cachirtg/NN/cachirtg help/NN/help improve/VB/improve performance/NN/performance /,/, while/IN/while log/NN/log structures/NNS/structures and/CC/and raid/VBD/raid improve/VB/improve reliability/NNP/reliability. the/DT/the wafl/NN/wafl file/NN/file system/NN/system is/VBZ/is an/DT/an example/NN/example of/IN/of optimization/NN/optimization of/IN/of performance/NN/performance to/TO/to match/VB/match a/DT/a specific/JJ/specific i/o/NN/i/o load/NN/load /./. 11.1/CD/11.1 in/IN/in what/WP/what situations/NNS/situations would/MD/would using/VBG/using memory/NN/memory as/IN/as a/DT/a ram/NN/ram disk/NN/disk be/VB/be more/RBR/more useful/JJ/useful than/IN/than using/VBG/using it/PRP/it as/IN/as a/DT/a disk/NN/disk cache/NN/cache 11.2/CD/11.2 consider/NN/consider a/DT/a file/NN/file systenc/NN/systenc that/WDT/that uses/VBZ/uses a/DT/a modifed/VBN/modifed contiguous-allocation/NN/contiguous-allocation scheme/NN/scheme with/IN/with support/NN/support for/IN/for extents/NNP/extents. a/DT/a file/NN/file is/VBZ/is a/DT/a collection/NN/collection of/IN/of extents/NNS/extents /,/, with/IN/with each/DT/each extent/NN/extent corresponding/VBG/corresponding to/TO/to a/DT/a contiguous/JJ/contiguous set/NN/set of/IN/of blocks/NNP/blocks. a/DT/a key/JJ/key issue/NN/issue in/IN/in such/JJ/such systems/NNS/systems is/VBZ/is the/DT/the degree/NN/degree of/IN/of variability/NN/variability in/IN/in the/DT/the size/NN/size of/IN/of the/DT/the 500/CD/500 chapter/NN/chapter 11/CD/11 extents/NNP/extents. what/WP/what are/VBP/are the/DT/the advantages/NNS/advantages and/CC/and disadvantages/NNS/disadvantages of/IN/of the/DT/the following/JJ/following schemes/NNS/schemes a/NNP/a. all/DT/all extents/NNS/extents are/VBP/are of/IN/of the/DT/the same/JJ/same size/NN/size /,/, and/CC/and the/DT/the size/NN/size is/VBZ/is predetermined/VBN/predetermined /./. b/NNP/b. extents/NNS/extents can/MD/can be/VB/be of/IN/of any/DT/any size/NN/size and/CC/and are/VBP/are allocated/VBN/allocated dynamically/RB/dynamically /./. c/NNP/c. extents/NNS/extents can/MD/can be/VB/be of/IN/of a/DT/a few/JJ/few fixed/VBN/fixed sizes/NNS/sizes /,/, and/CC/and these/DT/these sizes/NNS/sizes are/VBP/are predetermined/VBN/predetermined /./. 11.3/CD/11.3 some/DT/some file/JJ/file systems/NNS/systems allow/VBP/allow disk/NN/disk storage/NN/storage to/TO/to be/VB/be allocated/VBN/allocated at/IN/at different/JJ/different levels/NNS/levels of/IN/of granularity/NNP/granularity. for/IN/for instance/NN/instance /,/, a/DT/a file/NN/file system/NN/system could/MD/could allocate/VB/allocate 4/CD/4 kb/NN/kb of/IN/of disk/NN/disk space/NN/space as/IN/as a/DT/a single/JJ/single 4-kb/CD/4-kb block/NN/block or/CC/or as/IN/as eight/CD/eight 512-byte/CD/512-byte blocks/NNP/blocks. how/WRB/how could/MD/could we/VB/we take/VB/take advantage/NN/advantage of/IN/of this/DT/this flexibility/NN/flexibility to/TO/to improve/VB/improve performance/NN/performance what/WP/what modifications/NNS/modifications would/MD/would have/VB/have to/TO/to be/VB/be made/VBN/made to/TO/to the/DT/the free-space/NN/free-space management/NN/management scheme/NN/scheme in/IN/in order/NN/order to/TO/to support/VB/support this/DT/this feature/NN/feature 11.4/CD/11.4 what/WP/what are/VBP/are the/DT/the advantages/NNS/advantages of/IN/of the/DT/the variant/JJ/variant of/IN/of linked/VBN/linked allocation/NN/allocation that/IN/that uses/NNS/uses a/DT/a fat/JJ/fat to/TO/to chain/VB/chain together/RP/together the/DT/the blocks/NNS/blocks of/IN/of a/DT/a file/NN/file 11.5/CD/11.5 consider/NN/consider a/DT/a file/NN/file currently/RB/currently consisting/VBG/consisting of/IN/of 100/CD/100 blocks/NNP/blocks. assume/NN/assume that/WDT/that the/DT/the filecontrol/NN/filecontrol block/NN/block /:/( and/CC/and the/DT/the index/NN/index block/NN/block /,/, in/IN/in the/DT/the case/NN/case of/IN/of indexed/VBN/indexed allocation/NN/allocation /:/) is/VBZ/is already/RB/already in/IN/in memory/NNP/memory. calculate/NN/calculate how/WRB/how many/JJ/many disk/NN/disk i/0/-NONE-/i/0 operations/NNS/operations are/VBP/are required/VBN/required for/IN/for contiguous/JJ/contiguous /,/, linked/VBN/linked /,/, and/CC/and indexed/VBD/indexed /CD/( single-level/JJ/single-level /NN/) allocation/NN/allocation strategies/NNS/strategies /,/, if/IN/if /,/, for/IN/for one/CD/one block/NN/block /,/, the/DT/the following/VBG/following conditions/NNS/conditions hold/NNP/hold. in/IN/in the/DT/the contiguous-allocation/NN/contiguous-allocation case/NN/case /,/, assume/NN/assume that/IN/that there/EX/there is/VBZ/is no/DT/no room/NN/room to/TO/to grow/VB/grow at/IN/at the/DT/the beginning/NN/beginning but/CC/but there/EX/there is/VBZ/is room/NN/room to/TO/to grow/VB/grow at/IN/at the/DT/the end/NNP/end. also/RB/also assume/VBD/assume that/IN/that the/DT/the block/NN/block information/NN/information to/TO/to be/VB/be added/VBN/added is/VBZ/is stored/VBN/stored in/IN/in memory/NN/memory /./. a/NNP/a. the/DT/the block/NN/block is/VBZ/is added/VBN/added at/IN/at the/DT/the beginning/NN/beginning /./. b/NNP/b. the/DT/the block/NN/block is/VBZ/is added/VBN/added in/IN/in the/DT/the middle/NN/middle /./. c/NNP/c. the/DT/the block/NN/block is/VBZ/is added/VBN/added at/IN/at the/DT/the end/NN/end /./. d/NNP/d. the/DT/the block/NN/block is/VBZ/is removed/VBN/removed from/IN/from the/DT/the beginning/NN/beginning /./. e/NNP/e. the/DT/the block/NN/block is/VBZ/is removed/VBN/removed from/IN/from the/DT/the middle/NN/middle /./. f/NNP/f. the/DT/the block/NN/block is/VBZ/is removed/VBN/removed from/IN/from the/DT/the end/NN/end /./. 11.6/CD/11.6 consider/NN/consider a/DT/a file/NN/file system/NN/system that/WDT/that uses/VBZ/uses inodes/VBZ/inodes to/TO/to represent/VB/represent files/NNP/files. disk/NN/disk blocks/NNS/blocks are/VBP/are 8/CD/8 kb/NN/kb in/IN/in size/NN/size /,/, and/CC/and a/DT/a pointer/NN/pointer to/TO/to a/DT/a disk/NN/disk block/NN/block requires/VBZ/requires 4/CD/4 bytes/NNP/bytes. this/DT/this file/NN/file system/NN/system has/VBZ/has 12/CD/12 direct/JJ/direct disk/NN/disk blocks/NNS/blocks /,/, as/IN/as well/RB/well as/IN/as single/JJ/single /,/, double/JJ/double /,/, and/CC/and triple/VB/triple indirect/JJ/indirect disk/NN/disk blocks/NNP/blocks. what/WP/what is/VBZ/is the/DT/the maximum/NN/maximum size/NN/size of/IN/of a/DT/a file/NN/file that/WDT/that can/MD/can be/VB/be stored/VBN/stored in/IN/in this/DT/this file/NN/file system/NN/system 11.7/CD/11.7 assume/NN/assume that/WDT/that in/IN/in a/DT/a particular/JJ/particular augmentation/NN/augmentation of/IN/of a/DT/a reinote-file-access/JJ/reinote-file-access protocol/NN/protocol /,/, each/DT/each client/NN/client maintains/VBZ/maintains a/DT/a name/NN/name cache/NN/cache that/WDT/that caches/VBZ/caches translations/NNS/translations from/IN/from file/JJ/file names/NNS/names to/TO/to corresponding/VBG/corresponding file/NN/file handles/NNP/handles. what/WP/what issues/NNS/issues should/MD/should we/PRP/we take/VB/take into/IN/into account/NN/account in/IN/in implementing/NN/implementing the/DT/the name/NN/name cache/NN/cache 11.8/CD/11.8 consider/NN/consider the/DT/the following/VBG/following backup/NN/backup scheme/NN/scheme /:/: day/NN/day 1/CD/1. copy/NN/copy to/TO/to a/DT/a backup/NN/backup medium/NN/medium all/DT/all files/NNS/files from/IN/from the/DT/the disk/NN/disk /./. day/NN/day 2/CD/2. copy/NN/copy to/TO/to another/DT/another m.edium/NN/m.edium all/DT/all files/NNS/files changed/VBD/changed since/IN/since day/NN/day 1/CD/1 /./. day/NN/day 3/CD/3. copy/NN/copy to/TO/to another/DT/another medium/NN/medium all/DT/all files/NNS/files changed/VBD/changed since/IN/since day/NN/day 1/CD/1 /./. 501/CD/501 this/DT/this differs/NNS/differs from/IN/from the/DT/the schedule/NN/schedule given/VBN/given in/IN/in section/NN/section 11.7.4/CD/11.7.4 by/IN/by having/NN/having all/DT/all subsequent/NN/subsequent backups/NNS/backups copy/VBP/copy all/DT/all files/NNS/files modified/VBD/modified since/IN/since the/DT/the first/JJ/first full/JJ/full backup/NN/backup /./. what/WP/what are/VBP/are the/DT/the benefits/NNS/benefits of/IN/of this/DT/this system/NN/system over/IN/over the/DT/the one/CD/one in/IN/in section/NN/section 11.7.4/CD/11.7.4 what/WP/what are/VBP/are the/DT/the drawbacks/NNS/drawbacks are/VBP/are restore/RB/restore operations/NNS/operations made/VBD/made easier/JJR/easier or/CC/or more/JJR/more difficult/JJ/difficult explain/NN/explain your/PRP$/your answer/NN/answer /./. 11.9/CD/11.9 why/WRB/why must/MD/must the/DT/the bit/NN/bit map/NN/map for/IN/for file/NN/file allocation/NN/allocation be/VB/be kept/VBN/kept on/IN/on mass/NN/mass storage/NN/storage /,/, rather/RB/rather than/IN/than in/IN/in main/JJ/main memory/NN/memory 11.10/CD/11.10 consider/NN/consider a/DT/a file/NN/file system/NN/system on/IN/on a/DT/a disk/NN/disk that/WDT/that has/VBZ/has both/DT/both logical/JJ/logical and/CC/and physical/JJ/physical block/NN/block sizes/VBZ/sizes of/IN/of 512/CD/512 bytes/NNP/bytes. assume/NN/assume that/WDT/that the/DT/the information/NN/information about/IN/about each/DT/each file/NN/file is/VBZ/is already/RB/already in/IN/in memory/NNP/memory. for/IN/for each/DT/each of/IN/of the/DT/the three/CD/three allocation/NN/allocation strategies/NNS/strategies /:/( contiguous/JJ/contiguous /,/, linked/VBN/linked /,/, and/CC/and indexed/VBD/indexed /CD/) /,/, answer/NN/answer these/DT/these questions/NNS/questions /:/: a/NNP/a. how/WRB/how is/VBZ/is the/DT/the logical-to-physical/JJ/logical-to-physical address/NN/address mapping/VBG/mapping accomplished/VBN/accomplished in/IN/in this/DT/this system/NN/system /:/( for/IN/for the/DT/the indexed/VBN/indexed allocation/NN/allocation /,/, assume/NN/assume that/IN/that a/DT/a file/NN/file is/VBZ/is always/RB/always less/JJR/less than/IN/than 512/CD/512 blocks/NNS/blocks long/NNP/long. /NNP/) b/NNP/b. if/IN/if we/PRP/we are/VBP/are currently/RB/currently at/IN/at logical/JJ/logical block/NN/block 10/CD/10 /CD/( the/DT/the last/JJ/last block/NN/block accessed/VBD/accessed was/VBD/was block/NN/block 10/CD/10 /CD/) and/CC/and want/JJ/want to/TO/to access/NN/access logical/JJ/logical block/NN/block 4/CD/4 /,/, how/WRB/how many/JJ/many physical/JJ/physical blocks/NNS/blocks must/MD/must be/VB/be read/VBN/read from/IN/from the/DT/the disk/NN/disk 11.11/CD/11.11 why/WRB/why is/VBZ/is it/PRP/it advantageous/VBZ/advantageous to/TO/to the/DT/the user/NN/user for/IN/for an/DT/an operating/NN/operating system/NN/system to/TO/to dynamically/RB/dynamically allocate/VB/allocate its/PRP$/its internal/JJ/internal tables/NNS/tables what/WP/what are/VBP/are the/DT/the penalties/NNS/penalties to/TO/to the/DT/the operating/NN/operating system/NN/system for/IN/for doing/VBG/doing so/RB/so 11.12/CD/11.12 explain/NN/explain why/WRB/why logging/VBG/logging metadata/NNS/metadata updates/NNS/updates ensures/NNS/ensures recovery/VBP/recovery of/IN/of a/DT/a file/NN/file system/NN/system after/IN/after a/DT/a file-system/JJ/file-system crash/NN/crash /./. 11.13/CD/11.13 fragmentation/NN/fragmentation on/IN/on a/DT/a storage/NN/storage device/NN/device can/MD/can be/VB/be eliminated/VBN/eliminated by/IN/by recompaction/NN/recompaction of/IN/of the/DT/the information/NNP/information. typical/JJ/typical disk/NN/disk devices/NNS/devices do/VBP/do not/RB/not have/VB/have relocation/NN/relocation or/CC/or base/NN/base registers/NNS/registers /:/( such/JJ/such as/IN/as those/DT/those used/VBN/used when/WRB/when memory/NN/memory is/VBZ/is to/TO/to be/VB/be compacted/VBN/compacted /-NONE-/) /,/, so/IN/so how/WRB/how can/MD/can we/PRP/we relocate/VB/relocate files/NNS/files give/VBP/give three/CD/three reasons/NNS/reasons why/WRB/why recompacting/VBG/recompacting and/CC/and relocation/NN/relocation of/IN/of files/NNS/files are/VBP/are often/RB/often avoided/VBN/avoided /./. 11.14/CD/11.14 consider/NN/consider a/DT/a system/NN/system where/WRB/where free/JJ/free space/NN/space is/VBZ/is kept/VBN/kept in/IN/in a/DT/a free-space/NN/free-space list/NN/list /./. a/NNP/a. suppose/NN/suppose that/WDT/that the/DT/the pointer/NN/pointer to/TO/to the/DT/the free-space/NN/free-space list/NN/list is/VBZ/is lost/NNP/lost. can/MD/can the/DT/the system/NN/system reconstruct/NN/reconstruct the/DT/the free-space/NN/free-space list/NN/list explain/NN/explain your/PRP$/your answer/NN/answer /./. b/NNP/b. consider/NN/consider a/DT/a file/NN/file system/NN/system similar/JJ/similar to/TO/to the/DT/the one/CD/one used/JJ/used by/IN/by unix/NN/unix with/IN/with indexed/VBN/indexed allocation/NNP/allocation. how/WRB/how many/JJ/many disk/NN/disk i/0/-NONE-/i/0 operations/NNS/operations might/MD/might be/VB/be 502/CD/502 chapter/NN/chapter 11/CD/11 required/VBN/required to/TO/to read/VB/read the/DT/the contents/NNS/contents of/IN/of a/DT/a small/JJ/small local/JJ/local file/NN/file at/IN/at /a/b/c/JJ//a/b/c assume/NN/assume that/WDT/that none/NN/none of/IN/of the/DT/the disk/NN/disk blocks/NNS/blocks is/VBZ/is currently/RB/currently being/VBG/being cached/VBN/cached /./. c/NNP/c. suggest/VBP/suggest a/DT/a scheme/NN/scheme to/TO/to ensure/VB/ensure that/IN/that the/DT/the pointer/NN/pointer is/VBZ/is never/RB/never lost/VBN/lost as/IN/as a/DT/a result/NN/result of/IN/of memory/NN/memory failure/NN/failure /./. 11.15/CD/11.15 one/CD/one problem/NN/problem with/IN/with contiguous/JJ/contiguous allocation/NN/allocation is/VBZ/is that/IN/that the/DT/the user/NN/user must/MD/must preallocate/VB/preallocate enough/RB/enough space/NN/space for/IN/for each/DT/each file/NNP/file. if/IN/if the/DT/the file/NN/file grows/VBZ/grows to/TO/to be/VB/be larger/JJR/larger than/IN/than the/DT/the space/NN/space allocated/VBD/allocated for/IN/for it/PRP/it /,/, special/JJ/special actions/NNS/actions must/MD/must be/VB/be taken/NNP/taken. one/CD/one solution/NN/solution to/TO/to this/DT/this problem/NN/problem is/VBZ/is to/TO/to define/VB/define a/DT/a file/NN/file structure/NN/structure consisting/VBG/consisting of/IN/of an/DT/an initial/JJ/initial contiguous/JJ/contiguous area/NN/area /:/( of/IN/of a/DT/a specified/VBN/specified size/NN/size /:/) /./. if/IN/if this/DT/this area/NN/area is/VBZ/is filled/VBN/filled /,/, the/DT/the operating/NN/operating system/NN/system automatically/RB/automatically defines/VBZ/defines an/DT/an overflow/JJ/overflow area/NN/area that/WDT/that is/VBZ/is linked/VBN/linked to/TO/to the/DT/the initial/JJ/initial contiguous/JJ/contiguous area/NNP/area. if/IN/if the/DT/the overflow/NN/overflow area/NN/area is/VBZ/is filled/VBN/filled /,/, another/DT/another overflow/NN/overflow area/NN/area is/VBZ/is allocated/NNP/allocated. compare/NN/compare this/DT/this implementation/NN/implementation of/IN/of a/DT/a file/NN/file with/IN/with the/DT/the standard/JJ/standard contiguous/JJ/contiguous and/CC/and linked/VBN/linked implementations/NNS/implementations /./. 11.16/CD/11.16 discuss/NNS/discuss how/WRB/how performance/NN/performance optimizations/NNS/optimizations for/IN/for file/NN/file systems/NNS/systems might/MD/might result/VB/result in/IN/in difficulties/NNS/difficulties in/IN/in maintaining/VBG/maintaining the/DT/the consistency/NN/consistency of/IN/of the/DT/the systems/NNS/systems in/IN/in the/DT/the event/NN/event of/IN/of com.puter/JJ/com.puter crashes/NNS/crashes /./. the/DT/the ms-dos/NNP/ms-dos fat/NN/fat system/NN/system is/VBZ/is explained/VBN/explained in/IN/in norton/NN/norton and/CC/and wilton/NN/wilton /:/[ 1988/CD/1988 /CD/] /,/, and/CC/and the/DT/the os/2/NNP/os/2 description/NN/description can/MD/can be/VB/be found/VBN/found in/IN/in iacobucci/NN/iacobucci /:/[ 1988/CD/1988 /CD/] /./. these/DT/these operating/NN/operating systems/NNS/systems use/VBP/use the/DT/the intel/NN/intel 8086/CD/8086 cpus/NN/cpus /:/( intel/NN/intel /:/[ 1985b/CD/1985b /CD/] /,/, intel/NN/intel /:/[ 1985a/CD/1985a /CD/] /,/, intel/NN/intel /:/[ 1986/CD/1986 /CD/] /,/, and/CC/and intel/NN/intel /:/[ 1990/CD/1990 /CD/] /CD/) /./. ibm/NN/ibm allocation/NN/allocation methods/NNS/methods are/VBP/are described/VBN/described in/IN/in deitel/NN/deitel /:/[ 1990/CD/1990 /CD/] /./. the/DT/the internals/NNS/internals of/IN/of the/DT/the bsd/NN/bsd unl/NN/unl '/''/' system/NN/system are/VBP/are covered/VBN/covered in/IN/in full/JJ/full in/IN/in mckusick/NN/mckusick et/NN/et al/NNP/al. /NNP/[ 1996/CD/1996 /CD/] /./. mcvoy/NN/mcvoy and/CC/and kleiman/NN/kleiman /:/[ 1991/CD/1991 /CD/] discusses/NNS/discusses optimizations/NNS/optimizations of/IN/of these/DT/these methods/NNS/methods made/VBN/made in/IN/in solaris/NNP/solaris. the/DT/the coogle/NN/coogle file/NN/file system/NN/system is/VBZ/is described/VBN/described in/IN/in ghemawat/NN/ghemawat et/NN/et al/NNP/al. /NNP/[ 2003/CD/2003 /CD/] /./. fuse/NN/fuse can/MD/can be/VB/be found/VBN/found at/IN/at http/NN/http /:/: //:// /fuse.sourceforge.net//JJ//fuse.sourceforge.net/ /./. disk/NN/disk file/NN/file allocation/NN/allocation based/VBN/based on/IN/on the/DT/the buddy/NN/buddy system/NN/system is/VBZ/is covered/VBN/covered in/IN/in koch/NN/koch /:/[ 1987/CD/1987 /CD/] /./. a/DT/a file-organization/NN/file-organization scheme/NN/scheme that/WDT/that guarantees/VBZ/guarantees retrieval/NN/retrieval in/IN/in one/CD/one access/NN/access is/VBZ/is described/VBN/described by/IN/by larson/NN/larson and/CC/and kajla/NN/kajla /:/[ 1984/CD/1984 /CD/] /./. log-structured/JJ/log-structured file/NN/file organizations/NNS/organizations for/IN/for enhancing/VBG/enhancing both/DT/both performance/NN/performance and/CC/and consistency/NN/consistency are/VBP/are discussed/VBN/discussed in/IN/in rosenblum/NN/rosenblum and/CC/and ousterhout/IN/ousterhout /CD/[ 1991/CD/1991 /CD/] /,/, seltzer/NN/seltzer et/NN/et al/NNP/al. /NNP/[ 1993/CD/1993 /CD/] /,/, and/CC/and seltzer/NN/seltzer et/NN/et al/NN/al /:/[ 1995/CD/1995 /CD/] /./. algorithms/NNS/algorithms such/JJ/such as/IN/as balanced/JJ/balanced trees/NNS/trees /:/( and/CC/and much/JJ/much more/RBR/more /JJ/) are/VBP/are covered/VBN/covered by/IN/by knuth/NN/knuth /:/[ 1998/CD/1998 /CD/] and/CC/and carmen/NNS/carmen et/VBP/et al/JJ/al /NN/[ 2001/CD/2001 /CD/] /./. the/DT/the zfs/NNS/zfs source/NN/source code/NN/code for/IN/for space/NN/space maps/NNS/maps can/MD/can be/VB/be found/VBN/found at/IN/at http/NN/http /:/: //src.opensolaris.org/source/xref/onnv/onnvgate//JJ///src.opensolaris.org/source/xref/onnv/onnvgate/ usr/NN/usr i/PRP/i src/uts//VBP/src/uts/ common//JJ/common/ fs//NN/fs/ zfs//NN/zfs/ space_map.c/NN/space_map.c /./. disk/NN/disk caching/VBG/caching is/VBZ/is discussed/VBN/discussed by/IN/by mckeon/NN/mckeon /:/[ 1985/CD/1985 /CD/] and/CC/and smith/IN/smith /CD/[ 1985/CD/1985 /CD/] /./. caching/NN/caching in/IN/in the/DT/the experimental/JJ/experimental sprite/NN/sprite operating/NN/operating system/NN/system is/VBZ/is described/VBN/described in/IN/in nelson/NN/nelson et/NN/et al/NN/al /:/[ 1988/CD/1988 /CD/] /./. general/JJ/general discussions/NNS/discussions concerning/VBG/concerning mass-storage/NN/mass-storage technology/NN/technology are/VBP/are offered/VBN/offered by/IN/by chi/NN/chi /:/[ 1982/CD/1982 /CD/] and/CC/and hoagland/NN/hoagland /:/[ 1985/CD/1985 /CD/] /./. folk/NN/folk and/CC/and zoellick/NN/zoellick /:/[ 1987/CD/1987 /CD/] covers/NNS/covers the/DT/the gamut/NN/gamut of/IN/of file/NN/file structures/NNP/structures. silvers/NNS/silvers /:/[ 2000/CD/2000 /CD/] discusses/NNS/discusses implementing/VBG/implementing the/DT/the page/NN/page cache/NN/cache in/IN/in the/DT/the netbsd/NN/netbsd operating/NN/operating system/NN/system /./. the/DT/the network/NN/network file/NN/file system/NN/system /:/( nfs/NNS/nfs /VBP/) is/VBZ/is discussed/VBN/discussed in/IN/in sandberg/NN/sandberg et/NN/et al/NN/al /:/[ 1985/CD/1985 /CD/] /,/, sandberg/NN/sandberg /:/[ 1987/CD/1987 /CD/] /,/, sun/NN/sun /:/[ 1990/CD/1990 /CD/] /,/, and/CC/and callaghan/IN/callaghan /CD/[ 2000/CD/2000 /CD/] /./. nfs/NNS/nfs version/NN/version 4/CD/4 is/VBZ/is a/DT/a standard/JJ/standard described/VBN/described at/IN/at http/NN/http /:/: //:// /www.ietf.org/rfc/rfc3530.txt/NNP//www.ietf.org/rfc/rfc3530.txt. the/DT/the characteristics/NNS/characteristics of/IN/of 503/CD/503 workloads/NNS/workloads in/IN/in distributed/VBN/distributed file/NN/file systems/NNS/systems are/VBP/are examined/VBN/examined in/IN/in baker/NN/baker et/NN/et al/NNP/al. /NNP/[ 1991/CD/1991 /CD/] /./. ousterhout/IN/ousterhout /CD/[ 1991/CD/1991 /CD/] discusses/NNS/discusses the/DT/the role/NN/role of/IN/of distributed/VBN/distributed state/NN/state in/IN/in networked/JJ/networked file/NN/file systems/NNP/systems. log-structured/JJ/log-structured designs/NNS/designs for/IN/for networked/VBN/networked file/NN/file systems/NNS/systems are/VBP/are proposed/VBN/proposed in/IN/in hartman/NN/hartman and/CC/and ousterhout/IN/ousterhout /CD/[ 1995/CD/1995 /CD/] and/CC/and thekkath/NN/thekkath et/NN/et al/NNP/al. /NNP/[ 1997/CD/1997 /CD/] /./. nfs/NNS/nfs and/CC/and the/DT/the unix/NN/unix file/NN/file system/NN/system /:/( ufs/NNS/ufs /VBP/) are/VBP/are described/VBN/described in/IN/in vahalia/NN/vahalia /:/[ 1996/CD/1996 /CD/] and/CC/and mauro/NN/mauro and/CC/and mcdougall/NN/mcdougall /:/[ 2007/CD/2007 /CD/] /./. the/DT/the windows/NNS/windows nt/VBP/nt file/JJ/file system/NN/system /,/, ntfs/VBZ/ntfs /,/, is/VBZ/is explained/VBN/explained in/IN/in solomon/NN/solomon /:/[ 1998/CD/1998 /CD/] /./. the/DT/the ext2/NNP/ext2 file/NN/file system/NN/system used/VBD/used in/IN/in linux/NN/linux is/VBZ/is described/VBN/described in/IN/in bovet/NN/bovet and/CC/and cesati/NN/cesati /:/[ 2002/CD/2002 /CD/] and/CC/and the/DT/the wafl/NN/wafl file/NN/file system/NN/system in/IN/in hitz/NN/hitz et/NN/et al/NNP/al. /NNP/[ 1995/CD/1995 /CD/] /./. zfs/NNS/zfs documentation/NN/documentation can/MD/can be/VB/be found/VBN/found at/IN/at http/NN/http /:/: //:// /www.opensolaris.org//JJ//www.opensolaris.org/ os//NN/os/ community/NN/community /zfs//NN//zfs/ docs/NNS/docs /./. 12.1/CD/12.1 the/DT/the file/NN/file system/NN/system can/MD/can be/VB/be viewed/VBN/viewed logically/RB/logically as/IN/as consisting/VBG/consisting of/IN/of three/CD/three parts/NNP/parts. in/IN/in chapter/NN/chapter 10/CD/10 /,/, we/PRP/we examined/VBD/examined the/DT/the user/NN/user and/CC/and programmer/NN/programmer interface/NN/interface to/TO/to the/DT/the file/NN/file system/NNP/system. in/IN/in chapter/NN/chapter 11/CD/11 /,/, we/PRP/we described/VBD/described the/DT/the internal/JJ/internal data/NNS/data structures/NNS/structures and/CC/and algorithms/NNS/algorithms used/VBN/used by/IN/by the/DT/the operating/NN/operating system/NN/system to/TO/to implement/VB/implement this/DT/this interface/NNP/interface. in/IN/in this/DT/this chapter/NN/chapter /,/, we/PRP/we discuss/VBP/discuss the/DT/the lowest/JJS/lowest level/NN/level of/IN/of the/DT/the file/NN/file system/NN/system /:/: the/DT/the secondary/JJ/secondary and/CC/and tertiary/JJ/tertiary storage/NN/storage structures/NNP/structures. we/PRP/we first/RB/first describe/VBP/describe the/DT/the physical/JJ/physical structure/NN/structure of/IN/of magenetic/JJ/magenetic disks/NNS/disks and/CC/and magnetic/JJ/magnetic tapes/NNP/tapes. we/PRP/we then/RB/then describe/VBP/describe disk-scheduling/JJ/disk-scheduling algorithms/NNS/algorithms /,/, which/WDT/which schedule/NN/schedule the/DT/the order/NN/order of/IN/of disk/NN/disk i//NN/i/ os/NNS/os to/TO/to improve/VB/improve performance/NNP/performance. next/JJ/next /,/, we/PRP/we discuss/VBP/discuss disk/NN/disk formatting/VBG/formatting and/CC/and management/NN/management of/IN/of boot/NN/boot blocks/NNS/blocks /,/, damaged/VBD/damaged blocks/NNS/blocks /,/, and/CC/and swap/NN/swap space/NNP/space. we/PRP/we then/RB/then examine/VBP/examine secondary/JJ/secondary storage/NN/storage structure/NN/structure /,/, covering/VBG/covering disk/NN/disk reliability/NN/reliability and/CC/and stablestorage/NN/stablestorage implementation/NNP/implementation. we/PRP/we conclude/VBP/conclude with/IN/with a/DT/a brief/JJ/brief description/NN/description of/IN/of tertiary/JJ/tertiary storage/NN/storage devices/NNS/devices and/CC/and the/DT/the problems/NNS/problems that/WDT/that arise/VBP/arise when/WRB/when an/DT/an operating/NN/operating system/NN/system uses/NNS/uses tertiary/JJ/tertiary storage/NN/storage /./. to/TO/to describe/VB/describe the/DT/the physical/JJ/physical structure/NN/structure of/IN/of secondary/JJ/secondary and/CC/and tertiary/JJ/tertiary storage/NN/storage devices/NNS/devices and/CC/and its/PRP$/its effects/NNS/effects on/IN/on the/DT/the uses/NNS/uses of/IN/of the/DT/the devices/NNS/devices /./. to/TO/to explain/VB/explain the/DT/the performance/NN/performance characteristics/NNS/characteristics of/IN/of mass-storage/JJ/mass-storage devices/NNS/devices /./. to/TO/to discuss/VB/discuss operating-system/JJ/operating-system services/NNS/services provided/VBN/provided for/IN/for mass/NN/mass storage/NN/storage /,/, including/VBG/including raid/NN/raid and/CC/and hsm/NN/hsm /./. in/IN/in this/DT/this section/NN/section /,/, we/PRP/we present/VBP/present a/DT/a general/JJ/general overview/NN/overview of/IN/of the/DT/the physical/JJ/physical structure/NN/structure of/IN/of secondary/JJ/secondary and/CC/and tertiary/JJ/tertiary storage/NN/storage devices/NNS/devices /./. 12.1.1/CD/12.1.1 magnetic/JJ/magnetic disks/NNS/disks provide/VBP/provide the/DT/the bulk/NN/bulk of/IN/of secondary/JJ/secondary storage/NN/storage for/IN/for modern/JJ/modern computer/NN/computer systems/NNP/systems. conceptually/RB/conceptually /,/, disks/NNS/disks are/VBP/are relatively/RB/relatively simple/JJ/simple /NN/( figure/NN/figure 12.1/CD/12.1 /CD/) /./. each/DT/each disk/NN/disk platter/NN/platter has/VBZ/has a/DT/a flat/JJ/flat circular/NN/circular shape/NN/shape /,/, like/IN/like a/DT/a cd/NNP/cd. common/JJ/common platter/NN/platter diameters/NNS/diameters range/VBP/range 505/CD/505 506/CD/506 chapter/NN/chapter 12/CD/12 arm/NN/arm assembly/RB/assembly rotation/NN/rotation figure/NN/figure 12.1/CD/12.1 moving-head/JJ/moving-head disk/NN/disk mechanism/NN/mechanism /./. from/IN/from 1.8/CD/1.8 to/TO/to 5.25/CD/5.25 inches/NNP/inches. the/DT/the two/CD/two surfaces/NNS/surfaces of/IN/of a/DT/a platter/NN/platter are/VBP/are covered/VBN/covered with/IN/with a/DT/a magnetic/JJ/magnetic material/NNP/material. we/PRP/we store/VBP/store information/NN/information by/IN/by recording/VBG/recording it/PRP/it magnetically/RB/magnetically on/IN/on the/DT/the platters/NNS/platters /./. a/DT/a read/NN/read -write/JJ/-write head/NN/head flies/NNS/flies just/RB/just above/IN/above each/DT/each surface/NN/surface of/IN/of every/DT/every platter/NNP/platter. the/DT/the heads/NNS/heads are/VBP/are attached/VBN/attached to/TO/to a/DT/a that/IN/that moves/VBZ/moves all/DT/all the/DT/the heads/NNS/heads as/IN/as a/DT/a unit/NNP/unit. the/DT/the surface/NN/surface of/IN/of a/DT/a platter/NN/platter is/VBZ/is logically/RB/logically divided/VBN/divided into/IN/into circular/JJ/circular which/WDT/which are/VBP/are subdivided/VBN/subdivided into/IN/into the/DT/the set/NN/set of/IN/of tracks/NNS/tracks that/WDT/that are/VBP/are at/IN/at one/CD/one arm/NN/arm position/NN/position makes/VBZ/makes up/RP/up a/DT/a there/RB/there may/MD/may be/VB/be thousands/NNS/thousands of/IN/of concentric/JJ/concentric cylinders/NNS/cylinders in/IN/in a/DT/a disk/NN/disk drive/NN/drive /,/, and/CC/and each/DT/each track/NN/track may/MD/may contain/VB/contain hundreds/NNS/hundreds of/IN/of sectors/NNP/sectors. the/DT/the storage/NN/storage capacity/NN/capacity of/IN/of common/JJ/common disk/NN/disk drives/NNS/drives is/VBZ/is measured/VBN/measured iil/NN/iil gigabytes/NNS/gigabytes /./. when/WRB/when the/DT/the disk/NN/disk is/VBZ/is in/IN/in use/NN/use /,/, a/DT/a drive/JJ/drive motor/NN/motor spins/NNS/spins it/PRP/it at/IN/at high/JJ/high speed/NNP/speed. most/JJS/most drives/NNS/drives rotate/VBP/rotate 60/CD/60 to/TO/to 200/CD/200 times/NNS/times per/IN/per second/NNP/second. disk/NN/disk speed/VBD/speed has/VBZ/has two/CD/two parts/NNP/parts. the/DT/the is/VBZ/is the/DT/the rate/NN/rate at/IN/at which/WDT/which data/NNS/data flow/VBP/flow between/IN/between the/DT/the drive/JJ/drive and/CC/and the/DT/the computer/NNP/computer. the/DT/the sometimes/RB/sometimes called/VBN/called the/DT/the consists/NNS/consists of/IN/of the/DT/the time/NN/time necessary/JJ/necessary to/TO/to move/VB/move the/DT/the disk/NN/disk arm/NN/arm to/TO/to the/DT/the desired/VBN/desired cylinder/NN/cylinder /,/, called/VBN/called the/DT/the and/CC/and the/DT/the time/NN/time necessary/JJ/necessary for/IN/for the/DT/the desired/VBN/desired sector/NN/sector to/TO/to rotate/VB/rotate to/TO/to the/DT/the disk/NN/disk head/NN/head /,/, called/VBN/called the/DT/the typical/JJ/typical disks/NNS/disks can/MD/can transfer/VB/transfer several/JJ/several megabytes/NNS/megabytes of/IN/of data/NNS/data per/IN/per second/JJ/second /,/, and/CC/and they/PRP/they seek/VBP/seek times/NNS/times and/CC/and rotational/JJ/rotational latencies/NNS/latencies of/IN/of several/JJ/several milliseconds/NNS/milliseconds /./. because/IN/because the/DT/the disk/NN/disk head/NN/head flies/NNS/flies on/IN/on an/DT/an extremely/RB/extremely thin/JJ/thin cushion/NN/cushion of/IN/of air/NN/air /:/( measured/VBN/measured in/IN/in microns/NNS/microns /:/) /,/, there/EX/there is/VBZ/is a/DT/a danger/NN/danger that/WDT/that the/DT/the head/NN/head will/MD/will make/VB/make contact/NN/contact with/IN/with the/DT/the disk/NN/disk surface/NNP/surface. although/IN/although the/DT/the disk/NN/disk platters/NNS/platters are/VBP/are coated/VBN/coated with/IN/with a/DT/a thin/JJ/thin protective/JJ/protective laye1/NNP/laye1 ~/NNP/~ the/DT/the head/NN/head will/MD/will sometimes/RB/sometimes damage/VB/damage the/DT/the magnetic/JJ/magnetic surface/NNP/surface. this/DT/this accident/NN/accident is/VBZ/is called/VBN/called a/DT/a a/DT/a head/NN/head crash/NN/crash normally/RB/normally can/MD/can not/RB/not be/VB/be repaired/VBN/repaired ;/:/; the/DT/the entire/JJ/entire disk/NN/disk must/MD/must be/VB/be replaced/VBN/replaced /./. a/DT/a disk/NN/disk can/MD/can be/VB/be allowing/VBG/allowing different/JJ/different disks/NNS/disks to/TO/to be/VB/be mounted/VBN/mounted as/IN/as needed/VBN/needed /./. removable/JJ/removable magnetic/JJ/magnetic disks/NNS/disks generally/RB/generally consist/VBP/consist of/IN/of one/CD/one platter/NN/platter /,/, held/VBD/held in/IN/in a/DT/a plastic/JJ/plastic case/NN/case to/TO/to prevent/VB/prevent damage/NN/damage while/IN/while not/RB/not in/IN/in the/DT/the disk/NN/disk drive/NNP/drive. are/VBP/are inexpensive/JJ/inexpensive removable/JJ/removable magnetic/JJ/magnetic disks/NNS/disks that/WDT/that have/VBP/have a/DT/a soft/JJ/soft plastic/NN/plastic case/NN/case containing/VBG/containing a/DT/a flexible/JJ/flexible platter/NNP/platter. the/DT/the head/NN/head of/IN/of a/DT/a floppy-disk/JJ/floppy-disk drive/JJ/drive generally/RB/generally sits/VBZ/sits directly/RB/directly on/IN/on the/DT/the disk/NN/disk 12.1/CD/12.1 507/CD/507 disk/NN/disk transfer/NN/transfer rates/NNS/rates as/IN/as with/IN/with many/JJ/many aspects/NNS/aspects of/IN/of computingf/NN/computingf published/VBD/published performance/NN/performance numbers/NNS/numbers for/IN/for disks/NNS/disks are/VBP/are not/RB/not the/DT/the same/JJ/same as/IN/as real-world/JJ/real-world performance/NN/performance numbers/NNP/numbers. stated/VBD/stated transfer/NN/transfer rates/NNS/rates are/VBP/are always/RB/always lower/JJR/lower than/IN/than for/IN/for example/NNP/example. the/DT/the transfer/NN/transfer rate/NN/rate may/MD/may be/VB/be the/DT/the rate/NN/rate at/IN/at which/WDT/which bits/NNS/bits can/MD/can be/VB/be read/VBN/read from/IN/from the/DT/the magnetic/JJ/magnetic media/NNS/media by/IN/by the/DT/the disk/NN/disk head/NN/head /,/, but/CC/but that/IN/that is/VBZ/is different/JJ/different from/IN/from the/DT/the rate/NN/rate at/IN/at which/WDT/which blocks/NNS/blocks are/VBP/are delivered/VBN/delivered to/TO/to the/DT/the operating/NN/operating system/NN/system /./. surface/NN/surface /,/, so/RB/so the/DT/the drive/JJ/drive is/VBZ/is designed/VBN/designed to/TO/to rotate/VB/rotate more/JJR/more slowly/RB/slowly than/IN/than a/DT/a hard-disk/JJ/hard-disk drive/JJ/drive to/TO/to reduce/VB/reduce the/DT/the wear/NN/wear on/IN/on the/DT/the disk/NN/disk surface/NNP/surface. the/DT/the storage/NN/storage capacity/NN/capacity of/IN/of a/DT/a floppy/NN/floppy disk/NN/disk is/VBZ/is typically/RB/typically only/RB/only 1.44mb/CD/1.44mb or/CC/or so/NNP/so. removable/JJ/removable disks/NNS/disks are/VBP/are available/JJ/available that/IN/that work/NN/work much/RB/much like/IN/like normal/JJ/normal hard/JJ/hard disks/NNS/disks and/CC/and have/VBP/have capacities/NNS/capacities measured/VBN/measured in/IN/in gigabytes/NNS/gigabytes /./. a/DT/a disk/NN/disk drive/NN/drive is/VBZ/is attached/VBN/attached to/TO/to a/DT/a computer/NN/computer by/IN/by a/DT/a set/NN/set of/IN/of wires/NNS/wires called/VBN/called an/DT/an several/JJ/several kinds/NNS/kinds of/IN/of buses/NNS/buses are/VBP/are available/JJ/available /,/, including/VBG/including buses/NNP/buses. the/DT/the data/NNS/data transfers/NNS/transfers on/IN/on a/DT/a bus/NN/bus are/VBP/are carried/VBN/carried out/RP/out by/IN/by special/JJ/special electronic/JJ/electronic processors/NNS/processors called/VBN/called the/DT/the is/VBZ/is the/DT/the controller/NN/controller at/IN/at the/DT/the computer/NN/computer end/NN/end of/IN/of the/DT/the bus/NNP/bus. a/DT/a is/VBZ/is built/VBN/built into/IN/into each/DT/each disk/NN/disk drive/NNP/drive. to/TO/to perform/VB/perform a/DT/a disk/NN/disk i/0/-NONE-/i/0 operation/NN/operation /,/, the/DT/the computer/NN/computer places/NNS/places a/DT/a command/NN/command into/IN/into the/DT/the host/NN/host controller/NN/controller /,/, typically/RB/typically using/VBG/using memory-mapped/JJ/memory-mapped i/0/-NONE-/i/0 portsf/NN/portsf as/IN/as described/VBN/described in/IN/in section/NN/section 9.7.3/CD/9.7.3. the/DT/the host/NN/host controller/NN/controller then/RB/then sends/VBZ/sends the/DT/the command/NN/command via/IN/via messages/NNS/messages to/TO/to the/DT/the disk/NN/disk controller/NN/controller /,/, and/CC/and the/DT/the disk/NN/disk controller/NN/controller operates/VBZ/operates the/DT/the disk-drive/JJ/disk-drive hardware/NN/hardware to/TO/to carry/VB/carry out/RP/out the/DT/the command/NNP/command. disk/NN/disk controllers/NNS/controllers usually/RB/usually have/VBP/have a/DT/a built-in/JJ/built-in cache/NNP/cache. data/NNS/data transfer/VBP/transfer at/IN/at the/DT/the disk/NN/disk drive/VBP/drive happens/NNS/happens between/IN/between the/DT/the cache/NN/cache and/CC/and the/DT/the disk/NN/disk surface/NN/surface /,/, and/CC/and data/NNS/data transfer/VBP/transfer to/TO/to the/DT/the host/NN/host /,/, at/IN/at fast/JJS/fast electronic/JJ/electronic speeds/NNS/speeds /,/, occurs/NNS/occurs between/IN/between the/DT/the cache/NN/cache and/CC/and the/DT/the host/NN/host controller/NN/controller /./. 12.1.2/CD/12.1.2 magnetic/JJ/magnetic tapes/NNS/tapes was/VBD/was used/VBN/used as/IN/as an/DT/an early/JJ/early secondary-storage/NN/secondary-storage medium/NNP/medium. although/IN/although it/PRP/it is/VBZ/is relatively/RB/relatively permanent/JJ/permanent and/CC/and can/MD/can hold/VB/hold large/JJ/large quantities/NNS/quantities of/IN/of dataf/NN/dataf its/PRP$/its access/NN/access time/NN/time is/VBZ/is slow/JJ/slow compared/VBN/compared with/IN/with that/DT/that of/IN/of main/JJ/main memory/NN/memory and/CC/and magnetic/JJ/magnetic disk/NNP/disk. in/IN/in addition/NN/addition /,/, random/NN/random access/NN/access to/TO/to magnetic/JJ/magnetic tape/NN/tape is/VBZ/is about/IN/about a/DT/a thousand/NN/thousand times/VBZ/times slower/JJR/slower than/IN/than random/NN/random access/NN/access to/TO/to magnetic/JJ/magnetic disk/NN/disk /,/, so/RB/so tapes/VBZ/tapes are/VBP/are not/RB/not very/RB/very useful/JJ/useful for/IN/for secondary/JJ/secondary storage/NN/storage /./. tapes/NNS/tapes are/VBP/are used/VBN/used mainly/RB/mainly for/IN/for backup/NN/backup /,/, for/IN/for storage/NN/storage of/IN/of infrequently/RB/infrequently used/VBN/used information/NN/information /,/, and/CC/and as/IN/as a/DT/a medium/NN/medium for/IN/for transferring/NN/transferring information/NN/information from/IN/from one/CD/one system/NN/system to/TO/to another/DT/another /./. a/DT/a tape/NN/tape is/VBZ/is kept/VBN/kept in/IN/in a/DT/a spool/NN/spool and/CC/and is/VBZ/is wound/VBN/wound or/CC/or rewound/IN/rewound past/JJ/past a/DT/a read-write/JJ/read-write head/NN/head /./. moving/VBG/moving to/TO/to the/DT/the correct/NN/correct spot/NN/spot on/IN/on a/DT/a tape/NN/tape can/MD/can take/VB/take minutes/NNS/minutes /,/, but/CC/but once/RB/once positioned/VBN/positioned /,/, tape/NN/tape drives/NNS/drives can/MD/can write/VB/write data/NNS/data at/IN/at speeds/NNS/speeds comparable/JJ/comparable to/TO/to disk/VB/disk drives/NNP/drives. tape/NN/tape capacities/NNS/capacities vary/JJ/vary greatly/RB/greatly /,/, depending/VBG/depending on/IN/on the/DT/the particular/JJ/particular kind/NN/kind of/IN/of tape/NN/tape drive/NNP/drive. typically/RB/typically /,/, they/PRP/they store/VBP/store from/IN/from 20gb/CD/20gb to/TO/to 200gb/CD/200gb. some/DT/some have/VBP/have built-in/JJ/built-in compression/NN/compression that/WDT/that can/MD/can more/RBR/more than/IN/than double/JJ/double the/DT/the effective/JJ/effective storage/NNP/storage. tapes/NNS/tapes and/CC/and their/PRP$/their drivers/NNS/drivers are/VBP/are usually/RB/usually categorized/VBN/categorized by/IN/by width/NN/width /,/, includil1.g/JJ/includil1.g 4/CD/4 /,/, 8f/CD/8f and/CC/and 19/CD/19 millimeters/NNS/millimeters and/CC/and 1/4/CD/1/4 and/CC/and 1/2/CD/1/2 inch/NNP/inch. some/DT/some are/VBP/are named/VBN/named according/VBG/according to/TO/to technology/NN/technology /,/, such/JJ/such as/IN/as lt0-2/-NONE-/lt0-2 and/CC/and sdlt/NNP/sdlt. tape/NN/tape storage/NN/storage is/VBZ/is further/RBR/further described/VBN/described in/IN/in section/NN/section 12.9/CD/12.9 /./. 508/CD/508 chapter/NN/chapter 12/CD/12 12.2/CD/12.2 fire/NN/fire wire/NN/wire refers/NNS/refers to/TO/to an/DT/an interface/NN/interface designed/VBN/designed for/IN/for connecting/NN/connecting peripheral/JJ/peripheral devices/NNS/devices such/JJ/such as/IN/as hard/JJ/hard drives/NNS/drives /,/, dvd/VBD/dvd drives/NNS/drives /,/, and/CC/and digital/JJ/digital video/NN/video cameras/NNS/cameras to/TO/to a/DT/a computer/NN/computer system/NNP/system. fire/NN/fire wire/NN/wire was/VBD/was first/JJ/first developed/VBN/developed by/IN/by apple/NN/apple computer/NN/computer and/CC/and became/VBD/became the/DT/the ieee/NN/ieee 1394/CD/1394 standard/JJ/standard in/IN/in 1995/CD/1995. the/DT/the originalfirewire/NN/originalfirewire standard/NN/standard provided/VBD/provided bandwidth/NN/bandwidth up/IN/up to/TO/to 400/CD/400 megabits/NNS/megabits per/IN/per second/NNP/second. recently/RB/recently /,/, a/DT/a new/JJ/new standardfirewire/NN/standardfirewire 2-has/CD/2-has emerged/VBD/emerged and/CC/and is/VBZ/is identified/VBN/identified by/IN/by the/DT/the ieee/NN/ieee 1394b/CD/1394b standard/JJ/standard /./. firewire/NN/firewire 2/CD/2 provides/NNS/provides double/JJ/double the/DT/the data/NNS/data rate/NN/rate of/IN/of the/DT/the original/JJ/original firewire-800/NN/firewire-800 megabits/NNS/megabits per/IN/per second/JJ/second /./. modern/JJ/modern disk/NN/disk drives/NNS/drives are/VBP/are addressed/VBN/addressed as/IN/as large/JJ/large one-dimensional/JJ/one-dimensional arrays/NNS/arrays of/IN/of where/WRB/where the/DT/the logical/JJ/logical block/NN/block is/VBZ/is the/DT/the smallest/JJS/smallest unit/NN/unit of/IN/of transfer/NNP/transfer. the/DT/the size/NN/size of/IN/of a/DT/a logical/JJ/logical block/NN/block is/VBZ/is usually/RB/usually 512/CD/512 bytes/NNS/bytes /,/, although/IN/although some/DT/some disks/NNS/disks can/MD/can be/VB/be to/TO/to have/VB/have a/DT/a different/JJ/different logical/JJ/logical block/NN/block size/NN/size /,/, such/JJ/such as/IN/as 1,024/CD/1,024 bytes/NNP/bytes. this/DT/this option/NN/option is/VBZ/is described/VBN/described in/IN/in section/NN/section 12.5.1/CD/12.5.1. the/DT/the one-dimensional/JJ/one-dimensional array/NN/array of/IN/of logical/JJ/logical blocks/NNS/blocks is/VBZ/is mapped/VBN/mapped onto/IN/onto the/DT/the sectors/NNS/sectors of/IN/of the/DT/the disk/NN/disk sequentially/NNP/sequentially. sector/NN/sector 0/-NONE-/0 is/VBZ/is the/DT/the first/JJ/first sector/NN/sector of/IN/of the/DT/the first/JJ/first track/NN/track on/IN/on the/DT/the outermost/NN/outermost cylinder/NNP/cylinder. the/DT/the mapping/NN/mapping proceeds/VBZ/proceeds in/IN/in order/NN/order through/IN/through that/DT/that track/NN/track /,/, then/RB/then through/IN/through the/DT/the rest/NN/rest of/IN/of the/DT/the tracks/NNS/tracks in/IN/in that/DT/that cylinder/NN/cylinder /,/, and/CC/and then/RB/then through/IN/through the/DT/the rest/NN/rest of/IN/of the/DT/the cylinders/NNS/cylinders from/IN/from outermost/JJS/outermost to/TO/to innermost/VB/innermost /./. by/IN/by using/VBG/using this/DT/this mapping/NN/mapping /,/, we/PRP/we can/MD/can -at/VB/-at least/JJS/least in/IN/in theory-convert/NN/theory-convert a/DT/a logical/JJ/logical block/NN/block number/NN/number into/IN/into an/DT/an old-style/JJ/old-style disk/NN/disk address/NN/address that/WDT/that consists/VBZ/consists of/IN/of a/DT/a cylinder/NN/cylinder number/NN/number /,/, a/DT/a track/NN/track number/NN/number within/IN/within that/DT/that cylinder/NN/cylinder /,/, and/CC/and a/DT/a sector/NN/sector number/NN/number within/IN/within that/DT/that track/NNP/track. in/IN/in practice/NN/practice /,/, it/PRP/it is/VBZ/is difficult/JJ/difficult to/TO/to perform/NN/perform this/DT/this translation/NN/translation /,/, for/IN/for two/CD/two reasons/NNP/reasons. first/JJ/first /,/, most/JJS/most disks/NNS/disks have/VBP/have some/DT/some defective/JJ/defective sectors/NNS/sectors /,/, but/CC/but the/DT/the mapping/NN/mapping hides/VBZ/hides this/DT/this by/IN/by substituting/NN/substituting spare/NN/spare sectors/NNS/sectors from/IN/from elsewhere/RB/elsewhere on/IN/on the/DT/the disk/NNP/disk. second/JJ/second /,/, the/DT/the number/NN/number of/IN/of sectors/NNS/sectors per/IN/per track/NN/track is/VBZ/is not/RB/not a/DT/a constant/JJ/constant on/IN/on smne/NN/smne drives/NNS/drives /./. let/NN/let 's/POS/'s look/NN/look more/JJR/more closely/RB/closely at/IN/at the/DT/the second/JJ/second reason/NNP/reason. on/IN/on media/NNS/media that/IN/that use/NN/use the/DT/the density/NN/density of/IN/of bits/NNS/bits per/IN/per track/NN/track is/VBZ/is uniform/NNP/uniform. the/DT/the farther/NN/farther a/DT/a track/NN/track is/VBZ/is from/IN/from the/DT/the center/NN/center of/IN/of the/DT/the disk/NN/disk /,/, the/DT/the greater/JJR/greater its/PRP$/its length/NN/length /,/, so/RB/so the/DT/the more/RBR/more sectors/NNS/sectors it/PRP/it can/MD/can hold/NNP/hold. as/IN/as we/PRP/we move/VBP/move from/IN/from outer/NN/outer zones/NNS/zones to/TO/to inner/VB/inner zones/NNS/zones /,/, the/DT/the number/NN/number of/IN/of sectors/NNS/sectors per/IN/per track/NN/track decreases/NNP/decreases. tracks/VBZ/tracks in/IN/in the/DT/the outermost/NN/outermost zone/NN/zone typically/RB/typically hold/JJ/hold 40/CD/40 percent/NN/percent more/JJR/more sectors/NNS/sectors than/IN/than do/VB/do tracks/NNS/tracks in/IN/in the/DT/the innermost/NN/innermost zone/NNP/zone. the/DT/the drive/JJ/drive increases/NNS/increases its/PRP$/its rotation/NN/rotation speed/NN/speed as/IN/as the/DT/the head/NN/head moves/VBZ/moves from/IN/from the/DT/the outer/NN/outer to/TO/to the/DT/the inner/NN/inner tracks/VBZ/tracks to/TO/to keep/VB/keep the/DT/the same/JJ/same rate/NN/rate of/IN/of data/NNS/data moving/VBG/moving under/IN/under the/DT/the head/NNP/head. this/DT/this method/NN/method is/VBZ/is used/VBN/used in/IN/in cd-rom/NNP/cd-rom and/CC/and dvd-rom/NNP/dvd-rom drives/NNP/drives. alternatively/RB/alternatively /,/, the/DT/the disk/NN/disk rotation/NN/rotation speed/NN/speed can/MD/can stay/VB/stay constant/JJ/constant ;/:/; in/IN/in this/DT/this case/NN/case /,/, the/DT/the density/NN/density of/IN/of bits/NNS/bits decreases/NNS/decreases from/IN/from inner/NN/inner tracks/NNS/tracks to/TO/to outer/VB/outer tracks/NNS/tracks to/TO/to keep/VB/keep the/DT/the data/NNS/data rate/NN/rate constant/NNP/constant. this/DT/this method/NN/method is/VBZ/is used/VBN/used in/IN/in hard/JJ/hard disks/NNS/disks and/CC/and is/VBZ/is known/VBN/known as/IN/as the/DT/the number/NN/number of/IN/of sectors/NNS/sectors per/IN/per track/NN/track has/VBZ/has been/VBN/been increasing/VBG/increasing as/IN/as disk/NN/disk technology/NN/technology improves/VBZ/improves /,/, and/CC/and the/DT/the outer/NN/outer zone/NN/zone of/IN/of a/DT/a disk/NN/disk usually/RB/usually has/VBZ/has several/JJ/several hundred/CD/hundred sectors/NNS/sectors per/IN/per track/NNP/track. similarly/RB/similarly /,/, the/DT/the number/NN/number of/IN/of cylinders/NNS/cylinders per/IN/per disk/NN/disk has/VBZ/has been/VBN/been increasing/VBG/increasing ;/:/; large/JJ/large disks/NNS/disks have/VBP/have tens/NNS/tens of/IN/of thousands/NNS/thousands of/IN/of cylinders/NNS/cylinders /./. 12.3/CD/12.3 12.3/CD/12.3 509/CD/509 computers/NNS/computers access/NN/access disk/NN/disk storage/NN/storage in/IN/in two/CD/two ways/NNP/ways. one/CD/one way/NN/way is/VBZ/is via/IN/via i/o/JJ/i/o ports/NNS/ports /:/( or/CC/or this/DT/this is/VBZ/is common/JJ/common on/IN/on small/JJ/small systems/NNP/systems. the/DT/the other/JJ/other way/NN/way is/VBZ/is via/IN/via a/DT/a remote/NN/remote host/NN/host in/IN/in a/DT/a distributed/VBN/distributed file/NN/file system/NN/system ;/:/; this/DT/this is/VBZ/is referred/VBN/referred to/TO/to as/RB/as 12.3.1/CD/12.3.1 host-attached/JJ/host-attached storage/NN/storage host-attached/JJ/host-attached storage/NN/storage is/VBZ/is storage/NN/storage accessed/VBN/accessed through/IN/through local/JJ/local i/0/-NONE-/i/0 ports/NNP/ports. these/DT/these ports/NNS/ports use/VBP/use several/JJ/several technologies/NNP/technologies. the/DT/the typical/JJ/typical desktop/NN/desktop pc/NN/pc uses/NNS/uses an/DT/an i/0/-NONE-/i/0 bus/VBZ/bus architecture/NN/architecture called/VBN/called ide/NN/ide or/CC/or ata/NNP/ata. this/DT/this architecture/NN/architecture supports/VBZ/supports a/DT/a maximum/NN/maximum of/IN/of two/CD/two drives/NNS/drives per/IN/per i/0/-NONE-/i/0 bus/NNP/bus. a/DT/a newer/JJR/newer /,/, similar/JJ/similar protocol/NN/protocol that/WDT/that has/VBZ/has simplified/VBN/simplified cabling/VBG/cabling is/VBZ/is sata/NNP/sata. high-end/NN/high-end workstations/NNS/workstations and/CC/and servers/NNS/servers generally/RB/generally use/VBP/use more/JJR/more sophisticated/JJ/sophisticated i/0/-NONE-/i/0 architectures/VBZ/architectures /,/, such/JJ/such as/IN/as scsi/NN/scsi and/CC/and fiber/NN/fiber charmel/NN/charmel /:/( fc/NN/fc /:/) /./. scsi/NN/scsi is/VBZ/is a/DT/a bus/NN/bus architecture/NNP/architecture. its/PRP$/its physical/JJ/physical medium/NN/medium is/VBZ/is usually/RB/usually a/DT/a ribbon/NN/ribbon cable/NN/cable with/IN/with a/DT/a large/JJ/large number/NN/number of/IN/of conductors/NNS/conductors /:/( typically/RB/typically 50/CD/50 or/CC/or 68/CD/68 /CD/) /./. the/DT/the scsi/NN/scsi protocol/NN/protocol supports/NNS/supports a/DT/a maximum/NN/maximum of/IN/of 16/CD/16 devices/NNS/devices per/IN/per bus/NNP/bus. generally/RB/generally /,/, the/DT/the devices/NNS/devices include/VBP/include one/CD/one controller/NN/controller card/NN/card in/IN/in the/DT/the host/NN/host /:/( the/DT/the and/CC/and up/RP/up to/TO/to 15/CD/15 storage/NN/storage devices/NNS/devices /:/( the/DT/the to.rgr/JJ/to.rgr /:/: /:/: /:/: ts/NNS/ts /VBP/) /./. a/DT/a scsi/NN/scsi disk/NN/disk is/VBZ/is a/DT/a common/JJ/common scsi/NN/scsi target/NN/target /,/, but/CC/but the/DT/the protocol/NN/protocol provides/VBZ/provides the/DT/the ability/NN/ability to/TO/to address/VB/address up/RP/up to/TO/to 8/CD/8 in/IN/in each/DT/each scsi/NN/scsi target/NNP/target. a/DT/a typical/JJ/typical use/NN/use of/IN/of logical/JJ/logical unit/NN/unit addressing/VBG/addressing is/VBZ/is to/TO/to commands/NNS/commands to/TO/to components/NNS/components of/IN/of a/DT/a raid/JJ/raid array/NN/array or/CC/or components/NNS/components of/IN/of a/DT/a removable/JJ/removable media/NNS/media library/JJ/library /NN/( such/JJ/such as/IN/as a/DT/a cd/NN/cd jukebox/NN/jukebox sendil/NN/sendil g/NN/g commands/NNS/commands to/TO/to the/DT/the media-changer/JJ/media-changer mechanism/NN/mechanism or/CC/or to/TO/to one/CD/one of/IN/of the/DT/the drives/NNS/drives /:/) /./. fc/NN/fc is/VBZ/is a/DT/a high-speed/JJ/high-speed serial/NN/serial architecture/NN/architecture that/WDT/that can/MD/can operate/VB/operate over/IN/over optical/JJ/optical fiber/NN/fiber or/CC/or over/IN/over a/DT/a four-conductor/NN/four-conductor copper/NN/copper cable/NNP/cable. it/PRP/it has/VBZ/has two/CD/two variants/NNP/variants. one/CD/one is/VBZ/is a/DT/a large/JJ/large switched/VBN/switched fabric/JJ/fabric having/NN/having a/DT/a 24-bit/JJ/24-bit address/NN/address space/NNP/space. this/DT/this variant/NN/variant is/VBZ/is expected/VBN/expected to/TO/to dominate/VB/dominate in/IN/in the/DT/the future/NN/future and/CC/and is/VBZ/is the/DT/the basis/NN/basis of/IN/of /NNP/( sjld/NN/sjld '/POS/' /,/, ;/:/; s/NNS/s /VBP/) /,/, discussed/VBN/discussed in/IN/in section/NN/section 12.3.3/CD/12.3.3. because/IN/because of/IN/of the/DT/the large/JJ/large space/NN/space and/CC/and the/DT/the switched/JJ/switched nature/NN/nature of/IN/of the/DT/the communication/NN/communication /,/, multiple/NN/multiple hosts/NNS/hosts and/CC/and storage/NN/storage devices/NNS/devices can/MD/can attach/VB/attach to/TO/to the/DT/the fabric/JJ/fabric /,/, allowing/VBG/allowing great/JJ/great flexibility/NN/flexibility in/IN/in i/0/-NONE-/i/0 communication/NNP/communication. the/DT/the other/JJ/other fc/NN/fc variant/NN/variant is/VBZ/is an/DT/an that/IN/that can/MD/can address/VB/address 126/CD/126 devices/NNS/devices /:/( drives/NNS/drives and/CC/and controllers/NNS/controllers /:/) /./. a/DT/a wide/JJ/wide variety/NN/variety of/IN/of storage/NN/storage devices/NNS/devices are/VBP/are suitable/JJ/suitable for/IN/for use/NN/use as/IN/as host-attached/JJ/host-attached storage/NNP/storage. among/IN/among these/DT/these are/VBP/are hard/JJ/hard disk/NN/disk drives/NNS/drives /,/, raid/VBD/raid arrays/NNS/arrays /,/, and/CC/and cd/VBD/cd /,/, dvd/NN/dvd /,/, and/CC/and tape/NN/tape drives/NNP/drives. the/DT/the i/0/NNP/i/0 commands/VBZ/commands that/IN/that initiate/NN/initiate data/NNS/data transfers/NNS/transfers to/TO/to a/DT/a host-attached/JJ/host-attached storage/NN/storage device/NN/device are/VBP/are reads/NNS/reads and/CC/and writes/NNS/writes of/IN/of logical/JJ/logical data/NNS/data blocks/NNS/blocks directed/VBD/directed to/TO/to specifically/RB/specifically identified/VBD/identified storage/NN/storage units/NNS/units /:/( such/JJ/such as/IN/as bus/NN/bus id/VBD/id /,/, scsi/NN/scsi id/VBD/id /,/, and/CC/and target/VB/target logical/JJ/logical unit/NN/unit /:/) /./. 12.3.2/CD/12.3.2 network-attached/JJ/network-attached storage/NN/storage a/DT/a network-attached/JJ/network-attached storage/NN/storage /:/( nas/NNS/nas /VBP/) device/NN/device is/VBZ/is a/DT/a special-purpose/JJ/special-purpose storage/NN/storage system/NN/system that/WDT/that is/VBZ/is accessed/VBN/accessed remotely/RB/remotely over/IN/over a/DT/a data/NN/data network/NN/network /:/( figure/NN/figure 12.2/CD/12.2 /CD/) /./. clients/NNS/clients access/NN/access network-attached/JJ/network-attached storage/NN/storage via/IN/via a/DT/a remote-procedure-call/JJ/remote-procedure-call interface/NN/interface such/JJ/such as/IN/as nfs/NNS/nfs for/IN/for unix/NN/unix systems/NNS/systems or/CC/or cifs/NNS/cifs for/IN/for windows/NNS/windows machines/NNP/machines. the/DT/the remote/NN/remote procedure/NN/procedure calls/VBZ/calls /:/( rpcs/NNS/rpcs /VBP/) are/VBP/are carried/VBN/carried via/IN/via tcp/NN/tcp or/CC/or udp/VB/udp over/IN/over an/DT/an ip/NN/ip network-usually/RB/network-usually the/DT/the same/JJ/same local-area/NN/local-area network/NN/network /:/( lan/NN/lan /:/) that/IN/that carries/NNS/carries all/DT/all data/NNS/data traffic/VBP/traffic to/TO/to the/DT/the clients/NNP/clients. the/DT/the networkattached/JJ/networkattached storage/NN/storage unit/NN/unit is/VBZ/is usually/RB/usually implemented/VBN/implemented as/IN/as a/DT/a raid/NN/raid array/NN/array with/IN/with software/NN/software that/IN/that implements/NNS/implements the/DT/the rpc/NN/rpc interface/NNP/interface. it/PRP/it is/VBZ/is easiest/JJS/easiest to/TO/to thil/VB/thil k/NN/k of/IN/of nas/NNS/nas as/IN/as simply/RB/simply another/DT/another storage-access/NN/storage-access protocol/NNP/protocol. for/IN/for example/NN/example /,/, rather/RB/rather than/IN/than using/VBG/using a/DT/a scsi/NN/scsi device/NN/device driver/NN/driver and/CC/and scsi/NN/scsi protocols/NNS/protocols to/TO/to access/NN/access storage/NN/storage /,/, a/DT/a system/NN/system using/VBG/using nas/NNS/nas would/MD/would use/VB/use rpc/NN/rpc over/IN/over tcp/NN/tcp /ip/NN//ip /./. 510/CD/510 chapter/NN/chapter 12/CD/12 12.4/CD/12.4 lan/wan/JJ/lan/wan figure/NN/figure 12.2/CD/12.2 network-attached/JJ/network-attached storage/NN/storage /./. network-attached/JJ/network-attached storage/NN/storage provides/VBZ/provides a/DT/a convenient/JJ/convenient way/NN/way for/IN/for all/DT/all the/DT/the computers/NNS/computers on/IN/on a/DT/a lan/NN/lan to/TO/to share/VB/share a/DT/a pool/NN/pool of/IN/of storage/NN/storage with/IN/with the/DT/the same/JJ/same ease/NN/ease of/IN/of naming/VBG/naming and/CC/and access/NN/access enjoyed/VBD/enjoyed with/IN/with local/JJ/local host-attached/JJ/host-attached storage/NNP/storage. however/RB/however /,/, it/PRP/it tends/VBZ/tends to/TO/to be/VB/be less/JJR/less efficient/JJ/efficient and/CC/and have/VBP/have lower/JJR/lower performance/NN/performance than/IN/than some/DT/some direct-attached/JJ/direct-attached storage/NN/storage options/NNS/options /./. is/VBZ/is the/DT/the latest/JJS/latest network-attached/JJ/network-attached storage/NN/storage protocol/NNP/protocol. in/IN/in essence/NN/essence /,/, it/PRP/it uses/VBZ/uses the/DT/the ip/NN/ip network/NN/network protocol/NN/protocol to/TO/to carry/VB/carry the/DT/the scsi/NN/scsi protocol/NNP/protocol. thus/RB/thus /,/, networks-rather/JJ/networks-rather than/IN/than scsi/NN/scsi cables-can/JJ/cables-can be/NN/be used/VBN/used as/IN/as the/DT/the interconnects/NNS/interconnects between/IN/between hosts/NNS/hosts and/CC/and their/PRP$/their storage/NN/storage /./. as/IN/as a/DT/a result/NN/result /,/, hosts/VBZ/hosts can/MD/can treat/VB/treat their/PRP$/their storage/NN/storage as/IN/as if/IN/if it/PRP/it were/VBD/were directly/RB/directly attached/VBN/attached /,/, even/RB/even if/IN/if the/DT/the storage/NN/storage is/VBZ/is distant/JJ/distant from/IN/from the/DT/the host/NN/host /./. 12.3.3/CD/12.3.3 storage-area/NNP/storage-area network/NN/network one/CD/one drawback/NN/drawback of/IN/of network-attached/JJ/network-attached storage/NN/storage systems/NNS/systems is/VBZ/is that/IN/that the/DT/the storage/NN/storage i/o/-NONE-/i/o operations/NNS/operations consume/VBP/consume bandwidth/NN/bandwidth on/IN/on the/DT/the data/NNS/data network/NN/network /,/, thereby/RB/thereby increasing/VBG/increasing the/DT/the latency/NN/latency of/IN/of network/NN/network communication/NNP/communication. this/DT/this problem/NN/problem can/MD/can be/VB/be particularly/RB/particularly acute/JJ/acute in/IN/in large/JJ/large client-server/NN/client-server installations-the/NN/installations-the communication/NN/communication between/IN/between servers/NNS/servers and/CC/and clients/NNS/clients competes/NNS/competes for/IN/for bandwidth/NN/bandwidth with/IN/with the/DT/the communication/NN/communication among/IN/among servers/NNS/servers and/CC/and storage/NN/storage devices/NNS/devices /./. a/DT/a storage-area/NN/storage-area network/NN/network /:/( san/NN/san /:/) is/VBZ/is a/DT/a private/JJ/private network/NN/network /:/( using/VBG/using storage/NN/storage protocols/NNS/protocols rather/RB/rather than/IN/than networking/VBG/networking protocols/NNS/protocols /:/) connecting/VBG/connecting servers/NNS/servers and/CC/and storage/NN/storage units/NNS/units /,/, as/IN/as shown/NN/shown in/IN/in figure/NN/figure 12.3/CD/12.3. the/DT/the power/NN/power of/IN/of a/DT/a san/NN/san lies/NNS/lies in/IN/in its/PRP$/its flexibility/NNP/flexibility. multiple/NN/multiple hosts/NNS/hosts and/CC/and multiple/VB/multiple storage/NN/storage arrays/NNS/arrays can/MD/can attach/VB/attach to/TO/to the/DT/the same/JJ/same san/NN/san /,/, and/CC/and storage/NN/storage can/MD/can be/VB/be dynamically/RB/dynamically allocated/VBN/allocated to/TO/to hosts/NNP/hosts. a/DT/a san/NN/san switch/NN/switch allows/VBZ/allows or/CC/or prohibits/VBZ/prohibits access/NN/access between/IN/between the/DT/the hosts/NNS/hosts and/CC/and the/DT/the storage/NNP/storage. as/IN/as one/CD/one example/NN/example /,/, if/IN/if a/DT/a host/NN/host is/VBZ/is running/VBG/running low/JJ/low on/IN/on disk/NN/disk space/NN/space /,/, the/DT/the san/NN/san can/MD/can be/VB/be configured/VBN/configured to/TO/to allocate/VB/allocate more/JJR/more storage/NN/storage to/TO/to that/DT/that host/NN/host /./. sans/NNS/sans make/VBP/make it/PRP/it possible/JJ/possible for/IN/for clusters/NNS/clusters of/IN/of servers/NNS/servers to/TO/to share/VB/share the/DT/the same/JJ/same storage/NN/storage and/CC/and for/IN/for storage/NN/storage arrays/NNS/arrays to/TO/to include/VB/include multiple/NN/multiple direct/NN/direct host/NN/host com1.ections/NNP/com1.ections. sans/NNS/sans typically/RB/typically have/VBP/have more/JJR/more ports/NNS/ports /,/, and/CC/and less/JJR/less expensive/JJ/expensive ports/NNS/ports /,/, than/IN/than storage/NN/storage arrays/NNS/arrays /./. fc/NN/fc is/VBZ/is the/DT/the most/RBS/most common/JJ/common san/NN/san interconnect/NN/interconnect /,/, although/IN/although the/DT/the simplicity/NN/simplicity of/IN/of iscsi/NN/iscsi is/VBZ/is increasing/VBG/increasing its/PRP$/its use/NNP/use. an/DT/an emerging/VBG/emerging alternative/NN/alternative is/VBZ/is a/DT/a special-purpose/JJ/special-purpose bus/NN/bus architecture/NN/architecture named/VBD/named infiniband/NN/infiniband /,/, which/WDT/which provides/VBZ/provides hardware/NN/hardware and/CC/and software/NN/software support/NN/support for/IN/for highspeed/NN/highspeed interconnection/NN/interconnection networks/NNS/networks for/IN/for servers/NNS/servers and/CC/and storage/NN/storage units/NNS/units /./. one/CD/one of/IN/of the/DT/the responsibilities/NNS/responsibilities of/IN/of the/DT/the operating/NN/operating system/NN/system is/VBZ/is to/TO/to use/VB/use the/DT/the hardware/NN/hardware efficiently/NNP/efficiently. for/IN/for the/DT/the disk/NN/disk drives/NNS/drives /,/, meeting/NN/meeting this/DT/this responsibility/NN/responsibility entails/VBZ/entails having/VBG/having 12.4/CD/12.4 511/CD/511 figure/NN/figure 12.3/CD/12.3 storage-area/NN/storage-area network/NN/network /./. fast/NN/fast access/NN/access time/NN/time and/CC/and large/JJ/large disk/NN/disk bandwidth/NNP/bandwidth. the/DT/the access/NN/access time/NN/time has/VBZ/has two/CD/two major/JJ/major components/NNS/components /:/( also/RB/also see/VBP/see section/NN/section 12.1.1/CD/12.1.1 /CD/) /./. the/DT/the is/VBZ/is the/DT/the time/NN/time for/IN/for the/DT/the disk/NN/disk arm/NN/arm to/TO/to move/VB/move the/DT/the heads/NNS/heads to/TO/to the/DT/the cylinder/NN/cylinder containing/VBG/containing the/DT/the desired/JJ/desired sector/NNP/sector. the/DT/the is/VBZ/is the/DT/the additional/JJ/additional time/NN/time for/IN/for the/DT/the disk/NN/disk to/TO/to rotate/VB/rotate the/DT/the desired/VBN/desired sector/NN/sector to/TO/to the/DT/the disk/NN/disk head/NNP/head. the/DT/the disk/NN/disk is/VBZ/is the/DT/the total/JJ/total number/NN/number of/IN/of bytes/NNS/bytes transferred/VBN/transferred /,/, divided/VBN/divided by/IN/by the/DT/the total/JJ/total time/NN/time between/IN/between the/DT/the first/JJ/first request/NN/request for/IN/for service/NN/service and/CC/and the/DT/the completion/NN/completion of/IN/of the/DT/the last/JJ/last transfer/NNP/transfer. we/PRP/we can/MD/can improve/VB/improve both/DT/both the/DT/the access/NN/access time/NN/time and/CC/and the/DT/the bandwidth/NN/bandwidth by/IN/by managing/VBG/managing the/DT/the order/NN/order in/IN/in which/WDT/which disk/NN/disk i/o/-NONE-/i/o requests/VBZ/requests are/VBP/are serviced/VBN/serviced /./. whenever/NN/whenever a/DT/a process/NN/process needs/VBZ/needs i/0/-NONE-/i/0 to/TO/to or/CC/or from/IN/from the/DT/the disk/NN/disk /,/, it/PRP/it issues/VBZ/issues a/DT/a system/NN/system call/NN/call to/TO/to the/DT/the operating/NN/operating system/NNP/system. the/DT/the request/NN/request specifies/NNS/specifies several/JJ/several pieces/NNS/pieces of/IN/of information/NN/information /:/: whether/IN/whether this/DT/this operation/NN/operation is/VBZ/is input/VBN/input or/CC/or output/NN/output what/WP/what the/DT/the disk/NN/disk address/NN/address for/IN/for the/DT/the transfer/NN/transfer is/VBZ/is what/WP/what the/DT/the memory/NN/memory address/NN/address for/IN/for the/DT/the transfer/NN/transfer is/VBZ/is what/WP/what the/DT/the number/NN/number of/IN/of sectors/NNS/sectors to/TO/to be/VB/be transferred/VBN/transferred is/VBZ/is if/IN/if the/DT/the desired/VBN/desired disk/NN/disk drive/JJ/drive and/CC/and controller/NN/controller are/VBP/are available/JJ/available /,/, the/DT/the request/NN/request can/MD/can be/VB/be serviced/VBN/serviced immediately/-NONE-/immediately. if/IN/if the/DT/the drive/JJ/drive or/CC/or controller/JJR/controller is/VBZ/is busy/JJ/busy /,/, any/DT/any new/JJ/new requests/NNS/requests for/IN/for service/NN/service will/MD/will be/VB/be placed/VBN/placed in/IN/in the/DT/the queue/NN/queue of/IN/of pending/VBG/pending requests/NNS/requests for/IN/for that/DT/that drive/JJ/drive /./. for/IN/for a/DT/a multiprogramming/NN/multiprogramming system/NN/system with/IN/with many/JJ/many processes/NNS/processes /,/, the/DT/the disk/NN/disk queue/NN/queue may/MD/may often/RB/often have/VB/have several/JJ/several pending/VBG/pending requests/NNP/requests. thus/RB/thus /,/, when/WRB/when one/CD/one request/NN/request is/VBZ/is completed/VBN/completed /,/, the/DT/the operating/NN/operating system/NN/system chooses/NNS/chooses which/WDT/which pending/VBG/pending request/NN/request to/TO/to service/NN/service next/NNP/next. how/WRB/how does/VBZ/does the/DT/the operating/NN/operating system/NN/system make/NN/make this/DT/this choice/NN/choice any/DT/any one/CD/one of/IN/of several/JJ/several disk-scheduling/JJ/disk-scheduling algorithms/NNS/algorithms can/MD/can be/VB/be used/VBN/used /,/, and/CC/and we/PRP/we discuss/VBP/discuss them/PRP/them next/JJ/next /./. 12.4.1/CD/12.4.1 fcfs/NNS/fcfs scheduling/VBG/scheduling the/DT/the simplest/JJS/simplest form/NN/form of/IN/of disk/NN/disk scheduling/VBG/scheduling is/VBZ/is /,/, of/IN/of course/NN/course /,/, the/DT/the first-come/JJ/first-come /,/, first-served/JJ/first-served /NN/( fcfs/NNS/fcfs /:/) algorithm/NNP/algorithm. this/DT/this algorithm/NN/algorithm is/VBZ/is intrinsically/RB/intrinsically fair/JJ/fair /,/, but/CC/but it/PRP/it generally/RB/generally does/VBZ/does not/RB/not provide/VB/provide the/DT/the fastest/JJS/fastest service/NNP/service. consider/NN/consider /,/, for/IN/for example/NN/example /,/, a/DT/a disk/NN/disk queue/NN/queue with/IN/with requests/NNS/requests for/IN/for i/0/-NONE-/i/0 to/TO/to blocks/NNS/blocks on/IN/on cylinders/NNS/cylinders 98/CD/98 /,/, 183/CD/183 /,/, 37/CD/37 /,/, 122/CD/122 /,/, 14/CD/14 /,/, 124/CD/124 /,/, 65/CD/65 /,/, 67/CD/67 /,/, 512/CD/512 chapter/NN/chapter 12/CD/12 queue/NN/queue =/:/= 98/CD/98 /,/, 183,37,122/CD/183,37,122 /,/, 14,124,65,67/CD/14,124,65,67 head/NN/head starts/NNS/starts at/IN/at 53/CD/53 0/-NONE-/0 14/CD/14 37/CD/37 536567/CD/536567 98/CD/98 122124/CD/122124 figure/NN/figure 12.4/CD/12.4 fcfs/NNS/fcfs disk/NN/disk scheduling/VBG/scheduling /./. 183199/CD/183199 in/IN/in that/DT/that order/NNP/order. if/IN/if the/DT/the disk/NN/disk head/NN/head is/VBZ/is initially/RB/initially at/IN/at cylinder/NN/cylinder 53/CD/53 /,/, it/PRP/it will/MD/will first/RB/first move/VB/move from/IN/from 53/CD/53 to/TO/to 98/CD/98 /,/, then/RB/then to/TO/to 183/CD/183 /,/, 37/CD/37 /,/, 122/CD/122 /,/, 14/CD/14 /,/, 124/CD/124 /,/, 65/CD/65 /,/, and/CC/and finally/RB/finally to/TO/to 67/CD/67 /,/, for/IN/for a/DT/a total/JJ/total head/NN/head movement/NN/movement of/IN/of 640/CD/640 cylinders/NNP/cylinders. this/DT/this schedule/NN/schedule is/VBZ/is diagrammed/VBN/diagrammed in/IN/in figure/NN/figure 12.4/CD/12.4 /./. the/DT/the wild/NN/wild swing/NN/swing from/IN/from 122/CD/122 to/TO/to 14/CD/14 and/CC/and then/RB/then back/RB/back to/TO/to 124/CD/124 illustrates/NNS/illustrates the/DT/the problem/NN/problem with/IN/with this/DT/this schedule/NNP/schedule. if/IN/if the/DT/the requests/NNS/requests for/IN/for cylinders/NNS/cylinders 37/CD/37 and/CC/and 14/CD/14 could/MD/could be/VB/be serviced/VBN/serviced together/RP/together /,/, before/IN/before or/CC/or after/IN/after the/DT/the requests/NNS/requests for/IN/for 122/CD/122 and/CC/and 124/CD/124 /,/, the/DT/the total/JJ/total head/NN/head movement/NN/movement could/MD/could be/VB/be decreased/VBN/decreased substantially/RB/substantially /,/, and/CC/and performance/NN/performance could/MD/could be/VB/be thereby/RB/thereby improved/VBN/improved /./. 12.4.2/CD/12.4.2 sstf/NN/sstf scheduling/VBG/scheduling it/PRP/it seems/VBZ/seems reasonable/JJ/reasonable to/TO/to service/NN/service all/DT/all the/DT/the requests/NNS/requests close/VBP/close to/TO/to the/DT/the current/JJ/current head/NN/head position/NN/position before/IN/before moving/VBG/moving the/DT/the head/NN/head far/RB/far to/TO/to service/NN/service other/JJ/other this/DT/this assumption/NN/assumption is/VBZ/is the/DT/the basis/NN/basis for/IN/for the/DT/the the/DT/the sstf/NN/sstf algorithm/NN/algorithm selects/NNS/selects the/DT/the request/NN/request with/IN/with the/DT/the least/JJS/least seek/NN/seek time/NN/time from/IN/from the/DT/the current/JJ/current head/NN/head position/NN/position /./. since/IN/since seek/NN/seek time/NN/time increases/NNS/increases with/IN/with the/DT/the number/NN/number of/IN/of cylinders/NNS/cylinders traversed/VBN/traversed by/IN/by the/DT/the head/NN/head /,/, sstf/NN/sstf chooses/NNS/chooses the/DT/the pending/VBG/pending request/NN/request closest/NN/closest to/TO/to the/DT/the current/JJ/current head/NN/head position/NN/position /./. for/IN/for our/PRP$/our example/NN/example request/NN/request queue/NN/queue /,/, the/DT/the closest/JJS/closest request/NN/request to/TO/to the/DT/the initial/JJ/initial head/NN/head position/NN/position /:/( 53/CD/53 /CD/) is/VBZ/is at/IN/at cylinder/NN/cylinder 65/CD/65. once/RB/once we/PRP/we are/VBP/are at/IN/at cylinder/NN/cylinder 65/CD/65 /,/, the/DT/the next/JJ/next closest/NN/closest request/NN/request is/VBZ/is at/IN/at cylinder/NN/cylinder 67/CD/67. from/IN/from there/EX/there /,/, the/DT/the request/NN/request at/IN/at cylinder/NN/cylinder 37/CD/37 is/VBZ/is closer/JJR/closer than/IN/than the/DT/the one/CD/one at/IN/at 98/CD/98 /,/, so/RB/so 37/CD/37 is/VBZ/is served/VBN/served next/NNP/next. continuing/VBG/continuing /,/, we/PRP/we service/VBP/service the/DT/the request/NN/request at/IN/at cylinder/NN/cylinder 14/CD/14 /,/, then/RB/then 98/CD/98 /,/, 122/CD/122 /,/, 124/CD/124 /,/, and/CC/and finally/RB/finally 183/CD/183 /CD/( figure/NN/figure 12.5/CD/12.5 /CD/) /./. this/DT/this scheduling/NN/scheduling method/NN/method results/NNS/results in/IN/in a/DT/a total/NN/total head/NN/head movement/NN/movement of/IN/of only/RB/only 236/CD/236 cylinders-little/JJ/cylinders-little more/JJR/more than/IN/than one-third/NN/one-third of/IN/of the/DT/the distance/NN/distance needed/VBD/needed for/IN/for fcfs/NNS/fcfs scheduling/VBG/scheduling of/IN/of this/DT/this request/NN/request queue/NNP/queue. clearly/RB/clearly /,/, this/DT/this algorithm/NN/algorithm gives/VBZ/gives a/DT/a substantial/JJ/substantial improvement/NN/improvement in/IN/in performance/NN/performance /./. sstf/NN/sstf scheduling/VBG/scheduling is/VBZ/is essentially/RB/essentially a/DT/a form/NN/form of/IN/of shortest-job-first/JJ/shortest-job-first /NN/( sjf/NN/sjf /:/) scheduling/VBG/scheduling ;/:/; and/CC/and like/IN/like sjf/NN/sjf scheduling/VBG/scheduling /,/, it/PRP/it may/MD/may cause/VB/cause starvation/NN/starvation of/IN/of some/DT/some requests/NNP/requests. remember/NN/remember that/WDT/that requests/VBZ/requests may/MD/may arrive/VB/arrive at/IN/at any/DT/any time/NNP/time. suppose/NN/suppose that/WDT/that we/PRP/we have/VBP/have two/CD/two requests/NNS/requests in/IN/in the/DT/the queue/NN/queue /,/, for/IN/for cylinders/NNS/cylinders 14/CD/14 and/CC/and 186/CD/186 /,/, and/CC/and while/IN/while the/DT/the request/NN/request from/IN/from 14/CD/14 is/VBZ/is being/VBG/being serviced/VBN/serviced /,/, a/DT/a new/JJ/new request/NN/request near/IN/near 14/CD/14 arrives/NNP/arrives. this/DT/this new/JJ/new request/NN/request will/MD/will be/VB/be serviced/VBN/serviced next/JJ/next /,/, making/VBG/making the/DT/the request/NN/request at/IN/at 186/CD/186 wait/NNP/wait. while/IN/while this/DT/this request/NN/request is/VBZ/is being/VBG/being serviced/VBN/serviced /,/, another/DT/another request/NN/request close/NN/close to/TO/to 14/CD/14 could/MD/could arrive/NNP/arrive. in/IN/in theory/NN/theory /,/, a/DT/a continual/JJ/continual stream/NN/stream of/IN/of requests/NNS/requests near/IN/near one/CD/one another/DT/another could/MD/could cause/VB/cause the/DT/the request/NN/request for/IN/for cylinder/NN/cylinder 186/CD/186 to/TO/to wait/VB/wait indefinitely/RB/indefinitely /./. 12.4/CD/12.4 queue/NN/queue =/:/= 98/CD/98 /,/, 183/CD/183 /,/, 37/CD/37 /,/, 122/CD/122 /,/, 14/CD/14 /,/, 124/CD/124 /,/, 65/CD/65 /,/, 67/CD/67 head/NN/head starts/NNS/starts at/IN/at 53/CD/53 0/-NONE-/0 14/CD/14 37/CD/37 536567/CD/536567 98/CD/98 122124/CD/122124 figure/NN/figure 12.5/CD/12.5 sstf/NN/sstf disk/NN/disk scheduling/VBG/scheduling /./. 513/CD/513 183199/CD/183199 this/DT/this scenario/NN/scenario becomes/VBZ/becomes increasingly/RB/increasingly likely/JJ/likely as/IN/as the/DT/the pending-request/JJS/pending-request queue/NN/queue grows/VBZ/grows longer/JJR/longer /./. although/IN/although the/DT/the sstf/NN/sstf algorithm/NN/algorithm is/VBZ/is a/DT/a substantial/JJ/substantial improvement/NN/improvement over/IN/over the/DT/the fcfs/NNS/fcfs algorithm/VBP/algorithm /,/, it/PRP/it is/VBZ/is not/RB/not optimal/NNP/optimal. in/IN/in the/DT/the example/NN/example /,/, we/PRP/we can/MD/can do/VB/do better/RBR/better by/IN/by moving/NN/moving the/DT/the head/NN/head from/IN/from 53/CD/53 to/TO/to 37/CD/37 /,/, even/RB/even though/IN/though the/DT/the latter/NN/latter is/VBZ/is not/RB/not closest/JJS/closest /,/, and/CC/and then/RB/then to/TO/to 14/CD/14 /,/, before/IN/before turning/VBG/turning around/IN/around to/TO/to service/NN/service 65/CD/65 /,/, 67/CD/67 /,/, 98/CD/98 /,/, 122/CD/122 /,/, 124/CD/124 /,/, and/CC/and 183/CD/183. this/DT/this strategy/NN/strategy reduces/NNS/reduces the/DT/the total/JJ/total head/NN/head movement/NN/movement to/TO/to 208/CD/208 cylinders/NNS/cylinders /./. 12.4.3/CD/12.4.3 scan/NN/scan scheduling/VBG/scheduling in/IN/in the/DT/the toward/NN/toward the/DT/the end/NN/end /,/, servicing/NN/servicing requests/NNS/requests as/IN/as it/PRP/it reaches/VBZ/reaches each/DT/each cylinder/NN/cylinder /,/, until/IN/until it/PRP/it gets/VBZ/gets to/TO/to the/DT/the other/JJ/other end/NN/end of/IN/of the/DT/the disk/NNP/disk. at/IN/at the/DT/the other/JJ/other end/NN/end /,/, the/DT/the direction/NN/direction of/IN/of head/NN/head movement/NN/movement is/VBZ/is reversed/VBN/reversed /,/, and/CC/and servicing/NN/servicing continues/NNP/continues. the/DT/the head/NN/head continuously/RB/continuously scans/VBZ/scans back/RB/back and/CC/and forth/JJ/forth across/IN/across the/DT/the disk/NNP/disk. the/DT/the scan/NN/scan algorithm/NN/algorithm is/VBZ/is sometimes/RB/sometimes called/VBN/called the/DT/the since/NN/since the/DT/the disk/NN/disk arm/NN/arm behaves/NNS/behaves just/RB/just like/IN/like an/DT/an elevator/NN/elevator in/IN/in a/DT/a building/NN/building /,/, first/JJ/first servicing/NN/servicing all/DT/all the/DT/the requests/NNS/requests going/VBG/going up/RP/up and/CC/and then/RB/then reversing/VBG/reversing to/TO/to service/NN/service requests/NNS/requests the/DT/the other/JJ/other way/NN/way /./. let/NN/let 's/POS/'s return/NN/return to/TO/to our/PRP$/our example/NN/example to/TO/to illustrate/NNP/illustrate. before/IN/before applying/VBG/applying scan/NN/scan to/TO/to schedule/VB/schedule the/DT/the requests/NNS/requests on/IN/on cylinders/NNS/cylinders 98/CD/98 /,/, 183,37/CD/183,37 /,/, 122/CD/122 /,/, 14/CD/14 /,/, 124/CD/124 /,/, 65/CD/65 /,/, and/CC/and 67/CD/67 /,/, we/PRP/we need/VBP/need to/TO/to know/VB/know the/DT/the direction/NN/direction of/IN/of head/NN/head movement/NN/movement in/IN/in addition/NN/addition to/TO/to the/DT/the head/NN/head 's/POS/'s current/JJ/current position/NN/position /./. assuming/VBG/assuming that/IN/that the/DT/the disk/NN/disk arm/NN/arm is/VBZ/is moving/VBG/moving toward/IN/toward 0/-NONE-/0 and/CC/and that/IN/that the/DT/the initial/JJ/initial head/NN/head position/NN/position is/VBZ/is again/RB/again 53/CD/53 /,/, the/DT/the head/NN/head will/MD/will next/VB/next service/NN/service 37/CD/37 and/CC/and then/RB/then 14/CD/14. at/IN/at cylinder/NN/cylinder 0/-NONE-/0 /,/, the/DT/the arm/NN/arm will/MD/will reverse/VB/reverse and/CC/and will/MD/will move/VB/move toward/IN/toward the/DT/the other/JJ/other end/NN/end of/IN/of the/DT/the disk/NN/disk /,/, servicil/NN/servicil lg/NN/lg the/DT/the requests/NNS/requests at/IN/at 65/CD/65 /,/, 67/CD/67 /,/, 98/CD/98 /,/, 122/CD/122 /,/, 124/CD/124 /,/, and/CC/and 183/CD/183 /CD/( figure/NN/figure 12.6/CD/12.6 /CD/) /./. if/IN/if a/DT/a request/NN/request arrives/VBZ/arrives in/IN/in the/DT/the queue/NN/queue just/RB/just in/IN/in front/NN/front of/IN/of the/DT/the head/NN/head /,/, it/PRP/it will/MD/will be/VB/be serviced/VBN/serviced almost/RB/almost immediately/RB/immediately ;/:/; a/DT/a request/NN/request arriving/VBG/arriving just/RB/just behind/IN/behind the/DT/the head/NN/head will/MD/will have/VB/have to/TO/to wait/VB/wait until/IN/until the/DT/the arm/NN/arm moves/VBZ/moves to/TO/to the/DT/the end/NN/end of/IN/of the/DT/the disk/NN/disk /,/, reverses/NNS/reverses direction/NN/direction /,/, and/CC/and comes/VBZ/comes back/RP/back /./. assuming/VBG/assuming a/DT/a uniform/NN/uniform distribution/NN/distribution of/IN/of requests/NNS/requests for/IN/for cylinders/NNS/cylinders /,/, consider/NN/consider the/DT/the density/NN/density of/IN/of requests/NNS/requests when/WRB/when the/DT/the head/NN/head reaches/VBZ/reaches one/CD/one end/NN/end and/CC/and reverses/NNS/reverses direction/NNP/direction. at/IN/at this/DT/this point/NN/point /,/, relatively/RB/relatively few/JJ/few requests/NNS/requests are/VBP/are immediately/RB/immediately in/IN/in front/NN/front of/IN/of the/DT/the head/NN/head /,/, since/IN/since these/DT/these cylinders/NNS/cylinders have/VBP/have recently/RB/recently been/VBN/been serviced/NNP/serviced. the/DT/the heaviest/JJS/heaviest density/NN/density of/IN/of requests/NNS/requests 514/CD/514 chapter/NN/chapter 12/CD/12 queue/NN/queue =/:/= 98/CD/98 /,/, 183,37,122/CD/183,37,122 /,/, 14,124,65,67/CD/14,124,65,67 head/NN/head starts/NNS/starts at/IN/at 53/CD/53 0/-NONE-/0 14/CD/14 37/CD/37 536567/CD/536567 98/CD/98 122124/CD/122124 figure/NN/figure 12.6/CD/12.6 scan/NN/scan disk/NN/disk scheduling/VBG/scheduling /./. 183199/CD/183199 is/VBZ/is at/IN/at the/DT/the other/JJ/other end/NN/end of/IN/of the/DT/the disk/NN/disk these/DT/these requests/NNS/requests have/VBP/have also/RB/also waited/VBN/waited the/DT/the longest/JJS/longest so/RB/so why/WRB/why not/RB/not go/VB/go there/RB/there first/JJ/first that/IN/that is/VBZ/is the/DT/the idea/NN/idea of/IN/of the/DT/the next/JJ/next algorithm/NN/algorithm /./. 12.4.4/CD/12.4.4 c-scan/JJ/c-scan scheduling/NN/scheduling is/VBZ/is a/DT/a variant/JJ/variant of/IN/of scan/JJ/scan designed/VBN/designed to/TO/to provide/VB/provide a/DT/a more/RBR/more uniform/NN/uniform wait/NN/wait time/NNP/time. like/IN/like scan/NN/scan /,/, c-scan/JJ/c-scan moves/NNS/moves the/DT/the head/NN/head from/IN/from one/CD/one end/NN/end of/IN/of the/DT/the disk/NN/disk to/TO/to the/DT/the other/JJ/other /,/, servicing/NN/servicing requests/NNS/requests along/IN/along the/DT/the way/NNP/way. when/WRB/when the/DT/the head/NN/head reaches/VBZ/reaches the/DT/the other/JJ/other end/NN/end /,/, however/RB/however /,/, it/PRP/it immediately/RB/immediately returns/VBZ/returns to/TO/to the/DT/the beginning/NN/beginning of/IN/of the/DT/the disk/NN/disk without/IN/without servicing/NN/servicing any/DT/any requests/NNS/requests on/IN/on the/DT/the return/NN/return trip/NN/trip /:/( figure/NN/figure 12.7/CD/12.7 /CD/) /./. the/DT/the c-scan/JJ/c-scan scheduling/NN/scheduling algorithm/NN/algorithm essentially/RB/essentially treats/VBZ/treats the/DT/the cylinders/NNS/cylinders as/IN/as a/DT/a circular/JJ/circular list/NN/list that/WDT/that wraps/VBZ/wraps around/IN/around from/IN/from the/DT/the final/JJ/final cylinder/NN/cylinder to/TO/to the/DT/the first/JJ/first one/CD/one /./. queue/NN/queue =/:/= 98/CD/98 /,/, 183/CD/183 /,/, 37/CD/37 /,/, 122/CD/122 /,/, 14/CD/14 /,/, 124/CD/124 /,/, 65/CD/65 /,/, 67/CD/67 head/NN/head starts/NNS/starts at/IN/at 53/CD/53 0/-NONE-/0 1/CD/1 4/CD/4 37/CD/37 53/CD/53 65/CD/65 67/CD/67 98/CD/98 1/CD/1 22/CD/22 1/CD/1 24/CD/24 figure/NN/figure 12.7/CD/12.7 c-scan/JJ/c-scan disk/NN/disk scheduling/VBG/scheduling /./. 183199/CD/183199 12.4/CD/12.4 queue/NN/queue =/:/= 98/CD/98 /,/, 183/CD/183 /,/, 37/CD/37 /,/, 122/CD/122 /,/, 14/CD/14 /,/, 124/CD/124 /,/, 65/CD/65 /,/, 67/CD/67 head/NN/head starts/NNS/starts at/IN/at 53/CD/53 0/-NONE-/0 14/CD/14 37/CD/37 536567/CD/536567 98/CD/98 122124/CD/122124 figure/NN/figure 12.8/CD/12.8 c-look/NN/c-look disk/NN/disk scheduling/VBG/scheduling /./. 12.4.5/CD/12.4.5 look/NN/look scheduling/VBG/scheduling 515/CD/515 183199/CD/183199 as/IN/as we/PRP/we described/VBD/described themf/NN/themf both/DT/both scan/NN/scan and/CC/and c-scan/JJ/c-scan move/NN/move the/DT/the disk/NN/disk arm/NN/arm across/IN/across the/DT/the full/JJ/full width/NN/width of/IN/of the/DT/the disk/NN/disk in/IN/in practicef/NN/practicef neither/DT/neither algorithm/NN/algorithm is/VBZ/is often/RB/often implemented/VBN/implemented this/DT/this way/NNP/way. more/RBR/more commonlyf/JJ/commonlyf the/DT/the arm/NN/arm goes/VBZ/goes only/RB/only as/IN/as far/RB/far as/IN/as the/DT/the final/JJ/final request/NN/request in/IN/in each/DT/each direction/NNP/direction. then/RB/then /,/, it/PRP/it reverses/VBZ/reverses direction/NN/direction immediatelyf/NN/immediatelyf without/IN/without going/VBG/going all/DT/all the/DT/the way/NN/way to/TO/to the/DT/the end/NN/end of/IN/of the/DT/the disk/NN/disk versions/NNS/versions of/IN/of scan/JJ/scan and/CC/and c-scan/JJ/c-scan that/IN/that follow/JJ/follow this/DT/this pattern/NN/pattern are/VBP/are called/VBN/called and/CC/and because/IN/because they/PRP/they look/VBP/look for/IN/for a/DT/a request/NN/request before/IN/before continuing/VBG/continuing to/TO/to move/VB/move in/IN/in a/DT/a given/VBN/given direction/NN/direction /:/( figure/NN/figure 12.8/CD/12.8 /CD/) /./. 12.4.6/CD/12.4.6 selection/NN/selection of/IN/of a/DT/a disk-scheduling/JJ/disk-scheduling algorithm/NN/algorithm given/VBN/given so/RB/so many/JJ/many disk-scheduling/JJ/disk-scheduling algorithmsf/NN/algorithmsf how/WRB/how do/VBP/do we/PRP/we choose/VB/choose the/DT/the best/JJS/best one/CD/one sstf/NN/sstf is/VBZ/is common/JJ/common and/CC/and has/VBZ/has a/DT/a natural/JJ/natural appeal/NN/appeal because/IN/because it/PRP/it increases/VBZ/increases performance/NN/performance over/IN/over fcfs/NNP/fcfs. scan/NN/scan and/CC/and c-scan/JJ/c-scan perform/NN/perform better/RBR/better for/IN/for systems/NNS/systems that/WDT/that place/NN/place a/DT/a heavy/JJ/heavy load/NN/load on/IN/on the/DT/the diskf/NN/diskf because/IN/because they/PRP/they are/VBP/are less/RBR/less likely/JJ/likely to/TO/to cause/VB/cause a/DT/a starvation/NN/starvation problem/NNP/problem. for/IN/for any/DT/any particular/JJ/particular list/NN/list of/IN/of requestsf/NN/requestsf we/PRP/we can/MD/can define/VB/define an/DT/an optimal/JJ/optimal order/NN/order of/IN/of retrievat/NN/retrievat but/CC/but the/DT/the computation/NN/computation needed/VBD/needed to/TO/to find/VB/find an/DT/an optimal/JJ/optimal schedule/NN/schedule may/MD/may not/RB/not justify/VB/justify the/DT/the savings/NNS/savings over/IN/over sstf/NN/sstf or/CC/or scan/NNP/scan. with/IN/with any/DT/any scheduling/VBG/scheduling algoritlunf/NN/algoritlunf howeverf/NN/howeverf performance/NN/performance depends/NNS/depends heavily/RB/heavily on/IN/on the/DT/the number/NN/number and/CC/and types/NNS/types of/IN/of requests/NNP/requests. for/IN/for instance/NN/instance /,/, suppose/NN/suppose that/IN/that the/DT/the queue/NN/queue usually/RB/usually has/VBZ/has just/RB/just one/CD/one outstanding/JJ/outstanding request/NNP/request. thenf/NN/thenf all/DT/all scheduling/VBG/scheduling algorithms/NNS/algorithms behave/VBP/behave the/DT/the samef/NN/samef because/IN/because they/PRP/they have/VBP/have only/RB/only one/CD/one choice/NN/choice of/IN/of where/WRB/where to/TO/to move/VB/move the/DT/the disk/NN/disk head/NN/head /:/: they/PRP/they all/VBP/all behave/VBP/behave like/IN/like fcfs/NNS/fcfs scheduling/VBG/scheduling /./. requests/NNS/requests for/IN/for disk/NN/disk service/NN/service can/MD/can be/VB/be greatly/RB/greatly influenced/VBN/influenced by/IN/by the/DT/the file-allocation/NN/file-allocation method/NNP/method. a/DT/a program/NN/program reading/NN/reading a/DT/a contiguously/RB/contiguously allocated/VBN/allocated file/NN/file will/MD/will generate/VB/generate several/JJ/several requests/NNS/requests that/WDT/that are/VBP/are close/RB/close together/RB/together on/IN/on the/DT/the disk/NN/disk /,/, resulting/VBG/resulting in/IN/in limited/JJ/limited head/NN/head movement/NN/movement /./. a/DT/a linked/VBN/linked or/CC/or indexed/VBN/indexed fik/NN/fik in/IN/in contrastf/NN/contrastf may/MD/may include/VB/include blocks/NNS/blocks that/WDT/that are/VBP/are widely/RB/widely scattered/VBN/scattered on/IN/on the/DT/the diskf/NN/diskf resulting/VBG/resulting in/IN/in greater/JJR/greater head/NN/head movement/NN/movement /./. the/DT/the location/NN/location of/IN/of directories/NNS/directories and/CC/and index/NN/index blocks/NNS/blocks is/VBZ/is also/RB/also important/NNP/important. since/IN/since every/DT/every file/NN/file must/MD/must be/VB/be opened/VBN/opened to/TO/to be/VB/be usedf/JJ/usedf and/CC/and opening/VBG/opening a/DT/a file/NN/file requires/VBZ/requires searching/VBG/searching the/DT/the directory/NN/directory structuref/NN/structuref the/DT/the directories/NNS/directories will/MD/will be/VB/be accessed/VBN/accessed frequently/-NONE-/frequently. suppose/RB/suppose that/IN/that a/DT/a directory/NN/directory entry/NN/entry is/VBZ/is on/IN/on the/DT/the first/JJ/first cylinder/NN/cylinder and/CC/and a/DT/a filef/NN/filef s/VBZ/s data/NNS/data are/VBP/are on/IN/on the/DT/the final/JJ/final cylinder/NNP/cylinder. in/IN/in this/DT/this casef/NN/casef the/DT/the disk/NN/disk head/NN/head has/VBZ/has to/TO/to move/VB/move the/DT/the entire/JJ/entire width/NN/width of/IN/of the/DT/the disk/NN/disk if/IN/if the/DT/the directory/NN/directory 516/CD/516 chapter/NN/chapter 12/CD/12 12.5/CD/12.5 entry/NN/entry were/VBD/were on/IN/on the/DT/the middle/NN/middle cylinder/NN/cylinder /,/, the/DT/the head/NN/head would/MD/would have/VB/have to/TO/to move/VB/move only/RB/only one-half/JJ/one-half the/DT/the width/NNP/width. caching/NN/caching the/DT/the directories/NNS/directories and/CC/and index/NN/index blocks/NNS/blocks in/IN/in main/JJ/main memory/NN/memory can/MD/can also/RB/also help/VB/help to/TO/to reduce/VB/reduce disk-arm/JJ/disk-arm movement/NN/movement particularly/RB/particularly for/IN/for read/NN/read requests/NNS/requests /./. because/IN/because of/IN/of these/DT/these complexities/NNS/complexities /,/, the/DT/the disk-scheduling/JJ/disk-scheduling algorithm/NN/algorithm should/MD/should be/VB/be written/VBN/written as/IN/as a/DT/a separate/JJ/separate module/NN/module of/IN/of the/DT/the operating/NN/operating system/NN/system /,/, so/RB/so that/IN/that it/PRP/it can/MD/can be/VB/be replaced/VBN/replaced with/IN/with a/DT/a different/JJ/different algorithm/NN/algorithm if/IN/if necessary/NNP/necessary. either/CC/either sstf/NN/sstf or/CC/or look/VB/look is/VBZ/is a/DT/a reasonable/JJ/reasonable choice/NN/choice for/IN/for the/DT/the default/NN/default algorithm/NN/algorithm /./. the/DT/the scheduling/NN/scheduling algorithms/NNS/algorithms described/VBD/described here/RB/here consider/JJR/consider only/RB/only the/DT/the seek/NN/seek distances/NNS/distances /./. for/IN/for modern/JJ/modern disks/NNS/disks /,/, the/DT/the rotational/JJ/rotational latency/NN/latency can/MD/can be/VB/be nearly/RB/nearly as/IN/as large/JJ/large as/IN/as the/DT/the average/NN/average seek/NN/seek time/NNP/time. it/PRP/it is/VBZ/is difficult/JJ/difficult for/IN/for the/DT/the operating/NN/operating system/NN/system to/TO/to schedule/VB/schedule for/IN/for improved/VBN/improved rotational/JJ/rotational latency/NN/latency /,/, though/IN/though /,/, because/IN/because modern/JJ/modern disks/NNS/disks do/VBP/do not/RB/not disclose/VB/disclose the/DT/the physical/JJ/physical location/NN/location of/IN/of logical/JJ/logical blocks/NNP/blocks. disk/NN/disk manufacturers/NNS/manufacturers have/VBP/have been/VBN/been alleviating/VBG/alleviating this/DT/this problem/NN/problem by/IN/by implementing/NN/implementing disk-scheduling/JJ/disk-scheduling algorithms/NNS/algorithms in/IN/in the/DT/the controller/NN/controller hardware/NN/hardware built/VBN/built into/IN/into the/DT/the disk/NN/disk drive/NNP/drive. if/IN/if the/DT/the operating/NN/operating system/NN/system sends/NNS/sends a/DT/a batch/NN/batch of/IN/of requests/NNS/requests to/TO/to the/DT/the controller/NN/controller /,/, the/DT/the controller/NN/controller can/MD/can queue/VB/queue them/PRP/them and/CC/and then/RB/then schedule/JJ/schedule them/PRP/them to/TO/to improve/VB/improve both/DT/both the/DT/the seek/NN/seek time/NN/time and/CC/and the/DT/the rotational/JJ/rotational latency/NN/latency /./. if/IN/if i/o/NNP/i/o performance/NN/performance were/VBD/were the/DT/the only/JJ/only consideration/NN/consideration /,/, the/DT/the operating/NN/operating system/NN/system would/MD/would gladly/RB/gladly turn/VB/turn over/IN/over the/DT/the responsibility/NN/responsibility of/IN/of disk/NN/disk scheduling/VBG/scheduling to/TO/to the/DT/the disk/NN/disk hardware/NN/hardware /./. in/IN/in practice/NN/practice /,/, however/RB/however /,/, the/DT/the operating/NN/operating system/NN/system may/MD/may have/VB/have other/JJ/other constraints/NNS/constraints on/IN/on the/DT/the service/NN/service order/NN/order for/IN/for requests/NNP/requests. for/IN/for instance/NN/instance /,/, demand/NN/demand paging/VBG/paging may/MD/may take/VB/take priority/NN/priority over/IN/over application/NN/application i/0/-NONE-/i/0 /,/, and/CC/and writes/VBZ/writes are/VBP/are more/JJR/more urgent/JJ/urgent than/IN/than reads/NNS/reads if/IN/if the/DT/the cache/NN/cache is/VBZ/is running/VBG/running out/RP/out of/IN/of free/JJ/free pages/NNP/pages. also/RB/also /,/, it/PRP/it may/MD/may be/VB/be desirable/JJ/desirable to/TO/to guarantee/VB/guarantee the/DT/the order/NN/order of/IN/of a/DT/a set/NN/set of/IN/of disk/NN/disk writes/NNS/writes to/TO/to make/VB/make the/DT/the file/NN/file system/NN/system robust/NN/robust in/IN/in the/DT/the face/NN/face of/IN/of system/NN/system crashes/NNS/crashes /./. consider/NN/consider what/WP/what could/MD/could happen/VB/happen if/IN/if the/DT/the operating/NN/operating system/NN/system allocated/VBD/allocated a/DT/a disk/NN/disk page/NN/page to/TO/to a/DT/a file/NN/file and/CC/and the/DT/the application/NN/application wrote/VBD/wrote data/NNS/data into/IN/into that/DT/that page/NN/page before/IN/before the/DT/the operating/NN/operating system/NN/system had/VBD/had a/DT/a chance/NN/chance to/TO/to flush/VB/flush the/DT/the modified/JJ/modified inode/NN/inode and/CC/and free-space/NN/free-space list/NN/list back/RB/back to/TO/to disk/NNP/disk. to/TO/to accommodate/VB/accommodate such/JJ/such requirements/NNS/requirements /,/, an/DT/an operating/NN/operating system/NN/system may/MD/may choose/VB/choose to/TO/to do/VB/do its/PRP$/its own/JJ/own disk/NN/disk scheduling/NN/scheduling and/CC/and to/TO/to spoon-feed/JJ/spoon-feed the/DT/the requests/NNS/requests to/TO/to the/DT/the disk/NN/disk controller/NN/controller /,/, one/CD/one by/IN/by one/CD/one /,/, for/IN/for some/DT/some types/NNS/types of/IN/of i/0/-NONE-/i/0 /./. the/DT/the operating/NN/operating system/NN/system is/VBZ/is responsible/JJ/responsible for/IN/for several/JJ/several other/JJ/other aspects/NNS/aspects of/IN/of disk/NN/disk management/NN/management /,/, too/NNP/too. here/RB/here we/PRP/we discuss/VBP/discuss disk/NN/disk initialization/NN/initialization /,/, booting/VBG/booting from/IN/from disk/NN/disk /,/, and/CC/and bad-block/JJ/bad-block recovery/NN/recovery /./. 12.5.1/CD/12.5.1 disk/NN/disk formatting/VBG/formatting a/DT/a new/JJ/new magnetic/JJ/magnetic disk/NN/disk is/VBZ/is a/DT/a blank/NN/blank slate/NN/slate /:/: it/PRP/it is/VBZ/is just/RB/just a/DT/a platter/NN/platter of/IN/of a/DT/a magnetic/JJ/magnetic recording/NN/recording material/NNP/material. before/IN/before a/DT/a disk/NN/disk can/MD/can store/VB/store data/NNS/data /,/, it/PRP/it must/MD/must be/VB/be divided/VBN/divided into/IN/into sectors/NNS/sectors that/WDT/that the/DT/the disk/NN/disk controller/NN/controller can/MD/can read/VB/read and/CC/and write/NNP/write. this/DT/this process/NN/process is/VBZ/is called/VBN/called or/CC/or low-level/NNP/low-level formatting/NN/formatting fills/VBZ/fills the/DT/the disk/NN/disk with/IN/with a/DT/a special/JJ/special data/NNS/data structure/NN/structure for/IN/for each/DT/each sector/NNP/sector. the/DT/the data/NNS/data structure/VBP/structure for/IN/for a/DT/a sector/NN/sector typically/RB/typically consists/VBZ/consists of/IN/of a/DT/a header/NN/header /,/, a/DT/a data/NN/data area/NN/area /:/( usually/RB/usually 512/CD/512 bytes/NNS/bytes in/IN/in size/NN/size /:/) /,/, and/CC/and a/DT/a trailer/NNP/trailer. the/DT/the header/NN/header and/CC/and trailer/NN/trailer contain/NN/contain information/NN/information used/VBD/used by/IN/by the/DT/the disk/NN/disk controller/NN/controller /,/, such/JJ/such as/IN/as a/DT/a sector/NN/sector number/NN/number and/CC/and an/DT/an /./. when/WRB/when the/DT/the controller/NN/controller writes/VBZ/writes a/DT/a sector/NN/sector of/IN/of data/NNS/data during/IN/during normal/JJ/normal i/0/-NONE-/i/0 /,/, the/DT/the ecc/NN/ecc is/VBZ/is updated/VBN/updated with/IN/with a/DT/a value/NN/value calculated/VBN/calculated from/IN/from all/DT/all the/DT/the bytes/NNS/bytes in/IN/in the/DT/the data/NN/data area/NNP/area. when/WRB/when the/DT/the sector/NN/sector is/VBZ/is read/VBN/read /,/, the/DT/the ecc/NN/ecc is/VBZ/is recalculated/VBN/recalculated and/CC/and compared/VBN/compared with/IN/with the/DT/the stored/VBN/stored value/NNP/value. if/IN/if the/DT/the stored/VBN/stored and/CC/and calculated/VBN/calculated numbers/NNS/numbers are/VBP/are different/JJ/different /,/, this/DT/this 12.5/CD/12.5 517/CD/517 mismatch/NN/mismatch indicates/VBZ/indicates that/IN/that the/DT/the data/NNS/data area/NN/area of/IN/of the/DT/the sector/NN/sector has/VBZ/has become/VBN/become corrupted/VBN/corrupted and/CC/and that/IN/that the/DT/the disk/NN/disk sector/NN/sector may/MD/may be/VB/be bad/JJ/bad /NN/( section/NN/section 12.5.3/CD/12.5.3 /CD/) /./. the/DT/the ecc/NN/ecc is/VBZ/is an/DT/an error-correcting/JJ/error-correcting code/NN/code because/IN/because it/PRP/it contains/VBZ/contains enough/RB/enough information/NN/information /,/, if/IN/if only/RB/only a/DT/a few/JJ/few bits/NNS/bits of/IN/of data/NNS/data have/VBP/have been/VBN/been corrupted/VBN/corrupted /,/, to/TO/to enable/JJ/enable the/DT/the controller/NN/controller to/TO/to identify/VB/identify which/WDT/which bits/NNS/bits have/VBP/have changed/VBN/changed and/CC/and calculate/JJ/calculate what/WP/what their/PRP$/their correct/NN/correct values/NNS/values should/MD/should be/NNP/be. it/PRP/it then/RB/then reports/VBZ/reports a/DT/a recoverable/JJ/recoverable /./. the/DT/the controller/NN/controller automatically/RB/automatically does/VBZ/does the/DT/the ecc/NN/ecc processing/NN/processing whenever/NN/whenever a/DT/a sector/NN/sector is/VBZ/is read/VBN/read or/CC/or written/VBN/written /./. most/JJS/most hard/JJ/hard disks/NNS/disks are/VBP/are low-level-formatted/JJ/low-level-formatted at/IN/at the/DT/the factory/NN/factory as/IN/as a/DT/a part/NN/part of/IN/of the/DT/the manufacturing/VBG/manufacturing process/NNP/process. this/DT/this formatting/NN/formatting enables/VBZ/enables the/DT/the manufacturer/NN/manufacturer to/TO/to test/NN/test the/DT/the disk/NN/disk and/CC/and to/TO/to initialize/VB/initialize the/DT/the mapping/NN/mapping from/IN/from logical/JJ/logical block/NN/block numbers/NNS/numbers to/TO/to defect-free/JJ/defect-free sectors/NNS/sectors on/IN/on the/DT/the disk/NNP/disk. for/IN/for many/JJ/many hard/JJ/hard disks/NNS/disks /,/, when/WRB/when the/DT/the disk/NN/disk controller/NN/controller is/VBZ/is instructed/VBN/instructed to/TO/to low-level-format/JJ/low-level-format the/DT/the disk/NN/disk /,/, it/PRP/it can/MD/can also/RB/also be/VB/be told/VBN/told how/WRB/how many/JJ/many bytes/NNS/bytes of/IN/of data/NNS/data space/NN/space to/TO/to leave/VB/leave between/IN/between the/DT/the header/NN/header and/CC/and trailer/NN/trailer of/IN/of all/DT/all sectors/NNP/sectors. it/PRP/it is/VBZ/is usually/RB/usually possible/JJ/possible to/TO/to choose/VB/choose among/IN/among a/DT/a few/JJ/few sizes/NNS/sizes /,/, such/JJ/such as/IN/as 256,512/CD/256,512 /,/, and/CC/and 1,024/CD/1,024 bytes/NNP/bytes. formatting/NN/formatting a/DT/a disk/NN/disk with/IN/with a/DT/a larger/JJR/larger sector/NN/sector size/NN/size means/VBZ/means that/DT/that fewer/JJR/fewer sectors/NNS/sectors can/MD/can fit/VB/fit on/IN/on each/DT/each track/NN/track ;/:/; but/CC/but it/PRP/it also/RB/also means/VBZ/means that/DT/that fewer/JJR/fewer headers/NNS/headers and/CC/and trailers/NNS/trailers are/VBP/are written/VBN/written on/IN/on each/DT/each track/NN/track and/CC/and more/JJR/more space/NN/space is/VBZ/is available/JJ/available for/IN/for user/NN/user data/NNP/data. some/DT/some operating/NN/operating systems/NNS/systems can/MD/can handle/VB/handle only/RB/only a/DT/a sector/NN/sector size/NN/size of/IN/of 512/CD/512 bytes/NNS/bytes /./. before/IN/before it/PRP/it can/MD/can use/VB/use a/DT/a disk/NN/disk to/TO/to hold/VB/hold files/NNS/files /,/, the/DT/the operating/NN/operating system/NN/system still/RB/still needs/VBZ/needs to/TO/to record/VB/record its/PRP$/its own/JJ/own data/NNS/data structures/NNS/structures on/IN/on the/DT/the disk/NNP/disk. it/PRP/it does/VBZ/does so/RB/so in/IN/in two/CD/two steps/NNP/steps. the/DT/the first/JJ/first step/NN/step is/VBZ/is to/TO/to the/DT/the disk/NN/disk into/IN/into one/CD/one or/CC/or more/JJR/more groups/NNS/groups of/IN/of cylinders/NNP/cylinders. the/DT/the operatiltg/NN/operatiltg system/NN/system can/MD/can treat/VB/treat each/DT/each partition/NN/partition as/IN/as though/IN/though it/PRP/it were/VBD/were a/DT/a separate/JJ/separate disk/NNP/disk. for/IN/for instance/NN/instance /,/, one/CD/one partition/NN/partition can/MD/can hold/VB/hold a/DT/a copy/NN/copy of/IN/of the/DT/the operating/NN/operating system/NN/system 's/POS/'s executable/JJ/executable code/NN/code /,/, while/IN/while another/DT/another holds/NNS/holds user/NN/user files/NNP/files. the/DT/the second/JJ/second step/NN/step is/VBZ/is icgicz/NN/icgicz ;/:/; i/PRP/i or/CC/or creation/NN/creation of/IN/of a/DT/a file/NN/file system/NNP/system. in/IN/in this/DT/this step/NN/step /,/, the/DT/the operating/NN/operating system/NN/system stores/NNS/stores the/DT/the iltitial/JJ/iltitial file-system/NN/file-system data/NNS/data structures/NNS/structures onto/IN/onto the/DT/the disk/NNP/disk. these/DT/these data/NNS/data structures/NNS/structures may/MD/may include/VB/include maps/NNS/maps of/IN/of free/JJ/free and/CC/and allocated/VBD/allocated space/NN/space /:/( a/DT/a fat/JJ/fat or/CC/or inodes/NNS/inodes /:/) and/CC/and an/DT/an initial/JJ/initial empty/NN/empty directory/NN/directory /./. to/TO/to increase/VB/increase efficiency/NN/efficiency /,/, most/JJS/most file/JJ/file systems/NNS/systems group/NN/group blocks/NNS/blocks together/RB/together into/IN/into larger/JJR/larger chunks/NNS/chunks /,/, frequently/RB/frequently called/VBN/called disk/NN/disk i/0/-NONE-/i/0 is/VBZ/is done/VBN/done via/IN/via blocks/NNS/blocks /,/, but/CC/but file/RB/file system/NN/system ii/NN/ii 0/-NONE-/0 is/VBZ/is done/VBN/done via/IN/via clusters/NNS/clusters /,/, effectively/RB/effectively assuring/VBG/assuring that/IN/that ii/NN/ii 0/-NONE-/0 has/VBZ/has more/JJR/more sequential-access/JJ/sequential-access and/CC/and fewer/JJR/fewer random-access/JJ/random-access characteristics/NNS/characteristics /./. some/DT/some operating/NN/operating systems/NNS/systems give/VBP/give special/JJ/special programs/NNS/programs the/DT/the ability/NN/ability to/TO/to use/VB/use a/DT/a disk/NN/disk partition/NN/partition as/IN/as a/DT/a large/JJ/large sequential/NN/sequential array/NN/array of/IN/of logical/JJ/logical blocks/NNS/blocks /,/, without/IN/without any/DT/any file-system/JJ/file-system data/NNS/data structures/NNP/structures. this/DT/this array/NN/array is/VBZ/is sometimes/RB/sometimes called/VBN/called the/DT/the raw/NN/raw disk/NN/disk /,/, and/CC/and ii/NN/ii 0/-NONE-/0 to/TO/to this/DT/this array/NN/array is/VBZ/is termed/VBN/termed raw/NN/raw l/0/NNP/l/0. for/IN/for example/NN/example /,/, some/DT/some database/NN/database systems/NNS/systems prefer/VBP/prefer raw/JJ/raw iio/NN/iio because/IN/because it/PRP/it enables/VBZ/enables them/PRP/them to/TO/to control/NN/control the/DT/the exact/JJ/exact disk/NN/disk location/NN/location where/WRB/where each/DT/each database/NN/database record/NN/record is/VBZ/is stored/NNP/stored. raw/NN/raw l/0/-NONE-/l/0 bypasses/VBZ/bypasses all/DT/all the/DT/the file-system/JJ/file-system services/NNS/services /,/, such/JJ/such as/IN/as the/DT/the buffer/NN/buffer cache/NN/cache /,/, file/NN/file locking/VBG/locking /,/, prefetching/VBG/prefetching /,/, space/NN/space allocation/NN/allocation /,/, file/NN/file names/VBZ/names /,/, and/CC/and directories/NNP/directories. we/PRP/we can/MD/can make/VB/make certain/JJ/certain applications/NNS/applications more/RBR/more efficient/JJ/efficient by/IN/by allowing/NN/allowing them/PRP/them to/TO/to implement/VB/implement their/PRP$/their own/JJ/own special-purpose/JJ/special-purpose storage/NN/storage services/NNS/services on/IN/on a/DT/a raw/JJ/raw partition/NN/partition /,/, but/CC/but most/JJS/most applications/NNS/applications perform/NN/perform better/RBR/better when/WRB/when they/PRP/they use/VBP/use the/DT/the regular/JJ/regular file-system/NN/file-system services/NNS/services /./. 12.5.2/CD/12.5.2 boot/NN/boot block/NN/block for/IN/for a/DT/a computer/NN/computer to/TO/to start/VB/start running-for/JJ/running-for instance/NN/instance /,/, when/WRB/when it/PRP/it is/VBZ/is powered/VBN/powered up/RP/up or/CC/or rebooted/VBN/rebooted -it/JJ/-it must/MD/must have/VB/have an/DT/an initial/JJ/initial program/NN/program to/TO/to run/NNP/run. this/DT/this initial/JJ/initial bootstrap/NN/bootstrap program/NN/program tends/NNS/tends to/TO/to be/VB/be simple/NNP/simple. it/PRP/it initializes/VBZ/initializes all/DT/all aspects/NNS/aspects of/IN/of the/DT/the system/NN/system /,/, from/IN/from cpu/NN/cpu registers/NNS/registers to/TO/to device/VB/device controllers/NNS/controllers and/CC/and the/DT/the contents/NNS/contents of/IN/of main/JJ/main memory/NN/memory /,/, and/CC/and then/RB/then starts/VBZ/starts the/DT/the operating/NN/operating system/NNP/system. to/TO/to do/VB/do its/PRP$/its job/NN/job /,/, the/DT/the bootstrap/NN/bootstrap program/NN/program finds/NNS/finds the/DT/the 518/CD/518 chapter/NN/chapter 12/CD/12 operating-system/JJ/operating-system kernel/NN/kernel on/IN/on disk/NN/disk /,/, loads/NNS/loads that/WDT/that kernel/NN/kernel into/IN/into memory/NN/memory /,/, and/CC/and jumps/NNS/jumps to/TO/to an/DT/an initial/JJ/initial address/NN/address to/TO/to begin/VB/begin the/DT/the operating-system/JJ/operating-system execution/NN/execution /./. for/IN/for most/JJS/most computers/NNS/computers /,/, the/DT/the bootstrap/NN/bootstrap is/VBZ/is stored/VBN/stored in/IN/in this/DT/this location/NN/location is/VBZ/is convenient/JJ/convenient /,/, because/IN/because rom/NN/rom needs/VBZ/needs no/DT/no initialization/NN/initialization and/CC/and is/VBZ/is at/IN/at a/DT/a fixed/VBN/fixed location/NN/location that/IN/that the/DT/the processor/NN/processor can/MD/can start/VB/start executing/VBG/executing when/WRB/when powered/VBN/powered up/RP/up or/CC/or reset/NNP/reset. and/CC/and /,/, since/IN/since rom/NN/rom is/VBZ/is read/VBN/read only/RB/only /,/, it/PRP/it can/MD/can not/RB/not be/VB/be infected/VBN/infected by/IN/by a/DT/a computer/NN/computer virus/NNP/virus. the/DT/the problem/NN/problem is/VBZ/is that/IN/that changing/VBG/changing this/DT/this bootstrap/NN/bootstrap code/NN/code requires/VBZ/requires changing/VBG/changing the/DT/the rom/NN/rom hardware/NN/hardware chips/NNS/chips /./. for/IN/for this/DT/this reason/NN/reason /,/, most/JJS/most systems/NNS/systems store/VBP/store a/DT/a tiny/NN/tiny bootstrap/NN/bootstrap loader/NN/loader program/NN/program in/IN/in the/DT/the boot/NN/boot rom/IN/rom whose/WP$/whose only/RB/only job/NN/job is/VBZ/is to/TO/to bring/VB/bring in/IN/in a/DT/a full/JJ/full bootstrap/NN/bootstrap program/NN/program from/IN/from disk/NNP/disk. the/DT/the full/JJ/full bootstrap/NN/bootstrap program/NN/program can/MD/can be/VB/be changed/VBN/changed easily/RB/easily /:/: a/DT/a new/JJ/new version/NN/version is/VBZ/is simply/RB/simply written/VBN/written onto/IN/onto the/DT/the disk/NNP/disk. the/DT/the full/JJ/full bootstrap/NN/bootstrap program/NN/program is/VBZ/is stored/VBN/stored in/IN/in the/DT/the boot/NN/boot blocks/NNS/blocks at/IN/at a/DT/a fixed/VBN/fixed location/NN/location on/IN/on the/DT/the disk/NNP/disk. a/DT/a disk/NN/disk that/WDT/that has/VBZ/has a/DT/a boot/NN/boot partition/NN/partition is/VBZ/is called/VBN/called a/DT/a or/CC/or the/DT/the code/NN/code in/IN/in the/DT/the boot/NN/boot rom/IN/rom instructs/NNS/instructs the/DT/the disk/NN/disk controller/NN/controller to/TO/to read/VB/read the/DT/the boot/NN/boot blocks/NNS/blocks into/IN/into memory/NN/memory /:/( no/DT/no device/NN/device drivers/NNS/drivers are/VBP/are loaded/VBN/loaded at/IN/at this/DT/this point/NN/point /:/) and/CC/and then/RB/then starts/VBZ/starts executing/VBG/executing that/IN/that code/NNP/code. the/DT/the full/JJ/full bootstrap/NN/bootstrap program/NN/program is/VBZ/is more/RBR/more sophisticated/JJ/sophisticated than/IN/than the/DT/the bootstrap/NN/bootstrap loader/NN/loader in/IN/in the/DT/the boot/NN/boot rom/IN/rom ;/:/; it/PRP/it is/VBZ/is able/JJ/able to/TO/to load/VB/load the/DT/the entire/JJ/entire operating/NN/operating system/NN/system from/IN/from a/DT/a non-fixed/JJ/non-fixed location/NN/location on/IN/on disk/NN/disk and/CC/and to/TO/to start/VB/start the/DT/the operating/NN/operating system/NN/system ruru1ing/NN/ruru1ing /./. even/RB/even so/RB/so /,/, the/DT/the full/JJ/full bootstrap/NN/bootstrap code/NN/code may/MD/may be/VB/be small/JJ/small /./. let/NN/let 's/POS/'s consider/NN/consider as/IN/as an/DT/an example/NN/example the/DT/the boot/NN/boot process/NN/process in/IN/in windows/NNS/windows 2000/CD/2000. the/DT/the windows/NNS/windows 2000/CD/2000 system/NN/system places/NNS/places its/PRP$/its boot/NN/boot code/NN/code in/IN/in the/DT/the first/JJ/first sector/NN/sector on/IN/on the/DT/the hard/JJ/hard disk/NN/disk /:/( which/WDT/which it/PRP/it terms/VBZ/terms the/DT/the or/CC/or furthermore/JJR/furthermore /,/, windows/VBZ/windows 2000/CD/2000 allows/NNS/allows a/DT/a hard/JJ/hard disk/NN/disk to/TO/to be/VB/be divided/VBN/divided into/IN/into one/CD/one or/CC/or more/JJR/more partitions/NNS/partitions ;/:/; one/CD/one partition/NN/partition /,/, identified/VBD/identified as/IN/as the/DT/the contains/NNS/contains the/DT/the operating/NN/operating system/NN/system and/CC/and device/NN/device drivers/NNP/drivers. bootil1g/NNP/bootil1g begins/VBZ/begins in/IN/in a/DT/a windows/NN/windows 2000/CD/2000 system/NN/system by/IN/by running/NN/running code/NN/code that/WDT/that is/VBZ/is resident/NN/resident in/IN/in the/DT/the system/NN/system 's/POS/'s rom/NN/rom memory/NNP/memory. this/DT/this code/NN/code directs/VBZ/directs the/DT/the system/NN/system to/TO/to read/VB/read the/DT/the boot/NN/boot code/NN/code from/IN/from the/DT/the mbr/NNP/mbr. in/IN/in addition/NN/addition to/TO/to containing/VBG/containing boot/NN/boot code/NN/code /,/, the/DT/the mbr/NN/mbr contains/VBZ/contains a/DT/a table/JJ/table listing/NN/listing the/DT/the partitions/NNS/partitions for/IN/for the/DT/the hard/JJ/hard disk/NN/disk and/CC/and a/DT/a flag/NN/flag indicating/VBG/indicating which/WDT/which partition/NN/partition the/DT/the system/NN/system is/VBZ/is to/TO/to be/VB/be booted/VBN/booted from/IN/from /,/, as/IN/as illustrated/VBN/illustrated in/IN/in figure/NN/figure 12.9/CD/12.9 /./. once/RB/once the/DT/the system/NN/system identifies/NNS/identifies the/DT/the boot/NN/boot partition/NN/partition /,/, it/PRP/it reads/VBZ/reads the/DT/the first/JJ/first sector/NN/sector from/IN/from that/DT/that partition/NN/partition /:/( which/WDT/which is/VBZ/is called/VBN/called the/DT/the and/CC/and contilmes/VBZ/contilmes with/IN/with the/DT/the remainder/NN/remainder of/IN/of the/DT/the boot/NN/boot process/NN/process /,/, which/WDT/which includes/VBZ/includes loading/VBG/loading the/DT/the various/JJ/various subsystems/NNS/subsystems and/CC/and system/NN/system services/NNS/services /./. mbr/NN/mbr partition/NN/partition 1/CD/1 partition/NN/partition 2/CD/2 partition/NN/partition 3/CD/3 partition/NN/partition 4/CD/4 boot/NN/boot code/NN/code partition/NN/partition table/NN/table boot/NN/boot partition/NN/partition figure/NN/figure 12.9/CD/12.9 booting/VBG/booting from/IN/from disk/NN/disk in/IN/in windows/NNS/windows 2000/CD/2000 /./. 12.5/CD/12.5 519/CD/519 12.5.3/CD/12.5.3 bad/JJ/bad blocks/NNS/blocks because/IN/because disks/NNS/disks have/VBP/have moving/VBG/moving parts/NNS/parts and/CC/and small/JJ/small tolerances/NNS/tolerances /:/( recall/NN/recall that/IN/that the/DT/the disk/NN/disk head/NN/head flies/NNS/flies just/RB/just above/IN/above the/DT/the disk/NN/disk surface/NN/surface /:/) /,/, they/PRP/they are/VBP/are prone/RB/prone to/TO/to failure/NNP/failure. sometimes/RB/sometimes the/DT/the failure/NN/failure is/VBZ/is complete/JJ/complete ;/:/; in/IN/in this/DT/this case/NN/case /,/, the/DT/the disk/NN/disk needs/VBZ/needs to/TO/to be/VB/be replaced/VBN/replaced and/CC/and its/PRP$/its contents/NNS/contents restored/VBD/restored from/IN/from backup/NN/backup media/NNS/media to/TO/to the/DT/the new/JJ/new disk/NNP/disk. more/RBR/more frequently/RB/frequently /,/, one/CD/one or/CC/or more/JJR/more sectors/NNS/sectors become/VBP/become defective/NNP/defective. most/JJS/most disks/NNS/disks even/RB/even con'le/JJ/con'le from/IN/from the/DT/the factory/NN/factory with/IN/with depending/VBG/depending on/IN/on the/DT/the disk/NN/disk and/CC/and controller/NN/controller in/IN/in use/NN/use /,/, these/DT/these blocks/NNS/blocks are/VBP/are handled/VBN/handled in/IN/in a/DT/a variety/NN/variety of/IN/of ways/NNS/ways /./. on/IN/on simple/JJ/simple disks/NNS/disks /,/, such/JJ/such as/IN/as some/DT/some disks/NNS/disks with/IN/with ide/JJ/ide controllers/NNS/controllers /,/, bad/JJ/bad blocks/NNS/blocks are/VBP/are handled/VBN/handled manually/NNP/manually. for/IN/for instance/NN/instance /,/, the/DT/the ms-dos/NNP/ms-dos format/NN/format command/NN/command performs/NNS/performs logical/JJ/logical formatting/NN/formatting and/CC/and /,/, as/IN/as a/DT/a part/NN/part of/IN/of the/DT/the process/NN/process /,/, scans/NNS/scans the/DT/the disk/NN/disk to/TO/to find/VB/find bad/JJ/bad blocks/NNP/blocks. if/IN/if format/NN/format finds/NNS/finds a/DT/a bad/JJ/bad block/NN/block /,/, it/PRP/it writes/VBZ/writes a/DT/a special/JJ/special value/NN/value into/IN/into the/DT/the corresponding/NN/corresponding fat/NN/fat entry/NN/entry to/TO/to tell/VB/tell the/DT/the allocation/NN/allocation routines/NNS/routines not/RB/not to/TO/to use/VB/use that/IN/that block/NNP/block. if/IN/if blocks/NNS/blocks go/VBP/go bad/JJ/bad during/IN/during normal/JJ/normal operation/NN/operation /,/, a/DT/a special/JJ/special program/NN/program /NN/( such/JJ/such as/IN/as chkdsk/NN/chkdsk /:/) must/MD/must be/VB/be run/VBN/run manually/RB/manually to/TO/to search/VB/search for/IN/for the/DT/the bad/JJ/bad blocks/NNS/blocks and/CC/and to/TO/to lock/VB/lock them/PRP/them away/NNP/away. data/NNS/data that/WDT/that resided/VBD/resided on/IN/on the/DT/the bad/JJ/bad blocks/NNS/blocks usually/RB/usually are/VBP/are lost/VBN/lost /./. more/RBR/more sophisticated/JJ/sophisticated disks/NNS/disks /,/, such/JJ/such as/IN/as the/DT/the scsi/NN/scsi disks/VBZ/disks used/VBN/used in/IN/in high-end/JJ/high-end pcs/NNS/pcs and/CC/and most/JJS/most workstations/NNS/workstations and/CC/and servers/NNS/servers /,/, are/VBP/are smarter/RB/smarter about/IN/about bad-block/JJ/bad-block recovery/NNP/recovery. the/DT/the controller/NN/controller maintains/VBZ/maintains a/DT/a list/NN/list of/IN/of bad/JJ/bad blocks/NNS/blocks on/IN/on the/DT/the disk/NNP/disk. the/DT/the list/NN/list is/VBZ/is initialized/VBN/initialized during/IN/during the/DT/the low-level/JJ/low-level formatting/NN/formatting at/IN/at the/DT/the factory/NN/factory and/CC/and is/VBZ/is updated/VBN/updated over/IN/over the/DT/the life/NN/life of/IN/of the/DT/the disk/NN/disk /./. low-level/JJ/low-level formatting/NN/formatting also/RB/also sets/VBZ/sets aside/JJ/aside spare/NN/spare sectors/NNS/sectors not/RB/not visible/JJ/visible to/TO/to the/DT/the operating/NN/operating system/NNP/system. the/DT/the controller/NN/controller can/MD/can be/VB/be told/VBN/told to/TO/to replace/VB/replace each/DT/each bad/JJ/bad sector/NN/sector logically/RB/logically with/IN/with one/CD/one of/IN/of the/DT/the spare/NN/spare sectors/NNP/sectors. this/DT/this scheme/NN/scheme is/VBZ/is known/VBN/known as/IN/as or/CC/or a/DT/a typical/JJ/typical bad-sector/NN/bad-sector transaction/NN/transaction might/MD/might be/VB/be as/RB/as follows/VBZ/follows /:/: the/DT/the operating/NN/operating system/NN/system tries/NNS/tries to/TO/to read/VB/read logical/JJ/logical block/NN/block 87/CD/87 /./. the/DT/the controller/NN/controller calculates/VBZ/calculates the/DT/the ecc/NN/ecc and/CC/and finds/NNS/finds that/WDT/that the/DT/the sector/NN/sector is/VBZ/is bad/NNP/bad. it/PRP/it reports/VBZ/reports this/DT/this finding/NN/finding to/TO/to the/DT/the operating/NN/operating system/NN/system /./. the/DT/the next/JJ/next time/NN/time the/DT/the system/NN/system is/VBZ/is rebooted/VBN/rebooted /,/, a/DT/a special/JJ/special command/NN/command is/VBZ/is run/VBN/run to/TO/to tell/VB/tell the/DT/the scsi/NN/scsi controller/NN/controller to/TO/to replace/VB/replace the/DT/the bad/JJ/bad sector/NN/sector with/IN/with a/DT/a spare/NN/spare /./. after/IN/after that/DT/that /,/, whenever/RB/whenever the/DT/the system/NN/system requests/NNS/requests logical/JJ/logical block/NN/block 87/CD/87 /,/, the/DT/the request/NN/request is/VBZ/is translated/VBN/translated into/IN/into the/DT/the replacement/NN/replacement sector/NN/sector 's/POS/'s address/NN/address by/IN/by the/DT/the controller/NN/controller /./. note/NN/note that/IN/that such/JJ/such a/DT/a redirection/NN/redirection by/IN/by the/DT/the controller/NN/controller could/MD/could invalidate/VB/invalidate any/DT/any optimization/NN/optimization by/IN/by the/DT/the operating/NN/operating system/NN/system 's/POS/'s disk-scheduling/JJ/disk-scheduling algorithm/NN/algorithm !/./! for/IN/for this/DT/this reason/NN/reason /,/, most/JJS/most disks/NNS/disks are/VBP/are formatted/VBN/formatted to/TO/to provide/VB/provide a/DT/a few/JJ/few spare/NN/spare sectors/NNS/sectors in/IN/in each/DT/each cylinder/NN/cylinder and/CC/and a/DT/a spare/NN/spare cylinder/NN/cylinder as/IN/as well/NNP/well. when/WRB/when a/DT/a bad/JJ/bad block/NN/block is/VBZ/is remapped/VBN/remapped /,/, the/DT/the controller/NN/controller uses/VBZ/uses a/DT/a spare/NN/spare sector/NN/sector from/IN/from the/DT/the same/JJ/same cylinder/NN/cylinder /,/, if/IN/if possible/JJ/possible /./. as/IN/as an/DT/an alternative/NN/alternative to/TO/to sector/NN/sector some/DT/some controllers/NNS/controllers can/MD/can be/VB/be instructed/VBN/instructed to/TO/to replace/VB/replace a/DT/a bad/JJ/bad block/NN/block by/IN/by here/RB/here is/VBZ/is an/DT/an example/NN/example /:/: suppose/NN/suppose that/IN/that logical/JJ/logical block/NN/block 17/CD/17 becomes/VBZ/becomes defective/JJ/defective and/CC/and the/DT/the first/JJ/first available/JJ/available spare/NN/spare follows/VBZ/follows sector/NN/sector 202/CD/202. then/RB/then /,/, sector/NN/sector slipping/VBG/slipping remaps/NNS/remaps all/DT/all the/DT/the sectors/NNS/sectors front/VBP/front 17/CD/17 to/TO/to 202/CD/202 /,/, moving/VBG/moving them/PRP/them all/DT/all down/RB/down one/CD/one spot/NNP/spot. that/WDT/that is/VBZ/is /,/, sector/NN/sector 202/CD/202 is/VBZ/is copied/VBN/copied into/IN/into the/DT/the spare/JJ/spare /,/, then/RB/then sector/NN/sector 201/CD/201 into/IN/into 202/CD/202 /,/, then/RB/then 200/CD/200 into/IN/into 201/CD/201 /,/, and/CC/and so/RB/so on/IN/on /,/, until/IN/until sector/NN/sector 18/CD/18 is/VBZ/is copied/VBN/copied into/IN/into sector/NN/sector 19/CD/19 /./. slipping/NN/slipping the/DT/the sectors/NNS/sectors in/IN/in this/DT/this way/NN/way frees/VBZ/frees up/RP/up the/DT/the space/NN/space of/IN/of sector/NN/sector 18/CD/18 /,/, so/RB/so sector/NN/sector 17/CD/17 can/MD/can be/VB/be mapped/VBN/mapped to/TO/to it/PRP/it /./. the/DT/the replacement/NN/replacement of/IN/of a/DT/a bad/JJ/bad block/NN/block generally/RB/generally is/VBZ/is not/RB/not totally/RB/totally automatic/JJ/automatic because/IN/because the/DT/the data/NNS/data in/IN/in the/DT/the bad/JJ/bad block/NN/block are/VBP/are usually/RB/usually lost/NNP/lost. soft/NN/soft errors/NNS/errors may/MD/may trigger/VB/trigger a/DT/a process/NN/process in/IN/in 520/CD/520 chapter/NN/chapter 12/CD/12 12.6/CD/12.6 which/WDT/which a/DT/a copy/NN/copy of/IN/of the/DT/the block/NN/block data/NNS/data is/VBZ/is made/VBN/made and/CC/and the/DT/the block/NN/block is/VBZ/is spared/VBN/spared or/CC/or slipped/VBN/slipped /./. an/DT/an unrecoverable/JJ/unrecoverable howeverf/NN/howeverf results/NNS/results in/IN/in lost/NN/lost data/NNP/data. whatever/NN/whatever file/NN/file was/VBD/was using/VBG/using th.at/JJ/th.at block/NN/block must/MD/must be/VB/be repaired/VBN/repaired /-NONE-/( for/IN/for instancef/NN/instancef by/IN/by restoration/NN/restoration from/IN/from a/DT/a backup/NN/backup tape/NN/tape /:/) f/NN/f and/CC/and that/IN/that requires/NNS/requires manual/JJ/manual intervention/NN/intervention /./. swapping/VBG/swapping was/VBD/was first/JJ/first presented/VBN/presented in/IN/in section/NN/section 8.2f/CD/8.2f where/WRB/where we/PRP/we discussed/VBD/discussed moving/VBG/moving entire/JJ/entire processes/NNS/processes between/IN/between disk/NN/disk and/CC/and main/JJ/main memory/NNP/memory. swapping/NN/swapping in/IN/in that/DT/that setting/NN/setting occurs/NNS/occurs when/WRB/when the/DT/the amount/NN/amount of/IN/of physical/JJ/physical memory/NN/memory reaches/NNS/reaches a/DT/a critically/RB/critically low/JJ/low point/NN/point and/CC/and processes/NNS/processes are/VBP/are moved/VBN/moved from/IN/from memory/NN/memory to/TO/to swap/VB/swap space/NN/space to/TO/to free/JJ/free available/JJ/available memory/NN/memory /./. in/IN/in practicef/NN/practicef very/RB/very few/JJ/few modern/JJ/modern operating/NN/operating systems/NNS/systems implement/NN/implement swapping/VBG/swapping in/IN/in this/DT/this fashion/NNP/fashion. rathel/NN/rathel ~/:/~ systems/NNS/systems now/RB/now combine/VBP/combine swapping/VBG/swapping with/IN/with virtual/JJ/virtual memory/NN/memory techniques/NNS/techniques /:/( chapter/NN/chapter 9/CD/9 /CD/) and/CC/and swap/NN/swap pagesf/NN/pagesf not/RB/not necessarily/RB/necessarily entire/JJ/entire processes/NNP/processes. in/IN/in fact/NN/fact some/DT/some systems/NNS/systems now/RB/now use/VBP/use the/DT/the terms/NNS/terms swapping/VBG/swapping and/CC/and paging/VBG/paging interchangeablyf/NN/interchangeablyf reflecting/VBG/reflecting the/DT/the merging/NN/merging of/IN/of these/DT/these two/CD/two concepts/NNS/concepts /./. is/VBZ/is another/DT/another low-level/JJ/low-level task/NN/task of/IN/of the/DT/the operating/NN/operating system/NNP/system. virtual/JJ/virtual memory/NN/memory uses/NNS/uses disk/VBP/disk space/NN/space as/IN/as an/DT/an extension/NN/extension of/IN/of main/JJ/main memory/NN/memory /./. since/IN/since disk/NN/disk access/NN/access is/VBZ/is much/JJ/much slower/NN/slower than/IN/than memory/NN/memory accessf/NN/accessf using/VBG/using swap/NN/swap space/NN/space significantly/RB/significantly decreases/VBZ/decreases system/NN/system performance/NNP/performance. the/DT/the main/JJ/main goal/NN/goal for/IN/for the/DT/the design/NN/design and/CC/and implementation/NN/implementation of/IN/of swap/NN/swap space/NN/space is/VBZ/is to/TO/to provide/VB/provide the/DT/the best/JJS/best throughput/NN/throughput for/IN/for the/DT/the virtual/JJ/virtual memory/NN/memory system/NNP/system. in/IN/in this/DT/this sectionf/NN/sectionf we/PRP/we discuss/VBZ/discuss how/WRB/how swap/NN/swap space/NN/space is/VBZ/is usedf/NN/usedf where/WRB/where swap/NN/swap space/NN/space is/VBZ/is located/VBN/located on/IN/on diskf/NN/diskf and/CC/and how/WRB/how swap/NN/swap space/NN/space is/VBZ/is managed/VBN/managed /./. 12.6.1/CD/12.6.1 swap-space/NN/swap-space use/NN/use swap/NN/swap space/NN/space is/VBZ/is used/VBN/used in/IN/in various/JJ/various ways/NNS/ways by/IN/by different/JJ/different operating/NN/operating systemsf/NN/systemsf depending/VBG/depending on/IN/on the/DT/the memory-management/JJ/memory-management algorithms/NNS/algorithms in/IN/in use/NNP/use. for/IN/for instancef/NN/instancef systems/NNS/systems that/WDT/that implement/NN/implement swapping/VBG/swapping may/MD/may use/VB/use swap/NN/swap space/NN/space to/TO/to hold/VB/hold an/DT/an entire/JJ/entire process/NN/process imagef/NN/imagef including/VBG/including the/DT/the code/NN/code and/CC/and data/NNS/data segments/NNP/segments. paging/VBG/paging systems/NNS/systems may/MD/may simply/RB/simply store/VB/store pages/NNS/pages that/WDT/that have/VBP/have been/VBN/been pushed/VBN/pushed out/RP/out of/IN/of main/JJ/main memory/NNP/memory. the/DT/the amount/NN/amount of/IN/of swap/NN/swap space/NN/space needed/VBN/needed on/IN/on a/DT/a system/NN/system can/MD/can therefore/VB/therefore vary/JJ/vary from/IN/from a/DT/a few/JJ/few megabytes/NNS/megabytes of/IN/of disk/NN/disk space/NN/space to/TO/to gigabytesf/VB/gigabytesf depending/VBG/depending on/IN/on the/DT/the amow1.t/JJ/amow1.t of/IN/of physical/JJ/physical memoryf/NN/memoryf the/DT/the amount/NN/amount of/IN/of virtual/JJ/virtual memory/NN/memory it/PRP/it is/VBZ/is backingf/IN/backingf and/CC/and the/DT/the way/NN/way in/IN/in which/WDT/which the/DT/the virtual/JJ/virtual memory/NN/memory is/VBZ/is used/VBN/used /./. note/NN/note that/IN/that it/PRP/it may/MD/may be/VB/be safer/RBR/safer to/TO/to overestimate/VB/overestimate than/IN/than to/TO/to underestimate/VB/underestimate the/DT/the amount/NN/amount of/IN/of swap/NN/swap space/NN/space requiredf/NN/requiredf because/IN/because if/IN/if a/DT/a system/NN/system runs/VBZ/runs out/RP/out of/IN/of swap/NN/swap space/NN/space it/PRP/it may/MD/may be/VB/be forced/VBN/forced to/TO/to abort/VB/abort processes/NNS/processes or/CC/or may/MD/may crash/VB/crash entirely/NNP/entirely. overestimation/NN/overestimation wastes/VBZ/wastes disk/NN/disk space/NN/space that/WDT/that could/MD/could otherwise/VB/otherwise be/VB/be used/VBN/used for/IN/for filesf/NN/filesf but/CC/but it/PRP/it does/VBZ/does no/DT/no other/JJ/other harm/NNP/harm. some/DT/some systems/NNS/systems recommend/VBP/recommend the/DT/the amount/NN/amount to/TO/to be/VB/be set/VBN/set aside/NN/aside for/IN/for swap/NN/swap space/NNP/space. solarisf/NN/solarisf for/IN/for examplef/NN/examplef suggests/VBZ/suggests setting/VBG/setting swap/NN/swap space/NN/space equal/JJ/equal to/TO/to the/DT/the amount/NN/amount by/IN/by which/WDT/which virtual/JJ/virtual memory/NN/memory exceeds/NNS/exceeds pageable/JJ/pageable physical/JJ/physical memory/NNP/memory. in/IN/in the/DT/the past/JJ/past linux/NN/linux has/VBZ/has suggested/VBN/suggested setting/VBG/setting swap/NN/swap space/NN/space to/TO/to double/JJ/double the/DT/the amount/NN/amount of/IN/of physical/JJ/physical memoryf/NN/memoryf although/IN/although most/JJS/most linux/NN/linux systems/NNS/systems now/RB/now use/VBP/use considerably/RB/considerably less/RBR/less swap/NN/swap space/NNP/space. in/IN/in factf/NN/factf there/EX/there is/VBZ/is currently/RB/currently much/RB/much debate/VBP/debate in/IN/in the/DT/the linux/NN/linux community/NN/community about/IN/about whether/IN/whether to/TO/to set/VB/set aside/JJ/aside swap/NN/swap space/NN/space at/IN/at all/DT/all !/./! some/DT/some operating/NN/operating systems-including/NN/systems-including linux-allow/JJ/linux-allow the/DT/the use/NN/use of/IN/of multiple/NN/multiple swap/NN/swap spaces/NNP/spaces. these/DT/these swap/NN/swap spaces/NNS/spaces are/VBP/are usually/RB/usually put/VBN/put on/IN/on separate/JJ/separate disks/NNS/disks so/IN/so that/IN/that the/DT/the load/NN/load placed/VBD/placed on/IN/on the/DT/the i/0/NNP/i/0 system/NNP/system. by/IN/by paging/NN/paging and/CC/and swapping/VBG/swapping can/MD/can be/VB/be spread/VBN/spread over/RP/over the/DT/the systemfs/NNS/systemfs i/o/-NONE-/i/o devices/NNS/devices /./. 12.6/CD/12.6 521/CD/521 12.6.2/CD/12.6.2 swap-space/NN/swap-space location/NN/location a/DT/a swap/NN/swap space/NN/space can/MD/can reside/VB/reside in/IN/in one/CD/one of/IN/of two/CD/two places/NNS/places /:/: it/PRP/it can/MD/can be/VB/be carved/VBN/carved out/RP/out of/IN/of the/DT/the normal/JJ/normal file/NN/file system/NN/system /,/, or/CC/or it/PRP/it can/MD/can be/VB/be in/IN/in a/DT/a separate/JJ/separate disk/NN/disk partition/NNP/partition. if/IN/if the/DT/the swap/NN/swap space/NN/space is/VBZ/is simply/RB/simply a/DT/a large/JJ/large file/NN/file within/IN/within the/DT/the file/NN/file system/NN/system /,/, normal/JJ/normal file-system/NN/file-system routines/NNS/routines can/MD/can be/VB/be used/VBN/used to/TO/to create/VB/create it/PRP/it /,/, name/VBD/name it/PRP/it and/CC/and allocate/VB/allocate its/PRP$/its space/NNP/space. this/DT/this approach/NN/approach /,/, though/IN/though easy/JJ/easy to/TO/to implement/NN/implement is/VBZ/is inefficient/NNP/inefficient. navigating/NN/navigating the/DT/the directory/NN/directory structure/NN/structure and/CC/and the/DT/the diskallocation/NN/diskallocation data/NNS/data structures/NNS/structures takes/VBZ/takes time/NN/time and/CC/and /CD/( possibly/RB/possibly /:/) extra/JJ/extra disk/NN/disk accesses/NNP/accesses. external/JJ/external fragmentation/NN/fragmentation can/MD/can greatly/RB/greatly increase/VB/increase swapping/VBG/swapping times/NNS/times by/IN/by forcing/NN/forcing multiple/NN/multiple seeks/VBZ/seeks during/IN/during reading/NN/reading or/CC/or writing/VBG/writing of/IN/of a/DT/a process/NN/process image/NNP/image. we/PRP/we can/MD/can improve/VB/improve performance/NN/performance by/IN/by caching/NN/caching the/DT/the block/NN/block location/NN/location information/NN/information in/IN/in physical/JJ/physical memory/NN/memory and/CC/and by/IN/by using/VBG/using special/JJ/special tools/NNS/tools to/TO/to allocate/VB/allocate physically/RB/physically contiguous/JJ/contiguous blocks/NNS/blocks for/IN/for the/DT/the swap/NN/swap file/NN/file /,/, but/CC/but the/DT/the cost/NN/cost of/IN/of traversing/VBG/traversing the/DT/the file-system/JJ/file-system data/NNS/data structures/NNS/structures remains/VBZ/remains /./. alternatively/RB/alternatively /,/, swap/NN/swap space/NN/space can/MD/can be/VB/be created/VBN/created in/IN/in a/DT/a separate/JJ/separate partition/NNP/partition. no/DT/no file/NN/file system/NN/system or/CC/or directory/NN/directory structure/NN/structure is/VBZ/is placed/VBN/placed in/IN/in this/DT/this space/NNP/space. rather/RB/rather /,/, a/DT/a separate/JJ/separate swap-space/NN/swap-space storage/NN/storage manager/NN/manager is/VBZ/is used/VBN/used to/TO/to allocate/VB/allocate and/CC/and deallocate/VB/deallocate the/DT/the blocks/NNS/blocks from/IN/from the/DT/the raw/NN/raw partition/NNP/partition. this/DT/this manager/NN/manager uses/VBZ/uses algorithms/NNS/algorithms optimized/VBN/optimized for/IN/for speed/NN/speed rather/RB/rather than/IN/than for/IN/for storage/NN/storage efficiency/NN/efficiency /,/, because/IN/because swap/NN/swap space/NN/space is/VBZ/is accessed/VBN/accessed much/JJ/much more/RBR/more frequently/RB/frequently than/IN/than file/NN/file systems/NNS/systems /:/( when/WRB/when it/PRP/it is/VBZ/is used/VBN/used /-NONE-/) /./. internal/JJ/internal fragmentation/NN/fragmentation may/MD/may increase/VB/increase /,/, but/CC/but this/DT/this trade-off/JJ/trade-off is/VBZ/is acceptable/JJ/acceptable because/IN/because the/DT/the life/NN/life of/IN/of data/NNS/data in/IN/in the/DT/the swap/NN/swap space/NN/space generally/RB/generally is/VBZ/is much/RB/much shorter/JJR/shorter than/IN/than that/DT/that of/IN/of files/NNS/files in/IN/in the/DT/the file/NN/file system/NNP/system. since/IN/since swap/NN/swap space/NN/space is/VBZ/is reinitialized/VBN/reinitialized at/IN/at boot/NN/boot time/NN/time /,/, any/DT/any fragmentation/NN/fragmentation is/VBZ/is short-lived/NNP/short-lived. the/DT/the raw-partition/NN/raw-partition approach/NN/approach creates/VBZ/creates a/DT/a fixed/VBN/fixed amount/NN/amount of/IN/of swap/NN/swap space/NN/space during/IN/during disk/NN/disk partitioning/NNP/partitioning. adding/NN/adding more/JJR/more swap/NN/swap space/NN/space requires/VBZ/requires either/DT/either repartitioning/VBG/repartitioning the/DT/the disk/NN/disk /:/( which/WDT/which involves/NNS/involves moving/VBG/moving the/DT/the other/JJ/other file-system/JJ/file-system partitions/NNS/partitions or/CC/or destroying/VBG/destroying them/PRP/them and/CC/and restoring/VBG/restoring them/PRP/them from/IN/from backup/NN/backup /:/) or/CC/or adding/VBG/adding another/DT/another swap/NN/swap space/NN/space elsewhere/RB/elsewhere /./. some/DT/some operating/NN/operating systems/NNS/systems are/VBP/are flexible/JJ/flexible and/CC/and can/MD/can swap/VB/swap both/DT/both in/IN/in raw/NN/raw partitions/NNS/partitions and/CC/and in/IN/in file-system/JJ/file-system space/NNP/space. linux/NN/linux is/VBZ/is an/DT/an example/NN/example /:/: the/DT/the policy/NN/policy and/CC/and implementation/NN/implementation are/VBP/are separate/JJ/separate /,/, allowing/VBG/allowing the/DT/the machine/NN/machine 's/POS/'s administrator/NN/administrator to/TO/to decide/VB/decide which/WDT/which type/NN/type of/IN/of swapping/VBG/swapping to/TO/to use/NNP/use. the/DT/the trade-off/JJ/trade-off is/VBZ/is between/IN/between the/DT/the convenience/NN/convenience of/IN/of allocation/NN/allocation and/CC/and management/NN/management in/IN/in the/DT/the file/NN/file system/NN/system and/CC/and the/DT/the performance/NN/performance of/IN/of swapping/VBG/swapping in/IN/in raw/NN/raw partitions/NNS/partitions /./. 12.6.3/CD/12.6.3 swap-space/NN/swap-space management/NN/management /:/: an/DT/an example/NN/example we/PRP/we can/MD/can illustrate/VB/illustrate how/WRB/how swap/NN/swap space/NN/space is/VBZ/is used/VBN/used by/IN/by following/NN/following the/DT/the evolution/NN/evolution of/IN/of swapping/VBG/swapping and/CC/and paging/VBG/paging in/IN/in various/JJ/various unix/NN/unix systems/NNP/systems. the/DT/the traditional/JJ/traditional unix/NN/unix kernel/NN/kernel started/VBD/started with/IN/with an/DT/an implementation/NN/implementation of/IN/of swapping/VBG/swapping that/IN/that copied/JJ/copied entire/NN/entire processes/NNS/processes between/IN/between contiguous/JJ/contiguous disk/NN/disk regions/NNS/regions and/CC/and memory/NNP/memory. unix/NN/unix later/JJ/later evolved/VBD/evolved to/TO/to a/DT/a combination/NN/combination of/IN/of swapping/VBG/swapping and/CC/and paging/VBG/paging as/IN/as pagiltg/NN/pagiltg hardware/NN/hardware became/VBD/became available/JJ/available /./. in/IN/in solaris/NNS/solaris 1/CD/1 /CD/( sunos/NNS/sunos /:/) /,/, the/DT/the designers/NNS/designers changed/VBD/changed standard/JJ/standard unix/NN/unix methods/NNS/methods to/TO/to improve/VB/improve efficiency/NN/efficiency and/CC/and reflect/VB/reflect technological/JJ/technological developments/NNP/developments. when/WRB/when a/DT/a process/NN/process executes/VBZ/executes /,/, text-segment/JJ/text-segment pages/NNS/pages containing/VBG/containing code/NN/code are/VBP/are brought/VBN/brought in/IN/in from/IN/from the/DT/the file/NN/file system/NN/system /,/, accessed/VBD/accessed in/IN/in main/JJ/main memory/NN/memory /,/, and/CC/and thrown/VB/thrown away/RP/away if/IN/if selected/VBN/selected for/IN/for pageout/NNP/pageout. it/PRP/it is/VBZ/is more/RBR/more efficient/JJ/efficient to/TO/to reread/VB/reread a/DT/a page/NN/page from/IN/from the/DT/the file/NN/file system/NN/system than/IN/than to/TO/to write/VB/write it/PRP/it to/TO/to swap/VB/swap space/NN/space and/CC/and then/RB/then reread/VB/reread it/PRP/it from/IN/from there/NNP/there. swap/NN/swap space/NN/space is/VBZ/is only/RB/only used/VBN/used as/IN/as a/DT/a backing/NN/backing store/NN/store for/IN/for pages/NNS/pages of/IN/of memory/NN/memory /,/, which/WDT/which includes/VBZ/includes memory/NN/memory allocated/VBN/allocated for/IN/for the/DT/the stack/NN/stack /,/, heap/NN/heap /,/, and/CC/and uninitialized/VBD/uninitialized data/NNS/data of/IN/of a/DT/a process/NN/process /./. more/JJR/more changes/NNS/changes were/VBD/were made/VBN/made in/IN/in later/JJ/later versions/NNS/versions of/IN/of solaris/NNP/solaris. the/DT/the biggest/JJS/biggest change/NN/change is/VBZ/is that/IN/that solaris/NNS/solaris now/RB/now allocates/VBZ/allocates swap/NN/swap space/NN/space only/RB/only when/WRB/when a/DT/a page/NN/page is/VBZ/is forced/VBN/forced out/RP/out of/IN/of physical/JJ/physical memory/NN/memory /,/, rather/RB/rather than/IN/than when/WRB/when the/DT/the virtual/JJ/virtual memory/NN/memory page/NN/page is/VBZ/is first/JJ/first created/VBN/created /./. 522/CD/522 chapter/NN/chapter 12/CD/12 12.7/CD/12.7 swap/NN/swap partition/NN/partition or/CC/or swap/NN/swap file/NN/file swap/NN/swap map/NN/map 1---------swap/CD/1---------swap area--------1/-NONE-/area--------1 page/NN/page i/-NONE-/i- slot/NN/slot -1/-NONE-/-1 l/-NONE-/l--- ~/:/~ /:/--- ~/:/~ ---_l/JJ/---_l __/NNP/__ _l/NNP/_l _/NNP/_ ~/NNP/~ figure/NN/figure 12.10/CD/12.10 the/DT/the data/NNS/data structures/NNS/structures for/IN/for swapping/VBG/swapping on/IN/on linux/NN/linux systems/NNS/systems /./. this/DT/this scheme/NN/scheme gives/VBZ/gives better/JJR/better performance/NN/performance on/IN/on modern/JJ/modern computers/NNS/computers /,/, which/WDT/which have/VBP/have more/JJR/more physical/JJ/physical memory/NN/memory than/IN/than older/JJR/older systems/NNS/systems and/CC/and tend/VBP/tend to/TO/to page/NN/page less/JJR/less /./. linux/NN/linux is/VBZ/is similar/JJ/similar to/TO/to solaris/NNS/solaris in/IN/in that/DT/that swap/NN/swap space/NN/space is/VBZ/is only/RB/only used/VBN/used for/IN/for anonymous/JJ/anonymous memory/NN/memory or/CC/or for/IN/for regions/NNS/regions of/IN/of memory/NN/memory shared/VBN/shared by/IN/by several/JJ/several processes/NNP/processes. linux/NN/linux allows/VBZ/allows one/CD/one or/CC/or more/JJR/more swap/NN/swap areas/NNS/areas to/TO/to be/VB/be established/NNP/established. a/DT/a swap/NN/swap area/NN/area may/MD/may be/VB/be in/IN/in either/DT/either a/DT/a swap/NN/swap file/NN/file on/IN/on a/DT/a regular/JJ/regular file/NN/file system/NN/system or/CC/or a/DT/a raw-swap-space/NN/raw-swap-space partition/NNP/partition. each/DT/each swap/NN/swap area/NN/area consists/NNS/consists of/IN/of a/DT/a series/NN/series of/IN/of 4-kb/CD/4-kb which/WDT/which are/VBP/are used/VBN/used to/TO/to hold/VB/hold swapped/VBN/swapped pages/NNS/pages /./. associated/VBN/associated with/IN/with each/DT/each swap/NN/swap area/NN/area is/VBZ/is a/DT/a .u1.2.p-an/JJ/.u1.2.p-an array/NN/array of/IN/of integer/JJR/integer counters/NNS/counters /,/, each/DT/each corresponding/VBG/corresponding to/TO/to a/DT/a page/NN/page slot/NN/slot in/IN/in the/DT/the swap/NN/swap area/NNP/area. if/IN/if the/DT/the value/NN/value of/IN/of a/DT/a counter/NN/counter is/VBZ/is 0/-NONE-/0 /,/, the/DT/the corresponding/NN/corresponding page/NN/page slot/NN/slot is/VBZ/is available/NNP/available. values/NNS/values greater/JJR/greater than/IN/than 0/-NONE-/0 indicate/VBP/indicate that/IN/that the/DT/the page/NN/page slot/NN/slot is/VBZ/is occupied/VBN/occupied by/IN/by a/DT/a swapped/JJ/swapped page/NNP/page. the/DT/the value/NN/value of/IN/of the/DT/the counter/NN/counter ij.l.dicates/VBZ/ij.l.dicates the/DT/the number/NN/number of/IN/of mappings/NNS/mappings to/TO/to the/DT/the swapped/JJ/swapped page/NN/page ;/:/; for/IN/for example/NN/example /,/, a/DT/a value/NN/value of/IN/of 3/CD/3 indicates/NNS/indicates that/WDT/that the/DT/the swapped/VBD/swapped page/NN/page is/VBZ/is mapped/VBN/mapped to/TO/to three/CD/three different/JJ/different processes/NNS/processes /:/( which/WDT/which can/MD/can occur/VB/occur if/IN/if the/DT/the swapped/VBN/swapped page/NN/page is/VBZ/is storing/VBG/storing a/DT/a region/NN/region of/IN/of memory/NN/memory shared/VBN/shared by/IN/by three/CD/three processes/NNS/processes /:/) /./. the/DT/the data/NNS/data structures/NNS/structures for/IN/for swapping/VBG/swapping on/IN/on linux/NN/linux systems/NNS/systems are/VBP/are shown/VBN/shown in/IN/in figure/NN/figure 12.10/CD/12.10 /./. disk/NN/disk drives/NNS/drives have/VBP/have continued/VBN/continued to/TO/to get/VB/get smaller/JJR/smaller and/CC/and cheaper/JJR/cheaper /,/, so/RB/so it/PRP/it is/VBZ/is now/RB/now economically/RB/economically feasible/JJ/feasible to/TO/to attach/VB/attach many/JJ/many disks/NNS/disks to/TO/to a/DT/a computer/NN/computer system/NNP/system. having/NN/having a/DT/a large/JJ/large number/NN/number of/IN/of disks/NNS/disks in/IN/in a/DT/a system/NN/system presents/NNS/presents opportunities/NNS/opportunities for/IN/for improving/VBG/improving the/DT/the rate/NN/rate at/IN/at which/WDT/which data/NNS/data can/MD/can be/VB/be read/VBN/read or/CC/or written/VBN/written /,/, if/IN/if the/DT/the disks/NNS/disks are/VBP/are operated/VBN/operated in/IN/in parallel/NNP/parallel. furthermore/NN/furthermore /,/, this/DT/this setup/NN/setup offers/VBZ/offers the/DT/the potential/NN/potential for/IN/for improving/NN/improving the/DT/the reliability/NN/reliability of/IN/of data/NNS/data storage/NN/storage /,/, because/IN/because redundant/JJ/redundant information/NN/information can/MD/can be/VB/be stored/VBN/stored on/IN/on multiple/NN/multiple disks/NNP/disks. thus/RB/thus /,/, failure/NN/failure of/IN/of one/CD/one disk/NN/disk does/VBZ/does not/RB/not lead/VB/lead to/TO/to loss/NN/loss of/IN/of data/NNP/data. a/DT/a of/IN/of disk-organization/NN/disk-organization techniques/NNS/techniques /,/, collectively/RB/collectively called/VBN/called disks/NNS/disks /:/( raids/NNS/raids /VBP/) /,/, are/VBP/are commonly/RB/commonly used/VBN/used to/TO/to address/NN/address the/DT/the performance/NN/performance and/CC/and reliability/NN/reliability issues/NNS/issues /./. in/IN/in the/DT/the past/JJ/past /,/, raids/NNS/raids composed/VBD/composed of/IN/of small/JJ/small /,/, cheap/NN/cheap disks/NNS/disks were/VBD/were viewed/VBN/viewed as/IN/as a/DT/a cost-effective/JJ/cost-effective alternative/NN/alternative to/TO/to large/JJ/large /,/, expensive/JJ/expensive disks/NNS/disks ;/:/; today/NN/today /,/, raids/NNS/raids are/VBP/are used/VBN/used for/IN/for their/PRP$/their higher/JJR/higher reliability/NN/reliability and/CC/and higher/JJR/higher data-transfer/JJ/data-transfer rate/NN/rate /,/, rather/RB/rather than/IN/than for/IN/for economic/JJ/economic reasons/NNP/reasons. hence/NN/hence /,/, the/DT/the i/PRP/i in/IN/in raid/JJ/raid /,/, which/WDT/which once/RB/once stood/VBD/stood for/IN/for inexpensive//JJ/inexpensive/ '/''/' now/RB/now stands/VBZ/stands for/IN/for ij.l.dependent/JJ/ij.l.dependent /./. 12.7.1/CD/12.7.1 improvement/NN/improvement of/IN/of reliability/NN/reliability via/IN/via redundancy/NN/redundancy let/NN/let us/PRP/us first/RB/first consider/VBP/consider the/DT/the reliability/NN/reliability of/IN/of raids/NNP/raids. the/DT/the chance/NN/chance that/IN/that some/DT/some disk/NN/disk out/RP/out of/IN/of a/DT/a set/NN/set of/IN/of n/NN/n disks/NNS/disks will/MD/will fail/VB/fail is/VBZ/is much/RB/much higher/JJR/higher than/IN/than the/DT/the chance/NN/chance that/IN/that a/DT/a specific/JJ/specific single/JJ/single 12.7/CD/12.7 523/CD/523 structuring/VBG/structuring raid/NN/raid raid/VBD/raid storage/NN/storage can/MD/can be/VB/be structured/VBN/structured in/IN/in a/DT/a variety/NN/variety of/IN/of ways/NNP/ways. for/IN/for example/NN/example /,/, a/DT/a system/NN/system can/MD/can have/VB/have disks/NNS/disks directly/RB/directly attached/VBD/attached to/TO/to its/PRP$/its buses/NNP/buses. in/IN/in this/DT/this case/NN/case /,/, the/DT/the operating/NN/operating system/NN/system or/CC/or system/NN/system software/NN/software can/MD/can implement/VB/implement raid/VBN/raid flmctionality/NNP/flmctionality. alternatively/RB/alternatively /,/, an/DT/an intelligent/NN/intelligent host/NN/host controller/NN/controller can/MD/can control/NN/control multiple/VB/multiple attached/VBN/attached disks/NNS/disks and/CC/and can/MD/can implement/VB/implement raid/VBN/raid on/IN/on those/DT/those disks/NNS/disks in/IN/in hardware/NNP/hardware. finally/RB/finally /,/, a/DT/a /,/, or/CC/or can/MD/can be/VB/be used/NNP/used. a/DT/a raid/NN/raid array/NN/array is/VBZ/is a/DT/a standalone/NN/standalone unit/NN/unit with/IN/with its/PRP$/its own/JJ/own controller/NN/controller /,/, cache/NN/cache /:/( usually/RB/usually /:/) /,/, and/CC/and disks/NNP/disks. it/PRP/it is/VBZ/is attached/VBN/attached to/TO/to the/DT/the host/NN/host via/IN/via one/CD/one or/CC/or more/JJR/more standard/JJ/standard ata/NNS/ata scsi/VBP/scsi or/CC/or fc/NN/fc controllers/NNP/controllers. this/DT/this common/JJ/common setup/NN/setup allows/VBZ/allows any/DT/any operating/NN/operating system/NN/system and/CC/and software/NN/software without/IN/without raid/NN/raid functionality/NN/functionality to/TO/to have/VB/have raid-protected/JJ/raid-protected disks/NNP/disks. it/PRP/it is/VBZ/is even/RB/even used/VBN/used on/IN/on systems/NNS/systems that/IN/that do/VBP/do have/VBP/have raid/VBN/raid software/NN/software layers/NNS/layers because/IN/because of/IN/of its/PRP$/its simplicity/NN/simplicity and/CC/and flexibility/NN/flexibility /./. disk/NN/disk will/MD/will fail/NNP/fail. suppose/VB/suppose that/IN/that the/DT/the of/IN/of a/DT/a single/JJ/single disk/NN/disk is/VBZ/is 100,000/CD/100,000 hours/NNP/hours. then/RB/then the/DT/the mean/NN/mean time/NN/time to/TO/to failure/VB/failure of/IN/of some/DT/some disk/NN/disk in/IN/in an/DT/an array/NN/array of/IN/of 100/CD/100 disks/NNS/disks will/MD/will be/VB/be 100,000/100/CD/100,000/100 =/CD/= 1,000/CD/1,000 hours/NNS/hours /,/, or/CC/or 41.66/CD/41.66 days/NNS/days /,/, which/WDT/which is/VBZ/is not/RB/not long/RB/long at/IN/at all/DT/all !/./! if/IN/if we/PRP/we store/VBP/store only/RB/only one/CD/one copy/NN/copy of/IN/of the/DT/the data/NNS/data /,/, then/RB/then each/DT/each disk/NN/disk failure/NN/failure will/MD/will result/VB/result in/IN/in loss/NN/loss of/IN/of a/DT/a significant/JJ/significant amount/NN/amount of/IN/of data/NNS/data -and/CC/-and such/JJ/such a/DT/a high/JJ/high rate/NN/rate of/IN/of data/NNS/data loss/NN/loss is/VBZ/is unacceptable/JJ/unacceptable /./. the/DT/the solution/NN/solution to/TO/to the/DT/the problem/NN/problem of/IN/of reliability/NN/reliability is/VBZ/is to/TO/to introduce/VB/introduce /,/, we/PRP/we store/VBP/store extra/JJ/extra information/NN/information that/WDT/that is/VBZ/is not/RB/not normally/RB/normally needed/VBN/needed but/CC/but that/IN/that can/MD/can be/VB/be used/VBN/used in/IN/in the/DT/the event/NN/event of/IN/of failure/NN/failure of/IN/of a/DT/a disk/NN/disk to/TO/to rebuild/VB/rebuild the/DT/the lost/JJS/lost information/NNP/information. thus/RB/thus /,/, even/RB/even if/IN/if a/DT/a disk/NN/disk fails/VBZ/fails /,/, data/NNS/data are/VBP/are not/RB/not lost/VBN/lost /./. the/DT/the simplest/JJS/simplest /:/( but/CC/but most/JJS/most expensive/JJ/expensive /NN/) approach/NN/approach to/TO/to introducing/VBG/introducing redundancy/NN/redundancy is/VBZ/is to/TO/to duplicate/VB/duplicate every/DT/every disk/NNP/disk. this/DT/this technique/NN/technique is/VBZ/is called/VBN/called with/IN/with mirroring/NN/mirroring /,/, a/DT/a logical/JJ/logical disk/NN/disk consists/NNS/consists of/IN/of two/CD/two physical/JJ/physical disks/NNS/disks /,/, and/CC/and every/DT/every write/NN/write is/VBZ/is carried/VBN/carried out/RP/out on/IN/on both/DT/both disks/NNP/disks. the/DT/the result/NN/result is/VBZ/is called/VBN/called a/DT/a mirrored/VBN/mirrored volume/NNP/volume. if/IN/if one/CD/one of/IN/of the/DT/the disks/NNS/disks in/IN/in the/DT/the volume/NN/volume fails/VBZ/fails /,/, the/DT/the data/NNS/data can/MD/can be/VB/be read/VBN/read from/IN/from the/DT/the other/NNP/other. data/NNS/data will/MD/will be/VB/be lost/VBN/lost only/RB/only if/IN/if the/DT/the second/JJ/second disk/NN/disk fails/NNS/fails before/IN/before the/DT/the first/JJ/first failed/VBD/failed disk/NN/disk is/VBZ/is replaced/VBN/replaced /./. the/DT/the mean/JJ/mean time/NN/time to/TO/to failure/VB/failure of/IN/of a/DT/a mirrored/VBN/mirrored volume-where/JJ/volume-where failure/NN/failure is/VBZ/is the/DT/the loss/NN/loss of/IN/of data/NNP/data- depends/NNS/depends on/IN/on two/CD/two factors/NNP/factors. one/CD/one is/VBZ/is the/DT/the mean/JJ/mean time/NN/time to/TO/to failure/VB/failure of/IN/of the/DT/the individual/JJ/individual disks/NNP/disks. the/DT/the other/JJ/other is/VBZ/is the/DT/the which/WDT/which is/VBZ/is the/DT/the time/NN/time it/PRP/it takes/VBZ/takes /:/( on/IN/on average/JJ/average /NN/) to/TO/to replace/VB/replace a/DT/a failed/VBN/failed disk/NN/disk and/CC/and to/TO/to restore/VB/restore the/DT/the data/NNS/data on/IN/on it/NNP/it. suppose/NN/suppose that/WDT/that the/DT/the failures/NNS/failures of/IN/of the/DT/the two/CD/two disks/NNS/disks are/VBP/are that/IN/that is/VBZ/is /,/, the/DT/the failure/NN/failure of/IN/of one/CD/one disk/NN/disk is/VBZ/is not/RB/not connected/VBN/connected to/TO/to the/DT/the failure/NN/failure of/IN/of the/DT/the other/NNP/other. then/RB/then /,/, if/IN/if the/DT/the mean/JJ/mean time/NN/time to/TO/to failure/VB/failure of/IN/of a/DT/a single/JJ/single disk/NN/disk is/VBZ/is 100,000/CD/100,000 hours/NNS/hours and/CC/and the/DT/the mean/JJ/mean time/NN/time to/TO/to repair/VB/repair is/VBZ/is 10/CD/10 hours/NNS/hours /,/, the/DT/the of/IN/of a/DT/a mirrored/VBN/mirrored disk/NN/disk system/NN/system is/VBZ/is 100/CD/100 /,/, 0002/CD/0002 //:// /CD/( 2/CD/2 10/CD/10 /CD/) =/CD/= 500/CD/500 106/CD/106 hours/NNS/hours /,/, or/CC/or 57,000/CD/57,000 years/NNS/years !/./! you/PRP/you should/MD/should be/VB/be aware/JJ/aware that/IN/that the/DT/the assumption/NN/assumption of/IN/of independence/NN/independence of/IN/of disk/NN/disk failures/NNS/failures is/VBZ/is not/RB/not valid/NNP/valid. power/NN/power failures/NNS/failures and/CC/and natural/JJ/natural disasters/NNS/disasters /,/, such/JJ/such as/IN/as earthquakes/NNS/earthquakes /,/, fires/NNS/fires /,/, and/CC/and floods/NNS/floods /,/, may/MD/may result/VB/result in/IN/in damage/NN/damage to/TO/to both/DT/both disks/NNS/disks at/IN/at the/DT/the same/JJ/same time/NNP/time. also/RB/also /,/, manufacturing/NN/manufacturing defects/NNS/defects in/IN/in a/DT/a batch/NN/batch of/IN/of disks/NNS/disks can/MD/can cause/VB/cause correlated/VBN/correlated failures/NNP/failures. as/IN/as disks/NNS/disks age/NN/age /,/, the/DT/the probability/NN/probability of/IN/of failure/NN/failure grows/VBZ/grows /,/, increasing/VBG/increasing the/DT/the chance/NN/chance that/IN/that a/DT/a second/JJ/second disk/NN/disk will/MD/will fail/VB/fail while/IN/while the/DT/the first/JJ/first is/VBZ/is being/VBG/being repaired/NNP/repaired. in/IN/in spite/NN/spite of/IN/of all/DT/all these/DT/these considerations/NNS/considerations /,/, however/RB/however /,/, n1.irrored-disk/JJ/n1.irrored-disk systems/NNS/systems offer/VBP/offer much/RB/much higher/JJR/higher reliability/NN/reliability than/IN/than do/VB/do singledisk/NN/singledisk systems/NNS/systems /./. power/NN/power failures/NNS/failures are/VBP/are a/DT/a particular/JJ/particular source/NN/source of/IN/of concern/NN/concern /,/, since/IN/since they/PRP/they occur/VBP/occur far/RB/far more/RBR/more frequently/RB/frequently than/IN/than do/VB/do natural/JJ/natural disasters/NNP/disasters. even/RB/even with/IN/with mirroring/VBG/mirroring of/IN/of disks/NNS/disks /,/, if/IN/if writes/NNS/writes are/VBP/are 524/CD/524 chapter/NN/chapter 12/CD/12 in/IN/in progress/NN/progress to/TO/to the/DT/the same/JJ/same block/NN/block in/IN/in both/DT/both disks/NNS/disks /,/, and/CC/and power/NN/power fails/NNS/fails before/IN/before both/DT/both blocks/NNS/blocks are/VBP/are fully/RB/fully written/VBN/written /,/, the/DT/the two/CD/two blocks/NNS/blocks can/MD/can be/VB/be in/IN/in an/DT/an inconsistent/NN/inconsistent state/NNP/state. one/CD/one solution/NN/solution to/TO/to this/DT/this is/VBZ/is to/TO/to write/VB/write one/CD/one copy/NN/copy first/RB/first then/RB/then the/DT/the next/NNP/next. another/DT/another is/VBZ/is to/TO/to add/VB/add a/DT/a cache/NN/cache to/TO/to the/DT/the raid/NN/raid array/NNP/array. this/DT/this write-back/NN/write-back cache/NN/cache is/VBZ/is protected/VBN/protected from/IN/from data/NNS/data loss/NN/loss during/IN/during power/NN/power failures/NNS/failures /,/, so/RB/so the/DT/the write/JJ/write can/NN/can be/VB/be considered/VBN/considered complete/JJ/complete at/IN/at that/DT/that point/NN/point /,/, assuming/VBG/assuming the/DT/the nvram/NN/nvram has/VBZ/has some/DT/some kind/NN/kind of/IN/of error/NN/error protection/NN/protection and/CC/and correction/NN/correction /,/, such/JJ/such as/IN/as ecc/NN/ecc or/CC/or mirroring/VBG/mirroring /./. 12.7.2/CD/12.7.2 improvement/NN/improvement in/IN/in performance/NN/performance via/IN/via parallelism/NN/parallelism now/RB/now let/VB/let 's/POS/'s consider/NN/consider how/WRB/how parallel/JJ/parallel access/NN/access to/TO/to multiple/VB/multiple disks/NNS/disks improves/NNS/improves performance/NN/performance /./. with/IN/with disk/NN/disk mirroring/VBG/mirroring /,/, the/DT/the rate/NN/rate at/IN/at which/WDT/which read/VB/read requests/NNS/requests can/MD/can be/VB/be handled/VBN/handled is/VBZ/is doubled/VBN/doubled /,/, since/IN/since read/NN/read requests/NNS/requests can/MD/can be/VB/be sent/VBN/sent to/TO/to either/DT/either disk/NN/disk /:/( as/IN/as long/RB/long as/IN/as both/DT/both disks/NNS/disks in/IN/in a/DT/a pair/NN/pair are/VBP/are functionat/RB/functionat as/IN/as is/VBZ/is almost/RB/almost always/RB/always the/DT/the case/NN/case /:/) /./. the/DT/the transfer/NN/transfer rate/NN/rate of/IN/of each/DT/each read/NN/read is/VBZ/is the/DT/the same/JJ/same as/IN/as in/IN/in a/DT/a single-disk/JJ/single-disk system/NN/system /,/, but/CC/but the/DT/the number/NN/number of/IN/of reads/NNS/reads per/IN/per unit/NN/unit time/NN/time has/VBZ/has doubled/VBN/doubled /./. with/IN/with multiple/NN/multiple disks/NNS/disks /,/, we/PRP/we can/MD/can improve/VB/improve the/DT/the transfer/NN/transfer rate/NN/rate as/IN/as well/RB/well /:/( or/CC/or instead/RB/instead /:/) by/IN/by striping/NN/striping data/NNS/data across/IN/across the/DT/the disks/NNP/disks. in/IN/in its/PRP$/its simplest/NN/simplest form/NN/form /,/, consists/VBZ/consists of/IN/of the/DT/the bits/NNS/bits of/IN/of each/DT/each byte/NN/byte across/IN/across multiple/NN/multiple disks/NNS/disks ;/:/; such/JJ/such striping/NN/striping is/VBZ/is called/VBN/called for/IN/for example/NN/example /,/, if/IN/if we/PRP/we have/VBP/have an/DT/an array/NN/array of/IN/of eight/CD/eight disks/NNS/disks /,/, we/PRP/we write/VBP/write bit/NN/bit i/PRP/i of/IN/of each/DT/each byte/NN/byte to/TO/to disk/VB/disk i/NNP/i. the/DT/the array/NN/array of/IN/of eight/CD/eight disks/NNS/disks can/MD/can be/VB/be treated/VBN/treated as/IN/as a/DT/a single/JJ/single disk/NN/disk with/IN/with sectors/NNS/sectors that/IN/that are/VBP/are eight/CD/eight times/NNS/times the/DT/the normal/JJ/normal size/NN/size and/CC/and /,/, more/RBR/more important/JJ/important that/IN/that have/VBP/have eight/CD/eight times/NNS/times the/DT/the access/NN/access rate/NNP/rate. in/IN/in such/JJ/such an/DT/an organization/NN/organization /,/, every/DT/every disk/NN/disk participates/VBZ/participates in/IN/in every/DT/every access/NN/access /:/( read/NN/read or/CC/or write/VB/write /CD/) ;/:/; so/RB/so the/DT/the number/NN/number of/IN/of accesses/NNS/accesses that/WDT/that can/MD/can be/VB/be processed/VBN/processed per/IN/per second/JJ/second is/VBZ/is about/IN/about the/DT/the same/JJ/same as/IN/as on/IN/on a/DT/a single/JJ/single disk/NN/disk /,/, but/CC/but each/DT/each access/NN/access can/MD/can read/VB/read eight/CD/eight times/NNS/times as/RB/as many/JJ/many data/NNS/data in/IN/in the/DT/the same/JJ/same time/NN/time as/IN/as on/IN/on a/DT/a single/JJ/single disk/NN/disk /./. bit-level/JJ/bit-level striping/NN/striping can/MD/can be/VB/be generalized/VBN/generalized to/TO/to include/VB/include a/DT/a number/NN/number of/IN/of disks/NNS/disks that/WDT/that either/DT/either is/VBZ/is a/DT/a multiple/NN/multiple of/IN/of 8/CD/8 or/CC/or divides/NNS/divides 8/CD/8. for/IN/for example/NN/example /,/, if/IN/if we/PRP/we use/VBP/use an/DT/an array/NN/array of/IN/of four/CD/four disks/NNS/disks /,/, bits/NNS/bits i/PRP/i and/CC/and 4/CD/4 +/CD/+ i/PRP/i of/IN/of each/DT/each go/NN/go to/TO/to disk/VB/disk i/NNP/i. further/RB/further /,/, striping/VBG/striping need/NN/need not/RB/not occur/VB/occur at/IN/at the/DT/the bit/NN/bit level/NNP/level. in/IN/in for/IN/for instance/NN/instance /,/, blocks/NNS/blocks of/IN/of a/DT/a file/NN/file are/VBP/are striped/VBN/striped across/IN/across multiple/JJ/multiple disks/NNS/disks ;/:/; with/IN/with n/NN/n disks/NNS/disks /,/, block/NN/block i/PRP/i of/IN/of a/DT/a file/NN/file goes/VBZ/goes to/TO/to disk/VB/disk /:/( i/PRP/i mod/VBP/mod n/JJ/n /NN/) +/:/+ 1/CD/1 /./. other/JJ/other levels/NNS/levels of/IN/of striping/VBG/striping /,/, such/JJ/such as/IN/as bytes/NNS/bytes of/IN/of a/DT/a sector/NN/sector or/CC/or sectors/NNS/sectors of/IN/of a/DT/a block/NN/block /,/, also/RB/also are/VBP/are possible/NNP/possible. block-level/NNP/block-level striping/NN/striping is/VBZ/is the/DT/the most/RBS/most common/JJ/common /./. parallelism/NN/parallelism in/IN/in a/DT/a disk/NN/disk system/NN/system /,/, as/IN/as achieved/VBN/achieved through/IN/through striping/NN/striping /,/, has/VBZ/has two/CD/two main/JJ/main goals/NNS/goals /:/: increase/NN/increase the/DT/the throughput/NN/throughput of/IN/of multiple/NN/multiple small/JJ/small accesses/NNS/accesses /:/( that/IN/that is/VBZ/is /,/, page/NN/page accesses/NNS/accesses /:/) by/IN/by load/NN/load balancing/VBG/balancing /./. reduce/NN/reduce the/DT/the response/NN/response time/NN/time of/IN/of large/JJ/large accesses/NNS/accesses /./. 12.7.3/CD/12.7.3 raid/VBD/raid levels/NNS/levels mirroring/VBG/mirroring provides/NNS/provides high/JJ/high reliability/NN/reliability /,/, but/CC/but it/PRP/it is/VBZ/is expensive/NNP/expensive. striping/NN/striping provides/VBZ/provides high/JJ/high data-transfer/JJ/data-transfer rates/NNS/rates /,/, but/CC/but it/PRP/it does/VBZ/does not/RB/not improve/VB/improve reliability/NNP/reliability. numerous/JJ/numerous schemes/NNS/schemes to/TO/to provide/VB/provide redundancy/NN/redundancy at/IN/at lower/JJR/lower cost/NN/cost by/IN/by using/VBG/using disk/NN/disk striping/VBG/striping combined/VBN/combined with/IN/with parity/NN/parity bits/NNS/bits /:/( which/WDT/which we/PRP/we describe/VBP/describe next/JJ/next /NN/) l1.ave/JJ/l1.ave been/NN/been proposed/NNP/proposed. these/DT/these schemes/NNS/schemes have/VBP/have different/JJ/different cost-performance/NN/cost-performance trade-offs/NNS/trade-offs and/CC/and are/VBP/are classified/VBN/classified according/VBG/according to/TO/to levels/NNS/levels called/VBN/called we/PRP/we describe/VBP/describe the/DT/the various/JJ/various levels/NNS/levels here/RB/here ;/:/; figure/NN/figure 12.11/CD/12.11 shows/NNS/shows them/PRP/them pictorially/RB/pictorially /VBP/( in/IN/in the/DT/the figure/NN/figure /,/, p/NN/p indicates/VBZ/indicates error-correcting/JJ/error-correcting bits/NNS/bits /,/, and/CC/and c/NN/c 12.7/CD/12.7 raid/VBD/raid structure/NN/structure 525/CD/525 /CD/( a/DT/a /NN/) raid/VBD/raid 0/-NONE-/0 /:/: non-redundant/JJ/non-redundant striping/NN/striping /./. /NN/( b/NN/b /:/) raid/VBD/raid 1/CD/1 /:/: mirrored/VBN/mirrored disks/NNS/disks /./. /:/( c/NN/c /:/) raid/VBD/raid 2/CD/2 /:/: memory-style/JJ/memory-style error-correcting/JJ/error-correcting codes/NNS/codes /./. /:/{ d/NN/d /:/) raid/VBD/raid 3/CD/3 /:/: bit-interleaved/JJ/bit-interleaved parity/NN/parity /./. /NN/( e/NN/e /:/) raid/VBD/raid 4/CD/4 /:/: block-interleaved/JJ/block-interleaved parity/NN/parity /./. /NN/{ f/NN/f /:/) raid/VBD/raid 5/CD/5 /:/: block-interleaved/JJ/block-interleaved distributed/VBN/distributed parity/NN/parity /./. /NN/( g/NN/g /:/) raid/VBD/raid 6/CD/6 /:/: p/NN/p +/:/+ q/NN/q redundancy/NN/redundancy /./. figure/NN/figure 12.11/CD/12.11 raid/VBD/raid levels/NNS/levels /./. indicates/NNS/indicates a/DT/a second/JJ/second copy/NNP/copy. of/IN/of the/DT/the data/NNS/data /:/) /./. in/IN/in all/DT/all cases/NNS/cases depicted/VBN/depicted in/IN/in the/DT/the figure/NN/figure /,/, four/CD/four disks/NNS/disks '/POS/' worth/NN/worth of/IN/of data/NNS/data are/VBP/are stored/VBN/stored /,/, and/CC/and the/DT/the extra/JJ/extra disks/NNS/disks are/VBP/are used/VBN/used to/TO/to store/VB/store redundant/JJ/redundant information/NN/information for/IN/for failure/NN/failure recovery/NN/recovery /./. raid/NN/raid level/NN/level 0/CD/0. raid/VBD/raid level/NN/level 0/-NONE-/0 refers/NNS/refers to/TO/to disk/VB/disk arrays/NNS/arrays with/IN/with striping/VBG/striping at/IN/at the/DT/the level/NN/level of/IN/of blocks/NNS/blocks but/CC/but without/IN/without any/DT/any redundancy/NN/redundancy /:/( such/JJ/such as/IN/as mirroring/NN/mirroring or/CC/or parity/NN/parity bits/NNS/bits /:/) /,/, as/IN/as shown/NN/shown in/IN/in figure/NN/figure 12.1l/CD/12.1l /CD/( a/DT/a /NN/) /./. raid/NN/raid ievell/NNP/ievell. raid/VBD/raid level1/NNP/level1 refers/NNS/refers to/TO/to disk/VB/disk mirroring/NNP/mirroring. figure/NN/figure 12.1l/CD/12.1l /CD/( b/NN/b /:/) shows/VBZ/shows a/DT/a mirrored/VBN/mirrored organization/NN/organization /./. '/''/' raid/VBD/raid level2/NNP/level2. raid/VBD/raid level2/NNP/level2 is/VBZ/is also/RB/also known/VBN/known as/IN/as memory-style/JJ/memory-style error-correctingcode/JJ/error-correctingcode /NN/( ecc/NN/ecc /:/) organization/NNP/organization. memory/NN/memory systems/NNS/systems have/VBP/have long/RB/long detected/VBN/detected certain/JJ/certain errors/NNS/errors by/IN/by using/VBG/using parity/NN/parity bits/NNP/bits. each/DT/each byte/NN/byte in/IN/in a/DT/a memory/NN/memory system/NN/system may/MD/may have/VB/have a/DT/a parity/NN/parity bit/NN/bit associated/VBN/associated with/IN/with it/PRP/it that/IN/that records/NNS/records whether/IN/whether the/DT/the number/NN/number of/IN/of bits/NNS/bits in/IN/in the/DT/the byte/NN/byte set/VBD/set to/TO/to 1/CD/1 is/VBZ/is even/RB/even /:/( parity/NN/parity =/:/= 0/-NONE-/0 /:/) or/CC/or odd/JJ/odd /NN/( parity/NN/parity =/:/= 1/CD/1 /CD/) /./. if/IN/if one/CD/one of/IN/of the/DT/the bits/NNS/bits in/IN/in the/DT/the 526/CD/526 chapter/NN/chapter 12/CD/12 byte/NN/byte is/VBZ/is damaged/VBN/damaged /-NONE-/( either/RB/either a/DT/a 1/CD/1 becomes/VBZ/becomes a/DT/a 0/-NONE-/0 /,/, or/CC/or a/DT/a 0/-NONE-/0 becomes/VBZ/becomes an/DT/an the/DT/the parity/NN/parity of/IN/of the/DT/the byte/NN/byte changes/NNS/changes and/CC/and thus/RB/thus does/VBZ/does not/RB/not match/VB/match the/DT/the stored/VBN/stored parity/NNP/parity. similarly/RB/similarly /,/, if/IN/if the/DT/the stored/VBN/stored parity/NN/parity bit/NN/bit is/VBZ/is damaged/VBN/damaged /,/, it/PRP/it does/VBZ/does not/RB/not match/VB/match the/DT/the computed/VBN/computed parity/NNP/parity. thus/RB/thus /,/, all/DT/all single-bit/JJ/single-bit errors/NNS/errors are/VBP/are detected/VBN/detected by/IN/by the/DT/the menwry/NN/menwry system/NN/system /:/.. error-correcting/JJ/error-correcting schemes/NNS/schemes store/VBP/store two/CD/two or/CC/or more/JJR/more extra/JJ/extra bits/NNS/bits and/CC/and can/MD/can reconstruct/VB/reconstruct the/DT/the data/NNS/data if/IN/if a/DT/a single/JJ/single bit/NN/bit is/VBZ/is damaged/NNP/damaged. the/DT/the idea/NN/idea of/IN/of ecc/NN/ecc can/MD/can be/VB/be used/VBN/used directly/RB/directly in/IN/in disk/NN/disk arrays/NNS/arrays via/IN/via striping/VBG/striping of/IN/of bytes/NNS/bytes across/IN/across disks/NNP/disks. for/IN/for example/NN/example /,/, the/DT/the first/JJ/first bit/NN/bit of/IN/of each/DT/each byte/NN/byte can/MD/can be/VB/be stored/VBN/stored in/IN/in disk/NN/disk 1/CD/1 /,/, the/DT/the second/JJ/second bit/NN/bit in/IN/in disk/NN/disk 2/CD/2 /,/, and/CC/and so/RB/so on/IN/on until/IN/until the/DT/the eighth/NN/eighth bit/NN/bit is/VBZ/is stored/VBN/stored in/IN/in disk/NN/disk 8/CD/8 ;/:/; the/DT/the error-correction/NN/error-correction bits/VBZ/bits are/VBP/are stored/VBN/stored in/IN/in further/JJ/further disks/NNP/disks. this/DT/this scheme/NN/scheme is/VBZ/is shown/VBN/shown pictorially/RB/pictorially in/IN/in figure/NN/figure 12.1l/CD/12.1l /CD/( c/NN/c /:/) /,/, where/WRB/where the/DT/the disks/NNS/disks labeled/VBD/labeled p/NN/p store/NN/store the/DT/the error-correction/NN/error-correction bits/NNP/bits. if/IN/if one/CD/one of/IN/of the/DT/the disks/NNS/disks fails/VBZ/fails /,/, the/DT/the remaining/VBG/remaining bits/NNS/bits of/IN/of the/DT/the byte/NN/byte and/CC/and the/DT/the associated/VBN/associated error-correction/NN/error-correction bits/NNS/bits can/MD/can be/VB/be read/VBN/read from/IN/from other/JJ/other disks/NNS/disks and/CC/and used/VBD/used to/TO/to reconstruct/VB/reconstruct the/DT/the damaged/JJ/damaged data/NNP/data. note/NN/note that/IN/that raid/NN/raid level/NN/level 2/CD/2 requires/NNS/requires only/RB/only three/CD/three disks/NNS/disks '/POS/' overhead/JJ/overhead for/IN/for four/CD/four disks/NNS/disks of/IN/of data/NNS/data /,/, unlike/IN/unlike raid/JJ/raid level/NN/level 1/CD/1 /,/, which/WDT/which requires/VBZ/requires four/CD/four disks/NNS/disks '/POS/' overhead/JJ/overhead /./. raid/NN/raid level/NN/level 3/CD/3. raid/VBD/raid level/NN/level 3/CD/3 /,/, or/CC/or improves/NNS/improves on/IN/on level/NN/level 2/CD/2 by/IN/by taking/NN/taking into/IN/into account/NN/account the/DT/the fact/NN/fact that/IN/that /,/, unlike/IN/unlike memory/NN/memory systems/NNS/systems /,/, disk/NN/disk controllers/NNS/controllers can/MD/can detect/VB/detect whether/IN/whether a/DT/a sector/NN/sector has/VBZ/has been/VBN/been read/VBN/read correctly/RB/correctly /,/, so/RB/so a/DT/a single/JJ/single parity/NN/parity bit/NN/bit can/MD/can be/VB/be used/VBN/used for/IN/for error/NN/error correction/NN/correction as/IN/as well/RB/well as/IN/as for/IN/for detection/NNP/detection. the/DT/the idea/NN/idea is/VBZ/is as/IN/as follows/NNS/follows /:/: if/IN/if one/CD/one of/IN/of the/DT/the sectors/NNS/sectors is/VBZ/is damaged/VBN/damaged /,/, we/PRP/we know/VBP/know exactly/RB/exactly which/WDT/which sector/NN/sector it/PRP/it is/VBZ/is /,/, and/CC/and we/PRP/we can/MD/can figure/VB/figure out/RP/out whether/IN/whether any/DT/any bit/NN/bit in/IN/in the/DT/the sector/NN/sector is/VBZ/is a/DT/a 1/CD/1 or/CC/or a/DT/a 0/-NONE-/0 by/IN/by computing/NN/computing the/DT/the parity/NN/parity of/IN/of the/DT/the corresponding/NN/corresponding bits/VBZ/bits from/IN/from sectors/NNS/sectors in/IN/in the/DT/the other/JJ/other disks/NNP/disks. if/IN/if the/DT/the parity/NN/parity of/IN/of the/DT/the remaining/VBG/remaining bits/NNS/bits is/VBZ/is equal/JJ/equal to/TO/to the/DT/the stored/VBN/stored parity/NN/parity /,/, the/DT/the missing/NN/missing bit/NN/bit is/VBZ/is 0/-NONE-/0 ;/:/; otherwise/NN/otherwise /,/, it/PRP/it is/VBZ/is 1/CD/1. raid/VBN/raid level3/NNP/level3 is/VBZ/is as/RB/as good/JJ/good as/IN/as level/NN/level 2/CD/2 but/CC/but is/VBZ/is less/JJR/less expensive/JJ/expensive in/IN/in the/DT/the number/NN/number of/IN/of extra/JJ/extra disks/NNS/disks required/VBN/required /-NONE-/( it/PRP/it has/VBZ/has only/RB/only a/DT/a one-disk/JJ/one-disk overhead/NN/overhead /:/) /,/, so/RB/so level/NN/level 2/CD/2 is/VBZ/is not/RB/not used/VBN/used in/IN/in practice/NNP/practice. this/DT/this scheme/NN/scheme is/VBZ/is shown/VBN/shown pictorially/RB/pictorially in/IN/in figure/NN/figure 12.1l/CD/12.1l /CD/( d/NN/d /:/) /./. raid/NN/raid level/NN/level 3/CD/3 has/VBZ/has two/CD/two advantages/NNS/advantages over/IN/over level/NN/level 1/CD/1. first/JJ/first /,/, the/DT/the storage/NN/storage overhead/NN/overhead is/VBZ/is reduced/VBN/reduced because/IN/because only/RB/only one/CD/one parity/NN/parity disk/NN/disk is/VBZ/is needed/VBN/needed for/IN/for several/JJ/several regular/JJ/regular disks/NNS/disks /,/, whereas/IN/whereas one/CD/one mirror/NN/mirror disk/NN/disk is/VBZ/is needed/VBN/needed for/IN/for every/DT/every disk/NN/disk in/IN/in level1/NNP/level1. second/JJ/second /,/, since/IN/since reads/NNS/reads and/CC/and writes/NNS/writes of/IN/of a/DT/a byte/NN/byte are/VBP/are spread/VBN/spread out/RP/out over/IN/over multiple/NNS/multiple disks/NNS/disks with/IN/with n-way/JJ/n-way striping/NN/striping of/IN/of data/NNS/data /,/, the/DT/the transfer/NN/transfer rate/NN/rate for/IN/for reading/NN/reading or/CC/or writing/VBG/writing a/DT/a single/JJ/single block/NN/block is/VBZ/is n/VBN/n times/NNS/times as/RB/as fast/JJ/fast as/IN/as with/IN/with raid/JJ/raid level/NN/level 1/CD/1. on/IN/on the/DT/the negative/JJ/negative side/NN/side /,/, raid/VBD/raid level3/NNP/level3 supports/NNS/supports fewer/JJR/fewer l/os/NNS/l/os per/IN/per second/JJ/second /,/, since/IN/since every/DT/every disk/NN/disk has/VBZ/has to/TO/to participate/VB/participate in/IN/in every/DT/every i/0/NN/i/0 request/NN/request /./. a/DT/a further/JJ/further performance/NN/performance problem/NN/problem with/IN/with raid/JJ/raid 3-and/CD/3-and with/IN/with all/DT/all paritybased/VBN/paritybased raid/VBN/raid levels-is/-NONE-/levels-is the/DT/the expense/NN/expense of/IN/of computing/NN/computing and/CC/and writing/VBG/writing the/DT/the parity/NN/parity /./. this/DT/this overhead/NN/overhead results/NNS/results in/IN/in significantly/RB/significantly slower/JJR/slower writes/NNS/writes than/IN/than with/IN/with non-parity/JJ/non-parity raid/NN/raid arrays/NNP/arrays. to/TO/to moderate/VB/moderate this/DT/this performance/NN/performance penalty/NN/penalty /,/, many/JJ/many raid/VBD/raid storage/NN/storage arrays/NNS/arrays include/VBP/include a/DT/a hardware/NN/hardware controller/NN/controller with/IN/with dedicated/JJ/dedicated parity/NN/parity hardware/NNP/hardware. this/DT/this controller/NN/controller offloads/NNS/offloads the/DT/the parity/NN/parity computation/NN/computation from/IN/from the/DT/the cpu/NN/cpu to/TO/to the/DT/the array/NNP/array. the/DT/the array/NN/array has/VBZ/has an/DT/an nvram/NN/nvram cache/NN/cache as/IN/as well/RB/well /,/, to/TO/to store/VB/store the/DT/the blocks/NNS/blocks while/IN/while the/DT/the parity/NN/parity is/VBZ/is computed/VBN/computed and/CC/and to/TO/to buffer/VB/buffer the/DT/the writes/NNS/writes from/IN/from the/DT/the controller/NN/controller to/TO/to the/DT/the spindles/NNP/spindles. this/DT/this combination/NN/combination can/MD/can make/VB/make parity/NN/parity raid/VBN/raid almost/RB/almost as/IN/as fast/JJ/fast as/IN/as non-parity/NNP/non-parity. in/IN/in fact/NN/fact /,/, a/DT/a caching/NN/caching array/NN/array doing/VBG/doing parity/NN/parity raid/VBD/raid can/MD/can outperform/VB/outperform a/DT/a non-caching/JJ/non-caching non-parity/NN/non-parity raid/VBD/raid /./. raid/VBN/raid level/NN/level 4/CD/4. raid/VBD/raid level4/NNP/level4 /,/, or/CC/or uses/NNS/uses block-level/JJ/block-level striping/NN/striping /,/, as/IN/as in/IN/in raid/NN/raid 0/-NONE-/0 /,/, and/CC/and in/IN/in addition/NN/addition keeps/NNS/keeps a/DT/a parity/NN/parity block/NN/block on/IN/on a/DT/a separate/JJ/separate disk/NN/disk for/IN/for corresponding/NN/corresponding blocks/NNS/blocks from/IN/from n/NN/n other/JJ/other disks/NNP/disks. this/DT/this scheme/NN/scheme is/VBZ/is 12.7/CD/12.7 527/CD/527 diagramed/VBN/diagramed in/IN/in figure/NN/figure 12.1l/CD/12.1l /CD/( e/NN/e /:/) /./. if/IN/if one/CD/one of/IN/of the/DT/the disks/NNS/disks fails/VBZ/fails /,/, the/DT/the parity/NN/parity block/NN/block can/MD/can be/VB/be used/VBN/used with/IN/with the/DT/the corresponding/VBG/corresponding blocks/NNS/blocks from/IN/from the/DT/the other/JJ/other disks/NNS/disks to/TO/to restore/VB/restore the/DT/the blocks/NNS/blocks of/IN/of the/DT/the failed/VBN/failed disk/NN/disk /./. a/DT/a block/NN/block read/NN/read accesses/NNS/accesses only/RB/only one/CD/one disk/NN/disk /,/, allowing/VBG/allowing other/JJ/other requests/NNS/requests to/TO/to be/VB/be processed/VBN/processed by/IN/by the/DT/the other/JJ/other disks/NNP/disks. thus/RB/thus /,/, the/DT/the data-transfer/JJ/data-transfer rate/NN/rate for/IN/for each/DT/each access/NN/access is/VBZ/is slowe1/NNP/slowe1 ~/:/~ but/CC/but multiple/NN/multiple read/VBD/read accesses/NNS/accesses can/MD/can proceed/VB/proceed in/IN/in parallel/NN/parallel /,/, leading/VBG/leading to/TO/to a/DT/a higher/JJR/higher overall/JJ/overall i/0/-NONE-/i/0 rate/NNP/rate. the/DT/the transfer/NN/transfer rates/NNS/rates for/IN/for large/JJ/large reads/NNS/reads are/VBP/are high/JJ/high /,/, since/IN/since all/DT/all the/DT/the disks/NNS/disks can/MD/can be/VB/be read/VBN/read in/IN/in parallel/NN/parallel ;/:/; large/JJ/large writes/NNS/writes also/RB/also have/VBP/have high/JJ/high transfer/NN/transfer rates/NNS/rates /,/, since/IN/since the/DT/the data/NNS/data and/CC/and parity/NN/parity can/MD/can be/VB/be written/VBN/written in/IN/in parallel/NN/parallel /./. small/JJ/small independent/NN/independent writes/VBZ/writes can/MD/can not/RB/not be/VB/be performed/VBN/performed in/IN/in parallel/NNP/parallel. an/DT/an operatingsystem/NN/operatingsystem write/NN/write of/IN/of data/NNS/data smaller/JJR/smaller than/IN/than a/DT/a block/NN/block requires/VBZ/requires that/IN/that the/DT/the block/NN/block be/VB/be read/VBN/read /,/, modified/VBN/modified with/IN/with the/DT/the new/JJ/new data/NNS/data /,/, and/CC/and written/VBN/written back/RP/back the/DT/the parity/NN/parity block/NN/block has/VBZ/has to/TO/to be/VB/be updated/VBN/updated as/IN/as well/NNP/well. this/DT/this is/VBZ/is known/VBN/known as/IN/as the/DT/the syti/NN/syti /:/: .e/JJ/.e /./. thus/RB/thus /,/, a/DT/a single/JJ/single write/NN/write requires/VBZ/requires four/CD/four disk/NN/disk accesses/NNS/accesses /:/: two/CD/two to/TO/to read/VB/read the/DT/the two/CD/two old/JJ/old blocks/NNS/blocks and/CC/and two/CD/two to/TO/to write/VB/write the/DT/the two/CD/two new/JJ/new blocks/NNS/blocks /./. wafl/NN/wafl /:/( chapter/NN/chapter 11/CD/11 /CD/) uses/NNS/uses raid/VBD/raid level4/NNP/level4 because/IN/because this/DT/this raid/NN/raid level/NN/level allows/VBZ/allows disks/NNS/disks to/TO/to be/VB/be added/VBN/added to/TO/to a/DT/a raid/NN/raid set/NN/set seamlessly/NNP/seamlessly. if/IN/if the/DT/the added/VBN/added disks/NNS/disks are/VBP/are initialized/VBN/initialized with/IN/with blocks/NNS/blocks containing/VBG/containing all/DT/all zeros/NNS/zeros /,/, then/RB/then the/DT/the parity/NN/parity value/NN/value does/VBZ/does not/RB/not change/VB/change /,/, and/CC/and the/DT/the raid/NN/raid set/VBD/set is/VBZ/is still/RB/still correct/JJ/correct /./. raid/NN/raid levels/NNP/levels. raid/VBD/raid levels/NNS/levels /,/, or/CC/or /,/, differs/NNS/differs from/IN/from level/NN/level 4/CD/4 by/IN/by spreading/NN/spreading data/NNS/data and/CC/and parity/NN/parity among/IN/among all/DT/all n/NN/n +/:/+ 1/CD/1 disks/NNS/disks /,/, rather/RB/rather than/IN/than storing/VBG/storing data/NNS/data in/IN/in n/NN/n disks/NNS/disks and/CC/and parity/NN/parity in/IN/in one/CD/one disk/NNP/disk. for/IN/for each/DT/each block/NN/block /,/, one/CD/one of/IN/of the/DT/the disks/NNS/disks stores/NNS/stores the/DT/the parity/NN/parity /,/, and/CC/and the/DT/the others/NNS/others store/VBP/store data/NNP/data. for/IN/for example/NN/example /,/, with/IN/with an/DT/an array/NN/array of/IN/of five/CD/five disks/NNS/disks /,/, the/DT/the parity/NN/parity for/IN/for the/DT/the nth/NN/nth block/NN/block is/VBZ/is stored/VBN/stored in/IN/in disk/NN/disk /:/( n/NN/n mod/NN/mod 5/CD/5 /CD/) +/CD/+ 1/CD/1 ;/:/; the/DT/the nth/NN/nth blocks/NNS/blocks of/IN/of the/DT/the other/JJ/other four/CD/four disks/NNS/disks store/RBR/store actual/JJ/actual data/NNS/data for/IN/for that/DT/that block/NN/block this/DT/this setup/NN/setup is/VBZ/is shown/VBN/shown in/IN/in figure/NN/figure 12.11/CD/12.11 /CD/( f/NN/f /:/) /,/, where/WRB/where the/DT/the ps/NNS/ps are/VBP/are distributed/VBN/distributed across/IN/across all/DT/all the/DT/the disks/NNP/disks. a/DT/a parity/NN/parity block/NN/block can/MD/can not/RB/not store/VB/store parity/NN/parity for/IN/for blocks/NNS/blocks in/IN/in the/DT/the same/JJ/same disk/NN/disk /,/, because/IN/because a/DT/a disk/NN/disk failure/NN/failure would/MD/would result/VB/result in/IN/in loss/NN/loss of/IN/of data/NNS/data as/IN/as well/RB/well as/IN/as of/IN/of parity/NN/parity /,/, and/CC/and hence/NN/hence the/DT/the loss/NN/loss would/MD/would not/RB/not be/VB/be recoverable/NNP/recoverable. by/IN/by spreading/NN/spreading the/DT/the parity/NN/parity across/IN/across all/DT/all the/DT/the disks/NNS/disks in/IN/in the/DT/the set/NN/set /,/, raid/VBD/raid 5/CD/5 avoids/NNS/avoids potential/JJ/potential overuse/NN/overuse of/IN/of a/DT/a single/JJ/single parity/NN/parity disk/NN/disk /,/, which/WDT/which can/MD/can occur/VB/occur with/IN/with raid/JJ/raid 4/CD/4. raid/NN/raid 5/CD/5 is/VBZ/is the/DT/the most/RBS/most common/JJ/common parity/NN/parity raid/VBD/raid system/NN/system /./. raid/NN/raid level/NN/level 6/CD/6. raid/VBD/raid level/NN/level 6/CD/6 /,/, also/RB/also called/VBN/called the/DT/the is/VBZ/is much/JJ/much like/IN/like raid/NN/raid level/NN/level 5/CD/5 but/CC/but stores/NNS/stores extra/VBP/extra redundant/JJ/redundant information/NN/information to/TO/to guard/VB/guard against/IN/against disk/NN/disk failures/NNP/failures. instead/RB/instead of/IN/of parity/NN/parity /,/, error-correcting/JJ/error-correcting codes/NNS/codes such/JJ/such as/IN/as the/DT/the are/VBP/are used/NNP/used. in/IN/in the/DT/the scheme/NN/scheme shown/NN/shown in/IN/in figure/NN/figure 12.11/CD/12.11 /CD/( g/NN/g /:/) /,/, 2/CD/2 bits/NNS/bits of/IN/of redundant/JJ/redundant data/NNS/data are/VBP/are stored/VBN/stored for/IN/for every/DT/every 4/CD/4 bits/NNS/bits of/IN/of datacompared/VBN/datacompared with/IN/with 1/CD/1 parity/NN/parity bit/NN/bit in/IN/in level/NN/level 5-and/CD/5-and the/DT/the system/NN/system can/MD/can tolerate/VB/tolerate two/CD/two disk/NN/disk failures/NNS/failures /./. raid/NN/raid levels/NNS/levels 0/-NONE-/0 +/:/+ 1/LS/1 and/CC/and 1/CD/1 +/CD/+ 0/CD/0. raid/NN/raid level/NN/level 0/-NONE-/0 +/./+ 1/CD/1 refers/NNS/refers to/TO/to a/DT/a combination/NN/combination of/IN/of raid/NN/raid levels/NNS/levels 0/-NONE-/0 and/CC/and 1/CD/1. raid/VBD/raid 0/-NONE-/0 provides/VBZ/provides the/DT/the performance/NN/performance /,/, while/IN/while raid/JJ/raid 1/CD/1 provides/NNS/provides the/DT/the reliability/NNP/reliability. generally/RB/generally /,/, this/DT/this level/NN/level provides/VBZ/provides better/JJR/better performance/NN/performance than/IN/than raid/NN/raid 5/CD/5. it/PRP/it is/VBZ/is common/JJ/common in/IN/in enviromnents/NNS/enviromnents where/WRB/where both/DT/both performance/NN/performance and/CC/and reliability/NN/reliability are/VBP/are important/NNP/important. unfortunately/RB/unfortunately /,/, like/IN/like raid/NN/raid 1/CD/1 /,/, it/PRP/it doubles/VBZ/doubles the/DT/the number/NN/number of/IN/of disks/NNS/disks needed/VBN/needed for/IN/for storage/NN/storage /,/, so/RB/so it/PRP/it is/VBZ/is also/RB/also relatively/RB/relatively expensive/NNP/expensive. in/IN/in raid/NN/raid 0/-NONE-/0 +/./+ 1/CD/1 /,/, a/DT/a set/NN/set of/IN/of disks/NNS/disks are/VBP/are striped/VBN/striped /,/, and/CC/and then/RB/then the/DT/the stripe/NN/stripe is/VBZ/is mirrored/VBN/mirrored to/TO/to another/DT/another /,/, equivalent/NN/equivalent stripe/NN/stripe /./. 528/CD/528 chapter/NN/chapter 12/CD/12 stripe/NN/stripe a/DT/a /NN/) raid/VBD/raid 0/-NONE-/0 +/:/+ 1/LS/1 with/IN/with a/DT/a single/JJ/single disk/NN/disk failure/NN/failure /./. ua/NN/ua mirror/NN/mirror b/NN/b /:/) raid/VBD/raid 1/CD/1 +/CD/+ 0/-NONE-/0 with/IN/with a/DT/a single/JJ/single disk/NN/disk failure/NN/failure /./. figure/NN/figure 12.12/CD/12.12 raid/VBD/raid 0/-NONE-/0 +/:/+ 1/LS/1 and/CC/and 1/CD/1 +/CD/+ 0/-NONE-/0 /./. another/DT/another raid/NN/raid option/NN/option that/WDT/that is/VBZ/is becoming/VBG/becoming available/JJ/available commercially/RB/commercially is/VBZ/is raid/VBN/raid level/NN/level 1/CD/1 +/CD/+ 0/-NONE-/0 /,/, in/IN/in which/WDT/which disks/NNS/disks are/VBP/are mirrored/VBN/mirrored in/IN/in pairs/NNS/pairs and/CC/and then/RB/then the/DT/the resulti.j.l.g/JJ/resulti.j.l.g mirrored/VBN/mirrored pairs/NNS/pairs are/VBP/are striped/NNP/striped. this/DT/this scheme/NN/scheme has/VBZ/has some/DT/some theoretical/JJ/theoretical advantages/NNS/advantages over/IN/over raid/JJ/raid 0/-NONE-/0 +/:/+ 1/CD/1. for/IN/for example/NN/example /,/, if/IN/if a/DT/a single/JJ/single disk/NN/disk fails/NNS/fails in/IN/in raid/NN/raid 0/-NONE-/0 +/./+ 1/CD/1 /,/, an/DT/an entire/JJ/entire stripe/NN/stripe is/VBZ/is inaccessible/JJ/inaccessible /,/, leaving/VBG/leaving only/RB/only the/DT/the other/JJ/other stripe/NN/stripe available/NNP/available. with/IN/with a/DT/a failure/NN/failure in/IN/in raid/NN/raid 1/CD/1 +/CD/+ 0/-NONE-/0 /,/, a/DT/a single/JJ/single disk/NN/disk is/VBZ/is unavailable/JJ/unavailable /,/, but/CC/but the/DT/the disk/NN/disk that/IN/that mirrors/NNS/mirrors it/PRP/it is/VBZ/is still/RB/still available/JJ/available /,/, as/IN/as are/VBP/are all/DT/all the/DT/the rest/NN/rest of/IN/of the/DT/the disks/NNS/disks /:/( figure/NN/figure 12.12/CD/12.12 /CD/) /./. numerous/JJ/numerous variations/NNS/variations have/VBP/have been/VBN/been proposed/VBN/proposed to/TO/to the/DT/the basic/JJ/basic raid/NN/raid schemes/NNS/schemes described/VBD/described here/NNP/here. as/IN/as a/DT/a result/NN/result /,/, some/DT/some confusion/NN/confusion may/MD/may exist/VB/exist about/IN/about the/DT/the exact/JJ/exact definitions/NNS/definitions of/IN/of the/DT/the different/JJ/different raid/NN/raid levels/NNS/levels /./. the/DT/the implementation/NN/implementation of/IN/of raid/NN/raid is/VBZ/is another/DT/another area/NN/area of/IN/of variation/NNP/variation. consider/NN/consider the/DT/the following/VBG/following layers/NNS/layers at/IN/at which/WDT/which raid/VBN/raid can/MD/can be/VB/be implemented/VBN/implemented /./. volume-management/JJ/volume-management software/NN/software can/MD/can implement/VB/implement raid/VBN/raid within/IN/within the/DT/the kernel/NN/kernel or/CC/or at/IN/at the/DT/the system/NN/system software/NN/software layer/NNP/layer. in/IN/in this/DT/this case/NN/case /,/, the/DT/the storage/NN/storage hardware/NN/hardware can/MD/can provide/VB/provide a/DT/a minimum/JJ/minimum of/IN/of features/NNS/features and/CC/and still/RB/still be/VB/be part/NN/part of/IN/of a/DT/a full/JJ/full raid/NN/raid solution/NNP/solution. parity/NN/parity raid/VBD/raid is/VBZ/is fairly/RB/fairly slow/JJ/slow when/WRB/when implemented/VBN/implemented in/IN/in software/NN/software /,/, so/RB/so typically/RB/typically raid/VBN/raid 0/-NONE-/0 /,/, 1/CD/1 /,/, or/CC/or 0/-NONE-/0 +/:/+ 1/LS/1 is/VBZ/is used/VBN/used /./. raid/VBN/raid can/MD/can be/VB/be implemented/VBN/implemented in/IN/in the/DT/the host/NN/host bus-adapter/NN/bus-adapter /:/( hba/NN/hba /:/) hardware/NNP/hardware. only/RB/only the/DT/the disks/NNS/disks directly/RB/directly connected/VBN/connected to/TO/to the/DT/the hba/NN/hba can/MD/can be/VB/be part/NN/part of/IN/of a/DT/a given/VBN/given raid/NN/raid set/NN/set /./. this/DT/this solution/NN/solution is/VBZ/is low/JJ/low in/IN/in cost/NN/cost but/CC/but not/RB/not very/RB/very flexible/JJ/flexible /./. 12.7/CD/12.7 529/CD/529 raid/NN/raid can/MD/can be/VB/be implemented/VBN/implemented in/IN/in the/DT/the hardware/NN/hardware of/IN/of the/DT/the storage/NN/storage array/NNP/array. the/DT/the storage/NN/storage array/NN/array can/MD/can create/VB/create raid/VBN/raid sets/NNS/sets of/IN/of various/JJ/various levels/NNS/levels and/CC/and can/MD/can even/RB/even slice/VB/slice these/DT/these sets/NNS/sets into/IN/into smaller/JJR/smaller volumes/NNS/volumes /,/, which/WDT/which are/VBP/are then/RB/then presented/VBN/presented to/TO/to the/DT/the operating/NN/operating system/NN/system /./. the/DT/the operating/NN/operating system/NN/system need/NN/need only/RB/only implement/JJ/implement the/DT/the file/NN/file system/NN/system on/IN/on each/DT/each of/IN/of the/DT/the volumes/NNP/volumes. arrays/VBZ/arrays can/MD/can have/VB/have multiple/NNS/multiple connections/NNS/connections available/JJ/available or/CC/or can/MD/can be/VB/be part/NN/part of/IN/of a/DT/a san/NN/san /,/, allowing/VBG/allowing multiple/NN/multiple hosts/NNS/hosts to/TO/to take/VB/take advantage/NN/advantage of/IN/of the/DT/the array/NN/array 's/POS/'s features/NNS/features /./. raid/NN/raid can/MD/can be/VB/be implemented/VBN/implemented in/IN/in the/DT/the san/NN/san interconnect/NN/interconnect layer/NN/layer by/IN/by disk/NN/disk virtualization/NN/virtualization devices/NNP/devices. in/IN/in this/DT/this case/NN/case /,/, a/DT/a device/NN/device sits/VBZ/sits between/IN/between the/DT/the hosts/NNS/hosts and/CC/and the/DT/the storage/NN/storage /./. it/PRP/it accepts/VBZ/accepts commands/NNS/commands from/IN/from the/DT/the servers/NNS/servers and/CC/and manages/NNS/manages access/NN/access to/TO/to the/DT/the storage/NN/storage /./. it/PRP/it could/MD/could provide/VB/provide mirroring/JJ/mirroring /,/, for/IN/for example/NN/example /,/, by/IN/by writing/NN/writing each/DT/each block/NN/block to/TO/to two/CD/two separate/JJ/separate storage/NN/storage devices/NNS/devices /./. other/JJ/other features/NNS/features /,/, such/JJ/such as/IN/as and/CC/and replication/NN/replication /,/, can/MD/can be/VB/be implemented/VBN/implemented at/IN/at each/DT/each of/IN/of these/DT/these levels/NNS/levels as/IN/as well/NNP/well. involves/NNS/involves the/DT/the automatic/JJ/automatic duplication/NN/duplication of/IN/of writes/NNS/writes between/IN/between separate/JJ/separate sites/NNS/sites for/IN/for redundancy/NN/redundancy and/CC/and disaster/NN/disaster recovery/NNP/recovery. replication/NN/replication can/MD/can be/VB/be synchronous/JJ/synchronous or/CC/or asynchronous/NNP/asynchronous. in/IN/in synchronous/JJ/synchronous replication/NN/replication /,/, each/DT/each block/NN/block must/MD/must be/VB/be written/VBN/written locally/RB/locally and/CC/and remotely/RB/remotely before/IN/before the/DT/the write/JJ/write is/VBZ/is considered/VBN/considered complete/JJ/complete /,/, whereas/NNS/whereas in/IN/in asynchronous/JJ/asynchronous replication/NN/replication /,/, the/DT/the writes/NNS/writes are/VBP/are grouped/VBN/grouped together/RB/together and/CC/and written/VBN/written periodically/NNP/periodically. asynchronous/JJ/asynchronous replication/NN/replication can/MD/can result/VB/result in/IN/in data/NN/data loss/NN/loss if/IN/if the/DT/the primary/JJ/primary site/NN/site fails/NNS/fails /,/, but/CC/but it/PRP/it is/VBZ/is faster/JJR/faster and/CC/and has/VBZ/has no/DT/no distance/NN/distance limitations/NNS/limitations /./. the/DT/the implementation/NN/implementation of/IN/of these/DT/these features/NNS/features differs/NNS/differs depending/VBG/depending on/IN/on the/DT/the layer/NN/layer at/IN/at which/WDT/which raid/VBN/raid is/VBZ/is implemented/NNP/implemented. for/IN/for example/NN/example /,/, if/IN/if raid/JJ/raid is/VBZ/is implemented/VBN/implemented in/IN/in software/NN/software /,/, then/RB/then each/DT/each host/NN/host may/MD/may need/VB/need to/TO/to carry/VB/carry out/RP/out and/CC/and manage/NN/manage its/PRP$/its own/JJ/own replication/NNP/replication. if/IN/if replication/NN/replication is/VBZ/is implemented/VBN/implemented in/IN/in the/DT/the storage/NN/storage array/NN/array or/CC/or in/IN/in the/DT/the san/NN/san intercom1ect/NNP/intercom1ect /,/, however/RB/however /,/, then/RB/then whatever/RB/whatever the/DT/the host/NN/host operating/NN/operating system/NN/system or/CC/or its/PRP$/its features/NNS/features /,/, the/DT/the host/NN/host 's/POS/'s data/NNS/data can/MD/can be/VB/be replicated/VBN/replicated /./. one/CD/one other/JJ/other aspect/NN/aspect of/IN/of most/JJS/most raid/JJ/raid implementations/NNS/implementations is/VBZ/is a/DT/a hot/JJ/hot spare/NN/spare disk/NN/disk or/CC/or disks/NNS/disks /./. a/DT/a is/VBZ/is not/RB/not used/VBN/used for/IN/for data/NNS/data but/CC/but is/VBZ/is configured/VBN/configured to/TO/to be/VB/be used/VBN/used as/IN/as a/DT/a replacement/NN/replacement in/IN/in case/NN/case disk/NN/disk failure/NNP/failure. for/IN/for instance/NN/instance /,/, a/DT/a hot/JJ/hot spare/NN/spare can/MD/can be/VB/be used/VBN/used to/TO/to rebuild/VB/rebuild a/DT/a mirrored/VBN/mirrored pair/NN/pair should/MD/should one/CD/one of/IN/of the/DT/the disks/NNS/disks in/IN/in the/DT/the pair/NN/pair fail/NNP/fail. in/IN/in this/DT/this way/NN/way /,/, the/DT/the raid/NN/raid level/NN/level can/MD/can be/VB/be reestablished/VBN/reestablished automatically/RB/automatically /,/, without/IN/without waiting/VBG/waiting for/IN/for the/DT/the failed/VBN/failed disk/NN/disk to/TO/to be/VB/be replaced/VBN/replaced /./. allocating/NN/allocating more/JJR/more than/IN/than one/CD/one hot/JJ/hot spare/NN/spare allows/VBZ/allows more/JJR/more than/IN/than one/CD/one failure/NN/failure to/TO/to be/VB/be repaired/VBN/repaired without/IN/without human/JJ/human intervention/NN/intervention /./. 12.7.4/CD/12.7.4 selecting/VBG/selecting a/DT/a raid/NN/raid level/NN/level given/VBN/given the/DT/the many/JJ/many choices/NNS/choices they/PRP/they have/VBP/have /,/, how/WRB/how do/VBP/do system/NN/system designers/NNS/designers choose/VBP/choose a/DT/a raid/NN/raid level/NN/level one/CD/one consideration/NN/consideration is/VBZ/is rebuild/VBN/rebuild performance/-NONE-/performance. if/IN/if a/DT/a disk/NN/disk fails/VBZ/fails /,/, the/DT/the time/NN/time needed/VBN/needed to/TO/to rebuild/VB/rebuild its/PRP$/its data/NNS/data can/MD/can be/VB/be significant/NNP/significant. this/DT/this may/MD/may be/VB/be an/DT/an important/JJ/important factor/NN/factor if/IN/if a/DT/a continuous/JJ/continuous supply/NN/supply of/IN/of data/NNS/data is/VBZ/is required/VBN/required /,/, as/IN/as it/PRP/it is/VBZ/is in/IN/in high-performance/NN/high-performance or/CC/or interactive/JJ/interactive database/NN/database systems/NNP/systems. furthermore/NN/furthermore /,/, rebuild/NN/rebuild performance/NN/performance influences/NNS/influences the/DT/the mean/JJ/mean time/NN/time to/TO/to failure/VB/failure /./. rebuild/NN/rebuild performance/NN/performance varies/NNS/varies with/IN/with the/DT/the raid/JJ/raid level/NN/level used/NNP/used. rebuilding/NN/rebuilding is/VBZ/is easiest/VBN/easiest or/CC/or raid/VBN/raid level1/NNP/level1 /,/, since/IN/since data/NNS/data can/MD/can be/VB/be copied/VBN/copied from/IN/from another/DT/another disk/NN/disk ;/:/; for/IN/for the/DT/the other/JJ/other levels/NNS/levels /,/, we/PRP/we need/VBP/need to/TO/to access/NN/access all/DT/all the/DT/the other/JJ/other disks/NNS/disks in/IN/in the/DT/the array/NN/array to/TO/to rebuild/VB/rebuild data/NNS/data in/IN/in a/DT/a failed/VBN/failed disk/NN/disk /./. rebuild/NN/rebuild times/NNS/times can/MD/can be/VB/be hours/NNS/hours for/IN/for raid/JJ/raid 5/CD/5 rebuilds/NNS/rebuilds of/IN/of large/JJ/large disk/NN/disk sets/NNS/sets /./. raid/NN/raid level/NN/level 0/-NONE-/0 is/VBZ/is used/VBN/used in/IN/in high-performance/NN/high-performance applications/NNS/applications where/WRB/where data/NNS/data loss/VBP/loss is/VBZ/is not/RB/not critical/NNP/critical. raid/VBD/raid level1/NNP/level1 is/VBZ/is popular/JJ/popular for/IN/for applications/NNS/applications that/WDT/that require/NN/require high/RB/high reliability/NN/reliability with/IN/with fast/JJ/fast recovery/NNP/recovery. raid/VBD/raid 0/-NONE-/0 +/:/+ 1/LS/1 and/CC/and 1/CD/1 +/CD/+ 0/-NONE-/0 are/VBP/are used/VBN/used where/WRB/where both/DT/both performance/NN/performance and/CC/and reliability/NN/reliability are/VBP/are important-for/JJ/important-for example/NN/example /,/, for/IN/for small/JJ/small databases/NNP/databases. due/JJ/due to/TO/to raid/VB/raid 1/CD/1 's/POS/'s 530/CD/530 chapter/NN/chapter 12/CD/12 the/DT/the inserv/NN/inserv storage/NN/storage array/NN/array im1ovation/NN/im1ovation /,/, in/IN/in an/DT/an effort/NN/effort to/TO/to provide/VB/provide better/JJR/better /,/, faster/JJR/faster /,/, and/CC/and less/JJR/less expensive/JJ/expensive solutions/NNS/solutions /,/, frequently/RB/frequently blurs/VBZ/blurs the/DT/the lines/NNS/lines that/WDT/that separated/VBN/separated previous/JJ/previous technologies/NNP/technologies. consider/NN/consider the/DT/the inserv/NN/inserv storage/NN/storage array/NN/array from/IN/from 3par/CD/3par. unlike/IN/unlike most/JJS/most other/JJ/other storage/NN/storage arrays/NNS/arrays /,/, inserv/NN/inserv does/VBZ/does not/RB/not require/VB/require that/IN/that a/DT/a set/NN/set of/IN/of disks/NNS/disks be/VB/be configured/VBN/configured at/IN/at a/DT/a specific/JJ/specific raid/NN/raid level/NN/level /./. rather/RB/rather /,/, each/DT/each disk/NN/disk is/VBZ/is broken/VBN/broken into/IN/into 256-mb/CD/256-mb chunklets/NNP/chunklets. ram/NN/ram is/VBZ/is then/RB/then applied/VBN/applied at/IN/at the/DT/the chunklet/NN/chunklet level/NNP/level. a/DT/a disk/NN/disk can/MD/can thus/RB/thus participate/VB/participate in/IN/in multiple/NN/multiple and/CC/and various/JJ/various raid/NN/raid levels/NNS/levels as/IN/as its/PRP$/its chunklets/NNS/chunklets are/VBP/are used/VBN/used for/IN/for multiple/NN/multiple volumes/NNS/volumes /./. inserv/NN/inserv also/RB/also provides/VBZ/provides snapshots/NNS/snapshots similar/JJ/similar to/TO/to those/DT/those created/VBN/created by/IN/by the/DT/the wafl/NN/wafl file/NN/file system/NNP/system. the/DT/the format/NN/format of/IN/of inserv/NN/inserv snapshots/NNS/snapshots can/MD/can be/VB/be read-write/JJ/read-write as/IN/as well/RB/well as/IN/as readonly/RB/readonly /,/, allowing/VBG/allowing multiple/NN/multiple hosts/NNS/hosts to/TO/to mount/VB/mount copies/NNS/copies of/IN/of a/DT/a given/VBN/given file/NN/file system/NN/system without/IN/without needing/NN/needing their/PRP$/their own/JJ/own copies/NNS/copies of/IN/of the/DT/the entire/JJ/entire file/NN/file system/NNP/system. any/DT/any changes/NNS/changes a/DT/a host/NN/host makes/VBZ/makes in/IN/in its/PRP$/its own/JJ/own copy/NN/copy are/VBP/are copy-on-write/JJ/copy-on-write and/CC/and so/RB/so are/VBP/are not/RB/not reflected/VBN/reflected in/IN/in the/DT/the other/JJ/other copies/NNS/copies /./. a/DT/a further/JJ/further innovation/NN/innovation is/VBZ/is /./. some/DT/some file/NN/file systems/NNS/systems do/VBP/do not/RB/not expand/VB/expand or/CC/or shrink/VB/shrink on/IN/on these/DT/these systems/NNS/systems /,/, the/DT/the original/JJ/original size/NN/size is/VBZ/is the/DT/the only/JJ/only size/NN/size /,/, and/CC/and any/DT/any change/NN/change requires/VBZ/requires copying/VBG/copying data/NNP/data. an/DT/an administrator/NN/administrator can/MD/can configure/VB/configure inserv/NN/inserv to/TO/to provide/VB/provide a/DT/a host/NN/host with/IN/with a/DT/a large/JJ/large amount/NN/amount of/IN/of logical/JJ/logical storage/NN/storage that/WDT/that initially/RB/initially occupies/VBZ/occupies only/RB/only a/DT/a small/JJ/small amount/NN/amount of/IN/of physical/JJ/physical storage/NNP/storage. as/IN/as the/DT/the host/NN/host starts/VBZ/starts using/VBG/using the/DT/the storage/NN/storage /,/, unused/VBD/unused disks/NNS/disks are/VBP/are allocated/VBN/allocated to/TO/to the/DT/the host/NN/host /,/, up/RB/up to/TO/to the/DT/the original/JJ/original logical/JJ/logical level/NNP/level. the/DT/the host/NN/host thus/RB/thus can/MD/can believe/VB/believe that/IN/that it/PRP/it has/VBZ/has a/DT/a large/JJ/large fixed/VBN/fixed storage/NN/storage space/NN/space /,/, create/VB/create its/PRP$/its file/NN/file systems/NNS/systems there/EX/there /,/, and/CC/and so/RB/so on/NNP/on. disks/NNS/disks can/MD/can be/VB/be added/VBN/added or/CC/or removed/VBN/removed from/IN/from the/DT/the file/NN/file system/NN/system by/IN/by inserv/NN/inserv without/IN/without the/DT/the file/NN/file systems/NNS/systems noticing/VBG/noticing the/DT/the change/NNP/change. this/DT/this feature/NN/feature can/MD/can reduce/VB/reduce the/DT/the number/NN/number of/IN/of drives/NNS/drives needed/VBN/needed by/IN/by hosts/NNS/hosts /,/, or/CC/or at/IN/at least/JJS/least delay/NN/delay the/DT/the purchase/NN/purchase of/IN/of disks/NNS/disks until/IN/until they/PRP/they are/VBP/are really/RB/really needed/VBN/needed /./. high/JJ/high space/NN/space overhead/NN/overhead /,/, raid/VBD/raid levels/NNS/levels is/VBZ/is often/RB/often preferred/VBN/preferred for/IN/for storing/NN/storing large/JJ/large volumes/NNS/volumes of/IN/of data/NNP/data. level6/NNP/level6 is/VBZ/is not/RB/not supported/VBN/supported currently/RB/currently by/IN/by many/JJ/many raid/JJ/raid implementations/NNS/implementations /,/, but/CC/but it/PRP/it should/MD/should offer/VB/offer better/JJR/better reliability/NN/reliability than/IN/than levels/NNS/levels /./. raid/NN/raid system/NN/system designers/NNS/designers and/CC/and administrators/NNS/administrators of/IN/of storage/NN/storage have/VBP/have to/TO/to make/VB/make several/JJ/several other/JJ/other decisions/NNS/decisions as/IN/as well/NNP/well. for/IN/for example/NN/example /,/, how/WRB/how many/JJ/many disks/NNS/disks should/MD/should be/VB/be in/IN/in a/DT/a given/VBN/given raid/NN/raid set/NN/set how/WRB/how many/JJ/many bits/NNS/bits should/MD/should be/VB/be protected/VBN/protected by/IN/by each/DT/each parity/NN/parity bit/NN/bit if/IN/if more/JJR/more disks/NNS/disks are/VBP/are in/IN/in an/DT/an array/NN/array /,/, data-transfer/JJ/data-transfer rates/NNS/rates are/VBP/are higher/JJR/higher /,/, but/CC/but the/DT/the system/NN/system is/VBZ/is more/RBR/more expensive/JJ/expensive /./. if/IN/if more/JJR/more bits/NNS/bits are/VBP/are protected/VBN/protected by/IN/by a/DT/a parity/NN/parity bit/NN/bit /,/, the/DT/the space/NN/space overhead/NN/overhead due/JJ/due to/TO/to parity/NN/parity bits/NNS/bits is/VBZ/is lower/JJR/lower /,/, but/CC/but the/DT/the chance/NN/chance that/IN/that a/DT/a second/JJ/second disk/NN/disk will/MD/will fail/VB/fail before/IN/before the/DT/the first/JJ/first failed/VBD/failed disk/NN/disk is/VBZ/is repaired/VBN/repaired is/VBZ/is greater/JJR/greater /,/, and/CC/and that/IN/that will/MD/will result/VB/result in/IN/in data/NN/data loss/NN/loss /./. 12.7.5/CD/12.7.5 extensions/NNS/extensions the/DT/the concepts/NNS/concepts of/IN/of raid/JJ/raid have/VBP/have been/VBN/been generalized/VBN/generalized to/TO/to other/JJ/other storage/NN/storage devices/NNS/devices /,/, including/VBG/including arrays/NNS/arrays of/IN/of tapes/NNS/tapes /,/, and/CC/and even/RB/even to/TO/to the/DT/the broadcast/NN/broadcast of/IN/of data/NNS/data over/IN/over wireless/NN/wireless systems/NNP/systems. when/WRB/when applied/VBD/applied to/TO/to arrays/NNS/arrays of/IN/of tapes/NNS/tapes /,/, raid/VBD/raid structures/NNS/structures are/VBP/are able/JJ/able to/TO/to recover/VB/recover data/NNS/data even/RB/even if/IN/if one/CD/one of/IN/of the/DT/the tapes/NNS/tapes in/IN/in an/DT/an array/NN/array is/VBZ/is damaged/NNP/damaged. when/WRB/when applied/VBD/applied to/TO/to broadcast/VB/broadcast of/IN/of data/NNS/data /,/, a/DT/a block/NN/block of/IN/of data/NNS/data is/VBZ/is split/VBN/split into/IN/into short/JJ/short units/NNS/units and/CC/and is/VBZ/is broadcast/JJ/broadcast along/IN/along with/IN/with a/DT/a parity/NN/parity unit/NN/unit ;/:/; if/IN/if one/CD/one of/IN/of the/DT/the units/NNS/units is/VBZ/is not/RB/not received/VBN/received for/IN/for any/DT/any reason/NN/reason /,/, it/PRP/it can/MD/can be/VB/be reconstructed/VBN/reconstructed from/IN/from the/DT/the other/JJ/other units/NNP/units. comrnonly/RB/comrnonly /,/, tape-drive/JJ/tape-drive robots/NNS/robots containing/VBG/containing multiple/NN/multiple tape/NN/tape drives/NNS/drives will/MD/will stripe/VB/stripe data/NNS/data across/IN/across all/DT/all the/DT/the drives/NNS/drives to/TO/to increase/VB/increase throughput/NN/throughput and/CC/and decrease/VB/decrease backup/RP/backup time/NN/time /./. 12.7/CD/12.7 531/CD/531 12.7.6/CD/12.7.6 problems/NNS/problems with/IN/with raid/JJ/raid unfortunately/RB/unfortunately /,/, raid/VBD/raid does/VBZ/does not/RB/not always/RB/always assure/VB/assure that/IN/that data/NNS/data are/VBP/are available/JJ/available for/IN/for the/DT/the operating/NN/operating system/NN/system and/CC/and its/PRP$/its users/NNP/users. a/DT/a pointer/NN/pointer to/TO/to a/DT/a file/NN/file could/MD/could be/VB/be wrong/JJ/wrong /,/, for/IN/for example/NN/example /,/, or/CC/or pointers/NNS/pointers within/IN/within the/DT/the file/NN/file structure/NN/structure could/MD/could be/VB/be wrong/NNP/wrong. incomplete/JJ/incomplete writes/NNS/writes /,/, if/IN/if not/RB/not properly/RB/properly recovered/VBD/recovered /,/, could/MD/could result/VB/result in/IN/in corrupt/JJ/corrupt data/NNP/data. some/DT/some other/JJ/other process/NN/process could/MD/could accidentally/RB/accidentally write/VB/write over/IN/over a/DT/a file/NN/file system/NN/system 's/POS/'s structures/NNS/structures /,/, too/NNP/too. raid/VBD/raid protects/NNS/protects against/IN/against physical/JJ/physical media/NNS/media errors/NNS/errors /,/, but/CC/but not/RB/not other/JJ/other hardware/NN/hardware and/CC/and software/NN/software errors/NNP/errors. as/IN/as large/JJ/large as/IN/as is/VBZ/is the/DT/the landscape/NN/landscape of/IN/of software/NN/software and/CC/and hardware/NN/hardware bugs/NNS/bugs /,/, that/IN/that is/VBZ/is how/WRB/how numerous/JJ/numerous are/VBP/are the/DT/the potential/NN/potential perils/NNS/perils for/IN/for data/NNS/data on/IN/on a/DT/a system/NN/system /./. the/DT/the solaris/NNS/solaris zfs/VBZ/zfs file/JJ/file system/NN/system takes/VBZ/takes an/DT/an innovative/JJ/innovative approach/NN/approach to/TO/to solving/NN/solving these/DT/these problems/NNS/problems through/IN/through the/DT/the use/NN/use of/IN/of /:/- a/DT/a technique/NN/technique which/WDT/which is/VBZ/is used/VBN/used to/TO/to verify/VB/verify the/DT/the integrity/NN/integrity of/IN/of data/NNP/data. zfs/NNS/zfs maintains/VBZ/maintains internal/JJ/internal checksums/NNS/checksums of/IN/of all/DT/all blocks/NNS/blocks /,/, including/VBG/including data/NNS/data and/CC/and metadata/NNP/metadata. these/DT/these checksums/NNS/checksums are/VBP/are not/RB/not kept/VBN/kept with/IN/with the/DT/the block/NN/block that/IN/that is/VBZ/is being/VBG/being checksummed/NNP/checksummed. rathel/NN/rathel ~/:/~ they/PRP/they are/VBP/are stored/VBN/stored with/IN/with the/DT/the pointer/NN/pointer to/TO/to that/DT/that block/NNP/block. /NNP/( see/VB/see figure/NN/figure 12.13/CD/12.13. /CD/) consider/NN/consider an/DT/an inode/NN/inode with/IN/with pointers/NNS/pointers to/TO/to its/PRP$/its data/NNP/data. within/IN/within the/DT/the inode/NN/inode is/VBZ/is the/DT/the checksum/NN/checksum of/IN/of each/DT/each block/NN/block of/IN/of data/NNP/data. if/IN/if there/EX/there is/VBZ/is a/DT/a problem/NN/problem with/IN/with the/DT/the data/NNS/data /,/, the/DT/the checksum/NN/checksum will/MD/will be/VB/be incorrect/VB/incorrect and/CC/and the/DT/the file/NN/file system/NN/system will/MD/will know/VB/know about/IN/about it/NNP/it. if/IN/if the/DT/the data/NNS/data are/VBP/are mirrored/VBN/mirrored /,/, and/CC/and there/EX/there is/VBZ/is a/DT/a block/NN/block with/IN/with a/DT/a correct/JJ/correct checksum/NN/checksum and/CC/and one/CD/one with/IN/with an/DT/an incorrect/NN/incorrect checksum/NN/checksum /,/, zfs/VBZ/zfs will/MD/will automatically/RB/automatically update/VB/update the/DT/the bad/JJ/bad block/NN/block with/IN/with the/DT/the good/JJ/good one/NNP/one. similarly/RB/similarly /,/, the/DT/the directory/NN/directory entry/NN/entry that/WDT/that points/VBZ/points to/TO/to the/DT/the inode/NN/inode has/VBZ/has a/DT/a checksum/NN/checksum for/IN/for the/DT/the inode/NNP/inode. any/DT/any problem/NN/problem in/IN/in the/DT/the inode/NN/inode is/VBZ/is detected/VBN/detected when/WRB/when the/DT/the directory/NN/directory is/VBZ/is accessed/VBN/accessed /./. this/DT/this checksumming/NN/checksumming takes/VBZ/takes places/NNS/places throughout/IN/throughout all/DT/all zfs/NNS/zfs structures/NNS/structures /,/, providing/VBG/providing a/DT/a much/RB/much higher/JJR/higher level/NN/level of/IN/of consistency/NN/consistency /,/, error/NN/error detection/NN/detection /,/, and/CC/and error/NN/error correction/NN/correction than/IN/than is/VBZ/is found/VBN/found in/IN/in raid/NN/raid disk/NN/disk sets/VBZ/sets or/CC/or standard/JJ/standard file/NN/file systems/NNP/systems. the/DT/the extra/JJ/extra overhead/NN/overhead that/WDT/that is/VBZ/is created/VBN/created by/IN/by the/DT/the checksum/NN/checksum calculation/NN/calculation and/CC/and extra/JJ/extra block/NN/block read-modify-write/JJ/read-modify-write cycles/NNS/cycles is/VBZ/is not/RB/not noticeable/JJ/noticeable because/IN/because the/DT/the overall/JJ/overall performance/NN/performance of/IN/of zfs/NNS/zfs is/VBZ/is very/RB/very fast/RB/fast /./. another/DT/another issue/NN/issue with/IN/with most/JJS/most raid/JJ/raid implementations/NNS/implementations is/VBZ/is lack/VBP/lack of/IN/of flexibility/NN/flexibility /./. consider/NN/consider a/DT/a storage/NN/storage array/NN/array with/IN/with twenty/NN/twenty disks/NNS/disks divided/VBD/divided into/IN/into four/CD/four sets/NNS/sets of/IN/of five/CD/five disks/NNS/disks /./. each/DT/each set/NN/set of/IN/of five/CD/five disks/NNS/disks is/VBZ/is a/DT/a raid/NN/raid level/NN/level 5/CD/5 set/NNP/set. as/IN/as a/DT/a result/NN/result /,/, there/EX/there are/VBP/are four/CD/four separate/JJ/separate data/NNS/data 1/CD/1 figure/NN/figure 12.13/CD/12.13 zfs/NNS/zfs checksums/NNS/checksums all/DT/all metadata/NN/metadata and/CC/and data/NNS/data /./. 532/CD/532 chapter/NN/chapter 12/CD/12 volumes/NNS/volumes /,/, each/DT/each holding/VBG/holding a/DT/a file/NN/file system/NNP/system. but/CC/but what/WP/what if/IN/if one/CD/one file/NN/file system/NN/system is/VBZ/is too/RB/too large/JJ/large to/TO/to fit/VB/fit on/IN/on a/DT/a five-disk/JJ/five-disk raid/NN/raid level/NN/level 5/CD/5 set/NN/set and/CC/and what/WP/what if/IN/if another/DT/another file/NN/file system/NN/system needs/VBZ/needs very/RB/very little/JJ/little space/NN/space if/IN/if such/JJ/such factors/NNS/factors are/VBP/are known/VBN/known ahead/RB/ahead of/IN/of time/NN/time /,/, then/RB/then the/DT/the disks/NNS/disks and/CC/and volumes/NNS/volumes can/MD/can be/VB/be properly/RB/properly allocated/NNP/allocated. very/RB/very frequently/RB/frequently /,/, however/RB/however /,/, disk/NN/disk use/NN/use and/CC/and requirements/NNS/requirements change/VBP/change over/IN/over time/NN/time /./. even/RB/even if/IN/if the/DT/the storage/NN/storage array/NN/array allowed/VBD/allowed the/DT/the entire/JJ/entire set/NN/set of/IN/of twenty/NN/twenty disks/NNS/disks to/TO/to be/VB/be created/VBN/created as/IN/as one/CD/one large/JJ/large raid/NN/raid set/NN/set other/JJ/other issues/NNS/issues could/MD/could arise/NNP/arise. several/JJ/several volumes/NNS/volumes of/IN/of various/JJ/various sizes/NNS/sizes could/MD/could be/VB/be built/VBN/built on/IN/on the/DT/the set/NNP/set. but/CC/but some/DT/some volume/NN/volume managers/NNS/managers do/VBP/do not/RB/not allow/VB/allow us/PRP/us to/TO/to change/VB/change a/DT/a volume/NN/volume 's/POS/'s size/NNP/size. in/IN/in that/DT/that case/NN/case /,/, we/PRP/we would/MD/would be/VB/be left/VBN/left with/IN/with the/DT/the same/JJ/same issue/NN/issue described/VBN/described above-mismatched/JJ/above-mismatched file-system/NN/file-system sizes/NNP/sizes. some/DT/some volume/NN/volume n/NN/n lanagers/NNS/lanagers allow/VBP/allow size/NN/size changes/NNS/changes /,/, but/CC/but some/DT/some file/JJ/file systems/NNS/systems do/VBP/do not/RB/not allow/VB/allow for/IN/for file-system/JJ/file-system growth/NN/growth or/CC/or shrinkage/NNP/shrinkage. the/DT/the volumes/NNS/volumes could/MD/could change/VB/change sizes/NNS/sizes /,/, but/CC/but the/DT/the file/NN/file systems/NNS/systems would/MD/would need/VB/need to/TO/to be/VB/be recreated/VBN/recreated to/TO/to take/VB/take advantage/NN/advantage of/IN/of those/DT/those changes/NNS/changes /./. zfs/NNS/zfs combines/NNS/combines file-system/JJ/file-system management/NN/management and/CC/and volume/NN/volume management/NN/management into/IN/into a/DT/a unit/NN/unit providing/VBG/providing greater/JJR/greater functionality/NN/functionality than/IN/than the/DT/the traditional/JJ/traditional separation/NN/separation of/IN/of those/DT/those functions/NNS/functions allows/NNP/allows. disks/NNS/disks /,/, or/CC/or partitions/NNS/partitions of/IN/of disks/NNS/disks /,/, are/VBP/are gathered/VBN/gathered together/RB/together via/IN/via raid/JJ/raid sets/NNS/sets into/IN/into of/IN/of storage/NNP/storage. a/DT/a pool/NN/pool can/MD/can hold/VB/hold one/CD/one or/CC/or more/JJR/more zfs/NNS/zfs file/VBP/file systems/NNP/systems. the/DT/the entire/JJ/entire pool/NN/pool 's/POS/'s free/JJ/free space/NN/space is/VBZ/is available/JJ/available to/TO/to all/DT/all file/NN/file systems/NNS/systems within/IN/within that/DT/that pool/NNP/pool. zfs/VBZ/zfs uses/NNS/uses the/DT/the memory/NN/memory model/NN/model of/IN/of malloc/NN/malloc and/CC/and free/JJ/free to/TO/to allocate/VB/allocate and/CC/and release/VB/release storage/NN/storage for/IN/for each/DT/each file/NN/file system/NN/system as/IN/as blocks/NNS/blocks are/VBP/are used/VBN/used and/CC/and freed/VBN/freed within/IN/within the/DT/the file/NN/file system/NNP/system. as/IN/as a/DT/a result/NN/result there/EX/there are/VBP/are no/DT/no artificial/JJ/artificial limits/NNS/limits on/IN/on storage/NN/storage use/NN/use and/CC/and no/DT/no need/NN/need to/TO/to relocate/VB/relocate file/JJ/file systems/NNS/systems between/IN/between volumes/NNS/volumes or/CC/or resize/VB/resize volumes/NNP/volumes. zfs/NNS/zfs provides/VBZ/provides quotas/NNS/quotas to/TO/to limit/VB/limit the/DT/the size/NN/size of/IN/of a/DT/a file/NN/file system/NN/system and/CC/and reservations/NNS/reservations to/TO/to assure/VB/assure that/IN/that a/DT/a file/NN/file system/NN/system can/MD/can grow/VB/grow by/IN/by a/DT/a specified/VBN/specified amount/NN/amount /,/, but/CC/but those/DT/those variables/NNS/variables may/MD/may be/VB/be changed/VBN/changed by/IN/by the/DT/the file/NN/file system/NN/system owner/NN/owner at/IN/at any/DT/any time/NNP/time. figure/NN/figure 12.14/CD/12.14 /CD/( a/DT/a /NN/) depicts/VBZ/depicts traditional/JJ/traditional volumes/NNS/volumes and/CC/and file/JJ/file systems/NNS/systems /,/, and/CC/and figure/NN/figure 12.14/CD/12.14 /CD/( b/NN/b /:/) shows/VBZ/shows the/DT/the zfs/NNS/zfs model/VBP/model /./. i/PRP/i fs/VBZ/fs i/PRP/i ~/VBP/~ /:/( a/DT/a /NN/) traditional/JJ/traditional volumes/NNS/volumes and/CC/and file/JJ/file systems/NNS/systems /./. /:/( b/NN/b /:/) zfs/NNS/zfs and/CC/and pooled/VBD/pooled storage/NN/storage /./. figure/NN/figure 12.14/CD/12.14 /CD/( a/DT/a /NN/) traditional/JJ/traditional volumes/NNS/volumes and/CC/and file/JJ/file systems/NNP/systems. /NNP/( b/NN/b /:/) a/DT/a zfs/NN/zfs pool/NN/pool and/CC/and file/NN/file systems/NNS/systems /./. 12.8/CD/12.8 12.8/CD/12.8 533/CD/533 in/IN/in chapter/NN/chapter 6/CD/6 /,/, we/PRP/we introduced/VBD/introduced the/DT/the write-ahead/JJ/write-ahead log/NN/log /,/, which/WDT/which requires/VBZ/requires the/DT/the availability/NN/availability of/IN/of stable/JJ/stable storage/NNP/storage. by/IN/by definition/NN/definition /,/, information/NN/information residing/VBG/residing in/IN/in stable/JJ/stable storage/NN/storage is/VBZ/is never/RB/never lost/NNP/lost. to/TO/to implement/VB/implement such/JJ/such storage/NN/storage /,/, we/PRP/we need/VBP/need to/TO/to replicate/VB/replicate the/DT/the required/VBN/required information/NN/information on/IN/on multiple/NN/multiple storage/NN/storage devices/NNS/devices /:/( usually/RB/usually disks/VBZ/disks /:/) with/IN/with independent/JJ/independent failure/NN/failure modes/VBZ/modes /./. we/PRP/we also/RB/also need/VBP/need to/TO/to coordinate/VB/coordinate the/DT/the writing/NN/writing of/IN/of updates/NNS/updates in/IN/in a/DT/a way/NN/way that/WDT/that guarantees/VBZ/guarantees that/IN/that a/DT/a failure/NN/failure during/IN/during an/DT/an update/JJ/update will/MD/will not/RB/not leave/VB/leave all/DT/all the/DT/the copies/NNS/copies in/IN/in a/DT/a damaged/JJ/damaged state/NN/state and/CC/and that/IN/that /,/, when/WRB/when we/PRP/we are/VBP/are recovering/VBG/recovering from/IN/from a/DT/a failure/NN/failure /,/, we/PRP/we can/MD/can force/VB/force all/PDT/all copies/NNS/copies to/TO/to a/DT/a consistent/NN/consistent and/CC/and correct/VB/correct value/NN/value /,/, even/RB/even if/IN/if another/DT/another failure/NN/failure occurs/NNS/occurs during/IN/during the/DT/the recovery/NN/recovery /./. in/IN/in this/DT/this section/NN/section /,/, we/PRP/we discuss/VBP/discuss how/WRB/how to/TO/to meet/VB/meet these/DT/these needs/NNS/needs /./. a/DT/a disk/NN/disk write/NN/write results/NNS/results in/IN/in one/CD/one of/IN/of three/CD/three outcomes/NNS/outcomes /:/: successful/JJ/successful completion/NNP/completion. the/DT/the data/NNS/data were/VBD/were written/VBN/written correctly/RB/correctly on/IN/on disk/NN/disk /./. partial/JJ/partial failure/NNP/failure. a/DT/a failure/NN/failure occurred/VBD/occurred in/IN/in the/DT/the midst/NN/midst of/IN/of transfer/NN/transfer /,/, so/RB/so only/RB/only some/DT/some of/IN/of the/DT/the sectors/NNS/sectors were/VBD/were written/VBN/written with/IN/with the/DT/the new/JJ/new data/NNS/data /,/, and/CC/and the/DT/the sector/NN/sector being/VBG/being written/VBN/written during/IN/during the/DT/the failure/NN/failure may/MD/may have/VB/have been/VBN/been corrupted/VBN/corrupted /./. total/JJ/total failure/NNP/failure. the/DT/the failure/NN/failure occurred/VBD/occurred before/IN/before the/DT/the disk/NN/disk write/NN/write started/VBD/started /,/, so/RB/so the/DT/the previous/JJ/previous data/NNS/data values/NNS/values on/IN/on the/DT/the disk/NN/disk remain/NN/remain intact/NN/intact /./. whenever/NN/whenever a/DT/a failure/NN/failure occurs/VBZ/occurs during/IN/during writing/VBG/writing of/IN/of a/DT/a block/NN/block /,/, the/DT/the system/NN/system needs/VBZ/needs to/TO/to detect/VB/detect it/PRP/it and/CC/and invoke/VB/invoke a/DT/a recovery/NN/recovery procedure/NN/procedure to/TO/to restore/VB/restore the/DT/the block/NN/block to/TO/to a/DT/a consistent/NN/consistent state/NNP/state. to/TO/to do/VB/do that/DT/that /,/, the/DT/the system/NN/system must/MD/must maintain/VB/maintain two/CD/two physical/JJ/physical blocks/NNS/blocks for/IN/for each/DT/each logical/JJ/logical block/NNP/block. an/DT/an output/NN/output operation/NN/operation is/VBZ/is executed/VBN/executed as/IN/as follows/NNS/follows /:/: write/JJ/write the/DT/the information/NN/information onto/IN/onto the/DT/the first/JJ/first physical/JJ/physical block/NN/block /./. when/WRB/when the/DT/the first/JJ/first write/NN/write completes/NNS/completes successfully/RB/successfully /,/, write/JJ/write the/DT/the same/JJ/same injormation/NN/injormation onto/IN/onto the/DT/the second/JJ/second physical/JJ/physical block/NN/block /./. declare/NN/declare the/DT/the operation/NN/operation complete/NN/complete only/RB/only after/IN/after the/DT/the second/JJ/second write/NN/write completes/VBZ/completes successfully/RB/successfully /./. during/IN/during recovery/NN/recovery from/IN/from a/DT/a failure/NN/failure /,/, each/DT/each pair/NN/pair of/IN/of physical/JJ/physical blocks/NNS/blocks is/VBZ/is examined/VBN/examined /./. if/IN/if both/DT/both are/VBP/are the/DT/the same/JJ/same and/CC/and no/DT/no detectable/JJ/detectable error/NN/error exists/NNS/exists /,/, then/RB/then no/DT/no further/JJ/further action/NN/action is/VBZ/is necessary/NNP/necessary. if/IN/if one/CD/one block/NN/block contains/NNS/contains a/DT/a detectable/JJ/detectable error/NN/error /,/, then/RB/then we/PRP/we replace/VBP/replace its/PRP$/its contents/NNS/contents with/IN/with the/DT/the value/NN/value of/IN/of the/DT/the other/JJ/other block/NNP/block. if/IN/if neither/DT/neither block/NN/block contains/VBZ/contains a/DT/a detectable/JJ/detectable error/NN/error /,/, but/CC/but the/DT/the blocks/NNS/blocks differ/VBP/differ in/IN/in content/NN/content /,/, then/RB/then we/PRP/we replace/VBP/replace the/DT/the content/NN/content of/IN/of the/DT/the first/JJ/first block/NN/block with/IN/with that/DT/that of/IN/of the/DT/the second/NNP/second. this/DT/this recovery/NN/recovery procedure/NN/procedure ensures/NNS/ensures that/WDT/that a/DT/a write/NN/write to/TO/to stable/VB/stable storage/NN/storage either/DT/either succeeds/NNS/succeeds completely/RB/completely or/CC/or results/NNS/results in/IN/in no/DT/no change/NN/change /./. we/PRP/we can/MD/can extend/VB/extend this/DT/this procedure/NN/procedure easily/RB/easily to/TO/to allow/VB/allow the/DT/the use/NN/use of/IN/of an/DT/an arbitrarily/NN/arbitrarily large/JJ/large number/NN/number of/IN/of copies/NNS/copies of/IN/of each/DT/each block/NN/block of/IN/of stable/JJ/stable storage/NNP/storage. although/IN/although having/VBG/having a/DT/a large/JJ/large number/NN/number of/IN/of copies/NNS/copies further/RB/further reduces/NNS/reduces the/DT/the probability/NN/probability of/IN/of a/DT/a failure/NN/failure /,/, it/PRP/it is/VBZ/is usually/RB/usually reasonable/JJ/reasonable to/TO/to simulate/VB/simulate stable/JJ/stable storage/NN/storage with/IN/with only/RB/only two/CD/two copies/NNP/copies. the/DT/the data/NNS/data in/IN/in stable/JJ/stable storage/NN/storage are/VBP/are guaranteed/VBN/guaranteed to/TO/to be/VB/be safe/JJ/safe unless/NN/unless a/DT/a failure/NN/failure destroys/VBZ/destroys all/DT/all the/DT/the copies/NNS/copies /./. because/IN/because waiting/VBG/waiting for/IN/for disk/NN/disk writes/NNS/writes to/TO/to complete/VB/complete /:/( synchronous/JJ/synchronous i/o/NN/i/o /:/) is/VBZ/is time/NN/time consuming/VBG/consuming /,/, many/JJ/many storage/NN/storage arrays/NNS/arrays add/VBP/add nvram/NN/nvram as/IN/as a/DT/a cache/NNP/cache. since/IN/since the/DT/the memory/NN/memory is/VBZ/is nonvolatile/JJ/nonvolatile /NN/( it/PRP/it usually/RB/usually has/VBZ/has battery/RB/battery power/JJR/power to/TO/to back/RB/back up/IN/up the/DT/the unit/NN/unit 's/POS/'s power/NN/power /:/) /,/, it/PRP/it can/MD/can be/VB/be trusted/VBN/trusted to/TO/to store/VB/store the/DT/the data/NNS/data en/VBP/en route/NN/route to/TO/to the/DT/the disks/NNP/disks. it/PRP/it is/VBZ/is thus/RB/thus considered/VBN/considered part/NN/part of/IN/of 534/CD/534 chapter/NN/chapter 12/CD/12 12.9/CD/12.9 the/DT/the stable/JJ/stable storage/NNP/storage. writes/VBZ/writes to/TO/to it/PRP/it are/VBP/are much/RB/much faster/JJR/faster than/IN/than to/TO/to disk/VB/disk /,/, so/RB/so performance/NN/performance is/VBZ/is greatly/RB/greatly improved/VBN/improved /./. would/MD/would you/PRP/you buy/VB/buy a/DT/a dvd/NN/dvd or/CC/or cd/NN/cd player/NN/player that/WDT/that had/VBD/had one/CD/one disk/NN/disk sealed/VBD/sealed inside/NN/inside of/IN/of course/NN/course not/NNP/not. you/PRP/you expect/VBP/expect to/TO/to use/VB/use a/DT/a dvd/NN/dvd or/CC/or cd/NN/cd player/NN/player with/IN/with many/JJ/many relatively/RB/relatively inexpensive/JJ/inexpensive disks/NNP/disks. on/IN/on a/DT/a computer/NN/computer as/IN/as well/RB/well /,/, using/VBG/using many/JJ/many inexpensive/JJ/inexpensive cartridges/NNS/cartridges with/IN/with one/CD/one drive/JJ/drive lowers/NNS/lowers the/DT/the overall/JJ/overall cost/NNP/cost. low/JJ/low cost/NN/cost is/VBZ/is the/DT/the defining/NN/defining characteristic/JJ/characteristic of/IN/of tertiary/JJ/tertiary storage/NN/storage /,/, which/WDT/which we/PRP/we discuss/VBP/discuss in/IN/in this/DT/this section/NN/section /./. 12.9.1/CD/12.9.1 tertiary-storage/NN/tertiary-storage devices/NNS/devices because/IN/because cost/NN/cost is/VBZ/is so/RB/so important/JJ/important /,/, in/IN/in practice/NN/practice /,/, tertiary/JJ/tertiary storage/NN/storage is/VBZ/is built/VBN/built with/IN/with the/DT/the most/RBS/most common/JJ/common examples/NNS/examples are/VBP/are floppy/JJ/floppy disks/NNS/disks /,/, tapes/NNS/tapes /,/, and/CC/and read-only/RB/read-only /,/, write-once/JJ/write-once /,/, and/CC/and rewritable/JJ/rewritable cds/NNS/cds and/CC/and dvds/NNP/dvds. many/JJ/many any/DT/any other/JJ/other kinds/NNS/kinds of/IN/of tertiarystorage/NN/tertiarystorage devices/NNS/devices are/VBP/are available/JJ/available as/IN/as well/RB/well /,/, including/VBG/including removable/JJ/removable devices/NNS/devices that/WDT/that store/IN/store data/NNS/data in/IN/in flash/NN/flash memory/NN/memory and/CC/and interact/NN/interact with/IN/with the/DT/the computer/NN/computer system/NN/system via/IN/via a/DT/a usb/NN/usb interface/NN/interface /./. 12.9.1.1/CD/12.9.1.1 removable/JJ/removable disks/NNS/disks removable/JJ/removable disks/NNS/disks are/VBP/are one/CD/one kind/NN/kind of/IN/of tertiary/JJ/tertiary storage/NNP/storage. floppy/NN/floppy disks/VBZ/disks are/VBP/are an/DT/an example/NN/example of/IN/of removable/JJ/removable magnetic/JJ/magnetic disks/NNP/disks. they/PRP/they are/VBP/are made/VBN/made from/IN/from a/DT/a thin/JJ/thin /,/, flexible/JJ/flexible disk/NN/disk coated/VBN/coated with/IN/with magnetic/JJ/magnetic material/NN/material and/CC/and enclosed/VBD/enclosed in/IN/in a/DT/a protective/JJ/protective plastic/NN/plastic case/NNP/case. although/IN/although common/JJ/common floppy/NN/floppy disks/NNS/disks can/MD/can hold/VB/hold only/RB/only about/IN/about 1/CD/1 mb/NN/mb /,/, similar/JJ/similar technology/NN/technology is/VBZ/is used/VBN/used for/IN/for removable/JJ/removable magnetic/JJ/magnetic disks/NNS/disks that/WDT/that hold/MD/hold more/RBR/more than/IN/than 1/CD/1 gb/NNP/gb. removable/JJ/removable magnetic/JJ/magnetic disks/NNS/disks can/MD/can be/VB/be nearly/RB/nearly as/IN/as fast/JJ/fast as/IN/as hard/JJ/hard disks/NNS/disks /,/, although/IN/although the/DT/the recording/NN/recording stuface/NN/stuface is/VBZ/is at/IN/at greater/JJR/greater risk/NN/risk of/IN/of from/IN/from scratches/NNS/scratches /./. a/DT/a is/VBZ/is another/DT/another kind/NN/kind of/IN/of removable/JJ/removable disk/NNP/disk. it/PRP/it records/VBZ/records data/NNS/data on/IN/on a/DT/a rigid/JJ/rigid platter/NN/platter coated/VBN/coated with/IN/with magnetic/JJ/magnetic material/NN/material /,/, but/CC/but the/DT/the recording/NN/recording technology/NN/technology is/VBZ/is quite/RB/quite different/JJ/different from/IN/from that/DT/that for/IN/for a/DT/a magnetic/JJ/magnetic disk/NNP/disk. the/DT/the magneto-optic/JJ/magneto-optic head/NN/head flies/NNS/flies much/RB/much farther/RB/farther from/IN/from the/DT/the disk/NN/disk surface/NN/surface than/IN/than a/DT/a magnetic/JJ/magnetic disk/NN/disk head/NN/head does/VBZ/does /,/, and/CC/and the/DT/the magnetic/JJ/magnetic material/NN/material is/VBZ/is covered/VBN/covered with/IN/with a/DT/a thick/NN/thick protective/JJ/protective layer/NN/layer of/IN/of plastic/JJ/plastic or/CC/or glass/NN/glass /./. this/DT/this arrangement/NN/arrangement makes/VBZ/makes the/DT/the disk/NN/disk much/RB/much more/RBR/more resistant/JJ/resistant to/TO/to head/VB/head crashes/NNS/crashes /./. the/DT/the magneto-optic/JJ/magneto-optic disk/NN/disk drive/JJ/drive has/VBZ/has a/DT/a coil/NN/coil that/WDT/that produces/VBZ/produces a/DT/a magnetic/JJ/magnetic field/NN/field ;/:/; at/IN/at room/NN/room temperature/NN/temperature /,/, the/DT/the field/NN/field is/VBZ/is too/RB/too large/JJ/large and/CC/and too/RB/too weak/JJ/weak to/TO/to magnetize/VB/magnetize a/DT/a bit/NN/bit on/IN/on the/DT/the disk/NNP/disk. to/TO/to write/VB/write a/DT/a bit/NN/bit /,/, the/DT/the disk/NN/disk head/NN/head flashes/NNS/flashes a/DT/a laser/NN/laser beam/NN/beam at/IN/at the/DT/the disk/NN/disk surface/NNP/surface. the/DT/the laser/NN/laser is/VBZ/is aimed/VBN/aimed at/IN/at a/DT/a tiny/NN/tiny spot/NN/spot where/WRB/where a/DT/a bit/NN/bit is/VBZ/is to/TO/to be/VB/be written/NNP/written. the/DT/the laser/NN/laser heats/NNS/heats this/DT/this spot/NN/spot /,/, which/WDT/which makes/VBZ/makes the/DT/the spot/NN/spot susceptible/JJ/susceptible to/TO/to the/DT/the magnetic/JJ/magnetic field/NNP/field. now/RB/now the/DT/the large/JJ/large /,/, weak/JJ/weak magnetic/JJ/magnetic field/NN/field can/MD/can record/VB/record a/DT/a tiny/JJ/tiny bit/NN/bit /./. the/DT/the magneto-optic/JJ/magneto-optic head/NN/head is/VBZ/is too/RB/too far/RB/far from/IN/from the/DT/the disk/NN/disk surface/NN/surface to/TO/to read/VB/read the/DT/the data/NNS/data by/IN/by detecting/VBG/detecting the/DT/the tiny/NN/tiny magnetic/JJ/magnetic fields/NNS/fields in/IN/in the/DT/the way/NN/way that/IN/that the/DT/the head/NN/head of/IN/of a/DT/a hard/JJ/hard disk/NN/disk does/VBZ/does /./. instead/RB/instead /,/, the/DT/the drive/JJ/drive reads/NNS/reads a/DT/a bit/NN/bit using/VBG/using a/DT/a property/NN/property of/IN/of laser/NN/laser light/NN/light called/VBN/called the/DT/the when/WRB/when a/DT/a laser/NN/laser beam/NN/beam is/VBZ/is bounced/VBN/bounced off/RP/off of/IN/of a/DT/a magnetic/JJ/magnetic spot/NN/spot /,/, the/DT/the polarization/NN/polarization of/IN/of the/DT/the laser/NN/laser beam/NN/beam is/VBZ/is rotated/VBN/rotated clockwise/NN/clockwise or/CC/or counterclockwise/VB/counterclockwise /,/, dependin/NN/dependin ~/:/~ g/NN/g on/IN/on the/DT/the orientation/NN/orientation of/IN/of the/DT/the magnetic/JJ/magnetic field/NNP/field. this/DT/this rotation/NN/rotation is/VBZ/is what/WP/what the/DT/the head/NN/head detects/VBZ/detects to/TO/to read/VB/read a/DT/a bit/NN/bit /./. another/DT/another category/NN/category of/IN/of removable/JJ/removable disk/NN/disk is/VBZ/is the/DT/the optical/JJ/optical disks/NNS/disks do/VBP/do not/RB/not use/VB/use magnetism/NN/magnetism at/IN/at all/NNP/all. instead/RB/instead /,/, they/PRP/they use/VBP/use special/JJ/special materials/NNS/materials that/WDT/that can/MD/can be/VB/be altered/VBN/altered by/IN/by laser/NN/laser light/JJ/light to/TO/to have/VB/have relatively/RB/relatively dark/JJ/dark or/CC/or bright/JJ/bright spots/NNP/spots. one/CD/one exarnple/NN/exarnple of/IN/of optical-disk/JJ/optical-disk 12.9/CD/12.9 535/CD/535 technology/NN/technology is/VBZ/is the/DT/the which/WDT/which is/VBZ/is coated/VBN/coated with/IN/with a/DT/a material/NN/material that/WDT/that can/MD/can freeze/VB/freeze into/IN/into either/DT/either a/DT/a crystalline/NN/crystalline or/CC/or an/DT/an amorphous/JJ/amorphous state/NNP/state. the/DT/the crystalline/NN/crystalline state/NN/state is/VBZ/is more/RBR/more transparent/JJ/transparent /,/, and/CC/and hence/NN/hence a/DT/a laser/NN/laser beam/NN/beam is/VBZ/is brighter/NN/brighter when/WRB/when it/PRP/it passes/VBZ/passes through/IN/through the/DT/the ltlaterial/JJ/ltlaterial and/CC/and bounces/NNS/bounces off/IN/off the/DT/the reflective/JJ/reflective layer/NNP/layer. the/DT/the phase-change/JJ/phase-change drive/JJ/drive uses/NNS/uses laser/NN/laser light/NN/light at/IN/at three/CD/three different/JJ/different powers/NNS/powers /:/: low/JJ/low power/NN/power to/TO/to read/VB/read data/NNS/data /,/, medium/NN/medium power/NN/power to/TO/to erase/VB/erase the/DT/the disk/NN/disk by/IN/by melting/NN/melting and/CC/and refreezing/VBG/refreezing the/DT/the recording/VBG/recording medium/NN/medium into/IN/into the/DT/the crystalline/NN/crystalline state/NN/state /,/, and/CC/and high/JJ/high power/NN/power to/TO/to melt/VB/melt the/DT/the medium/NN/medium into/IN/into the/DT/the amorphous/JJ/amorphous state/NN/state to/TO/to write/VB/write to/TO/to the/DT/the disk/NNP/disk. the/DT/the most/RBS/most common/JJ/common examples/NNS/examples of/IN/of this/DT/this technology/NN/technology are/VBP/are the/DT/the re-recordable/JJ/re-recordable cd-rw/NN/cd-rw and/CC/and dvd-rw/JJ/dvd-rw /./. the/DT/the kinds/NNS/kinds of/IN/of disks/NNS/disks just/RB/just described/VBN/described can/MD/can be/VB/be used/VBN/used over/RP/over and/CC/and over/NNP/over. they/PRP/they are/VBP/are called/VBN/called in/IN/in contrast/NN/contrast /,/, can/MD/can be/VB/be written/VBN/written only/RB/only once/NNP/once. an/DT/an old/JJ/old way/NN/way to/TO/to make/VB/make a/DT/a worm/NN/worm disk/NN/disk is/VBZ/is to/TO/to manufacture/VB/manufacture a/DT/a thin/JJ/thin aluminum/NN/aluminum film/NN/film sandwiched/VBD/sandwiched between/IN/between two/CD/two glass/NNS/glass or/CC/or plastic/JJ/plastic platters/NNP/platters. to/TO/to write/VB/write a/DT/a bit/NN/bit /,/, the/DT/the drive/JJ/drive uses/NNS/uses a/DT/a laser/NN/laser light/NN/light to/TO/to burn/VB/burn a/DT/a small/JJ/small hole/NN/hole through/IN/through the/DT/the aluminum/NNP/aluminum. this/DT/this burning/NN/burning can/MD/can not/RB/not be/VB/be reversed/NNP/reversed. although/IN/although it/PRP/it is/VBZ/is possible/JJ/possible to/TO/to destroy/VB/destroy the/DT/the information/NN/information on/IN/on a/DT/a worm/NN/worm disk/NN/disk by/IN/by burning/NN/burning holes/NNS/holes everywhere/RB/everywhere /,/, it/PRP/it is/VBZ/is virtually/RB/virtually impossible/JJ/impossible to/TO/to alter/NN/alter data/NNS/data on/IN/on the/DT/the disk/NN/disk /,/, because/IN/because holes/NNS/holes can/MD/can only/RB/only be/VB/be added/VBN/added /,/, and/CC/and the/DT/the ecc/NN/ecc code/NN/code associated/VBN/associated with/IN/with each/DT/each sector/NN/sector is/VBZ/is likely/JJ/likely to/TO/to detect/VB/detect such/JJ/such additions/NNP/additions. worm/NN/worm disks/VBZ/disks are/VBP/are considered/VBN/considered durable/JJ/durable and/CC/and reliable/JJ/reliable because/IN/because the/DT/the metal/NN/metal layer/NN/layer is/VBZ/is safely/RB/safely encapsulated/VBN/encapsulated between/IN/between the/DT/the protective/JJ/protective glass/NN/glass or/CC/or plastic/JJ/plastic platters/NNS/platters and/CC/and magnetic/JJ/magnetic fields/NNS/fields can/MD/can not/RB/not damage/VB/damage the/DT/the recording/NNP/recording. a/DT/a newer/JJR/newer write-once/NN/write-once technology/NN/technology records/NNS/records on/IN/on an/DT/an organic/JJ/organic polymer/NN/polymer dye/NN/dye instead/RB/instead of/IN/of an/DT/an aluminum/NN/aluminum layer/NN/layer ;/:/; the/DT/the dye/NN/dye absorbs/VBZ/absorbs laser/NN/laser light/NN/light to/TO/to form/NN/form marks/NNP/marks. this/DT/this technology/NN/technology is/VBZ/is used/VBN/used in/IN/in the/DT/the recordable/JJ/recordable cd-r/NN/cd-r and/CC/and dvd-r/JJ/dvd-r /./. read-oniv/NN/read-oniv such/JJ/such as/IN/as cd-rom/JJ/cd-rom and/CC/and dvd-rom/JJ/dvd-rom /,/, come/VBP/come from/IN/from the/DT/the factory/NN/factory with/IN/with the/DT/the data/NNS/data prerecorded/NNP/prerecorded. they/PRP/they use/VBP/use technology/NN/technology similar/JJ/similar to/TO/to that/DT/that of/IN/of worm/NN/worm disks/NNS/disks /:/( although/IN/although the/DT/the bits/NNS/bits are/VBP/are pressed/VBN/pressed /,/, not/RB/not burned/VBN/burned /-NONE-/) /,/, and/CC/and they/PRP/they are/VBP/are very/RB/very durable/JJ/durable /./. most/JJS/most removable/JJ/removable disks/NNS/disks are/VBP/are slower/JJR/slower than/IN/than their/PRP$/their nonremovable/JJ/nonremovable counterparts/NNS/counterparts /./. the/DT/the writing/NN/writing process/NN/process is/VBZ/is slower/JJR/slower /,/, as/IN/as are/VBP/are rotation/NN/rotation and/CC/and sometimes/RB/sometimes seek/VB/seek time/NN/time /./. 12.9.1.2/CD/12.9.1.2 tapes/NNS/tapes magnetic/JJ/magnetic tape/NN/tape is/VBZ/is another/DT/another type/NN/type of/IN/of removable/JJ/removable medium/NNP/medium. as/IN/as a/DT/a general/JJ/general rule/NN/rule /,/, a/DT/a tape/NN/tape holds/VBZ/holds more/JJR/more data/NNS/data than/IN/than an/DT/an optical/JJ/optical or/CC/or magnetic/JJ/magnetic disk/NN/disk cartridge/NNP/cartridge. tape/NN/tape drives/NNS/drives and/CC/and disk/VB/disk drives/NNS/drives have/VBP/have similar/JJ/similar transfer/NN/transfer rates/NNP/rates. but/CC/but random/NN/random access/NN/access to/TO/to tape/NN/tape is/VBZ/is much/JJ/much slower/NN/slower than/IN/than a/DT/a disk/NN/disk seek/NN/seek /,/, because/IN/because it/PRP/it requires/VBZ/requires a/DT/a fast-forward/JJ/fast-forward or/CC/or rewind/JJ/rewind operation/NN/operation that/WDT/that takes/VBZ/takes tens/NNS/tens of/IN/of seconds/NNS/seconds or/CC/or even/RB/even minutes/VBZ/minutes /./. although/IN/although a/DT/a typical/JJ/typical tape/NN/tape drive/JJ/drive is/VBZ/is more/RBR/more expensive/JJ/expensive than/IN/than a/DT/a typical/JJ/typical disk/NN/disk drive/JJ/drive /,/, the/DT/the price/NN/price of/IN/of a/DT/a tape/NN/tape cartridge/NN/cartridge is/VBZ/is lower/JJR/lower than/IN/than the/DT/the price/NN/price of/IN/of the/DT/the equivalent/NN/equivalent capacity/NN/capacity of/IN/of magnetic/JJ/magnetic disks/NNP/disks. so/RB/so tape/NN/tape is/VBZ/is an/DT/an economical/JJ/economical medium/NN/medium for/IN/for purposes/NNS/purposes that/WDT/that do/VBP/do not/RB/not require/VB/require fast/JJ/fast random/NN/random access/NNP/access. tapes/NNS/tapes are/VBP/are commonly/RB/commonly used/VBN/used to/TO/to hold/VB/hold backup/RP/backup copies/NNS/copies of/IN/of disk/NN/disk data/NNP/data. they/PRP/they are/VBP/are also/RB/also used/VBN/used in/IN/in large/JJ/large supercomputer/NN/supercomputer centers/NNS/centers to/TO/to hold/VB/hold the/DT/the enornwus/NN/enornwus volumes/VBZ/volumes of/IN/of data/NNS/data used/VBN/used in/IN/in scientific/JJ/scientific research/NN/research and/CC/and by/IN/by large/JJ/large commercial/JJ/commercial enterprises/NNS/enterprises /./. large/JJ/large tape/NN/tape installations/NNS/installations typically/RB/typically use/VB/use robotic/JJ/robotic tape/NN/tape changers/NNS/changers that/WDT/that move/NN/move tapes/VBZ/tapes between/IN/between tape/NN/tape drives/NNS/drives and/CC/and storage/NN/storage slots/NNS/slots in/IN/in a/DT/a tape/NN/tape library/NNP/library. these/DT/these mechanisms/NNS/mechanisms give/VBP/give the/DT/the computer/NN/computer automated/VBD/automated access/NN/access to/TO/to many/JJ/many tape/NN/tape cartridges/NNS/cartridges /./. a/DT/a robotic/JJ/robotic tape/NN/tape library/NN/library can/MD/can lower/JJR/lower the/DT/the overall/JJ/overall cost/NN/cost of/IN/of data/NNS/data storage/NNP/storage. a/DT/a diskresident/NN/diskresident file/NN/file that/WDT/that will/MD/will not/RB/not be/VB/be needed/VBN/needed for/IN/for a/DT/a while/NN/while can/MD/can be/VB/be to/TO/to tape/VB/tape /,/, where/WRB/where the/DT/the cost/NN/cost per/IN/per gigabyte/NN/gigabyte is/VBZ/is lower/JJR/lower ;/:/; if/IN/if the/DT/the file/NN/file is/VBZ/is needed/VBN/needed in/IN/in the/DT/the future/NN/future /,/, the/DT/the computer/NN/computer can/MD/can it/PRP/it back/RB/back into/IN/into disk/NN/disk storage/NN/storage for/IN/for active/JJ/active use/NNP/use. a/DT/a robotic/JJ/robotic tape/NN/tape library/NN/library is/VBZ/is 536/CD/536 chapter/NN/chapter 12/CD/12 sometimes/RB/sometimes called/VBN/called storage/NN/storage /,/, since/IN/since it/PRP/it is/VBZ/is between/IN/between the/DT/the high/JJ/high performance/NN/performance of/IN/of on-line/JJ/on-line magnetic/JJ/magnetic disks/NNS/disks and/CC/and the/DT/the low/JJ/low cost/NN/cost of/IN/of off-line/JJ/off-line tapes/NNS/tapes sitting/VBG/sitting on/IN/on shelves/NNS/shelves in/IN/in a/DT/a storage/NN/storage room/NN/room /./. 12.9.1.3/CD/12.9.1.3 future/JJ/future technology/NN/technology in/IN/in the/DT/the future/NN/future /,/, other/JJ/other storage/NN/storage technologies/NNS/technologies may/MD/may become/VB/become important/NNP/important. sometimes/RB/sometimes old/JJ/old technologies/NNS/technologies are/VBP/are used/VBN/used in/IN/in new/JJ/new ways/NNS/ways /,/, as/IN/as economics/NNS/economics change/VBP/change or/CC/or the/DT/the technologies/NNS/technologies evolve/NNP/evolve. for/IN/for example/NN/example /,/, solid-state/JJ/solid-state disks/NNS/disks /,/, or/CC/or are/VBP/are growing/VBG/growing in/IN/in importance/NN/importance and/CC/and becoming/VBG/becoming more/RBR/more common/NNP/common. simply/RB/simply described/VBD/described /,/, an/DT/an ssd/NN/ssd is/VBZ/is a/DT/a disk/NN/disk that/WDT/that is/VBZ/is used/VBN/used like/IN/like a/DT/a hard/JJ/hard drive/NNP/drive. depending/NN/depending on/IN/on the/DT/the memory/NN/memory technology/NN/technology used/VBD/used /,/, it/PRP/it can/MD/can be/VB/be volatile/JJ/volatile or/CC/or nonvolatile/NNP/nonvolatile. the/DT/the memory/NN/memory technology/NN/technology also/RB/also affects/VBZ/affects performance/NNP/performance. nonvolatile/NN/nonvolatile ssds/NNS/ssds have/VBP/have the/DT/the same/JJ/same characteristics/NNS/characteristics as/IN/as traditional/JJ/traditional hard/JJ/hard disks/NNS/disks but/CC/but can/MD/can be/VB/be more/RBR/more reliable/JJ/reliable because/IN/because they/PRP/they have/VBP/have no/DT/no moving/VBG/moving parts/NNS/parts and/CC/and faster/JJR/faster because/IN/because they/PRP/they have/VBP/have no/DT/no seek/NN/seek time/NN/time or/CC/or latency/NNP/latency. in/IN/in addition/NN/addition /,/, they/PRP/they use/VBP/use less/RBR/less energy/NNP/energy. however/RB/however /,/, they/PRP/they are/VBP/are more/RBR/more expensive/JJ/expensive per/NN/per megabyte/NN/megabyte than/IN/than traditional/JJ/traditional hard/JJ/hard disks/NNS/disks /,/, have/VBP/have lower/JJR/lower capacity/NN/capacity than/IN/than the/DT/the larger/JJR/larger hard/JJ/hard disks/NNS/disks /,/, and/CC/and may/MD/may have/VB/have shorter/NN/shorter life-spans/NNS/life-spans than/IN/than hard/JJ/hard disks/NNS/disks ;/:/; so/RB/so their/PRP$/their uses/NNS/uses are/VBP/are limited/NNP/limited. in/IN/in one/CD/one example/NN/example /,/, ssds/NNS/ssds are/VBP/are being/VBG/being used/VBN/used in/IN/in storage/NN/storage arrays/NNS/arrays to/TO/to hold/VB/hold metadata/NNS/metadata which/WDT/which requires/NNS/requires high-performance/VBP/high-performance such/JJ/such as/IN/as the/DT/the journal/NN/journal of/IN/of a/DT/a journaling/NN/journaling file/NN/file system/NNP/system. ssds/NNS/ssds are/VBP/are also/RB/also being/VBG/being added/VBN/added to/TO/to notebook/VB/notebook computers/NNS/computers to/TO/to make/VB/make them/PRP/them smaller/JJR/smaller /,/, faster/JJR/faster /,/, and/CC/and more/JJR/more energy/NN/energy efficient/NN/efficient /./. another/DT/another promising/NN/promising storage/NN/storage technology/NN/technology /,/, bologt/NN/bologt ;/:/; ;/:/; /:/: phk/NN/phk uses/NNS/uses laser/NN/laser light/NN/light to/TO/to record/VB/record holographic/JJ/holographic photographs/NNS/photographs on/IN/on special/JJ/special media/NNP/media. we/PRP/we can/MD/can think/VB/think of/IN/of a/DT/a hologram/NN/hologram as/IN/as a/DT/a three-dimensional/JJ/three-dimensional array/NN/array of/IN/of pixels/NNP/pixels. each/DT/each pixel/NN/pixel represents/VBZ/represents one/CD/one bit/NN/bit /:/: 0/-NONE-/0 for/IN/for black/JJ/black or/CC/or 1/CD/1 for/IN/for white/NNP/white. and/CC/and all/DT/all the/DT/the pixels/NNS/pixels in/IN/in a/DT/a hologram/NN/hologram are/VBP/are transferred/VBN/transferred in/IN/in one/CD/one flash/NN/flash of/IN/of laser/NN/laser light/NN/light /,/, so/RB/so the/DT/the data/NNS/data transfer/VBP/transfer rate/NN/rate is/VBZ/is extremely/RB/extremely high/NNP/high. with/IN/with continued/VBN/continued development/NN/development /,/, holographic/JJ/holographic storage/NN/storage may/MD/may become/VB/become commercially/RB/commercially viable/JJ/viable /./. another/DT/another technology/NN/technology under/IN/under active/JJ/active research/NN/research is/VBZ/is based/VBN/based on/IN/on /NNP/( iv/NN/iv !/./! e/NN/e \/:/\ 1s/CD/1s /CD/) /./. the/DT/the idea/NN/idea is/VBZ/is to/TO/to apply/RB/apply the/DT/the fabrication/NN/fabrication technologies/NNS/technologies that/WDT/that produce/NN/produce electronic/JJ/electronic chips/NNS/chips to/TO/to the/DT/the manufacture/NN/manufacture of/IN/of small/JJ/small datastorage/NN/datastorage machines/NNP/machines. one/CD/one proposal/NN/proposal calls/VBZ/calls for/IN/for the/DT/the fabrication/NN/fabrication of/IN/of an/DT/an array/NN/array of/IN/of 10,000/CD/10,000 tiny/JJ/tiny disk/NN/disk heads/NNS/heads /,/, with/IN/with a/DT/a square/JJ/square centimeter/NN/centimeter of/IN/of magnetic/JJ/magnetic storage/NN/storage material/NN/material suspended/VBD/suspended above/IN/above the/DT/the array/NNP/array. when/WRB/when the/DT/the storage/NN/storage material/NN/material is/VBZ/is moved/VBN/moved lengthwise/NN/lengthwise over/IN/over the/DT/the heads/NNS/heads /,/, each/DT/each head/NN/head accesses/NNS/accesses its/PRP$/its own/JJ/own linear/NN/linear track/NN/track of/IN/of data/NNS/data on/IN/on the/DT/the material/NNP/material. the/DT/the storage/NN/storage material/NN/material can/MD/can be/VB/be shifted/VBN/shifted sideways/NNS/sideways slightly/RB/slightly to/TO/to enable/JJ/enable all/DT/all the/DT/the heads/NNS/heads to/TO/to access/NN/access their/PRP$/their next/JJ/next track/NNP/track. although/IN/although it/PRP/it remains/VBZ/remains to/TO/to be/VB/be seen/VBN/seen whether/IN/whether this/DT/this technology/NN/technology can/MD/can be/VB/be successful/JJ/successful /,/, it/PRP/it may/MD/may provide/VB/provide a/DT/a nonvolatile/NN/nonvolatile data-storage/NN/data-storage technology/NN/technology that/IN/that is/VBZ/is faster/JJR/faster than/IN/than magnetic/JJ/magnetic disk/NN/disk and/CC/and cheaper/JJR/cheaper than/IN/than semiconductor/NN/semiconductor dram/NN/dram /./. whether/IN/whether the/DT/the storage/NN/storage medium/NN/medium is/VBZ/is a/DT/a removable/JJ/removable magnetic/JJ/magnetic disk/NN/disk /,/, a/DT/a dvd/NN/dvd /,/, or/CC/or a/DT/a 